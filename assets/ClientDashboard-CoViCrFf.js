import{r as n,j as e}from"./react-CrXOBDSJ.js";import{g as J,s as Q}from"./firebase-Drn0uAfr.js";import{y as _,z as K,G as X,H as Y,I as Z,D as ee}from"./@firebase-DgmhcEwT.js";import{d as I}from"./index-pOkjm1YA.js";import{L as te}from"./react-router-dom-9rcY47vU.js";import{N as se}from"./NotificationPanel-Cj7LHwXD.js";import{a as ie}from"./react-router-BxpCmtJ-.js";import{n as ae,g as oe,Q as L,m as E,b as ne,V as re,J as P,x as ce,W as le,M as de,C as me}from"./lucide-react-CCY59hBS.js";import{m as x}from"./framer-motion-BAPjnw1b.js";import"./core-js-ChGsxLo2.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./@remix-run-CjG9tKj3.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const he=()=>e.jsx("div",{className:"min-h-screen flex justify-center items-center relative",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})}),v=({title:i,value:u,subtext:m,icon:g,variants:p})=>e.jsxs(x.div,{variants:p,className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-300",children:i}),e.jsx("div",{className:"text-cyan-300",children:g})]}),e.jsx("p",{className:"text-3xl font-bold text-slate-50 mt-2",children:u}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:m})]}),b=({to:i,title:u,description:m,icon:g,variants:p})=>e.jsx(x.div,{variants:p,children:e.jsxs(te,{to:i,className:"group bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 rounded-lg p-4 flex items-center gap-4 transition-all duration-300",children:[e.jsx("div",{className:"bg-slate-700 group-hover:bg-cyan-500 text-cyan-400 group-hover:text-white p-3 rounded-lg transition-colors duration-300",children:g}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-slate-200",children:u}),e.jsx("p",{className:"text-sm text-slate-400",children:m})]}),e.jsx(me,{className:"text-slate-500 group-hover:text-white transition-colors duration-300"})]})}),Ue=()=>{const[i,u]=n.useState(null),[m,g]=n.useState(null),[p,T]=n.useState(!0),[M,h]=n.useState(""),[H,U]=n.useState(!1),[$,B]=n.useState(!1),[O,R]=n.useState(!1),j=ie(),N=J(),t=N.currentUser;n.useEffect(()=>{if(!t){console.log("ClientDashboard: Nessun utente autenticato, reindirizzamento a /login"),j("/login");return}console.log("ClientDashboard: Caricamento dati per UID:",t.uid,t.email);const s=navigator.userAgent,o=/iPad|iPhone|iPod/.test(s)&&!window.MSStream,r=/Android/.test(s);B(o),R(r),(o||r)&&!window.matchMedia("(display-mode: standalone)").matches&&U(!0);const W=async()=>{try{const c=_(I,"clients",t.uid),f=await K(c);f.exists()?(u(f.data()),console.log("ClientDashboard: Dati cliente:",f.data())):(h("Documento cliente non trovato."),console.log("ClientDashboard: Documento cliente non trovato per UID:",t.uid),j("/login"))}catch(c){console.error("ClientDashboard: Errore nel recupero del documento cliente:",c.code,c.message,{uid:t.uid,email:t.email}),h("Errore nel caricamento dei dati cliente: "+c.message),j("/login")}},F=()=>{const c=X(I,`clients/${t.uid}/checks`),f=Y(c,Z("createdAt","desc"));let S=0;return ee(f,l=>{var z,w;S++,console.log(`ClientDashboard: Snapshot #${S}, documenti:`,l.docs.length);try{const d=l.docs.map(A=>({id:A.id,...A.data()})),G=(w=(z=d[0])==null?void 0:z.createdAt)==null?void 0:w.toDate();g(G||null),d.length===0&&h("Nessun check-in disponibile. Carica il tuo primo check.")}catch(d){console.error("ClientDashboard: Errore nel caricamento dei check-in:",d.code,d.message,{uid:t.uid,email:t.email}),h("Errore nel caricamento dei check-in: "+(d.code==="permission-denied"?"Permessi insufficienti.":d.message))}},l=>{console.error("ClientDashboard: Errore snapshot check-in:",l.code,l.message,{uid:t.uid,email:t.email}),h("Errore nel caricamento dei check-in: "+(l.code==="permission-denied"?"Permessi insufficienti.":l.message))})};return W().finally(()=>T(!1)),F()},[t,j]);const V=()=>{Q(N).then(()=>{sessionStorage.removeItem("app_role"),console.log("ClientDashboard: Logout eseguito per UID:",t.uid),j("/login")}).catch(s=>{console.error("ClientDashboard: Errore durante il logout:",s.code,s.message),h("Errore durante il logout: "+s.message)})};if(p)return e.jsx(he,{});if(!i)return e.jsx("div",{className:"min-h-screen flex justify-center items-center p-8 relative",children:e.jsxs("p",{className:"text-center text-red-400 flex items-center gap-2",children:[e.jsx(ae,{size:18}),M||"Errore nel caricamento dei dati."]})});let C="N/D",D="Non impostata";if(i.scadenza&&i.scadenza.toDate){const s=i.scadenza.toDate(),o=new Date;s.setHours(23,59,59,999),o.setHours(0,0,0,0);const r=s-o;C=Math.max(0,Math.ceil(r/(1e3*60*60*24))),D=s.toLocaleDateString("it-IT")}let y="Nessun check registrato",k="Carica il tuo primo check!";if(m){const s=new Date;s.setHours(0,0,0,0);const o=new Date(m);o.setDate(o.getDate()+7);const r=Math.max(0,Math.ceil((o-s)/(1e3*60*60*24)));y=r===0?"Oggi":`${r} giorni`,k=`Prossimo check suggerito: ${o.toLocaleDateString("it-IT")}`}const q={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},a={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return e.jsx("div",{className:"min-h-screen text-slate-200 p-4 sm:p-8 relative",children:e.jsxs(x.div,{initial:"hidden",animate:"visible",variants:q,children:[e.jsxs(x.header,{variants:a,className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(se,{userType:"client"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-50",children:["Ciao, ",i.name,"!"]}),e.jsx("p",{className:"text-slate-300",children:"Benvenuto nella tua area personale."})]}),e.jsxs("button",{onClick:V,className:"flex items-center gap-2 px-3 py-2 bg-red-600/80 hover:bg-red-600 text-white text-sm font-semibold rounded-lg transition-colors",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:"Logout"})]})]}),H&&e.jsxs(x.div,{variants:a,className:"mb-6 space-y-3",children:[O&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-4 rounded-xl flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Aggiungi alla Schermata Home"}),e.jsxs("p",{className:"text-xs opacity-90",children:["Tocca ",e.jsx("strong",{children:"⋮ Menu → Aggiungi alla schermata home"})]})]})]}),e.jsx(E,{size:18})]}),$&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 rounded-xl flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Aggiungi alla Schermata Home"}),e.jsxs("p",{className:"text-xs opacity-90",children:["Tocca ",e.jsx("strong",{children:"Condividi → Aggiungi alla schermata Home"})]})]})]}),e.jsx(E,{size:18})]})]}),e.jsxs("main",{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(v,{title:"Scadenza Percorso",value:`${C} giorni`,subtext:`Scade il: ${D}`,icon:e.jsx(ne,{size:24}),variants:a}),e.jsx(v,{title:"Tipo Percorso",value:i.planType?i.planType.charAt(0).toUpperCase()+i.planType.slice(1):"Non specificato",subtext:"Il tuo piano attuale",icon:e.jsx(re,{size:24}),variants:a}),e.jsx(v,{title:"Prossimo Check",value:y,subtext:k,icon:e.jsx(P,{size:24}),variants:a})]}),e.jsxs(x.div,{variants:a,className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4 text-white",children:"Cosa vuoi fare?"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(b,{to:"/client/anamnesi",title:"La mia Anamnesi",description:"Visualizza o aggiorna i tuoi dati",icon:e.jsx(ce,{size:22}),variants:a}),e.jsx(b,{to:"/client/checks",title:"I miei Check",description:"Carica i tuoi progressi periodici",icon:e.jsx(P,{size:22}),variants:a}),e.jsx(b,{to:"/client/payments",title:"I miei Pagamenti",description:"Visualizza lo storico dei pagamenti",icon:e.jsx(le,{size:22}),variants:a}),e.jsx(b,{to:"/client/chat",title:"Chat con il Coach",description:"Invia un messaggio diretto",icon:e.jsx(de,{size:22}),variants:a})]})]})]})]})})};export{Ue as default};
