import{r as p,j as e}from"./react-CrXOBDSJ.js";import{z as fe,a0 as Ke,$ as Ve,N as Ge,A as F,D as te,B as xe,I as K,H as Qe,V as We,G as _e,P as Xe,J as Je,K as Ze}from"./@firebase-CuwLCerw.js";import{d as w,a as y}from"./index-D2WmDvAv.js";import{a as et}from"./react-router-BxpCmtJ-.js";import{m as M,A as pe}from"./framer-motion-BAPjnw1b.js";import{B as tt,a5 as at,a as st,C as rt,P as ae,X as ge,G as se,U as lt,v as he,p as nt,I as it}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Bp3EI6Ad.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const ot="BPBjZH1KnB4fCdqy5VobaJvb_mC5UTPKxodeIhyhl6PrRBZ1r6bd6nFqoloeDXSXKb4uffOVSupUGHQ4Q0l9Ato",ct=async f=>{try{if(!("Notification"in window))return console.log("Browser non supporta notifiche"),null;if(await Notification.requestPermission()!=="granted")return console.log("Permesso notifiche negato"),null;const u=fe(),S=await Ve(u,{vapidKey:ot});return S?(await Ge(F(w,"fcmTokens",f),{token:S,userId:f,updatedAt:new Date}),console.log("Token FCM ottenuto:",S),S):null}catch(l){return console.error("Errore richiesta permesso notifiche:",l),null}},dt=()=>"Notification"in window?Notification.permission:"not-supported",je=(f,l={})=>{if(Notification.permission==="granted"){const u=new Notification(f,{icon:"/icon-192.png",badge:"/icon-192.png",...l});return setTimeout(()=>u.close(),5e3),u}},mt=(f,l)=>{je("ðŸ“ž Chiamata imminente",{body:`${f} tra ${l} minuti`,tag:"upcoming-call",requireInteraction:!0,vibrate:[200,100,200]})},ut=f=>{const l=fe();return Ke(l,u=>{console.log("Messaggio ricevuto in foreground:",u),u.notification&&je(u.notification.title,{body:u.notification.body,icon:u.notification.icon,data:u.data}),f&&f(u)})},be=f=>{f.forEach(l=>{const[u,S]=l.time.split(":").map(Number),Y=new Date(l.date);Y.setHours(u,S,0,0);const k=new Date(Y.getTime()-30*60*1e3),C=new Date;if(k>C){const V=k.getTime()-C.getTime();setTimeout(()=>{mt(l.title,30)},V)}})};function zt(){var me,ue;const f=et(),[l,u]=p.useState(new Date),[S,Y]=p.useState([]),[k,C]=p.useState(null),[V,D]=p.useState(!1),[o,j]=p.useState({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[]}),[B,E]=p.useState(null),[ve,Ne]=p.useState(""),[P,ye]=p.useState(!1),[G,re]=p.useState(!1),[N,Q]=p.useState("month"),[xt,we]=p.useState([]),[A,W]=p.useState(!1),[T,_]=p.useState(null),[$,O]=p.useState(null),[m,q]=p.useState(null),[Se,U]=p.useState(!1),[le,X]=p.useState(!1),[a,b]=p.useState({name:"",number:"",email:"",source:"",note:"",date:"",time:""}),[De,I]=p.useState(!0);p.useEffect(()=>{if(!y.currentUser){f("/login");return}let t,s;return(async()=>{var h;const n=await xe(F(w,"collaboratori",y.currentUser.uid));n.exists()&&Ne(n.data().role||"");const c=await xe(F(w,"roles","admins")),i=c.exists()&&((h=c.data().uids)==null?void 0:h.includes(y.currentUser.uid));ye(i);const x=dt();re(x==="granted"),s=ut(g=>{console.log("Notifica ricevuta:",g)});let d;i?d=K(w,"calendarEvents"):d=K(w,"calendarEvents"),t=Qe(d,g=>{const L=g.docs.map(z=>({id:z.id,...z.data(),date:z.data().date}));Y(L);const v=new Date().toISOString().split("T")[0],H=L.filter(z=>z.date===v);x==="granted"&&H.length>0&&be(H)})})(),()=>{t&&t(),s&&s()}},[f]);const Me=t=>{const s=t.getFullYear(),r=t.getMonth(),n=new Date(s,r,1),i=new Date(s,r+1,0).getDate(),x=n.getDay(),d=[];for(let h=0;h<x;h++)d.push(null);for(let h=1;h<=i;h++)d.push(h);return d},R=t=>{const s=l.getFullYear(),r=String(l.getMonth()+1).padStart(2,"0"),n=String(t).padStart(2,"0");return`${s}-${r}-${n}`},J=t=>{if(!t)return[];const s=R(t);return S.filter(r=>r.date===s)},ne=t=>{const s=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${s}-${r}-${n}`},ke=t=>{const s=t.getDay(),r=new Date(t);return r.setHours(0,0,0,0),r.setDate(t.getDate()-s),r},Ce=t=>{const s=ke(t);return Array.from({length:7},(r,n)=>{const c=new Date(s);return c.setDate(s.getDate()+n),c})},ie=t=>{const s=ne(t);return S.filter(r=>r.date===s).sort((r,n)=>(r.time||"").localeCompare(n.time||""))},Ee=()=>{u(new Date(l.getFullYear(),l.getMonth()-1))},Te=()=>{u(new Date(l.getFullYear(),l.getMonth()+1))},$e=()=>{if(N==="month")return Ee();if(N==="week")return u(new Date(l.getFullYear(),l.getMonth(),l.getDate()-7));if(N==="day")return u(new Date(l.getFullYear(),l.getMonth(),l.getDate()-1))},Ie=()=>{if(N==="month")return Te();if(N==="week")return u(new Date(l.getFullYear(),l.getMonth(),l.getDate()+7));if(N==="day")return u(new Date(l.getFullYear(),l.getMonth(),l.getDate()+1))},Le=t=>{var s;t&&(C(t),D(!0),E(null),j({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[((s=y.currentUser)==null?void 0:s.uid)||""]}),I(!0))},Pe=async()=>{var t;if(!o.title||!o.time){alert("Inserisci titolo e ora");return}try{const s=R(k);let r=o.durationMinutes||30;if(o.endTime){const[n,c]=(o.time||"00:00").split(":").map(Number),[i,x]=(o.endTime||"00:00").split(":").map(Number),d=n*60+c,h=i*60+x;if(h<=d){alert("L'ora di fine deve essere successiva all'inizio");return}r=h-d}await We(K(w,"calendarEvents"),{title:o.title,time:o.time,type:o.type,note:o.note,durationMinutes:r,date:s,createdBy:y.currentUser.uid,participants:[],timestamp:new Date}),D(!1),j({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[((t=y.currentUser)==null?void 0:t.uid)||""]}),I(!0)}catch(s){console.error("Errore aggiunta evento:",s),alert("Errore nell'aggiungere l'evento")}},Ue=async()=>{var t;if(!(!B||!o.title||!o.time))try{let s=o.durationMinutes||30;if(o.endTime){const[r,n]=(o.time||"00:00").split(":").map(Number),[c,i]=(o.endTime||"00:00").split(":").map(Number),x=r*60+n,d=c*60+i;if(d<=x){alert("L'ora di fine deve essere successiva all'inizio");return}s=d-x}await te(F(w,"calendarEvents",B.id),{title:o.title,time:o.time,type:o.type,note:o.note,durationMinutes:s}),D(!1),E(null),j({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[((t=y.currentUser)==null?void 0:t.uid)||""]}),I(!0)}catch(s){console.error("Errore aggiornamento evento:",s)}},ze=async t=>{if(confirm("Eliminare questo evento?"))try{await _e(F(w,"calendarEvents",t))}catch(s){console.error("Errore eliminazione evento:",s)}},oe=t=>{var s;E(t),j({title:t.title,time:t.time,endTime:(()=>{const[r,n]=(t.time||"00:00").split(":").map(Number),c=r*60+n+(t.durationMinutes||30),i=String(Math.floor(c/60)).padStart(2,"0"),x=String(c%60).padStart(2,"0");return`${i}:${x}`})(),type:t.type||"call",note:t.note||"",durationMinutes:t.durationMinutes||30,participants:t.participants||[((s=y.currentUser)==null?void 0:s.uid)||""]})},Fe=async()=>{if(G)alert("Le notifiche sono attive! Puoi disattivarle dalle impostazioni del browser.");else if(await ct(y.currentUser.uid)){re(!0),alert("âœ… Notifiche attivate! Riceverai promemoria per le tue chiamate.");const s=new Date().toISOString().split("T")[0],r=S.filter(n=>n.date===s);r.length>0&&be(r)}else alert("âŒ Permesso notifiche negato. Abilitale dalle impostazioni del browser.")},Ae=new Intl.DateTimeFormat("it-IT",{month:"long",year:"numeric"}).format(l),Z=Ce(l),He=`${Z[0].toLocaleDateString("it-IT",{day:"2-digit",month:"short"})} - ${Z[6].toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})}`,Be=l.toLocaleDateString("it-IT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"}),Ye=Me(l),ee=new Date,ce=`${ee.getFullYear()}-${String(ee.getMonth()+1).padStart(2,"0")}-${String(ee.getDate()).padStart(2,"0")}`;p.useEffect(()=>{(async()=>{if(P)try{const s=await Xe(Je(K(w,"collaboratori"),Ze("nome")));we(s.docs.map(r=>({id:r.id,...r.data()||{}})))}catch(s){console.error("Errore caricamento collaboratori:",s)}})()},[P]);const de=()=>{var L;const t=new Date,s=t.getMinutes(),r=Math.ceil(s/15)*15;r===60&&t.setHours(t.getHours()+1);const n=String(t.getHours()).padStart(2,"0"),c=String(r===60?0:r).padStart(2,"0"),i=`${n}:${c}`,d=parseInt(n)*60+parseInt(c)+60,h=String(Math.floor(d/60)).padStart(2,"0"),g=String(d%60).padStart(2,"0");C(l.getDate()),E(null),j({title:"",time:i,endTime:`${h}:${g}`,type:"meeting",note:"",durationMinutes:60,participants:[((L=y.currentUser)==null?void 0:L.uid)||""]}),I(!1),D(!0)};return e.jsxs("div",{className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-50",children:"Calendario"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex items-center bg-slate-800/50 border border-slate-700 rounded-xl overflow-hidden text-xs sm:text-sm",children:[e.jsx("button",{onClick:()=>Q("month"),className:`px-3 py-1.5 ${N==="month"?"bg-slate-700 text-white":"text-slate-300 hover:text-white"}`,children:"Mese"}),e.jsx("button",{onClick:()=>Q("week"),className:`px-3 py-1.5 border-l border-slate-700 ${N==="week"?"bg-slate-700 text-white":"text-slate-300 hover:text-white"}`,children:"Settimana"}),e.jsx("button",{onClick:()=>Q("day"),className:`px-3 py-1.5 border-l border-slate-700 ${N==="day"?"bg-slate-700 text-white":"text-slate-300 hover:text-white"}`,children:"Giorno"})]}),e.jsx(M.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Fe,className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ${G?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/25":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 border border-slate-700"}`,children:G?e.jsxs(e.Fragment,{children:[e.jsx(tt,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Notifiche Attive"})]}):e.jsxs(e.Fragment,{children:[e.jsx(at,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Attiva Notifiche"})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:$e,className:"p-2 bg-slate-700/50 hover:bg-slate-700/70 text-slate-200 rounded-lg border border-slate-600",children:e.jsx(st,{size:20})}),e.jsx("span",{className:"text-xl font-semibold text-slate-200 min-w-[200px] text-center capitalize",children:N==="month"?Ae:N==="week"?He:Be}),e.jsx("button",{onClick:Ie,className:"p-2 bg-slate-700/50 hover:bg-slate-700/70 text-slate-200 rounded-lg border border-slate-600",children:e.jsx(rt,{size:20})}),e.jsx("button",{onClick:()=>u(new Date),className:"px-3 py-1.5 bg-slate-700/50 hover:bg-slate-700/70 text-slate-200 rounded-lg border border-slate-600 text-xs sm:text-sm",children:"Oggi"}),P&&e.jsxs(M.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:de,className:"hidden sm:flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all bg-gradient-to-r from-rose-600 to-pink-600 text-white shadow-lg shadow-rose-500/25",children:[e.jsx(ae,{className:"w-5 h-5"})," Nuovo evento"]})]})]})]}),P&&e.jsx("div",{className:"sm:hidden mb-4",children:e.jsxs("button",{onClick:de,className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl font-medium bg-gradient-to-r from-rose-600 to-pink-600 text-white",children:[e.jsx(ae,{className:"w-5 h-5"})," Nuovo evento"]})}),N==="month"&&e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl p-4 sm:p-6 border border-slate-700",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"].map(t=>e.jsx("div",{className:"text-center text-slate-400 font-semibold text-sm py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:Ye.map((t,s)=>{const r=t?R(t):"",n=t?J(t):[],c=r===ce;return e.jsx(M.div,{whileHover:t?{scale:1.02}:{},className:`min-h-[80px] sm:min-h-[100px] p-2 rounded-lg border transition-colors ${t?c?"bg-rose-900/30 border-rose-500/50 cursor-pointer hover:bg-rose-900/40":"bg-slate-700/50 border-slate-600 cursor-pointer hover:bg-slate-700/70":"bg-transparent border-transparent"}`,onClick:()=>Le(t),children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm font-semibold mb-1 ${c?"text-rose-300":"text-slate-200"}`,children:t}),e.jsxs("div",{className:"space-y-1",children:[n.slice(0,2).map(i=>e.jsxs("div",{onClick:x=>{i.type==="lead"&&(x.stopPropagation(),q(i),U(!0))},className:`text-[10px] sm:text-xs px-1.5 py-0.5 rounded truncate ${i.type==="lead"?"bg-emerald-600/80 text-emerald-100 cursor-pointer hover:bg-emerald-500/80":i.type==="call"?"bg-blue-600/80 text-blue-100":"bg-purple-600/80 text-purple-100"}`,title:i.title,children:[i.time," ",i.title]},i.id)),n.length>2&&e.jsxs("div",{className:"text-[10px] text-slate-400",children:["+",n.length-2]})]})]})},s)})})]}),N==="week"&&e.jsx("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl p-4 sm:p-6 border border-slate-700",children:e.jsx("div",{className:"grid grid-cols-7 gap-3",children:Z.map((t,s)=>{const r=ne(t),n=ie(t),c=r===ce;return e.jsxs("div",{className:`p-3 rounded-lg border ${c?"bg-rose-900/30 border-rose-500/50":"bg-slate-700/50 border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-2",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-200 capitalize",children:t.toLocaleDateString("it-IT",{weekday:"short"})}),e.jsx("div",{className:`text-sm font-bold ${c?"text-rose-300":"text-slate-100"}`,children:t.getDate()})]}),e.jsx("div",{className:"space-y-2",children:n.length===0?e.jsx("div",{className:"text-xs text-slate-400 italic",children:"Nessun evento"}):n.map(i=>e.jsxs("div",{onClick:()=>{i.type==="lead"&&(q(i),U(!0))},className:`px-2 py-1 rounded cursor-pointer ${i.type==="lead"?"bg-emerald-600/80 text-emerald-100 hover:bg-emerald-500/80":i.type==="call"?"bg-blue-600/80 text-blue-100":"bg-purple-600/80 text-purple-100"}`,title:i.title,children:[e.jsx("div",{className:"text-[11px] font-mono opacity-90",children:i.time}),e.jsx("div",{className:"text-xs truncate",children:i.title})]},i.id))})]},s)})})}),N==="day"&&e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl p-4 sm:p-6 border border-slate-700",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-slate-300 text-sm",children:l.toLocaleDateString("it-IT",{weekday:"long"})}),e.jsx("div",{className:"text-2xl font-bold text-slate-100",children:l.toLocaleDateString("it-IT")})]}),e.jsx("div",{className:"relative max-h-[70vh] overflow-auto rounded-lg border border-slate-700 select-none",onMouseUp:()=>{if(!A||T===null||$===null)return;const t=Math.min(T,$),s=Math.max(T,$)+15,r=String(Math.floor(t/60)).padStart(2,"0"),n=String(t%60).padStart(2,"0"),c=String(Math.floor(s/60)).padStart(2,"0"),i=String(s%60).padStart(2,"0");W(!1),_(null),O(null),C(l.getDate()),E(null),j({title:"",time:`${r}:${n}`,endTime:`${c}:${i}`,type:"meeting",note:"",durationMinutes:s-t}),I(!1),D(!0)},onMouseLeave:()=>{if(!A||T===null||$===null)return;const t=Math.min(T,$),s=Math.max(T,$)+15,r=String(Math.floor(t/60)).padStart(2,"0"),n=String(t%60).padStart(2,"0"),c=String(Math.floor(s/60)).padStart(2,"0"),i=String(s%60).padStart(2,"0");W(!1),_(null),O(null),C(l.getDate()),E(null),j({title:"",time:`${r}:${n}`,endTime:`${c}:${i}`,type:"meeting",note:"",durationMinutes:s-t}),I(!1),D(!0)},children:(()=>{const t=ie(l).map(r=>({...r,startMin:(()=>{const[n,c]=(r.time||"00:00").split(":").map(Number);return n*60+c})(),dur:r.durationMinutes||30})),s=Array.from({length:24},(r,n)=>n);return e.jsx("div",{children:s.map(r=>{const n=String(r).padStart(2,"0")+":00",c=r*60,i=[0,15,30,45];return e.jsxs("div",{className:"grid grid-cols-[70px,1fr] border-b border-slate-700/60",children:[e.jsx("div",{className:"px-2 py-4 text-xs text-slate-400 font-mono select-none cursor-pointer hover:text-slate-200",onClick:()=>{const x=c,d=c+60,h=String(Math.floor(x/60)).padStart(2,"0"),g=String(x%60).padStart(2,"0"),L=String(Math.floor(d/60)).padStart(2,"0"),v=String(d%60).padStart(2,"0");C(l.getDate()),E(null),j({title:"",time:`${h}:${g}`,endTime:`${L}:${v}`,type:"meeting",note:"",durationMinutes:d-x}),I(!1),D(!0)},children:n}),e.jsx("div",{className:"py-1 pr-2",children:e.jsx("div",{className:"grid grid-rows-4 gap-0.5",children:i.map(x=>{const d=c+x,h=t.filter(v=>d>=v.startMin&&d<v.startMin+v.dur),g=t.find(v=>v.startMin===d),L=A&&T!==null&&$!==null&&d>=Math.min(T,$)&&d<Math.max(T,$);return`${String(r).padStart(2,"0")}${String(x).padStart(2,"0")}`,e.jsxs("div",{className:`relative rounded ${L?"bg-rose-500/20":"bg-slate-900/20"} border border-slate-800/50 h-10`,onMouseDown:()=>{W(!0),_(d),O(d)},onMouseEnter:()=>{A&&O(d)},onMouseUp:()=>{},onClick:()=>{if(A)return;const v=d,H=d+30,z=String(Math.floor(v/60)).padStart(2,"0"),Oe=String(v%60).padStart(2,"0"),qe=String(Math.floor(H/60)).padStart(2,"0"),Re=String(H%60).padStart(2,"0");C(l.getDate()),E(null),j({title:"",time:`${z}:${Oe}`,endTime:`${qe}:${Re}`,type:"call",note:"",durationMinutes:H-v}),I(!1),D(!0)},children:[g&&e.jsxs("div",{className:`absolute inset-0 m-0.5 p-2 rounded-lg text-xs sm:text-sm shadow ${g.type==="lead"?"bg-emerald-600/80 text-emerald-100":g.type==="call"?"bg-blue-600/80 text-blue-100":"bg-purple-600/80 text-purple-100"}`,onClick:v=>{v.stopPropagation(),g.type==="lead"?(q(g),U(!0)):(oe(g),I(!1),D(!0))},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold truncate pr-2",children:g.title}),e.jsxs("div",{className:"text-[10px] opacity-90 font-mono",children:[g.time," Â· ",g.durationMinutes||30,"m"]})]}),g.note&&e.jsx("div",{className:"text-[11px] opacity-90 mt-1 truncate",children:g.note})]}),!g&&h.length>0&&e.jsx("div",{className:"absolute inset-y-0 left-0 right-0 mx-1 my-2 rounded bg-slate-200/10"})]},x)})})})]},r)})})})()})]}),e.jsx(pe,{children:V&&k&&e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs(M.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"bg-slate-900/95 rounded-2xl border border-slate-700 p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-slate-100",children:[R(k)," - ",new Date(l.getFullYear(),l.getMonth(),k).toLocaleDateString("it-IT",{weekday:"long"})]}),e.jsx("button",{onClick:()=>{D(!1),E(null)},className:"text-slate-400 hover:text-rose-400",children:e.jsx(ge,{size:24})})]}),De&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-3",children:"Eventi del giorno"}),e.jsx("div",{className:"space-y-2",children:J(k).length===0?e.jsx("p",{className:"text-slate-400 text-sm italic",children:"Nessun evento"}):J(k).map(t=>e.jsxs("div",{onClick:()=>{t.type==="lead"&&(q(t),U(!0))},className:`bg-slate-800/70 p-3 rounded-lg border border-slate-600 flex justify-between items-start ${t.type==="lead"?"cursor-pointer hover:bg-slate-800/90":""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.type==="lead"?e.jsx(se,{size:16,className:"text-emerald-400"}):t.type==="call"?e.jsx(se,{size:16,className:"text-blue-400"}):e.jsx(lt,{size:16,className:"text-purple-400"}),e.jsx("span",{className:"font-semibold text-slate-100",children:t.title}),e.jsx("span",{className:"text-sm text-slate-400",children:t.time}),t.type==="lead"&&e.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-300 px-2 py-0.5 rounded-full",children:"LEAD"})]}),t.note&&e.jsx("p",{className:"text-sm text-slate-300 mt-1",children:t.note}),t.type==="lead"&&t.leadData&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Click per dettagli â†’"})]}),t.type!=="lead"&&(P||ve)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>oe(t),className:"text-cyan-400 hover:text-cyan-300",title:"Modifica",children:e.jsx(he,{size:16})}),e.jsx("button",{onClick:()=>ze(t.id),className:"text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(nt,{size:16})})]})]},t.id))})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-4",children:B?"Modifica evento":"Nuovo evento"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:o.title,onChange:t=>j({...o,title:t.target.value}),placeholder:"Titolo evento",className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500"}),e.jsx("input",{type:"time",value:o.time,onChange:t=>j({...o,time:t.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500"}),e.jsx("input",{type:"time",value:o.endTime||"",onChange:t=>j({...o,endTime:t.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500",placeholder:"Ora fine"}),e.jsxs("select",{value:o.type,onChange:t=>j({...o,type:t.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500",children:[e.jsx("option",{value:"call",children:"Chiamata"}),e.jsx("option",{value:"meeting",children:"Riunione"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Durata"}),e.jsxs("select",{value:o.durationMinutes,onChange:t=>j({...o,durationMinutes:parseInt(t.target.value,10)}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500",children:[e.jsx("option",{value:15,children:"15 minuti"}),e.jsx("option",{value:30,children:"30 minuti"}),e.jsx("option",{value:45,children:"45 minuti"}),e.jsx("option",{value:60,children:"60 minuti"}),e.jsx("option",{value:90,children:"90 minuti"}),e.jsx("option",{value:120,children:"120 minuti"})]})]})}),e.jsx("textarea",{value:o.note,onChange:t=>j({...o,note:t.target.value}),placeholder:"Note (opzionale)",rows:"3",className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500"}),e.jsx("button",{onClick:B?Ue:Pe,className:"w-full bg-rose-600 hover:bg-rose-700 text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2",children:B?e.jsxs(e.Fragment,{children:[e.jsx(it,{size:20})," Salva Modifiche"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:20})," Aggiungi Evento"]})})]})]})]})})}),e.jsx(pe,{children:Se&&m&&e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>U(!1),children:e.jsxs(M.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:t=>t.stopPropagation(),className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl border border-emerald-500/30 shadow-2xl shadow-emerald-500/10 p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-emerald-500/20 rounded-xl",children:e.jsx(se,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-100",children:"Dettagli Lead"}),e.jsx("p",{className:"text-sm text-emerald-400",children:"Chiamata Programmata"})]})]}),e.jsx("button",{onClick:()=>U(!1),className:"text-slate-400 hover:text-rose-400 transition-colors",children:e.jsx(ge,{size:24})})]}),m.leadData&&!le&&e.jsxs("div",{className:"space-y-4",children:[!P&&m.createdBy!==(((me=y.currentUser)==null?void 0:me.uid)||"")&&e.jsx("div",{className:"text-xs text-amber-300 bg-amber-900/30 border border-amber-700/40 px-3 py-2 rounded-lg",children:"Solo lettura: non puoi modificare questo lead."}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Nome"}),e.jsx("p",{className:"text-lg font-semibold text-slate-100 mt-1",children:m.leadData.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Data"}),e.jsx("p",{className:"text-sm font-medium text-slate-100 mt-1",children:new Date(m.date).toLocaleDateString("it-IT")})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Ora"}),e.jsx("p",{className:"text-sm font-medium text-slate-100 mt-1",children:m.time})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Telefono"}),e.jsx("p",{className:"text-lg font-mono text-emerald-400 mt-1",children:m.leadData.number})]}),m.leadData.email&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Email"}),e.jsx("p",{className:"text-sm text-slate-100 mt-1",children:m.leadData.email})]}),m.leadData.source&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Provenienza"}),e.jsx("p",{className:"text-sm text-slate-100 mt-1",children:m.leadData.source})]}),m.leadData.note&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Note"}),e.jsx("p",{className:"text-sm text-slate-300 mt-1 whitespace-pre-wrap",children:m.leadData.note})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[(P||m.createdBy===(((ue=y.currentUser)==null?void 0:ue.uid)||""))&&e.jsxs(M.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{X(!0),b({name:m.leadData.name||"",number:m.leadData.number||"",email:m.leadData.email||"",source:m.leadData.source||"",note:m.leadData.note||"",date:m.date||"",time:m.time||""})},className:"w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-semibold py-3 rounded-xl shadow-lg shadow-emerald-500/25 flex items-center justify-center gap-2 transition-all",children:[e.jsx(he,{className:"w-5 h-5"}),"Modifica qui"]}),e.jsx(M.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{U(!1),f(P?"/collaboratori":"/collaboratore/dashboard")},className:"w-full bg-slate-800/60 hover:bg-slate-800 text-white border border-slate-700 font-semibold py-3 rounded-xl flex items-center justify-center gap-2 transition-all",children:"Apri in dashboard"})]})]}),m.leadData&&le&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Nome",value:a.name,onChange:t=>b({...a,name:t.target.value})}),e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Telefono",value:a.number,onChange:t=>b({...a,number:t.target.value})}),e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Email",value:a.email,onChange:t=>b({...a,email:t.target.value})}),e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Provenienza",value:a.source,onChange:t=>b({...a,source:t.target.value})}),e.jsx("textarea",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Note",rows:"3",value:a.note,onChange:t=>b({...a,note:t.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"date",className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:a.date,onChange:t=>b({...a,date:t.target.value})}),e.jsx("input",{type:"time",className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:a.time,onChange:t=>b({...a,time:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Dialed"}),e.jsx("input",{type:"number",min:"0",className:"w-full p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:a.dialed??0,onChange:t=>b({...a,dialed:parseInt(t.target.value||"0",10)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Importo (cash)"}),e.jsx("input",{type:"number",min:"0",className:"w-full p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:a.amount??"",onChange:t=>b({...a,amount:t.target.value===""?"":parseFloat(t.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Mesi"}),e.jsx("input",{type:"number",min:"0",className:"w-full p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:a.mesi??"",onChange:t=>b({...a,mesi:t.target.value===""?"":parseInt(t.target.value,10)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!a.offer,onChange:t=>b({...a,offer:t.target.checked})})," Offer"]}),e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!a.showUp,onChange:t=>b({...a,showUp:t.target.checked})})," Show Up"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!a.chiuso,onChange:t=>b({...a,chiuso:t.target.checked})})," Chiuso"]}),e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!a.riprenotato,onChange:t=>b({...a,riprenotato:t.target.checked})})," Riprenotato"]}),e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!a.settingCall,onChange:t=>b({...a,settingCall:t.target.checked})})," Setting Call"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!a.target,onChange:t=>b({...a,target:t.target.checked})})," Target"]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(M.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:async()=>{try{if(!m.leadId){alert("Lead non collegato (leadId mancante).");return}await te(F(w,"leads",m.leadId),{name:a.name,number:a.number,email:a.email,source:a.source,note:a.note,dataPrenotazione:a.date,oraPrenotazione:a.time,dialed:a.dialed??0,amount:a.amount===""?null:a.amount,mesi:a.mesi===""?null:a.mesi,chiuso:!!a.chiuso,showUp:!!a.showUp,offer:!!a.offer,riprenotato:!!a.riprenotato,target:!!a.target,settingCall:!!a.settingCall}),await te(F(w,"calendarEvents",m.id),{title:`ðŸ“ž ${a.name}`,date:a.date,time:a.time,leadData:{name:a.name,number:a.number,email:a.email,source:a.source,note:a.note}}),X(!1)}catch(t){console.error("Errore aggiornamento lead/evento:",t),alert("Errore nel salvataggio.")}},className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 rounded-xl",children:"Salva"}),e.jsx("button",{onClick:()=>X(!1),className:"flex-1 bg-slate-700/70 hover:bg-slate-700 text-white font-semibold py-3 rounded-xl",children:"Annulla"})]})]})]})})})]})}export{zt as default};
