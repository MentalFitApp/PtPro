import{h as E,r,T as O,V as j,j as e,aC as R,q as y,U as T,a3 as F,a0 as Y,a1 as q,W as w,aO as x,ax as D,Y as B}from"./.pnpm-C04Ba0Xq.js";import{t as H,d as u}from"./index-DdCoIfwr.js";function A(){const N=E(),[S,v]=r.useState([]),[p,b]=r.useState(null),[c,h]=r.useState(null),[C,M]=r.useState(!0);r.useEffect(()=>{const s=O(j(u,"clients"),o=>{const m=o.docs.map(t=>({id:t.id,...t.data()})),l={};m.forEach(t=>{const a=H(t.startDate);if(a){const i=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;l[i]||(l[i]={year:a.getFullYear(),month:a.getMonth()+1})}});const d=Object.keys(l).sort((t,a)=>new Date(a.split("-")[0],a.split("-")[1]-1)-new Date(t.split("-")[0],t.split("-")[1]-1));v(d),M(!1)});return()=>s()},[]);const I=async s=>{b(s),h(null);const[o,m]=s.split("-"),l=new Date(parseInt(o),parseInt(m)-1,1),d=new Date(parseInt(o),parseInt(m),1);try{const t=w(j(u,"clients"),x("startDate",">=",l),x("startDate","<",d)),i=(await D(t)).docs.map(n=>({id:n.id,...n.data()})),g=i.filter(n=>n.isOldClient).length,L=i.length-g,k=w(B(u,"payments"),x("paymentDate",">=",l),x("paymentDate","<",d)),z=(await D(k)).docs.filter(n=>!n.ref.parent.parent.data().isOldClient||!n.data().isPast).reduce((n,f)=>n+(f.data().amount||0),0);h({clients:i.length,renewals:g,newClients:L,income:z})}catch(t){console.error("Errore nel recupero stats mese:",t),h({clients:0,renewals:0,newClients:0,income:0})}};return C?e.jsx("div",{className:"flex justify-center items-center h-screen",children:"Caricamento..."}):e.jsxs("div",{className:"overflow-x-hidden w-full py-4 sm:py-6",children:[e.jsxs("button",{onClick:()=>N("/"),className:"flex items-center gap-2 mb-6 text-slate-400 hover:text-rose-500 mx-3 sm:mx-6",children:[e.jsx(R,{size:16})," Torna alla Dashboard"]}),e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-50 mb-6 mx-3 sm:mx-6",children:"Storico Business"}),e.jsx("div",{className:"space-y-4 mx-3 sm:mx-6",children:S.map(s=>e.jsx(y.div,{className:"bg-slate-800/60 backdrop-blur-sm p-4 rounded-lg cursor-pointer hover:bg-slate-700/70 border border-slate-700",onClick:()=>I(s),whileHover:{scale:1.02},children:e.jsx("h2",{className:"text-lg font-semibold text-slate-200",children:new Date(s.split("-")[0],s.split("-")[1]-1).toLocaleString("it-IT",{month:"long",year:"numeric"})})},s))}),p&&c&&e.jsxs(y.div,{className:"mt-8 space-y-4",initial:{opacity:0},animate:{opacity:1},children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-50",children:new Date(p.split("-")[0],p.split("-")[1]-1).toLocaleString("it-IT",{month:"long",year:"numeric"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{size:20,className:"text-blue-500"}),e.jsxs("p",{children:["Clienti del mese: ",c.clients]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:20,className:"text-green-500"}),e.jsxs("p",{children:["Clienti rinnovati: ",c.renewals]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{size:20,className:"text-amber-500"}),e.jsxs("p",{children:["Nuovi clienti: ",c.newClients]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{size:20,className:"text-green-500"}),e.jsxs("p",{children:["Incasso: â‚¬",c.income.toFixed(2)]})]})]})]})]})}export{A as default};
