import{r as c,j as e}from"./react-CrXOBDSJ.js";import{s as z,a as _,b as O}from"./firebase-Drn0uAfr.js";import{y as o,z as r}from"./@firebase-DgmhcEwT.js";import{a as p,d as l}from"./index-DGG2IrXP.js";import{a as F}from"./react-router-BxpCmtJ-.js";import{m as d}from"./framer-motion-BAPjnw1b.js";import{e as M,L as X,E as q,f as V}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const de=()=>{const[x,E]=c.useState(""),[D,I]=c.useState(""),[S,s]=c.useState(""),[R,P]=c.useState(!0),[b,A]=c.useState(!1),a=F();c.useEffect(()=>{const i=p.onAuthStateChanged(async t=>{if(t)try{const h=o(l,"roles","admins"),g=o(l,"roles","coaches"),v=o(l,"clients",t.uid),w=o(l,"collaboratori",t.uid),[m,u,n,f]=await Promise.all([r(h).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),r(g).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),r(v).catch(()=>({exists:()=>!1,data:()=>({})})),r(w).catch(()=>({exists:()=>!1,data:()=>({})}))]),y=m.exists()&&m.data().uids.includes(t.uid),j=u.exists()&&u.data().uids.includes(t.uid),N=n.exists()&&n.data().isClient===!0,C=f.exists();y?(sessionStorage.setItem("app_role","admin"),a("/")):j?(sessionStorage.setItem("app_role","coach"),a("/coach")):C?(sessionStorage.setItem("app_role","collaboratore"),a(f.data().firstLogin?"/collaboratore/first-access":"/collaboratore/dashboard")):N?(sessionStorage.setItem("app_role","client"),a(n.data().firstLogin?"/client/first-access":"/client/dashboard")):(s("Accesso non autorizzato. Contatta l'amministratore."),await z(p))}catch{s("Errore verifica ruolo. Riprova.")}P(!1)});return()=>i()},[a]);const k=async i=>{i.preventDefault(),s("");try{const t=await _(p,x,D),h=o(l,"roles","admins"),g=o(l,"roles","coaches"),v=o(l,"clients",t.user.uid),w=o(l,"collaboratori",t.user.uid),[m,u,n,f]=await Promise.all([r(h),r(g),r(v),r(w)]),y=m.exists()&&m.data().uids.includes(t.user.uid),j=u.exists()&&u.data().uids.includes(t.user.uid),N=n.exists()&&n.data().isClient===!0,C=f.exists();y?(sessionStorage.setItem("app_role","admin"),a("/")):j?(sessionStorage.setItem("app_role","coach"),a("/coach")):C?(sessionStorage.setItem("app_role","collaboratore"),a(f.data().firstLogin?"/collaboratore/first-access":"/collaboratore/dashboard")):N?(sessionStorage.setItem("app_role","client"),a(n.data().firstLogin?"/client/first-access":"/client/dashboard")):(s("Accesso non autorizzato. Contatta l'amministratore."),await z(p))}catch(t){t.code==="auth/wrong-password"?s("Password errata. Riprova o reimposta la password."):t.code==="auth/user-not-found"?s("Utente non trovato. Verifica l'email."):t.code==="auth/invalid-credential"?s("Credenziali non valide. Verifica email e password."):s("Errore login: "+t.message)}},L=async()=>{if(!x){s("Inserisci un'email per reimpostare la password.");return}try{await O(p,x),s("Email di reimpostazione inviata. Controlla la posta.")}catch(i){s("Errore invio email: "+i.message)}};return R?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-900",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-[#ef4444]"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-[#1b2735] to-[#090a0f] -z-10"}),e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs(d.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"relative w-full max-w-md z-10",children:[e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-1"}),e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-2"}),e.jsxs("div",{className:"relative bg-white/3 backdrop-blur-lg border border-white/8 rounded-3xl p-8 shadow-xl",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-1 opacity-30"}),e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-2 opacity-30"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(d.div,{className:"flex justify-center mb-8",children:e.jsxs("h1",{className:"text-4xl font-bold text-slate-100 relative",children:[e.jsx("span",{className:"relative z-10",children:"MentalFit"}),e.jsx(d.span,{className:"absolute inset-x-0 -bottom-1 h-1 bg-[#ef4444] rounded-full",initial:{scaleX:0,opacity:0},animate:{scaleX:1,opacity:[.6,1,.6]},transition:{scaleX:{duration:.8,ease:"easeOut"},opacity:{duration:2,repeat:1/0,ease:"easeInOut"}},style:{filter:"blur(4px)"}}),e.jsx(d.span,{className:"absolute inset-x-0 -bottom-2 h-2 bg-[#ef4444] rounded-full",animate:{opacity:[.3,.7,.3]},transition:{duration:2,repeat:1/0},style:{filter:"blur(8px)"}})]})}),e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsx("h2",{className:"text-xl font-medium text-slate-300",children:"Accedi al tuo account"})}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"email",value:x,onChange:i=>E(i.target.value),className:"w-full pl-12 pr-4 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"tuo@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:b?"text":"password",value:D,onChange:i=>I(i.target.value),className:"w-full pl-12 pr-14 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",onClick:()=>A(!b),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[#ef4444] transition-colors",children:b?e.jsx(q,{size:20}):e.jsx(V,{size:20})})]})]}),S&&e.jsx(d.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-[#ef4444] text-sm text-center font-medium",children:S}),e.jsx(d.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",className:"w-full py-4 bg-[#ef4444] hover:bg-[#dc2626] text-white font-bold rounded-xl shadow-lg hover:shadow-[#ef4444]/50 transition-all duration-300",children:"Accedi a MentalFit"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:L,className:"text-sm text-slate-400 hover:text-[#ef4444] transition-colors",children:"Password dimenticata?"})})]})]})]})})]})};export{de as default};
