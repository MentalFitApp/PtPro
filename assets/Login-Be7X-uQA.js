import{r as d,j as e}from"./react-CrXOBDSJ.js";import{s as R,a as M,b as X}from"./firebase-Bp3EI6Ad.js";import{A as i,B as r}from"./@firebase-CuwLCerw.js";import{a as p,d as l}from"./index-BoOldJoc.js";import{a as q}from"./react-router-BxpCmtJ-.js";import{m}from"./framer-motion-BAPjnw1b.js";import{e as V,L as B,E as H,f as T}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const fe=()=>{const[x,A]=d.useState(""),[S,L]=d.useState(""),[E,s]=d.useState(""),[P,k]=d.useState(!0),[C,_]=d.useState(!1),a=q();d.useEffect(()=>{const o=p.onAuthStateChanged(async t=>{var h,b;if(t)try{const g=i(l,"roles","admins"),D=i(l,"roles","coaches"),v=i(l,"clients",t.uid),w=i(l,"collaboratori",t.uid),[n,u,f,c]=await Promise.all([r(g).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),r(D).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),r(v).catch(()=>({exists:()=>!1,data:()=>({})})),r(w).catch(()=>({exists:()=>!1,data:()=>({})}))]),j=n.exists()&&n.data().uids.includes(t.uid),y=u.exists()&&u.data().uids.includes(t.uid),z=f.exists()&&f.data().isClient===!0,I=c.exists();if(console.log("ðŸ” Login check:",{uid:t.uid,isAdmin:j,isCoach:y,isClient:z,isCollaboratore:I,collabData:c.exists()?c.data():"N/A"}),j)sessionStorage.setItem("app_role","admin"),a("/");else if(y)sessionStorage.setItem("app_role","coach"),a("/coach");else if(I){sessionStorage.setItem("app_role","collaboratore");const N=((h=c.data())==null?void 0:h.firstLogin)===!0;console.log("ðŸ‘¤ Collaboratore login, firstLogin:",N),a(N?"/collaboratore/first-access":"/collaboratore/dashboard")}else if(z){sessionStorage.setItem("app_role","client");const N=((b=f.data())==null?void 0:b.firstLogin)===!0;a(N?"/client/first-access":"/client/dashboard")}else console.error("âŒ Nessun ruolo trovato per:",t.uid),s("Accesso non autorizzato. Contatta l'amministratore."),await R(p)}catch{s("Errore verifica ruolo. Riprova.")}k(!1)});return()=>o()},[a]);const F=async o=>{o.preventDefault(),s("");try{const t=await M(p,x,S),h=i(l,"roles","admins"),b=i(l,"roles","coaches"),g=i(l,"clients",t.user.uid),D=i(l,"collaboratori",t.user.uid),[v,w,n,u]=await Promise.all([r(h),r(b),r(g),r(D)]),f=v.exists()&&v.data().uids.includes(t.user.uid),c=w.exists()&&w.data().uids.includes(t.user.uid),j=n.exists()&&n.data().isClient===!0,y=u.exists();f?(sessionStorage.setItem("app_role","admin"),a("/")):c?(sessionStorage.setItem("app_role","coach"),a("/coach")):y?(sessionStorage.setItem("app_role","collaboratore"),a(u.data().firstLogin?"/collaboratore/first-access":"/collaboratore/dashboard")):j?(sessionStorage.setItem("app_role","client"),a(n.data().firstLogin?"/client/first-access":"/client/dashboard")):(s("Accesso non autorizzato. Contatta l'amministratore."),await R(p))}catch(t){t.code==="auth/wrong-password"?s("Password errata. Riprova o reimposta la password."):t.code==="auth/user-not-found"?s("Utente non trovato. Verifica l'email."):t.code==="auth/invalid-credential"?s("Credenziali non valide. Verifica email e password."):s("Errore login: "+t.message)}},O=async()=>{if(!x){s("Inserisci un'email per reimpostare la password.");return}try{await X(p,x),s("Email di reimpostazione inviata. Controlla la posta.")}catch(o){s("Errore invio email: "+o.message)}};return P?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-900",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-[#ef4444]"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-[#1b2735] to-[#090a0f] -z-10"}),e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs(m.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"relative w-full max-w-md z-10",children:[e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-1"}),e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-2"}),e.jsxs("div",{className:"relative bg-white/3 backdrop-blur-lg border border-white/8 rounded-3xl p-8 shadow-xl",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-1 opacity-30"}),e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-2 opacity-30"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(m.div,{className:"flex justify-center mb-8",children:e.jsxs("h1",{className:"text-4xl font-bold text-slate-100 relative",children:[e.jsx("span",{className:"relative z-10",children:"MentalFit"}),e.jsx(m.span,{className:"absolute inset-x-0 -bottom-1 h-1 bg-[#ef4444] rounded-full",initial:{scaleX:0,opacity:0},animate:{scaleX:1,opacity:[.6,1,.6]},transition:{scaleX:{duration:.8,ease:"easeOut"},opacity:{duration:2,repeat:1/0,ease:"easeInOut"}},style:{filter:"blur(4px)"}}),e.jsx(m.span,{className:"absolute inset-x-0 -bottom-2 h-2 bg-[#ef4444] rounded-full",animate:{opacity:[.3,.7,.3]},transition:{duration:2,repeat:1/0},style:{filter:"blur(8px)"}})]})}),e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsx("h2",{className:"text-xl font-medium text-slate-300",children:"Accedi al tuo account"})}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"email",value:x,onChange:o=>A(o.target.value),className:"w-full pl-12 pr-4 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"tuo@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:C?"text":"password",value:S,onChange:o=>L(o.target.value),className:"w-full pl-12 pr-14 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>_(!C),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[#ef4444] transition-colors",children:C?e.jsx(H,{size:20}):e.jsx(T,{size:20})})]})]}),E&&e.jsx(m.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-[#ef4444] text-sm text-center font-medium",children:E}),e.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",className:"w-full py-4 bg-[#ef4444] hover:bg-[#dc2626] text-white font-bold rounded-xl shadow-lg hover:shadow-[#ef4444]/50 transition-all duration-300",children:"Accedi a MentalFit"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:O,className:"text-sm text-slate-400 hover:text-[#ef4444] transition-colors",children:"Password dimenticata?"})})]})]})]})})]})};export{fe as default};
