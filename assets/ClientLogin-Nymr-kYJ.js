import{r as n,j as e}from"./react-FJB7Hj_2.js";import{L as k}from"./react-router-dom-udQfSOCw.js";import{s as L}from"./firebase-CiybzbB3.js";import{y as v,z as j}from"./@firebase-D5dUFubL.js";import{a as w,d as N}from"./index-C1w-7Ivh.js";import{a as I}from"./react-router-DF4cN2Hx.js";import{m as C}from"./framer-motion-Bo7GrDk8.js";import{b as P,c as R,d as D}from"./lucide-react-BYK_Rxhn.js";import"./papaparse-BHXrM2Hc.js";import"./react-dom-BrtcLnxQ.js";import"./scheduler-DYLXRpC5.js";import"./@remix-run-CjG9tKj3.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const S=()=>{const t=n.useRef(null),m=n.useRef(!1);return n.useEffect(()=>{if(m.current)return;let a=document.querySelector(".stars");if(a)t.current=a;else{a=document.createElement("div"),a.className="stars";let s=document.querySelector(".starry-background");s||(s=document.createElement("div"),s.className="starry-background",document.body.appendChild(s)),s.appendChild(a),t.current=a}for(let s=0;s<50;s++){const i=document.createElement("div");i.className="star",i.style.setProperty("--top-offset",`${Math.random()*100}vh`),i.style.setProperty("--fall-duration",`${8+Math.random()*6}s`),i.style.setProperty("--fall-delay",`${Math.random()*5}s`),i.style.setProperty("--star-width",`${1+Math.random()*2}px`),t.current.appendChild(i)}return m.current=!0,()=>{if(t.current)for(;t.current.firstChild;)t.current.removeChild(t.current.firstChild)}},[]),e.jsx("div",{className:"starry-background",children:e.jsx("div",{className:"stars"})})},X=()=>{const[t,m]=n.useState(""),[a,s]=n.useState(""),[i,u]=n.useState(""),[o,x]=n.useState(!1),[c,z]=n.useState(!0),p=I();n.useEffect(()=>{const l=w.onAuthStateChanged(async r=>{if(r){console.log("Utente autenticato all'avvio:",r.uid);const f=v(N,"clients",r.uid);try{const d=await j(f);d.exists()&&d.data().isClient===!0?(sessionStorage.setItem("app_role","client"),p(d.data().firstLogin?"/client/first-access":"/client/dashboard",{replace:!0})):u("Accesso non autorizzato. Area riservata ai clienti.")}catch(d){console.error("Errore nel recupero del documento cliente:",d),u("Errore nel verificare l'account cliente. Verifica i permessi o contatta il supporto.")}}z(!1)});return()=>l()},[p]);const E=async l=>{if(l.preventDefault(),o||c){console.log("Submit bloccato: giÃ  in corso o autenticazione in corso");return}u(""),x(!0),console.log("Tentativo di login con email:",t);try{const f=(await L(w,t,a)).user,d=v(N,"clients",f.uid),h=await j(d);if(h.exists()&&h.data().isClient===!0){sessionStorage.setItem("app_role","client");const A=h.data().firstLogin===!0;p(A?"/client/first-access":"/client/dashboard",{replace:!0})}else u("Accesso non autorizzato. Area riservata ai clienti.")}catch(r){console.error("Errore di login:",r.code,r.message),u(r.code==="auth/wrong-password"||r.code==="auth/user-not-found"?"Credenziali non valide. Riprova.":"Errore durante il login: "+r.message)}finally{x(!1)}};if(c)return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 sm:p-8",children:[e.jsx(S,{}),e.jsxs("div",{className:"flex flex-col justify-center items-center text-slate-200",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-500"}),e.jsx("p",{className:"mt-4 text-sm",children:"Verifica autenticazione..."})]})]});const g="relative",y="w-full p-3 pl-10 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 transition-all text-slate-200",b="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400";return e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 sm:p-8",children:[e.jsx(S,{}),e.jsxs(C.div,{className:"w-full max-w-md bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-8 space-y-8 shadow-2xl shadow-black/20",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{duration:.5,ease:"easeInOut"},children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-50",children:"Area Clienti"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Accedi con le credenziali fornite dal tuo coach."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{className:g,children:[e.jsx(P,{size:18,className:b}),e.jsx("input",{type:"email",value:t,onChange:l=>m(l.target.value),required:!0,placeholder:"Email",className:y,autoComplete:"email",disabled:o||c})]}),e.jsxs("div",{className:g,children:[e.jsx(R,{size:18,className:b}),e.jsx("input",{type:"password",value:a,onChange:l=>s(l.target.value),required:!0,placeholder:"Password",className:y,autoComplete:"current-password",disabled:o||c})]}),i&&e.jsx("p",{className:"text-red-500 text-sm text-center",children:i}),e.jsx("div",{children:e.jsxs(C.button,{type:"submit",disabled:o||c,className:"w-full flex items-center justify-center gap-2 px-4 py-3 font-bold text-white bg-cyan-600 rounded-lg hover:bg-cyan-700 transition-colors disabled:bg-cyan-900 disabled:cursor-not-allowed",whileHover:{scale:o||c?1:1.02},whileTap:{scale:o||c?1:.98},transition:{duration:.2},children:[e.jsx(D,{size:18}),o?"Accesso in corso...":"Accedi"]})})]}),e.jsx("div",{className:"text-center",children:e.jsx(k,{to:"/client/forgot-password",className:"text-sm text-slate-400 hover:text-cyan-400 hover:underline transition-colors",children:"Password dimenticata?"})})]})]})};export{X as default};
