import{r as c,j as e}from"./react-CrXOBDSJ.js";import{H as u,G as j,D as f,y as q,z as B}from"./@firebase-DgmhcEwT.js";import{a as R,d as p}from"./index-DGG2IrXP.js";import{g as Z,a as H}from"./react-router-BxpCmtJ-.js";import{m as x}from"./framer-motion-BAPjnw1b.js";import{b as Y,T as F,G as S,n as $,F as J}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Drn0uAfr.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";function fe(){const{date:l}=Z(),m=H(),[g,k]=c.useState([]),[C,D]=c.useState([]),[T,E]=c.useState([]),[P,U]=c.useState(!0),[N,z]=c.useState("");if(c.useEffect(()=>{if(!R.currentUser){m("/login");return}(async()=>{try{const s=q(p,"roles","admins"),a=await B(s);if(!a.exists()||!a.data().uids.includes(R.currentUser.uid)){m("/collaboratori");return}}catch(s){console.error("Errore verifica ruolo admin:",s),m("/collaboratori")}})();const r=u(j(p,"collaboratori")),d=f(r,s=>{const a=s.docs.map(o=>({id:o.id,...o.data()}));k(a)},s=>{console.error("Errore snapshot collaboratori:",s),z("Errore nel recupero dei collaboratori: "+s.message)}),b=u(j(p,"settingReports")),I=f(b,s=>{const a=s.docs.map(o=>({id:o.id,...o.data()}));D(a)}),G=u(j(p,"salesReports")),Q=f(G,s=>{const a=s.docs.map(o=>({id:o.id,...o.data()}));E(a)});return U(!1),()=>{d(),I(),Q()}},[m,l]),P)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-rose-500"})});if(N)return e.jsx("div",{className:"min-h-screen flex items-center justify-center text-red-500",children:e.jsx("p",{children:N})});const[A,L,O]=l.split("-").map(Number),M=new Date(A,L-1,O),V=new Intl.DateTimeFormat("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(M),h=new Date,y=[h.getFullYear(),String(h.getMonth()+1).padStart(2,"0"),String(h.getDate()).padStart(2,"0")].join("-"),v=g.map(t=>{var d;const r=(d=t.dailyReports)==null?void 0:d.find(b=>b.date===l);return r?{id:t.id,name:t.name||t.email.split("@")[0],role:t.role||"N/D",photoURL:t.photoURL||"/default-avatar.png",gender:t.gender||"M",report:r}:null}).filter(Boolean).sort((t,r)=>t.name.localeCompare(r.name)),i=C.find(t=>t.date===l),n=T.find(t=>t.date===l),w=t=>{if(!t)return"Sconosciuto";const r=g.find(d=>d.id===t);return r?r.name||r.email.split("@")[0]:"Sconosciuto"};return e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 sm:p-6 max-w-7xl mx-auto",children:[e.jsxs(x.header,{className:"flex justify-between items-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-50 flex items-center gap-3",children:[e.jsx(Y,{size:32})," Report del ",V]}),e.jsx("button",{onClick:()=>m("/collaboratori"),className:"px-6 py-3 bg-rose-600 hover:bg-rose-700 text-white rounded-xl transition-all font-medium",children:"Torna ai Collaboratori"})]}),e.jsxs(x.div,{className:"space-y-8",children:[i&&e.jsxs(x.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"glass-card p-8 bg-gradient-to-br from-cyan-900/40 to-blue-900/40 border border-cyan-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-cyan-300 flex items-center gap-3",children:[e.jsx(F,{size:28})," Report Setting"]}),e.jsxs("div",{className:"text-sm text-cyan-200",children:["Compilato da: ",e.jsx("span",{className:"font-bold",children:w(i.uid)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-5 text-center",children:[e.jsxs("div",{className:"p-5 bg-slate-800/60 rounded-xl border border-cyan-500/30",children:[e.jsx("p",{className:"text-cyan-400 font-medium text-sm",children:"Follow-ups"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:i.followUpsFatti||0})]}),e.jsxs("div",{className:"p-5 bg-slate-800/60 rounded-xl border border-cyan-500/30",children:[e.jsx("p",{className:"text-cyan-400 font-medium text-sm",children:"Dialed"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:i.dialedFatti||0})]}),e.jsxs("div",{className:"p-5 bg-green-900/30 rounded-xl border border-green-500/40",children:[e.jsx("p",{className:"text-green-400 font-medium text-sm",children:"Risposte"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:i.dialedRisposte||0})]}),e.jsxs("div",{className:"p-5 bg-rose-900/30 rounded-xl border border-rose-500/40",children:[e.jsx("p",{className:"text-rose-400 font-medium text-sm",children:"Prenotate"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:i.chiamatePrenotate||0})]})]})]}),n&&e.jsxs(x.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},className:"glass-card p-8 bg-gradient-to-br from-rose-900/40 to-purple-900/40 border border-rose-500/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-rose-300 flex items-center gap-3",children:[e.jsx(S,{size:28})," Report Vendita"]}),e.jsxs("div",{className:"text-sm text-rose-200",children:["Compilato da: ",e.jsx("span",{className:"font-bold",children:w(n.uid)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-5 text-center",children:[e.jsxs("div",{className:"p-5 bg-slate-800/60 rounded-xl border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-medium text-sm",children:"Call Fissate"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:n.chiamateFissate||0})]}),e.jsxs("div",{className:"p-5 bg-slate-800/60 rounded-xl border border-rose-500/30",children:[e.jsx("p",{className:"text-rose-400 font-medium text-sm",children:"Call Fatte"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:n.chiamateFatte||0})]}),e.jsxs("div",{className:"p-5 bg-yellow-900/30 rounded-xl border border-yellow-500/40",children:[e.jsx("p",{className:"text-yellow-400 font-medium text-sm",children:"Offer"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:n.offersFatte||0})]}),e.jsxs("div",{className:"p-5 bg-green-900/30 rounded-xl border border-green-500/40",children:[e.jsx("p",{className:"text-green-400 font-medium text-sm",children:"Chiuse"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:n.chiuse||0})]}),e.jsxs("div",{className:"p-5 bg-purple-900/30 rounded-xl border border-purple-500/40",children:[e.jsx("p",{className:"text-purple-400 font-medium text-sm",children:"Cash"}),e.jsxs("p",{className:"text-3xl font-bold text-white mt-2",children:["€",n.cash||0]})]})]})]}),v.length===0?e.jsxs("div",{className:"glass-card p-12 text-center",children:[e.jsx($,{size:80,className:"mx-auto text-yellow-500 mb-6 opacity-80"}),e.jsx("p",{className:"text-slate-300 text-xl font-medium",children:l<y?"Nessun report inviato per questa data passata.":"Nessun report inviato per oggi."}),l<y&&e.jsx("p",{className:"text-red-400 text-2xl font-bold mt-4",children:"GIORNATA SENZA REPORT"})]}):v.map((t,r)=>e.jsxs(x.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{delay:r*.1},className:"glass-card p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8 pb-6 border-b border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:t.photoURL,alt:t.name,className:"w-16 h-16 rounded-full border-2 border-rose-500 object-cover"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-200",children:t.name}),e.jsx("p",{className:"text-slate-400 text-lg",children:t.role})]})]}),e.jsx("div",{className:`px-6 py-3 rounded-full text-lg font-bold ${t.report.tracker?"bg-gradient-to-r from-green-600 to-emerald-600 text-white":"bg-gradient-to-r from-yellow-600 to-orange-600 text-white"}`,children:t.report.tracker?"COMPLETO":"PARZIALE"})]}),t.report.tracker&&e.jsxs("div",{className:"p-8 bg-gradient-to-br from-zinc-900/90 to-zinc-800/90 rounded-2xl border border-purple-500/30",children:[e.jsxs("h3",{className:"text-2xl font-bold text-purple-400 flex items-center gap-3 mb-6",children:[t.role==="Marketing"&&e.jsx(J,{size:28}),t.role==="Vendita"&&e.jsx(S,{size:28}),t.role==="Setter"&&e.jsx(F,{size:28}),"Tracker DMS (",t.role,")"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-5",children:[t.role==="Setter"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 bg-slate-800/60 rounded-xl border border-cyan-500/30 text-center",children:[e.jsx("p",{className:"text-cyan-400 font-medium text-sm",children:"Outreach Totale"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.outreachTotale||0})]}),e.jsxs("div",{className:"p-5 bg-slate-800/60 rounded-xl border border-cyan-500/30 text-center",children:[e.jsx("p",{className:"text-cyan-400 font-medium text-sm",children:"Follow-Ups Totali"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.followUpsTotali||0})]}),e.jsxs("div",{className:"p-5 bg-green-900/30 rounded-xl border border-green-500/40 text-center",children:[e.jsx("p",{className:"text-green-400 font-medium text-sm",children:"Risposte"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.risposte||0})]}),e.jsxs("div",{className:"p-5 bg-rose-900/30 rounded-xl border border-rose-500/40 text-center",children:[e.jsx("p",{className:"text-rose-400 font-medium text-sm",children:"Call Prenotate"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.callPrenotate||0})]})]}),t.role==="Marketing"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 bg-rose-900/40 rounded-xl border border-rose-500/50 text-center col-span-2",children:[e.jsx("p",{className:"text-rose-400 font-semibold text-lg",children:"Views 24h"}),e.jsx("p",{className:"text-5xl font-bold text-white mt-3",children:t.report.tracker.volumeViews24h||0})]}),e.jsxs("div",{className:"p-6 bg-green-900/40 rounded-xl border border-green-500/50 text-center col-span-2",children:[e.jsx("p",{className:"text-green-400 font-semibold text-lg",children:"Leads 24h"}),e.jsx("p",{className:"text-5xl font-bold text-white mt-3",children:t.report.tracker.volumeLeads24h||0})]})]}),t.role==="Vendita"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-5 bg-cyan-900/40 rounded-xl border border-cyan-500/50 text-center",children:[e.jsx("p",{className:"text-cyan-400 font-semibold",children:"Call Prenotate"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.callPrenotate||0})]}),e.jsxs("div",{className:"p-5 bg-green-900/40 rounded-xl border border-green-500/50 text-center",children:[e.jsx("p",{className:"text-green-400 font-semibold",children:"Call Fatte"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.callFatte||0})]}),e.jsxs("div",{className:"p-5 bg-yellow-900/40 rounded-xl border border-yellow-500/50 text-center",children:[e.jsx("p",{className:"text-yellow-400 font-semibold",children:"Offer Fatte"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.offerFatte||0})]}),e.jsxs("div",{className:"p-5 bg-rose-900/40 rounded-xl border border-rose-500/50 text-center",children:[e.jsx("p",{className:"text-rose-400 font-semibold",children:"Chiuse"}),e.jsx("p",{className:"text-3xl font-bold text-white mt-2",children:t.report.tracker.chiuse||0})]}),e.jsxs("div",{className:"p-5 bg-purple-900/40 rounded-xl border border-purple-500/50 text-center col-span-2",children:[e.jsx("p",{className:"text-purple-400 font-semibold text-lg",children:"Cash"}),e.jsxs("p",{className:"text-4xl font-bold text-white mt-2",children:["€",t.report.tracker.cash||0]})]})]})]})]})]},t.id))]})]})}export{fe as default};
