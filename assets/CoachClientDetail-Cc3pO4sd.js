var G=Object.defineProperty;var M=(t,a,n)=>a in t?G(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n;var A=(t,a,n)=>M(t,typeof a!="symbol"?a+"":a,n);import{E as W,h as X,k as Q,r as o,j as e,q as m,U as Z,aC as _,e as R,f as U,W as J,V as K,X as Y,T as ee,bb as se,bc as te,A as ae,av as ie}from"./.pnpm-C04Ba0Xq.js";import{n as T}from"./normalizePhotoURLs-D7k3b5VC.js";import{a as ne,t as v,d as k}from"./index-DdCoIfwr.js";class O extends o.Component{constructor(){super(...arguments);A(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(n){return{hasError:!0,error:n}}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-slate-900 text-red-400 flex justify-center items-center p-4",children:e.jsxs("p",{children:["Errore: ",this.state.error.message]})}):this.props.children}}const le=({src:t,onClose:a})=>e.jsx(ae,{children:t&&e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[1000] p-4",onClick:a,children:[e.jsx(m.img,{src:t,alt:"Ingrandita",className:"max-w-full max-h-full object-contain rounded-lg",initial:{scale:.8},animate:{scale:1},onClick:n=>n.stopPropagation()}),e.jsx("button",{onClick:a,className:"absolute top-4 right-4 text-white bg-slate-700/70 rounded-full p-2 hover:bg-slate-700",children:e.jsx(ie,{size:24})})]})}),re=({title:t,data:a,photoURLs:n,onImageClick:h,variants:x})=>{const[r,j]=o.useState({});return o.useEffect(()=>{(async()=>{if(!n)return;const l=Object.entries(n).map(([s,f])=>[s,f]);j(Object.fromEntries(l))})()},[n]),e.jsxs(m.div,{variants:x,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-cyan-300",children:t}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:Object.entries(a).map(([i,l])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-400",children:[i,":"]}),e.jsx("span",{className:"text-slate-200 font-medium",children:l||"N/D"})]},i))}),n&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Foto Anamnesi"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:["front","back","left","right"].map(i=>r[i]?e.jsx(m.img,{src:r[i],alt:i,className:"w-full h-40 object-cover rounded-lg cursor-pointer",onClick:()=>h(r[i]),whileHover:{scale:1.05}},i):e.jsx("div",{className:"w-full h-40 bg-slate-800 rounded-lg flex items-center justify-center text-xs text-slate-500",children:"Nessuna foto"},i))})]})]})},oe=({check:t,onImageClick:a,variants:n})=>{const[h,x]=o.useState({}),[r,j]=o.useState(!0);o.useEffect(()=>{(async()=>{if(!t.photoURLs)return;const s=Object.entries(t.photoURLs).map(([f,y])=>[f,y]);x(Object.fromEntries(s))})()},[t.photoURLs]);const i=v(t.createdAt);return e.jsxs(m.div,{variants:n,className:"p-4 rounded-lg bg-slate-700/50 border border-slate-600",children:[e.jsxs("p",{className:"text-sm font-semibold text-cyan-300 mb-2",children:["Check del ",i?i.toLocaleDateString("it-IT"):"N/D"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Peso:"}),e.jsxs("span",{className:"ml-2 font-medium text-white",children:[t.weight||"N/D"," kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium text-white",children:i?i.toLocaleString("it-IT"):"N/D"})]})]}),t.notes&&e.jsxs("p",{className:"mt-3 text-sm text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",t.notes]}),t.photoURLs&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{onClick:()=>j(l=>!l),className:"bg-slate-700 text-white px-2 py-1 rounded hover:bg-slate-700 transition",title:r?"Restringi sezione foto":"Espandi sezione foto",children:r?e.jsx(se,{size:18}):e.jsx(te,{size:18})}),e.jsx("span",{className:"text-xs text-slate-400",children:r?"Nascondi foto":"Mostra foto check"})]}),r&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:["front","back","left","right"].map(l=>h[l]?e.jsx(m.img,{src:h[l],alt:l,className:"w-full h-80 object-cover rounded-xl cursor-pointer",style:{maxHeight:"calc(92vh - 220px)"},onClick:()=>a(h[l]),whileHover:{scale:1.03}},l):e.jsx("div",{className:"w-full h-80 bg-slate-700 rounded-xl flex items-center justify-center text-xs text-slate-500",children:"Nessuna foto"},l))})]})]})};function ue(){var S,L,P;const t=W(),a=X(),n=Q(),[h,x]=o.useState(null),[r,j]=o.useState(null),[i,l]=o.useState([]),[s,f]=o.useState(null),[y,b]=o.useState(!0),[I,w]=o.useState(null),[p,C]=o.useState("info"),g=t.clientId||(()=>{const c=n.pathname.match(/\/coach\/client\/([a-zA-Z0-9_-]+)/);return c?c[1]:null})();o.useEffect(()=>{if(!ne.currentUser){a("/login");return}if(!g){w("ID cliente non valido"),b(!1);return}(async()=>{try{const N=R(k,"clients",g),E=await U(N);if(!E.exists()){w("Cliente non trovato"),b(!1);return}j({id:g,...E.data()});const H=R(k,"clients",g,"anamnesi","initial"),z=await U(H);if(z.exists()){let d=z.data();d.photoURLs&&(d.photoURLs=T(d.photoURLs),console.debug("[CoachClientDetail] Anamnesi photoURLs normalized:",d.photoURLs)),f(d)}else f(null);const V=J(K(k,"clients",g,"checks"),Y("createdAt","desc")),q=ee(V,d=>{const B=d.docs.map(u=>({id:u.id,...u.data()})).map(u=>(u.photoURLs&&(u.photoURLs=T(u.photoURLs)),u));console.debug("[CoachClientDetail] Checks photoURLs normalized"),l(B),b(!1)},d=>{console.error("Error loading checks:",d),w("Errore caricamento check"),b(!1)});return()=>q()}catch{w("Errore caricamento dati"),b(!1)}})()},[g,a]);const F={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},D={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};if(I)return e.jsx(O,{children:e.jsx("div",{className:"min-h-screen bg-slate-900 text-red-400 flex justify-center items-center p-4",children:e.jsx("p",{children:I})})});if(y)return e.jsx("div",{className:"min-h-screen flex justify-center items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})});const $=c=>{if(!c)return"N/D";const N=(v(c)-new Date)/(1e3*60*60*24);return N<0?"Scaduto":N<=7?"In scadenza":"Attivo"};return e.jsx(O,{children:e.jsx("div",{className:"overflow-x-hidden w-full min-h-screen",children:e.jsxs(m.div,{initial:"hidden",animate:"visible",variants:F,className:"w-full py-4 sm:py-6",children:[e.jsxs(m.header,{variants:D,className:"flex justify-between items-center mb-8 mx-3 sm:mx-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-50 flex items-center gap-2",children:[e.jsx(Z,{size:28})," ",r.name||"Cliente"]}),e.jsxs("button",{onClick:()=>a("/coach/clients"),className:"flex items-center gap-2 px-3 py-2 bg-slate-700 hover:bg-slate-700 text-slate-300 rounded-lg",children:[e.jsx(_,{size:16})," Indietro"]})]}),e.jsxs(m.div,{variants:D,className:"bg-slate-900/60 backdrop-blur-xl rounded-2xl border border-slate-700 p-6 mx-3 sm:mx-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6 bg-slate-800/70 p-1 rounded-lg border border-white/10",children:[e.jsx("button",{onClick:()=>C("info"),className:`px-4 py-2 text-sm rounded-md ${p==="info"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Info"}),e.jsxs("button",{onClick:()=>C("check"),className:`px-4 py-2 text-sm rounded-md ${p==="check"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:["Check (",i.length,")"]}),e.jsx("button",{onClick:()=>C("anamnesi"),className:`px-4 py-2 text-sm rounded-md ${p==="anamnesi"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Anamnesi"})]}),p==="info"&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Email:"}),e.jsx("span",{className:"font-medium text-white",children:r.email||"N/D"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Inizio:"}),e.jsx("span",{className:"font-medium text-white",children:((S=v(r.startDate))==null?void 0:S.toLocaleDateString("it-IT"))||"N/D"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Scadenza:"}),e.jsx("span",{className:"font-medium text-white",children:((L=v(r.scadenza))==null?void 0:L.toLocaleDateString("it-IT"))||"N/D"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Stato:"}),e.jsx("span",{className:"font-medium text-white",children:$(r.scadenza)})]})]}),p==="check"&&e.jsx("div",{className:"space-y-4",children:i.length>0?i.map(c=>e.jsx(oe,{check:c,onImageClick:x,variants:D},c.id)):e.jsx("p",{className:"text-center text-slate-400 py-8",children:"Nessun check"})}),p==="anamnesi"&&e.jsx("div",{children:s?e.jsx(re,{title:"Anamnesi Iniziale",data:{Nome:s.firstName,Cognome:s.lastName,"Data di Nascita":s.birthDate,Lavoro:s.job,Peso:s.weight?`${s.weight} kg`:"N/D",Altezza:s.height?`${s.height} cm`:"N/D","Pasti al Giorno":s.mealsPerDay,"Tipo Colazione":s.breakfastType,"Alimenti Preferiti":s.desiredFoods,"Alimenti da Evitare":s.dislikedFoods,"Allergie/Intolleranze":s.intolerances,"Problemi di Digestione":s.digestionIssues,"Allenamenti a Settimana":s.workoutsPerWeek,"Dettagli Allenamento":s.trainingDetails,"Orario e Durata":s.trainingTime,Infortuni:s.injuries,Farmaci:s.medications,Integratori:s.supplements,"Obiettivo Principale":s.mainGoal,"Durata Percorso":s.programDuration,"Data Invio":s.submittedAt?(P=v(s.submittedAt))==null?void 0:P.toLocaleDateString("it-IT"):"N/D"},photoURLs:s.photoURLs,onImageClick:x,variants:D}):e.jsx("p",{className:"text-center text-slate-400 py-8",children:"Nessuna anamnesi"})})]}),e.jsx(le,{src:h,onClose:()=>x(null)})]})})})}export{ue as default};
