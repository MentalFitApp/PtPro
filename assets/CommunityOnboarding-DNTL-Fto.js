const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/.pnpm-C04Ba0Xq.js","assets/.pnpm-DDKpoaqD.css"])))=>i.map(i=>d[i]);
import{h as G,r as d,f as P,e as h,aP as _,b5 as V,M as J,F as k,a2 as N,j as e,A as K,q as X,bz as Y,u as j,_ as z,a7 as g}from"./.pnpm-C04Ba0Xq.js";import{a as Z,d as u}from"./index-DdCoIfwr.js";import{u as ee}from"./storageUtils-DXx8Ax3l.js";import"./cloudflareStorage-DUIVXCyJ.js";const m=[{id:"video",title:"Video di Benvenuto",icon:_},{id:"photo",title:"Foto Profilo",icon:V},{id:"intro",title:"Presentati",icon:J},{id:"questionnaire",title:"Questionario",icon:k},{id:"complete",title:"Completato",icon:N}];function ie(){var S;const x=G(),[n,E]=d.useState(null),[l,f]=d.useState(0),[D,I]=d.useState(!0),[a,A]=d.useState(null),[y,w]=d.useState(!1),[p,L]=d.useState(""),[b,R]=d.useState(""),[C,U]=d.useState(!1);d.useEffect(()=>{const t=Z.onAuthStateChanged(async o=>{o?(E(o),await q(),await F(o.uid)):x("/login"),I(!1)});return()=>t()},[x]);const q=async()=>{try{const t=await P(h(u,"settings","community"));t.exists()&&A(t.data())}catch(t){console.error("Error loading settings:",t)}},F=async t=>{try{const o=await P(h(u,"users",t));if(o.exists()){const s=o.data();if(s.onboardingCompleted)x("/community");else if(s.onboardingStep){const c=m.findIndex(i=>i.id===s.onboardingStep);f(c>=0?c:0)}}}catch(o){console.error("Error checking onboarding status:",o)}},M=async t=>{if(n)try{await j(h(u,"users",n.uid),{onboardingStep:t,lastUpdated:g()})}catch(o){console.error("Error saving progress:",o)}},O=async t=>{const o=t.target.files[0];if(o){w(!0);try{const s=await ee(o,n.uid,"profile_photos",null,!0);L(s),await j(h(u,"users",n.uid),{photoURL:s})}catch(s){console.error("Error uploading photo:",s),alert("Errore nel caricamento della foto")}finally{w(!1)}}},T=async()=>{var o,s,c;const t=m[l];if(t.id==="video"&&((o=a==null?void 0:a.welcomeVideo)!=null&&o.enabled)&&!C){alert("Per favore guarda il video di benvenuto prima di continuare");return}if(t.id==="photo"&&((s=a==null?void 0:a.onboarding)!=null&&s.requireProfilePhoto)&&!p){alert("Per favore carica una foto profilo prima di continuare");return}if(t.id==="intro"&&((c=a==null?void 0:a.onboarding)!=null&&c.requireWelcomePost)&&!b.trim()){alert("Per favore scrivi un messaggio di presentazione prima di continuare");return}if(t.id==="intro"&&b.trim()){const{addDoc:i,collection:v}=await z(async()=>{const{addDoc:$,collection:H}=await import("./.pnpm-C04Ba0Xq.js").then(Q=>Q.b$);return{addDoc:$,collection:H}},__vite__mapDeps([0,1]));await i(v(u,"community_posts"),{content:b,channel:"vittorie",authorId:n.uid,authorName:n.displayName||"Nuovo Membro",authorPhotoURL:p||"",authorLevel:1,likes:[],likesCount:0,comments:[],commentsCount:0,isWelcomePost:!0,createdAt:g()})}if(l<m.length-1){const i=l+1;f(i),await M(m[i].id)}else await B()},B=async()=>{var t;try{if(await j(h(u,"users",n.uid),{onboardingCompleted:!0,onboardingCompletedAt:g(),totalLikes:0}),(t=a==null?void 0:a.onboarding)!=null&&t.sendPrivateVoiceMessage){const{addDoc:o,collection:s}=await z(async()=>{const{addDoc:c,collection:i}=await import("./.pnpm-C04Ba0Xq.js").then(v=>v.b$);return{addDoc:c,collection:i}},__vite__mapDeps([0,1]));await o(s(u,"notifications"),{type:"new_user_onboarding",userId:n.uid,userName:n.displayName||"Nuovo Membro",message:"Ha completato l'onboarding. Invia messaggio vocale personalizzato.",read:!1,createdAt:g()})}x("/community")}catch(o){console.error("Error completing onboarding:",o)}};if(D)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-900",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-rose-500"})});const r=m[l],W=r.icon;return e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-slate-900 to-slate-800 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:m.map((t,o)=>{const s=t.icon,c=o===l,i=o<l;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center font-bold transition-all ${i?"bg-emerald-600 text-white":c?"bg-rose-600 text-white":"bg-slate-700 text-slate-400"}`,children:i?e.jsx(N,{size:20}):e.jsx(s,{size:20})}),o<m.length-1&&e.jsx("div",{className:`w-12 sm:w-24 h-1 mx-1 transition-all ${i?"bg-emerald-600":"bg-slate-700"}`})]},t.id)})}),e.jsxs("p",{className:"text-center text-slate-400 text-sm mt-2",children:["Step ",l+1," di ",m.length,": ",r.title]})]}),e.jsx(K,{mode:"wait",children:e.jsxs(X.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},className:"bg-slate-800 rounded-xl p-6 sm:p-8 border border-slate-700",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-block p-4 bg-rose-600/20 rounded-full mb-4",children:e.jsx(W,{className:"text-rose-400",size:48})}),e.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:r.title})]}),r.id==="video"&&((S=a==null?void 0:a.welcomeVideo)==null?void 0:S.enabled)&&e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 text-center mb-6",children:a.welcomeVideo.description}),e.jsx("div",{className:"aspect-video bg-slate-900 rounded-lg mb-4 flex items-center justify-center",children:a.welcomeVideo.url?e.jsx("iframe",{src:a.welcomeVideo.url,title:a.welcomeVideo.title,className:"w-full h-full rounded-lg",allowFullScreen:!0}):e.jsxs("div",{className:"text-slate-500 text-center",children:[e.jsx(_,{size:48,className:"mx-auto mb-2"}),e.jsx("p",{children:"Nessun video configurato"})]})}),e.jsxs("label",{className:"flex items-center justify-center gap-2 text-sm text-slate-400",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:t=>U(t.target.checked),className:"w-4 h-4 rounded border-slate-600 text-rose-600 focus:ring-rose-500"}),"Ho guardato il video"]})]}),r.id==="photo"&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-300 mb-6",children:"Carica una tua foto per personalizzare il profilo"}),p?e.jsxs("div",{className:"mb-4",children:[e.jsx("img",{src:p,alt:"Profile",className:"w-32 h-32 rounded-full object-cover mx-auto mb-4 border-4 border-rose-600"}),e.jsx("p",{className:"text-emerald-400 text-sm",children:"✓ Foto caricata con successo"})]}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-slate-700 mx-auto mb-4 flex items-center justify-center",children:e.jsx(V,{size:48,className:"text-slate-500"})}),e.jsxs("label",{className:"inline-block px-6 py-3 bg-rose-600 hover:bg-rose-700 text-white rounded-lg font-medium cursor-pointer transition-colors",children:[y?"Caricamento...":p?"Cambia Foto":"Carica Foto",e.jsx("input",{type:"file",accept:"image/*",onChange:O,disabled:y,className:"hidden"})]})]}),r.id==="intro"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-300 mb-6",children:"Presentati alla community! Condividi i tuoi obiettivi personali e fisici con gli altri membri."}),e.jsx("textarea",{value:b,onChange:t=>R(t.target.value),placeholder:"Ciao a tutti! Sono... I miei obiettivi sono...",rows:8,className:"w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-3 text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-rose-500 resize-none"}),e.jsx("p",{className:"text-xs text-slate-500 mt-2",children:'Questo messaggio sarà pubblicato nel canale "Vittorie" della community'})]}),r.id==="questionnaire"&&e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-300 mb-6",children:"Compila il questionario per permettere al coach di conoscerti meglio e creare un piano personalizzato"}),e.jsxs("button",{onClick:()=>x("/client/anamnesi"),className:"inline-flex items-center gap-2 px-6 py-3 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-medium transition-colors",children:[e.jsx(k,{size:20}),"Vai al Questionario"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-4",children:"Dopo aver compilato il questionario, il coach ti invierà un messaggio vocale personalizzato"})]}),r.id==="complete"&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-emerald-600/20 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(N,{size:64,className:"text-emerald-400"})}),e.jsx("h3",{className:"text-2xl font-bold text-slate-100 mb-2",children:"Benvenuto in MentalFit!"}),e.jsx("p",{className:"text-slate-300 mb-8",children:"Hai completato l'onboarding. Ora puoi iniziare a interagire con la community e il tuo coach."})]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-slate-700",children:[l>0&&r.id!=="complete"&&e.jsx("button",{onClick:()=>f(l-1),className:"px-4 py-2 text-slate-400 hover:text-slate-200 transition-colors",children:"Indietro"}),e.jsxs("button",{onClick:T,className:"ml-auto flex items-center gap-2 px-6 py-3 bg-rose-600 hover:bg-rose-700 text-white rounded-lg font-medium transition-colors",children:[r.id==="complete"?"Vai alla Community":"Continua",e.jsx(Y,{size:20})]})]})]},r.id)})]})})}export{ie as default};
