var W=Object.defineProperty;var Z=(r,a,c)=>a in r?W(r,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):r[a]=c;var S=(r,a,c)=>Z(r,typeof a!="symbol"?a+"":a,c);import{r as d,j as e,R as J}from"./react-FJB7Hj_2.js";import{y as u,B as b,G as A,H as E,D as I,M as K,A as V}from"./@firebase-D5dUFubL.js";import{t as g,c as X,d as h,u as T}from"./index-C1w-7Ivh.js";import{g as ee,a as se,b as te}from"./react-router-DF4cN2Hx.js";import{m as v}from"./framer-motion-Bo7GrDk8.js";import{A as ae,u as ne,n as ie,v as R,w as le,b as re,s as oe,t as ce,x as de,D as me,F as xe}from"./lucide-react-BYK_Rxhn.js";import"./papaparse-BHXrM2Hc.js";import"./idb-BXWtuYvb.js";import"./react-dom-BrtcLnxQ.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-udQfSOCw.js";import"./@remix-run-CjG9tKj3.js";import"./firebase-CiybzbB3.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";class pe extends J.Component{constructor(){super(...arguments);S(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(c){return{hasError:!0,error:c}}render(){return this.state.hasError?e.jsxs("div",{className:"text-center text-red-400 p-8",children:["Si è verificato un errore: ",this.state.error.message,". Riprova o contatta il supporto."]}):this.props.children}}const he=({status:r})=>{const a={attivo:"bg-emerald-900/80 text-emerald-300 border border-emerald-500/30",rinnovato:"bg-amber-900/80 text-amber-300 border border-amber-500/30",non_rinnovato:"bg-red-900/80 text-red-400 border border-red-500/30",na:"bg-zinc-700/80 text-zinc-300 border border-zinc-500/30"},c={attivo:"Attivo",rinnovato:"In Scadenza",non_rinnovato:"Scaduto",na:"N/D"};return e.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${a[r]||a.na}`,children:c[r]||"N/D"})};function Ie(){var k,P;const r=ee(),a=se(),c=te(),[l,z]=d.useState(null),[L,f]=d.useState(!0),[m,j]=d.useState("info"),[D,$]=d.useState([]),[w,F]=d.useState([]),[s,U]=d.useState(null),[y,N]=d.useState(null),[M,C]=d.useState(!1),o=r.clientId||(()=>{const t=c.pathname;console.log("URL completo:",window.location.href),console.log("Pathname:",t);const i=t.match(/\/client\/([a-zA-Z0-9_-]+)/),p=i?i[1]:null;return console.log("ID estratto da params o URL:",r.clientId||p),!p&&!r.clientId?(N("ID cliente non trovato. Reindirizzamento alla lista dei clienti..."),setTimeout(()=>a("/clients"),3e3),null):p||r.clientId})();d.useEffect(()=>{if(!o||typeof o!="string"||o.trim()===""){N("ID cliente non valido. Reindirizzamento alla lista dei clienti..."),setTimeout(()=>a("/clients"),3e3),f(!1);return}const t=u(h,"clients",o),i=b(t,n=>{if(n.exists()){const x={id:n.id,...n.data()};z(x),console.log("Dati cliente caricati:",x),T(o)}else z(null),N("Cliente non trovato. Reindirizzamento alla lista dei clienti..."),setTimeout(()=>a("/clients"),3e3);f(!1)},n=>{console.error("Errore nel recupero del cliente:",n),N("Errore nel recupero del cliente. Reindirizzamento..."),setTimeout(()=>a("/clients"),3e3),f(!1)}),p=u(h,"clients",o,"anamnesi","initial"),_=b(p,n=>{U(n.exists()?n.data():null)},n=>{console.error("Errore nel recupero dell'anamnesi:",n)}),q=A(I(h,"clients",o,"checks"),E("createdAt","desc")),O=b(q,n=>{$(n.docs.map(x=>({id:x.id,...x.data()})))},n=>{console.error("Errore nel recupero dei checks:",n)}),Q=A(I(h,"clients",o,"payments"),E("paymentDate","desc")),H=b(Q,n=>{F(n.docs.map(x=>({id:x.id,...x.data()})))},n=>{console.error("Errore nel recupero dei pagamenti:",n)});return()=>{i(),_(),O(),H()}},[o,a,c.pathname]);const B=async()=>{if(window.confirm(`Sei sicuro di voler eliminare ${(l==null?void 0:l.name)||"il cliente"}?`))try{await K(u(h,"clients",o)),a("/clients")}catch(t){console.error("Errore nell'eliminazione del cliente:",t),alert("Errore durante l'eliminazione del cliente.")}},Y=async()=>{const t=prompt("Inserisci la nuova data di scadenza (YYYY-MM-DD):");if(t)try{const i=new Date(t);if(isNaN(i))throw new Error("Data non valida");await V(u(h,"clients",o),{scadenza:i}),T(o)}catch(i){console.error("Errore nell'aggiornamento della scadenza:",i),alert("Data non valida o errore nell'aggiornamento")}},G=()=>{const t="https://MentalFitApp.github.io/PtPro/#/client-login",i=l.tempPassword||"Password non disponibile (contatta l’amministratore per reimpostarla)",p=`Ciao ${l.name||"Cliente"},

Benvenuto in PT Manager, la tua area personale per monitorare i progressi e comunicare con il tuo coach!

Ecco le credenziali per il tuo accesso:

Link: ${t}
Email: ${l.email||"N/D"}
Password Temporanea: ${i}

Al primo accesso ti verrà chiesto di impostare una password personale.
A presto!`;navigator.clipboard.writeText(p),C(!0),setTimeout(()=>C(!1),2500)};return y?e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-red-400 p-8",children:y}):L?e.jsx("div",{className:"text-center text-slate-400 p-8",children:"Caricamento..."}):l?e.jsx(pe,{children:e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},className:"w-full max-w-4xl mx-auto p-4 sm:p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>a("/clients"),className:"flex items-center gap-2 text-slate-400 hover:text-rose-400 transition-colors",children:[e.jsx(ae,{size:18})," Torna ai Clienti"]})}),e.jsxs("div",{className:"bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center flex-wrap gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-50",children:l.name||"Cliente"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>a(`/edit/${o}`),className:"flex items-center gap-2 px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(ne,{size:16})," Modifica"]}),e.jsxs("button",{onClick:B,className:"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(ie,{size:16})," Elimina"]}),e.jsxs("button",{onClick:Y,className:"flex items-center gap-2 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(R,{size:16})," Aggiorna Scadenza"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6 bg-zinc-900/70 p-1 rounded-lg border border-white/10",children:[e.jsx("button",{onClick:()=>j("info"),className:`px-4 py-2 text-sm rounded-md transition-colors ${m==="info"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Informazioni"}),e.jsx("button",{onClick:()=>j("check"),className:`px-4 py-2 text-sm rounded-md transition-colors ${m==="check"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Check"}),e.jsx("button",{onClick:()=>j("payments"),className:`px-4 py-2 text-sm rounded-md transition-colors ${m==="payments"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Pagamenti"}),e.jsx("button",{onClick:()=>j("anamnesi"),className:`px-4 py-2 text-sm rounded-md transition-colors ${m==="anamnesi"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Anamnesi"})]}),m==="info"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(le,{className:"text-slate-400",size:18}),e.jsxs("p",{className:"text-slate-200",children:["Nome: ",e.jsx("span",{className:"font-semibold",children:l.name||"N/D"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(re,{className:"text-slate-400",size:18}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("p",{className:"text-slate-200",children:["Email: ",e.jsx("span",{className:"font-semibold",children:l.email||"N/D"})]}),e.jsx("button",{onClick:G,className:"p-1 text-slate-400 hover:text-emerald-400 rounded-md transition-colors",children:M?e.jsx(oe,{size:16}):e.jsx(ce,{size:16})})]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:l.tempPassword?"Al primo accesso ti verrà chiesto di impostare una password personale.":"Password non disponibile. Contatta l’amministratore per reimpostarla."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"text-slate-400",size:18}),e.jsxs("p",{className:"text-slate-200",children:["Telefono: ",e.jsx("span",{className:"font-semibold",children:l.phone||"N/D"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(R,{className:"text-slate-400",size:18}),e.jsxs("p",{className:"text-slate-200",children:["Scadenza: ",e.jsx("span",{className:"font-semibold",children:l.scadenza&&((k=g(l.scadenza))==null?void 0:k.toLocaleDateString("it-IT"))||"N/D"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(me,{className:"text-slate-400",size:18}),e.jsxs("p",{className:"text-slate-200",children:["Stato Percorso: ",e.jsx(he,{status:l.statoPercorso||X(l.scadenza)})]})]})]}),m==="check"&&e.jsx("div",{className:"space-y-4",children:D.length>0?D.map(t=>{var i;return e.jsxs("div",{className:"p-4 bg-zinc-900/70 rounded-lg border border-white/10",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["Data: ",((i=g(t.createdAt))==null?void 0:i.toLocaleDateString("it-IT"))||"N/D"]}),e.jsxs("p",{className:"text-sm text-slate-200",children:["Peso: ",t.weight||"N/D"," kg"]}),e.jsxs("p",{className:"text-sm text-slate-200",children:["Note: ",t.notes||"Nessuna nota"]})]},t.id)}):e.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Nessun check disponibile."})}),m==="payments"&&e.jsx("div",{className:"space-y-4",children:w.length>0?w.map(t=>{var i;return e.jsxs("div",{className:"p-4 bg-zinc-900/70 rounded-lg border border-white/10",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["Data: ",((i=g(t.paymentDate))==null?void 0:i.toLocaleDateString("it-IT"))||"N/D"]}),e.jsxs("p",{className:"text-sm text-slate-200",children:["Importo: ",new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(t.amount||0)]})]},t.id)}):e.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Nessun pagamento registrato."})}),m==="anamnesi"&&e.jsx("div",{className:"space-y-4",children:s?e.jsxs("div",{className:"bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-4",children:[e.jsxs("h4",{className:"font-bold text-lg text-cyan-300 border-b border-cyan-400/20 pb-2 flex items-center gap-2",children:[e.jsx(xe,{size:16})," Dettagli Anamnesi"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Nome:"})," ",e.jsx("span",{className:"text-slate-200",children:s.firstName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Cognome:"})," ",e.jsx("span",{className:"text-slate-200",children:s.lastName||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Data di Nascita:"})," ",e.jsx("span",{className:"text-slate-200",children:s.birthDate||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Lavoro:"})," ",e.jsx("span",{className:"text-slate-200",children:s.job||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Peso (kg):"})," ",e.jsx("span",{className:"text-slate-200",children:s.weight||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Altezza (cm):"})," ",e.jsx("span",{className:"text-slate-200",children:s.height||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Pasti al Giorno:"})," ",e.jsx("span",{className:"text-slate-200",children:s.mealsPerDay||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Tipo Colazione:"})," ",e.jsx("span",{className:"text-slate-200",children:s.breakfastType||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Alimenti Preferiti:"})," ",e.jsx("span",{className:"text-slate-200",children:s.desiredFoods||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Alimenti da Evitare:"})," ",e.jsx("span",{className:"text-slate-200",children:s.dislikedFoods||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Allergie/Intolleranze:"})," ",e.jsx("span",{className:"text-slate-200",children:s.intolerances||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Problemi di Digestione:"})," ",e.jsx("span",{className:"text-slate-200",children:s.digestionIssues||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Allenamenti a Settimana:"})," ",e.jsx("span",{className:"text-slate-200",children:s.workoutsPerWeek||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Dettagli Allenamento:"})," ",e.jsx("span",{className:"text-slate-200",children:s.trainingDetails||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Orario e Durata:"})," ",e.jsx("span",{className:"text-slate-200",children:s.trainingTime||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Infortuni:"})," ",e.jsx("span",{className:"text-slate-200",children:s.injuries||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Farmaci:"})," ",e.jsx("span",{className:"text-slate-200",children:s.medications||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Integratori:"})," ",e.jsx("span",{className:"text-slate-200",children:s.supplements||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Obiettivo Principale:"})," ",e.jsx("span",{className:"text-slate-200",children:s.mainGoal||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Durata Percorso:"})," ",e.jsx("span",{className:"text-slate-200",children:s.programDuration||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Data Invio:"})," ",e.jsx("span",{className:"text-slate-200",children:((P=g(s.submittedAt))==null?void 0:P.toLocaleDateString("it-IT"))||"-"})]}),s.notes&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-sm font-semibold text-slate-400",children:"Note:"})," ",e.jsx("span",{className:"text-slate-200",children:s.notes})]})]}),s.photoURLs&&e.jsxs("div",{className:"mt-4 col-span-2",children:[e.jsx("h5",{className:"font-semibold text-slate-400",children:"Foto:"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 mt-2",children:["front","back","left","right"].map(t=>s.photoURLs[t]?e.jsx("img",{src:s.photoURLs[t],alt:`${t} view`,className:"w-full h-24 object-cover rounded-lg hover:scale-105 transition-transform"},t):e.jsx("div",{className:"w-full h-24 bg-zinc-900 rounded-lg flex items-center justify-center text-slate-500",children:"Nessuna foto"},t))})]})]}):e.jsx("p",{className:"text-sm text-slate-400 text-center",children:"Nessuna anamnesi disponibile."})})]})]})}):e.jsx(v.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center text-slate-400 p-8",children:"Cliente non trovato. Reindirizzamento alla lista dei clienti..."})}export{Ie as default};
