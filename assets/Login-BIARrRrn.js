import{r as l,j as e}from"./react-CrXOBDSJ.js";import{L}from"./react-router-dom-9rcY47vU.js";import{s as P,a as R,b as k}from"./firebase-BzWCke7W.js";import{y as r,z as n}from"./@firebase-Dy5qmm0I.js";import{a as p,d as c}from"./index-BHKKfjAh.js";import{a as _}from"./react-router-BxpCmtJ-.js";import{m as d}from"./framer-motion-BAPjnw1b.js";import{A as O,d as F,L as M,E as U,e as X}from"./lucide-react-7Eidy6wR.js";import"./core-js-ChGsxLo2.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./@remix-run-CjG9tKj3.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const ce=()=>{const[x,C]=l.useState(""),[y,z]=l.useState(""),[N,s]=l.useState(""),[E,D]=l.useState(!0),[h,S]=l.useState(!1),i=_();l.useEffect(()=>{const a=p.onAuthStateChanged(async t=>{if(t)try{const f=r(c,"roles","admins"),b=r(c,"roles","coaches"),g=r(c,"clients",t.uid),[m,u,o]=await Promise.all([n(f).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),n(b).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),n(g).catch(()=>({exists:()=>!1,data:()=>({})}))]),w=m.exists()&&m.data().uids.includes(t.uid),j=u.exists()&&u.data().uids.includes(t.uid),v=o.exists()&&o.data().isClient===!0;w?(sessionStorage.setItem("app_role","admin"),i("/")):j?(sessionStorage.setItem("app_role","coach"),i("/coach")):v?(sessionStorage.setItem("app_role","client"),i(o.data().firstLogin?"/client/first-access":"/client/dashboard")):s("Accesso non autorizzato. Usa il login client se sei un cliente.")}catch{s("Errore verifica ruolo. Riprova.")}D(!1)});return()=>a()},[i]);const A=async a=>{a.preventDefault(),s("");try{const t=await P(p,x,y),f=r(c,"roles","admins"),b=r(c,"roles","coaches"),g=r(c,"clients",t.user.uid),[m,u,o]=await Promise.all([n(f),n(b),n(g)]),w=m.exists()&&m.data().uids.includes(t.user.uid),j=u.exists()&&u.data().uids.includes(t.user.uid),v=o.exists()&&o.data().isClient===!0;w?(sessionStorage.setItem("app_role","admin"),i("/")):j?(sessionStorage.setItem("app_role","coach"),i("/coach")):v?(sessionStorage.setItem("app_role","client"),i(o.data().firstLogin?"/client/first-access":"/client/dashboard")):(s("Accesso non autorizzato. Usa il login client se sei un cliente."),await R(p),i("/client-login"))}catch(t){t.code==="auth/wrong-password"?s("Password errata. Riprova o reimposta la password."):t.code==="auth/user-not-found"?s("Utente non trovato. Verifica l'email o usa il login client."):s("Errore login: "+t.message)}},I=async()=>{if(!x){s("Inserisci un'email per reimpostare la password.");return}try{await k(p,x),s("Email di reimpostazione inviata. Controlla la posta.")}catch(a){s("Errore invio email: "+a.message)}};return E?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-900",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-[#ef4444]"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-[#1b2735] to-[#090a0f] -z-10"}),e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs(d.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"relative w-full max-w-md z-10",children:[e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-1"}),e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-2"}),e.jsxs("div",{className:"relative bg-white/3 backdrop-blur-lg border border-white/8 rounded-3xl p-8 shadow-xl",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-1 opacity-30"}),e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-2 opacity-30"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(d.div,{className:"flex justify-center mb-8",children:e.jsxs("h1",{className:"text-4xl font-bold text-slate-100 relative",children:[e.jsx("span",{className:"relative z-10",children:"MentalFit"}),e.jsx(d.span,{className:"absolute inset-x-0 -bottom-1 h-1 bg-[#ef4444] rounded-full",initial:{scaleX:0,opacity:0},animate:{scaleX:1,opacity:[.6,1,.6]},transition:{scaleX:{duration:.8,ease:"easeOut"},opacity:{duration:2,repeat:1/0,ease:"easeInOut"}},style:{filter:"blur(4px)"}}),e.jsx(d.span,{className:"absolute inset-x-0 -bottom-2 h-2 bg-[#ef4444] rounded-full",animate:{opacity:[.3,.7,.3]},transition:{duration:2,repeat:1/0},style:{filter:"blur(8px)"}})]})}),e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h2",{className:"text-xl font-medium text-slate-300",children:"Login Coach/Admin"}),e.jsxs(L,{to:"/client-login",className:"flex items-center gap-2 text-sm text-slate-400 hover:text-[#ef4444] transition-colors",children:[e.jsx(O,{size:16})," Login Cliente"]})]}),e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"email",value:x,onChange:a=>C(a.target.value),className:"w-full pl-12 pr-4 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"tuo@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:h?"text":"password",value:y,onChange:a=>z(a.target.value),className:"w-full pl-12 pr-14 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"••••••••",required:!0}),e.jsx("button",{type:"button",onClick:()=>S(!h),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[#ef4444] transition-colors",children:h?e.jsx(U,{size:20}):e.jsx(X,{size:20})})]})]}),N&&e.jsx(d.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-[#ef4444] text-sm text-center font-medium",children:N}),e.jsx(d.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",className:"w-full py-4 bg-[#ef4444] hover:bg-[#dc2626] text-white font-bold rounded-xl shadow-lg hover:shadow-[#ef4444]/50 transition-all duration-300",children:"Accedi a MentalFit"})]}),e.jsx("button",{onClick:I,className:"mt-6 text-sm text-slate-400 hover:text-[#ef4444] w-full text-center transition-colors",children:"Password dimenticata?"})]})]})]})})]})};export{ce as default};
