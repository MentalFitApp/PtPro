import{r as n,j as e}from"./react-CrXOBDSJ.js";import{H as v,G as S,D as U,R,z as V,y as X}from"./@firebase-DgmhcEwT.js";import{a as E,d as y}from"./index-pOkjm1YA.js";import{C as Y,c as Z,b as ee,f as te,p as se,d as ae,e as le}from"./chart.js-m_wzuIQ6.js";import{a as oe}from"./react-router-BxpCmtJ-.js";import{c as re,U as A,ae as L,D as ce,i as z,M as ne,G as ie}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Drn0uAfr.js";import"./tslib-BGVaTf34.js";import"./@kurkle-D8fDXNIl.js";Y.register(Z,ee,te,se,ae,le);function Ie(){const T=oe(),[h,O]=n.useState(!1),[$,q]=n.useState(!0),[d,C]=n.useState(()=>{const t=new Date;return t.setDate(t.getDate()-6),t.toISOString().split("T")[0]}),[x,k]=n.useState(()=>new Date().toISOString().split("T")[0]),[f,B]=n.useState([]),[b,H]=n.useState([]),[g,_]=n.useState([]),[D,G]=n.useState([]),[I,W]=n.useState({});n.useEffect(()=>{(async()=>{if(!E.currentUser){T("/login");return}const s=await V(X(y,"roles","admins")),a=s.exists()?s.data().uids||[]:[];O(a.includes(E.currentUser.uid)),q(!1)})()},[T]),n.useEffect(()=>{if(!h)return;const t=v(S(y,"collaboratori")),s=U(t,a=>{const o={},r=a.docs.map(l=>{var u;const c=l.data();if(!(c.ruolo==="Setter"||c.role==="Setter"))return null;const N=l.id,m=c.nome||c.name||((u=c.email)==null?void 0:u.split("@")[0])||N;return o[N]=m,{uid:N,name:m,photoURL:c.photoURL||"/default-avatar.png",dailyReports:Array.isArray(c.dailyReports)?c.dailyReports:[]}}).filter(Boolean);G(r),W(o)});return()=>s()},[h]),n.useEffect(()=>{if(!h)return;const t=new Date(d),s=new Date(x);s.setHours(23,59,59,999);const a=v(S(y,"salesReports"),R("date",">=",d),R("date","<=",x)),o=v(S(y,"settingReports"),R("date",">=",d),R("date","<=",x)),r=v(S(y,"leads")),l=[U(a,c=>B(c.docs.map(i=>i.data()))),U(o,c=>H(c.docs.map(i=>i.data()))),U(r,c=>{const N=c.docs.map(m=>({id:m.id,...m.data()})).filter(m=>{var M;const u=(M=m.timestamp)==null?void 0:M.toDate();return u&&u>=t&&u<=s});_(N)})];return()=>l.forEach(c=>c())},[h,d,x]);const F=n.useMemo(()=>{const t={};return g.forEach(s=>{const a=s.collaboratoreId||"unknown",o=I[a]||s.collaboratoreNome||"Sconosciuto";t[a]||(t[a]={uid:a,name:o,total:0,showUp:0,chiuso:0}),t[a].total++,s.showUp&&t[a].showUp++,s.chiuso&&t[a].chiuso++}),Object.values(t).sort((s,a)=>a.total-s.total)},[g,I]),P=n.useMemo(()=>{if(D.length===0)return[];const t=new Date(d),s=new Date(x);s.setHours(23,59,59,999);const a=[];return D.forEach(o=>{(Array.isArray(o.dailyReports)?o.dailyReports:[]).forEach(l=>{if(!(l!=null&&l.date)||!l.tracker)return;const c=new Date(l.date);if(c<t||c>s)return;const i=l.tracker;a.push({uid:o.uid,name:o.name,outreachTotale:parseInt(i.outreachTotale)||0,followUpsTotali:parseInt(i.followUpsTotali)||0,risposte:parseInt(i.risposte)||0,callPrenotate:parseInt(i.callPrenotate)||0})})}),a},[D,d,x]),p=n.useMemo(()=>{const t={};return P.forEach(s=>{t[s.uid]||(t[s.uid]={name:s.name,outreachTotale:0,followUpsTotali:0,risposte:0,callPrenotate:0}),t[s.uid].outreachTotale+=s.outreachTotale,t[s.uid].followUpsTotali+=s.followUpsTotali,t[s.uid].risposte+=s.risposte,t[s.uid].callPrenotate+=s.callPrenotate}),Object.values(t)},[P]);n.useMemo(()=>p.reduce((t,s)=>({outreach:t.outreach+s.outreachTotale,followUps:t.followUps+s.followUpsTotali,risposte:t.risposte+s.risposte,callPrenotate:t.callPrenotate+s.callPrenotate}),{outreach:0,followUps:0,risposte:0,callPrenotate:0}),[p]);const j=n.useMemo(()=>{const t=f.reduce((r,l)=>r+(parseInt(l.chiamateFissate)||0),0),s=f.reduce((r,l)=>r+(parseInt(l.chiamateFatte)||0),0),a=f.reduce((r,l)=>r+(parseInt(l.offersFatte)||0),0),o=f.reduce((r,l)=>r+(parseInt(l.chiuse)||0),0);return{fissate:t,fatte:s,offers:a,chiuse:o,showUpRate:t>0?(s/t*100).toFixed(1):"0.0",warmRate:s>0?(a/s*100).toFixed(1):"0.0",closeRate:a>0?(o/a*100).toFixed(1):"0.0"}},[f]),w=n.useMemo(()=>{const t=b.reduce((r,l)=>r+(parseInt(l.dialedFatti)||0),0),s=b.reduce((r,l)=>r+(parseInt(l.dialedRisposte)||0),0),a=b.reduce((r,l)=>r+(parseInt(l.followUpsFatti)||0),0),o=b.reduce((r,l)=>r+(parseInt(l.chiamatePrenotate)||0),0);return{dialed:t,risposte:s,followUps:a,prenotate:o,risposteRate:t>0?(s/t*100).toFixed(1):"0.0",prenotateRate:s>0?(o/s*100).toFixed(1):"0.0"}},[b]),J=g.length,K=g.filter(t=>t.showUp).length,Q=g.filter(t=>t.chiuso).length;return $?e.jsx("div",{className:"p-6 text-center text-slate-400",children:"Caricamento..."}):h?e.jsxs("div",{className:"p-6 max-w-7xl mx-auto space-y-10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-100 flex items-center gap-3",children:[e.jsx(re,{size:32})," Statistiche Complete"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("input",{type:"date",value:d,onChange:t=>C(t.target.value),className:"px-4 py-2 bg-slate-800 text-slate-100 rounded-lg border border-slate-700 focus:outline-none focus:border-blue-500 text-sm"}),e.jsx("span",{className:"text-slate-400",children:"â†’"}),e.jsx("input",{type:"date",value:x,onChange:t=>k(t.target.value),className:"px-4 py-2 bg-slate-800 text-slate-100 rounded-lg border border-slate-700 focus:outline-none focus:border-blue-500 text-sm"}),e.jsx("button",{onClick:()=>{const t=new Date;t.setDate(t.getDate()-6),C(t.toISOString().split("T")[0]),k(new Date().toISOString().split("T")[0])},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Ultimi 7 giorni"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-5 border border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Lead Totali"}),e.jsx("p",{className:"text-3xl font-bold text-amber-300",children:J})]}),e.jsx(A,{size:28,className:"text-amber-400"})]})}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-5 border border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Show-Up"}),e.jsx("p",{className:"text-3xl font-bold text-emerald-300",children:K})]}),e.jsx(L,{size:28,className:"text-emerald-400"})]})}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-5 border border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Chiusi"}),e.jsx("p",{className:"text-3xl font-bold text-rose-300",children:Q})]}),e.jsx(ce,{size:28,className:"text-rose-400"})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[{label:"Call Fissate",value:j.fissate,color:"text-amber-300"},{label:"Call Fatte",value:j.fatte,color:"text-green-300"},{label:"Show-Up",value:`${j.showUpRate}%`,color:"text-emerald-300"},{label:"Warm",value:`${j.warmRate}%`,color:"text-yellow-300"},{label:"Close",value:`${j.closeRate}%`,color:"text-rose-300"}].map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-5 border border-slate-700",children:[e.jsx("p",{className:"text-sm text-slate-400",children:t.label}),e.jsx("p",{className:`text-2xl font-bold ${t.color}`,children:t.value})]},s))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[{label:"Dialed",value:w.dialed,color:"text-blue-300"},{label:"Risposte",value:`${w.risposteRate}%`,color:"text-cyan-300"},{label:"Follow-Ups",value:w.followUps,color:"text-green-300"},{label:"Prenotate",value:`${w.prenotateRate}%`,color:"text-rose-300"}].map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-5 border border-slate-700",children:[e.jsx("p",{className:"text-sm text-slate-400",children:t.label}),e.jsx("p",{className:`text-2xl font-bold ${t.color}`,children:t.value})]},s))}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(A,{size:28})," Lead per Setter"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[F.map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-5 border border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-600 rounded-full flex items-center justify-center text-xs font-bold text-slate-300",children:t.name.charAt(0).toUpperCase()}),e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:t.name})]})}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Lead Totali"}),e.jsx("span",{className:"font-bold text-amber-300",children:t.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Show-Up"}),e.jsxs("span",{className:"font-bold text-emerald-300",children:[t.showUp," (",t.total>0?(t.showUp/t.total*100).toFixed(1):0,"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Chiusi"}),e.jsxs("span",{className:"font-bold text-rose-300",children:[t.chiuso," (",t.total>0?(t.chiuso/t.total*100).toFixed(1):0,"%)"]})]})]})]},s)),F.length===0&&e.jsx("div",{className:"col-span-full text-center py-8 text-slate-400",children:"Nessun lead nel periodo"})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(z,{size:28})," DMS Tracker - Confronto"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[{title:"Outreach Totale",key:"outreachTotale",color:"text-amber-300",icon:ne},{title:"Follow-Ups",key:"followUpsTotali",color:"text-green-300",icon:ie},{title:"Risposte",key:"risposte",color:"text-cyan-300",icon:L},{title:"Call Prenotate",key:"callPrenotate",color:"text-rose-300",icon:z}].map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-5 border border-slate-700",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-100 mb-3 flex items-center gap-2",children:[e.jsx(t.icon,{size:20})," ",t.title]}),e.jsx("div",{className:"space-y-2",children:p.length===0?e.jsx("p",{className:"text-xs text-slate-500 italic text-center",children:"Nessun dato"}):p.sort((a,o)=>o[t.key]-a[t.key]).slice(0,5).map((a,o)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-300 truncate max-w-[100px]",children:a.name}),e.jsx("span",{className:`font-bold ${t.color}`,children:a[t.key]})]},o))})]},s))}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-6 border border-slate-700",children:[e.jsx("h3",{className:"text-sm sm:text-lg font-semibold text-slate-200 mb-3 sm:mb-4",children:"Tabella Completa DMS"}),e.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:e.jsxs("table",{className:"w-full text-xs sm:text-sm text-left",children:[e.jsx("thead",{className:"text-[10px] sm:text-xs uppercase bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3",children:"Setter"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Out"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center hidden sm:table-cell",children:"Follow-Up"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Risp"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Call"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-slate-400",children:"Nessun dato DMS"})}):p.map((t,s)=>e.jsxs("tr",{className:"border-t border-slate-700 hover:bg-slate-700/30",children:[e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 flex items-center gap-1 sm:gap-2",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-slate-600 rounded-full flex items-center justify-center text-[10px] sm:text-xs font-bold text-slate-300",children:t.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"font-medium text-slate-100 text-xs sm:text-sm truncate",children:t.name})]}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-amber-300 font-bold text-xs sm:text-sm",children:t.outreachTotale}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-green-300 font-bold text-xs sm:text-sm hidden sm:table-cell",children:t.followUpsTotali}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-cyan-300 font-bold text-xs sm:text-sm",children:t.risposte}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-rose-300 font-bold text-xs sm:text-sm",children:t.callPrenotate})]},s))})]})})]})]})]}):null}export{Ie as default};
