import{r as m,j as e}from"./react-FJB7Hj_2.js";import{g as G}from"./firebase-CiybzbB3.js";import{x as H,y as L,z as K,D as U,G as V,H as W,B as J,U as Q,V as Z,W as ee,A as te,K as R,T as se}from"./@firebase-D5dUFubL.js";import{d as y}from"./index-C1w-7Ivh.js";import{C as re}from"./react-calendar-Bb9WV09U.js";import{a as ae}from"./react-router-DF4cN2Hx.js";import{A as oe,G as ie,o as ne,X as F,z as ce,m as le,O as de}from"./lucide-react-BYK_Rxhn.js";import{m as T,A as he}from"./framer-motion-Bo7GrDk8.js";import{v as me}from"./uuid-CtRu48qb.js";import"./papaparse-BHXrM2Hc.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./react-dom-BrtcLnxQ.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-udQfSOCw.js";import"./@remix-run-CjG9tKj3.js";import"./clsx-B-dksMZM.js";import"./get-user-locale-CTD1oYsn.js";import"./memoize-BZNdjcd3.js";import"./mimic-function-BIlJVoeO.js";import"./@wojtekmaj-CaFejNaN.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const ue=`
.react-calendar { width: 100%; background: transparent; border: none; font-family: inherit; }
.react-calendar__navigation button { color: #67e8f9; font-weight: bold; font-size: 1.1em; }
.react-calendar__navigation button:hover, .react-calendar__navigation button:focus { background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; }
.react-calendar__month-view__weekdays__weekday { color: #9ca3af; text-transform: uppercase; font-size: 0.75rem; font-weight: 600; }
.react-calendar__tile { color: #d1d5db; border-radius: 0.5rem; height: 50px; }
.react-calendar__tile:disabled { color: #6b7280; }
.react-calendar__tile:enabled:hover, .react-calendar__tile:enabled:focus { background: rgba(255, 255, 255, 0.1); }
.react-calendar__tile--now { background: rgba(63, 63, 70, 0.7); font-weight: bold; }
.react-calendar__tile--active { background: #0891b2; color: white; }
.check-day { position: relative; }
.check-day::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; border-radius: 50%; background-color: #f43f5e; }
.check-submitted { position: relative; background-color: rgba(16, 185, 129, 0.2); }
.check-submitted::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; border-radius: 50%; background-color: #10b981; }
`,ge=()=>e.jsx("div",{className:"min-h-screen flex justify-center items-center relative",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})}),pe=({message:r,type:i,onDismiss:n})=>e.jsx(he,{children:r&&e.jsxs(T.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${i==="success"?"bg-emerald-900/80 text-emerald-300 border-emerald-500/30":"bg-red-900/80 text-red-300 border-red-500/30"} backdrop-blur-md shadow-lg`,children:[i==="success"?e.jsx(ie,{}):e.jsx(ne,{}),e.jsx("p",{children:r}),e.jsx("button",{onClick:n,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(F,{size:16})})]})}),xe=({formState:r,setFormState:i,handleSubmit:n,isUploading:c,handleFileChange:k})=>{const w=()=>i({id:null,notes:"",weight:"",photos:{},photoPreviews:{}}),x=({type:u,label:l,preview:f})=>e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:l}),e.jsxs("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-zinc-900/50 rounded-lg border-2 border-dashed border-zinc-700 hover:border-cyan-500 transition-colors relative group",children:[f?e.jsx("img",{src:f,alt:"preview",className:"h-full w-full object-contain rounded-lg p-1"}):e.jsxs("div",{className:"flex flex-col items-center text-slate-400 transition-colors group-hover:text-cyan-400",children:[e.jsx(de,{size:32}),e.jsx("p",{className:"mt-2 text-sm",children:"Carica foto"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:D=>k(D,u),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})]});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-cyan-300",children:r.id?"Modifica Check":"Carica Check"}),e.jsx("button",{onClick:w,className:"text-slate-400 hover:text-white p-1 rounded-full",children:e.jsx(F,{size:20})})]}),e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Peso Attuale (kg)*"}),e.jsx("input",{type:"number",step:"0.1",value:r.weight,onChange:u=>i(l=>({...l,weight:u.target.value})),required:!0,className:"w-full p-2.5 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200",placeholder:"Es. 75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Note sul check"}),e.jsx("textarea",{value:r.notes,onChange:u=>i(l=>({...l,notes:u.target.value})),rows:"4",className:"w-full p-2.5 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(x,{type:"front",label:"Frontale",preview:r.photoPreviews.front}),e.jsx(x,{type:"right",label:"Laterale Destro",preview:r.photoPreviews.right}),e.jsx(x,{type:"left",label:"Laterale Sinistro",preview:r.photoPreviews.left}),e.jsx(x,{type:"back",label:"Posteriore",preview:r.photoPreviews.back})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:c,className:"flex items-center gap-2 px-5 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition font-semibold disabled:opacity-50",children:[e.jsx(ce,{size:16}),c?"Salvataggio...":r.id?"Salva Modifiche":"Invia Check"]})})]})]})},fe=({check:r,handleEditClick:i})=>{const n=(new Date-r.createdAt.toDate())/36e5<2;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg text-cyan-300",children:["Riepilogo del ",r.createdAt.toDate().toLocaleDateString("it-IT")]}),n&&e.jsxs("button",{onClick:()=>i(r),className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm font-semibold rounded-lg",children:[e.jsx(le,{size:14})," Modifica"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"Peso Registrato:"}),e.jsxs("p",{className:"text-white text-xl font-bold",children:[r.weight," kg"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"Note:"}),e.jsx("p",{className:"text-slate-400 p-3 bg-zinc-900/50 rounded-lg whitespace-pre-wrap",children:r.notes||"Nessuna nota."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"Foto:"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mt-2",children:r.photoURLs&&["front","right","left","back"].map(c=>r.photoURLs[c]?e.jsx("a",{href:r.photoURLs[c],target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:r.photoURLs[c],alt:c,className:"rounded-lg w-full h-auto"},c)}):null)})]})]})]})};function qe(){const[r,i]=m.useState(null),[n,c]=m.useState([]),[k,w]=m.useState(!0),[x,u]=m.useState(new Date),[l,f]=m.useState({id:null,notes:"",weight:"",photos:{},photoPreviews:{}}),[D,_]=m.useState(!1),[z,N]=m.useState({message:"",type:""}),[A,E]=m.useState(null),C=ae(),g=G().currentUser,I=H();m.useEffect(()=>{if(!g){C("/client-login");return}(async()=>{try{const s=L(y,"clients",g.uid),a=await K(s);a.exists()&&a.data().createdAt?i(a.data().createdAt.toDate()):i(new Date);const o=U(y,`clients/${g.uid}/checks`),j=V(o,W("createdAt","desc"));return J(j,p=>{c(p.docs.map(h=>({id:h.id,...h.data()}))),w(!1)},p=>{console.error("Errore snapshot checks:",p),E("Errore nel caricamento dei check."),w(!1)})}catch(s){console.error("Errore fetchInitialData:",s),E("Errore nel caricamento dei dati."),w(!1)}})()},[g,C]);const b=(t,s="error")=>{N({message:t,type:s}),setTimeout(()=>N({message:"",type:""}),5e3)},$=t=>{try{if(!n.length)return[];const s=n.reduce((d,p)=>{var v;const h=(v=p.createdAt)==null?void 0:v.toDate();return!d||h&&h<d?h:d},null);if(!s)return[];let a=[],o=new Date(s.getTime());const j=new Date(t.getFullYear(),t.getMonth()+2,1);for(;o.getTime()<j.getTime();)o.getMonth()===t.getMonth()&&o.getFullYear()===t.getFullYear()&&a.push(new Date(o.getTime())),o.setDate(o.getDate()+7);return a}catch(s){return console.error("Errore getSuggestedCheckDays:",s),[]}},M=({date:t,view:s})=>{try{if(s==="month"){if(n.some(a=>a.createdAt&&a.createdAt.toDate&&a.createdAt.toDate().toDateString()===t.toDateString()))return"check-submitted";if($(t).some(a=>a.toDateString()===t.toDateString()))return"check-day"}return null}catch(a){return console.error("Errore tileClassName:",a),null}},O=(t,s)=>{try{const a=t.target.files[0];a&&f(o=>({...o,photos:{...o.photos,[s]:a},photoPreviews:{...o.photoPreviews,[s]:URL.createObjectURL(a)}}))}catch(a){console.error("Errore handleFileChange:",a),b("Errore nel caricamento della foto.")}},q=t=>{try{u(t.createdAt.toDate()),f({id:t.id,notes:t.notes||"",weight:t.weight||"",photos:{},photoPreviews:t.photoURLs||{}})}catch(s){console.error("Errore handleEditClick:",s),b("Errore nella modifica del check.")}},B=async t=>{t.preventDefault();const{id:s,notes:a,weight:o,photos:j}=l;if(!g||!s&&Object.values(j).length<4||!o){b("Compila il peso e carica tutte e 4 le foto.");return}_(!0);try{const d=s?n.find(v=>v.id===s):null;let p=d?{...d.photoURLs}:{};await Promise.all(Object.entries(j).map(async([v,S])=>{if(S){const Y=`clients/${g.uid}/checks/${me()}-${S.name}`,P=Q(I,Y);await Z(P,S),p[v]=await ee(P)}}));const h={notes:a,weight:parseFloat(o),photoURLs:p};s?(await te(L(y,`clients/${g.uid}/checks`,s),{...h,lastUpdatedAt:R()}),b("Check modificato con successo!","success")):(await se(U(y,`clients/${g.uid}/checks`),{...h,createdAt:R()}),b("Check caricato con successo!","success")),f({id:null,notes:"",weight:"",photos:{},photoPreviews:{}})}catch(d){console.error("Errore handleSubmit:",d),b("Si è verificato un errore.")}finally{_(!1)}},X=()=>{try{const t=n.find(s=>s.createdAt&&s.createdAt.toDate&&s.createdAt.toDate().toDateString()===x.toDateString());return l.id||!t?e.jsx(xe,{formState:l,setFormState:f,handleSubmit:B,isUploading:D,handleFileChange:O}):t?e.jsx(fe,{check:t,handleEditClick:q}):e.jsx("p",{className:"text-center text-slate-400 p-8",children:"Nessun check previsto o registrato per questa data."})}catch(t){return console.error("Errore renderContentForDate:",t),e.jsx("p",{className:"text-center text-red-400 p-8",children:"Errore nel caricamento del contenuto."})}};return A?e.jsx("div",{className:"min-h-screen bg-zinc-950 text-red-400 flex justify-center items-center",children:A}):k?e.jsx(ge,{}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:ue}),e.jsxs("div",{className:"min-h-screen text-slate-200 p-4 sm:p-8 relative",children:[e.jsx(pe,{message:z.message,type:z.type,onDismiss:()=>N({message:"",type:""})}),e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-50",children:"I miei Check"}),e.jsxs("button",{onClick:()=>C("/client/dashboard"),className:"flex items-center gap-2 px-3 py-2 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm font-semibold rounded-lg transition-colors",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:"Dashboard"})]})]}),e.jsxs(T.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1 bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-4",children:e.jsx(re,{onChange:u,value:x,tileClassName:M})}),e.jsx("div",{className:"lg:col-span-2 bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6 min-h-[400px]",children:X()})]})]})]})}export{qe as default};
