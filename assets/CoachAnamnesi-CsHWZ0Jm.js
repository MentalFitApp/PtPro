import{r as p,j as e}from"./react-CrXOBDSJ.js";import{J as k,I as A,H as M,T,K as z,P as I,A as L,B as R}from"./@firebase-CuwLCerw.js";import{a as $,t as B,d as N}from"./index-CI6shjpy.js";import{a as H}from"./react-router-BxpCmtJ-.js";import{m as b}from"./framer-motion-BAPjnw1b.js";import{u as q,p as F,F as U,b as G}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Bp3EI6Ad.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const J=()=>e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-cyan-400"})});function pe(){const o=H(),[g,u]=p.useState([]),[v,f]=p.useState([]),[y,w]=p.useState(""),[S,h]=p.useState(!0);p.useEffect(()=>{if(!$.currentUser){o("/login");return}const t=k(A(N,"clients")),i=M(t,async c=>{const j=c.docs.map(s=>s.id);if(j.length===0){u([]),f([]),h(!1);return}const P=j.map(async s=>{const d=c.docs.find(a=>a.id===s).data().name||"Cliente",r=k(A(N,"clients",s,"checks"),z("createdAt","desc"),T(3));return(await I(r)).docs.map(a=>{const n=a.data();return{clientId:s,clientName:d,date:n.createdAt,weight:n.weight,notes:n.notes}})}),E=j.map(async s=>{const d=c.docs.find(a=>a.id===s).data().name||"Cliente",r=L(N,"clients",s,"anamnesi","initial"),l=await R(r);if(l.exists()){const a=l.data();return{clientId:s,clientName:d,date:a.submittedAt,goal:a.mainGoal}}return null});try{const[s,d]=await Promise.all([Promise.all(P),Promise.all(E)]),r=s.flat(),l=d.filter(Boolean);r.sort((a,n)=>{var m,x;return(((m=n.date)==null?void 0:m.toMillis())||0)-(((x=a.date)==null?void 0:x.toMillis())||0)}),l.sort((a,n)=>{var m,x;return(((m=n.date)==null?void 0:m.toMillis())||0)-(((x=a.date)==null?void 0:x.toMillis())||0)}),u(r.slice(0,5)),f(l.slice(0,5)),h(!1)}catch(s){console.error("Errore batch:",s),h(!1)}},c=>{console.error("Errore snapshot:",c),h(!1)});return()=>i()},[o]);const C=t=>{var i;return((i=B(t))==null?void 0:i.toLocaleDateString("it-IT"))||"N/D"},D=()=>{u([]),f([]),w("Notifiche svuotate!"),setTimeout(()=>w(""),3e3)};return S?e.jsx(J,{}):e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-50",children:"Anamnesi & Check"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>o("/coach/clients"),className:"flex items-center gap-2 text-sm text-slate-400 hover:text-cyan-400",children:[e.jsx(q,{size:16})," Indietro"]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 text-sm text-slate-400 hover:text-rose-400",title:"Svuota notifiche",children:[e.jsx(F,{size:16})," Svuota notifiche"]})]})]}),y&&e.jsx("div",{className:"mb-3 text-center text-sm font-medium text-rose-400",children:y}),e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl rounded-xl border border-slate-700 p-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-cyan-300 flex items-center gap-2 mb-3",children:[e.jsx(U,{size:18})," Ultimi Check"]}),g.length>0?e.jsx("div",{className:"space-y-2",children:g.map(t=>{var i;return e.jsx(b.div,{whileHover:{scale:1.02},className:"p-2 bg-slate-800/50 rounded-lg border border-white/10 cursor-pointer",onClick:()=>o(`/coach/client/${t.clientId}`),children:e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.clientName}),e.jsx("p",{className:"text-slate-400",children:C(t.date)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-emerald-400",children:[t.weight," kg"]}),t.notes&&e.jsx("p",{className:"text-xs text-slate-400 line-clamp-1",children:t.notes})]})]})},`${t.clientId}-${(i=t.date)==null?void 0:i.toMillis()}`)})}):e.jsx("p",{className:"text-center text-slate-500 text-xs py-4",children:"Nessun check"})]}),e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl rounded-xl border border-slate-700 p-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 flex items-center gap-2 mb-3",children:[e.jsx(G,{size:18})," Nuove Anamnesi"]}),v.length>0?e.jsx("div",{className:"space-y-2",children:v.map(t=>e.jsx(b.div,{whileHover:{scale:1.02},className:"p-2 bg-slate-800/50 rounded-lg border border-white/10 cursor-pointer",onClick:()=>o(`/coach/client/${t.clientId}`),children:e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.clientName}),e.jsx("p",{className:"text-slate-400",children:C(t.date)})]}),e.jsx("p",{className:"text-amber-400 text-right line-clamp-1 max-w-[120px]",children:t.goal||"Nessun obiettivo"})]})},t.clientId))}):e.jsx("p",{className:"text-center text-slate-500 text-xs py-4",children:"Nessuna anamnesi"})]})]})}export{pe as default};
