import{r as l,j as e}from"./react-CrXOBDSJ.js";import{J as z,I as L,H as B,T as M,K as P,P as Q}from"./@firebase-CuwLCerw.js";import{a as A,t as i,d as I}from"./index-LD97HDty.js";import{a as O}from"./react-router-BxpCmtJ-.js";import{m as V}from"./framer-motion-BAPjnw1b.js";import{U as G,k as H,g as J,h as N,j as K,n as R,q as T,A as X,t as W}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Bp3EI6Ad.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const x=({active:o,onClick:p,label:b,icon:k})=>e.jsxs("button",{onClick:p,className:`px-3 py-1 text-sm rounded-md flex items-center gap-1 transition-colors ${o?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:[k," ",b]});function be(){const o=O(),[p,b]=l.useState([]),[k,C]=l.useState(!0),[h,E]=l.useState(""),[n,m]=l.useState("all"),[u,U]=l.useState("startDate"),[f,v]=l.useState("desc");l.useEffect(()=>{if(!A.currentUser){o("/login");return}const t=z(L(I,"clients")),a=B(t,async c=>{const s=c.docs.map(d=>({id:d.id,...d.data()})).map(async d=>{var D,S;const $=z(L(I,"clients",d.id,"checks"),P("createdAt","desc"),M(1)),q=((S=(D=(await Q($)).docs[0])==null?void 0:D.data())==null?void 0:S.createdAt)||null;return{...d,lastCheckDate:q}}),w=await Promise.all(s);b(w),C(!1)},c=>{console.error("Errore snapshot:",c),C(!1)});return()=>a()},[o]);const y=l.useMemo(()=>{let t=p.filter(a=>{if(!((a.name||"").toLowerCase().includes(h.toLowerCase())||(a.email||"").toLowerCase().includes(h.toLowerCase())))return!1;const r=new Date,s=i(a.scadenza),w=s?Math.ceil((s-r)/(1e3*60*60*24)):null;switch(n){case"active":return s&&s>r;case"expiring":return s&&w<=15&&w>0;case"expired":return s&&s<r;case"no-check":return!a.lastCheckDate;case"has-check":return!!a.lastCheckDate;default:return!0}});return t.sort((a,c)=>{let r,s;switch(u){case"name":r=a.name||"",s=c.name||"";break;case"startDate":r=i(a.startDate)||new Date(0),s=i(c.startDate)||new Date(0);break;case"expiry":r=i(a.scadenza)||new Date(0),s=i(c.scadenza)||new Date(0);break;case"lastCheck":r=i(a.lastCheckDate)||new Date(0),s=i(c.lastCheckDate)||new Date(0);break;default:r=0,s=0}return r<s?f==="desc"?1:-1:r>s?f==="desc"?-1:1:0}),t},[p,h,n,u,f]),F=()=>{A.signOut().then(()=>o("/login"))},g=t=>{u===t?v(a=>a==="desc"?"asc":"desc"):(U(t),v("desc"))},j=t=>u!==t?null:f==="desc"?e.jsx(X,{size:14}):e.jsx(W,{size:14});return k?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-rose-500"})}):e.jsx("div",{className:"overflow-x-hidden w-full",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsxs(V.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 sm:p-6",children:[e.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-50 flex items-center gap-2 mb-4 sm:mb-0",children:[e.jsx(G,{size:28})," Gestione Clienti"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{value:h,onChange:t=>E(t.target.value),className:"bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 pl-10 w-full outline-none focus:ring-2 focus:ring-rose-500",placeholder:"Cerca nome o email..."})]}),e.jsxs("button",{onClick:F,className:"flex items-center gap-2 px-3 py-1.5 bg-rose-600 hover:bg-rose-700 text-white text-sm rounded-lg",children:[e.jsx(J,{size:16})," Logout"]})]})]}),e.jsxs("div",{className:"mb-6 flex flex-wrap gap-2 p-2 bg-slate-700/50 border border-slate-600 rounded-lg",children:[e.jsx(x,{active:n==="all",onClick:()=>m("all"),label:"Tutti"}),e.jsx(x,{active:n==="active",onClick:()=>m("active"),label:"Attivi",icon:e.jsx(N,{className:"text-emerald-500",size:14})}),e.jsx(x,{active:n==="expiring",onClick:()=>m("expiring"),label:"In Scadenza",icon:e.jsx(K,{className:"text-amber-500",size:14})}),e.jsx(x,{active:n==="expired",onClick:()=>m("expired"),label:"Scaduti",icon:e.jsx(R,{className:"text-red-500",size:14})}),e.jsx(x,{active:n==="has-check",onClick:()=>m("has-check"),label:"Con Check",icon:e.jsx(N,{className:"text-cyan-500",size:14})}),e.jsx(x,{active:n==="no-check",onClick:()=>m("no-check"),label:"Senza Check",icon:e.jsx(T,{className:"text-gray-500",size:14})})]}),e.jsx("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:e.jsxs("table",{className:"w-full min-w-[800px] text-xs sm:text-sm text-left text-slate-300",children:[e.jsx("thead",{className:"bg-white/5 text-slate-400 uppercase text-[10px] sm:text-xs sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"p-2 sm:p-4 cursor-pointer hover:text-rose-400 flex items-center gap-1 min-w-[150px] sm:min-w-[180px]",onClick:()=>g("name"),children:["Nome ",j("name")]}),e.jsxs("th",{className:"p-2 sm:p-4 cursor-pointer hover:text-rose-400 flex items-center gap-1 min-w-[100px] sm:min-w-[140px]",onClick:()=>g("startDate"),children:["Inizio ",j("startDate")]}),e.jsxs("th",{className:"p-2 sm:p-4 cursor-pointer hover:text-rose-400 flex items-center gap-1 min-w-[120px] sm:min-w-[160px]",onClick:()=>g("expiry"),children:["Scadenza ",j("expiry")]}),e.jsxs("th",{className:"p-2 sm:p-4 cursor-pointer hover:text-rose-400 flex items-center gap-1 min-w-[120px] sm:min-w-[160px]",onClick:()=>g("lastCheck"),children:["Ultimo Check ",j("lastCheck")]})]})}),e.jsxs("tbody",{children:[y.map(t=>{const a=i(t.lastCheckDate),c=i(t.startDate),r=i(t.scadenza),s=r?Math.ceil((r-new Date)/(1e3*60*60*24)):null;return e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-2 sm:p-4 font-medium min-w-[150px] sm:min-w-[180px]",children:e.jsx("button",{onClick:()=>o(`/coach/client/${t.id}`),className:"hover:underline hover:text-rose-400 truncate block max-w-full",children:t.name||"-"})}),e.jsx("td",{className:"p-2 sm:p-4 min-w-[100px] sm:min-w-[140px] text-[10px] sm:text-xs",children:c?c.toLocaleDateString("it-IT"):"N/D"}),e.jsx("td",{className:"p-2 sm:p-4 min-w-[120px] sm:min-w-[160px]",children:r?e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"text-[10px] sm:text-xs",children:r.toLocaleDateString("it-IT")}),s!==null&&e.jsx("span",{className:`text-[9px] sm:text-xs px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full whitespace-nowrap ${s<0?"bg-red-900/80 text-red-300":s<=7?"bg-amber-900/80 text-amber-300":"bg-emerald-900/80 text-emerald-300"}`,children:s<0?"Scaduto":`${s} gg`})]}):"N/D"}),e.jsx("td",{className:"p-2 sm:p-4 min-w-[120px] sm:min-w-[160px]",children:a?e.jsxs("span",{className:"flex items-center gap-1 text-[10px] sm:text-xs",children:[e.jsx(N,{className:"text-emerald-500",size:14}),e.jsx("span",{className:"hidden sm:inline",children:a.toLocaleDateString("it-IT")}),e.jsx("span",{className:"sm:hidden",children:a.toLocaleDateString("it-IT",{day:"2-digit",month:"2-digit"})})]}):e.jsx(T,{className:"text-gray-500",size:14})})]},t.id)}),y.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center p-8 text-slate-400",children:"Nessun cliente trovato."})})]})]})})})]})})})}export{be as default};
