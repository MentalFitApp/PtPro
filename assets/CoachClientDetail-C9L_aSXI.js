var V=Object.defineProperty;var q=(s,a,i)=>a in s?V(s,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[a]=i;var L=(s,a,i)=>q(s,typeof a!="symbol"?a+"":a,i);import{r as o,j as e}from"./react-CrXOBDSJ.js";import{y as T,z as O,H as Q,G as X,I as Z,D as _,x as U,O as F,P as $}from"./@firebase-Dy5qmm0I.js";import{a as J,t as w,d as C}from"./index-BHKKfjAh.js";import{g as K,a as Y,b as ee}from"./react-router-BxpCmtJ-.js";import{m as x,A as te}from"./framer-motion-BAPjnw1b.js";import{U as se,A as ae,a2 as ie,a3 as ne,X as re}from"./lucide-react-7Eidy6wR.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-BzWCke7W.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";class R extends o.Component{constructor(){super(...arguments);L(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(i){return{hasError:!0,error:i}}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-slate-900 text-red-400 flex justify-center items-center p-4",children:e.jsxs("p",{children:["Errore: ",this.state.error.message]})}):this.props.children}}const oe=({src:s,onClose:a})=>e.jsx(te,{children:s&&e.jsxs(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[1000] p-4",onClick:a,children:[e.jsx(x.img,{src:s,alt:"Ingrandita",className:"max-w-full max-h-full object-contain rounded-lg",initial:{scale:.8},animate:{scale:1},onClick:i=>i.stopPropagation()}),e.jsx("button",{onClick:a,className:"absolute top-4 right-4 text-white bg-slate-700/70 rounded-full p-2 hover:bg-slate-700",children:e.jsx(re,{size:24})})]})}),le=({title:s,data:a,photoURLs:i,onImageClick:h,variants:u})=>{const[l,b]=o.useState({}),f=U();return o.useEffect(()=>{(async()=>{if(!i)return;const t=Object.entries(i).map(async([c,r])=>{if(r&&!r.startsWith("http")){const d=await F($(f,r)).catch(()=>null);return{type:c,url:d}}return{type:c,url:r}}),N=await Promise.all(t);b(Object.fromEntries(N.map(c=>[c.type,c.url])))})()},[i]),e.jsxs(x.div,{variants:u,className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-bold text-cyan-300",children:s}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:Object.entries(a).map(([n,t])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-slate-400",children:[n,":"]}),e.jsx("span",{className:"text-slate-200 font-medium",children:t||"N/D"})]},n))}),i&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-300 mb-2",children:"Foto Anamnesi"}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:["front","back","left","right"].map(n=>l[n]?e.jsx(x.img,{src:l[n],alt:n,className:"w-full h-40 object-cover rounded-lg cursor-pointer",onClick:()=>h(l[n]),whileHover:{scale:1.05}},n):e.jsx("div",{className:"w-full h-40 bg-slate-800 rounded-lg flex items-center justify-center text-xs text-slate-500",children:"Nessuna foto"},n))})]})]})},ce=({check:s,onImageClick:a,variants:i})=>{const[h,u]=o.useState({}),[l,b]=o.useState(!0),f=U();o.useEffect(()=>{(async()=>{if(!s.photoURLs)return;const N=Object.entries(s.photoURLs).map(async([r,d])=>{if(d&&!d.startsWith("http")){const p=await F($(f,d)).catch(()=>null);return{type:r,url:p}}return{type:r,url:d}}),c=await Promise.all(N);u(Object.fromEntries(c.map(r=>[r.type,r.url])))})()},[s.photoURLs]);const n=w(s.createdAt);return e.jsxs(x.div,{variants:i,className:"p-4 rounded-lg bg-slate-700/50 border border-slate-600",children:[e.jsxs("p",{className:"text-sm font-semibold text-cyan-300 mb-2",children:["Check del ",n?n.toLocaleDateString("it-IT"):"N/D"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Peso:"}),e.jsxs("span",{className:"ml-2 font-medium text-white",children:[s.weight||"N/D"," kg"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Data:"}),e.jsx("span",{className:"ml-2 font-medium text-white",children:n?n.toLocaleString("it-IT"):"N/D"})]})]}),s.notes&&e.jsxs("p",{className:"mt-3 text-sm text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"Note:"})," ",s.notes]}),s.photoURLs&&e.jsxs("div",{className:"mt-5",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("button",{onClick:()=>b(t=>!t),className:"bg-slate-700 text-white px-2 py-1 rounded hover:bg-slate-700 transition",title:l?"Restringi sezione foto":"Espandi sezione foto",children:l?e.jsx(ie,{size:18}):e.jsx(ne,{size:18})}),e.jsx("span",{className:"text-xs text-slate-400",children:l?"Nascondi foto":"Mostra foto check"})]}),l&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4",children:["front","back","left","right"].map(t=>h[t]?e.jsx(x.img,{src:h[t],alt:t,className:"w-full h-80 object-cover rounded-xl cursor-pointer",style:{maxHeight:"calc(92vh - 220px)"},onClick:()=>a(h[t]),whileHover:{scale:1.03}},t):e.jsx("div",{className:"w-full h-80 bg-slate-700 rounded-xl flex items-center justify-center text-xs text-slate-500",children:"Nessuna foto"},t))})]})]})};function Le(){var k,I,P;const s=K(),a=Y(),i=ee(),[h,u]=o.useState(null),[l,b]=o.useState(null),[f,n]=o.useState([]),[t,N]=o.useState(null),[c,r]=o.useState(!0),[d,p]=o.useState(null),[g,y]=o.useState("info"),j=s.clientId||(()=>{const m=i.pathname.match(/\/coach\/client\/([a-zA-Z0-9_-]+)/);return m?m[1]:null})();o.useEffect(()=>{if(!J.currentUser){a("/login");return}if(!j){p("ID cliente non valido"),r(!1);return}(async()=>{try{const v=T(C,"clients",j),S=await O(v);if(!S.exists()){p("Cliente non trovato"),r(!1);return}b({id:j,...S.data()});const W=T(C,"clients",j,"anamnesi","initial"),A=await O(W);N(A.exists()?A.data():null);const B=Q(X(C,"clients",j,"checks"),Z("createdAt","desc")),M=_(B,z=>{n(z.docs.map(E=>({id:E.id,...E.data()}))),r(!1)},z=>{p("Errore caricamento check"),r(!1)});return()=>M()}catch{p("Errore caricamento dati"),r(!1)}})()},[j,a]);const H={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},D={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};if(d)return e.jsx(R,{children:e.jsx("div",{className:"min-h-screen bg-slate-900 text-red-400 flex justify-center items-center p-4",children:e.jsx("p",{children:d})})});if(c)return e.jsx("div",{className:"min-h-screen flex justify-center items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})});const G=m=>{if(!m)return"N/D";const v=(w(m)-new Date)/(1e3*60*60*24);return v<0?"Scaduto":v<=7?"In scadenza":"Attivo"};return e.jsx(R,{children:e.jsxs(x.div,{initial:"hidden",animate:"visible",variants:H,className:"min-h-screen p-4 sm:p-8",children:[e.jsxs(x.header,{variants:D,className:"flex justify-between items-center mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-50 flex items-center gap-2",children:[e.jsx(se,{size:28})," ",l.name||"Cliente"]}),e.jsxs("button",{onClick:()=>a("/coach/clients"),className:"flex items-center gap-2 px-3 py-2 bg-slate-700 hover:bg-slate-700 text-slate-300 rounded-lg",children:[e.jsx(ae,{size:16})," Indietro"]})]}),e.jsxs(x.div,{variants:D,className:"bg-slate-900/60 backdrop-blur-xl rounded-2xl border border-slate-700 p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6 bg-slate-800/70 p-1 rounded-lg border border-white/10",children:[e.jsx("button",{onClick:()=>y("info"),className:`px-4 py-2 text-sm rounded-md ${g==="info"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Info"}),e.jsxs("button",{onClick:()=>y("check"),className:`px-4 py-2 text-sm rounded-md ${g==="check"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:["Check (",f.length,")"]}),e.jsx("button",{onClick:()=>y("anamnesi"),className:`px-4 py-2 text-sm rounded-md ${g==="anamnesi"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Anamnesi"})]}),g==="info"&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Inizio:"}),e.jsx("span",{className:"font-medium text-white",children:((k=w(l.startDate))==null?void 0:k.toLocaleDateString("it-IT"))||"N/D"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Scadenza:"}),e.jsx("span",{className:"font-medium text-white",children:((I=w(l.scadenza))==null?void 0:I.toLocaleDateString("it-IT"))||"N/D"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Stato:"}),e.jsx("span",{className:"font-medium text-white",children:G(l.scadenza)})]})]}),g==="check"&&e.jsx("div",{className:"space-y-4",children:f.length>0?f.map(m=>e.jsx(ce,{check:m,onImageClick:u,variants:D},m.id)):e.jsx("p",{className:"text-center text-slate-400 py-8",children:"Nessun check"})}),g==="anamnesi"&&e.jsx("div",{children:t?e.jsx(le,{title:"Anamnesi Iniziale",data:{Nome:t.firstName,Cognome:t.lastName,"Data di Nascita":t.birthDate,Lavoro:t.job,Peso:t.weight?`${t.weight} kg`:"N/D",Altezza:t.height?`${t.height} cm`:"N/D","Pasti al Giorno":t.mealsPerDay,"Tipo Colazione":t.breakfastType,"Alimenti Preferiti":t.desiredFoods,"Alimenti da Evitare":t.dislikedFoods,"Allergie/Intolleranze":t.intolerances,"Problemi di Digestione":t.digestionIssues,"Allenamenti a Settimana":t.workoutsPerWeek,"Dettagli Allenamento":t.trainingDetails,"Orario e Durata":t.trainingTime,Infortuni:t.injuries,Farmaci:t.medications,Integratori:t.supplements,"Obiettivo Principale":t.mainGoal,"Durata Percorso":t.programDuration,"Data Invio":t.submittedAt?(P=w(t.submittedAt))==null?void 0:P.toLocaleDateString("it-IT"):"N/D"},photoURLs:t.photoURLs,onImageClick:u,variants:D}):e.jsx("p",{className:"text-center text-slate-400 py-8",children:"Nessuna anamnesi"})})]}),e.jsx(oe,{src:h,onClose:()=>u(null)})]})})}export{Le as default};
