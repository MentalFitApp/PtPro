import{r as c,h as le,g as ie,aK as te,j as e,aC as re,q as S,at as z,b5 as w,aL as ne,av as W,e as B,f as oe,A as ce,b6 as de,a7 as V,a6 as me}from"./.pnpm-C04Ba0Xq.js";import{d as H}from"./index-DdCoIfwr.js";import{u as he}from"./storageUtils-DXx8Ax3l.js";import"./cloudflareStorage-DUIVXCyJ.js";const xe=({message:s,type:g,onDismiss:m})=>e.jsx(ce,{children:s&&e.jsxs(S.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${g==="success"?"bg-emerald-900/80 text-emerald-300 border-emerald-500/30":"bg-red-900/80 text-red-300 border-red-500/30"} backdrop-blur-md shadow-lg`,children:[e.jsx("p",{children:s}),e.jsx("button",{onClick:m,className:"p-2 rounded-full hover:bg-white/10 min-w-[44px] min-h-[44px] flex items-center justify-center",children:e.jsx(W,{size:16})})]})}),U=({type:s,label:g,onFileSelect:m,previewUrl:f,disabled:T})=>{const[p,k]=c.useState(f);c.useEffect(()=>{k(f)},[f]);const A=N=>{const h=N.target.files[0];if(!h)return;if(h.size>10*1024*1024){alert(`File troppo grande: ${h.name}. Limite: 10MB`);return}if(!h.type.startsWith("image/")){alert(`File non valido: ${h.name}`);return}const P=URL.createObjectURL(h);k(P),m(s,h)};return e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:g}),e.jsxs("div",{className:"mt-2 relative group",children:[e.jsx("div",{className:"flex justify-center items-center w-full h-48 bg-slate-700/30 rounded-lg border-2 border-dashed border-slate-600 group-hover:border-cyan-500 transition-colors cursor-pointer",children:p?e.jsx("img",{src:p,alt:g,className:"h-full w-full object-contain rounded-lg p-1"}):e.jsxs("div",{className:"flex flex-col items-center text-slate-400 group-hover:text-cyan-400",children:[e.jsx(de,{size:32}),e.jsx("p",{className:"mt-2 text-sm",children:"Clicca per caricare"})]})}),e.jsx("input",{type:"file",accept:"image/*",onChange:A,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:T})]})]})},fe=()=>{const[s,g]=c.useState(null),[m,f]=c.useState(!0),[T,p]=c.useState(!1),[k,A]=c.useState({front:null,right:null,left:null,back:null}),[N,h]=c.useState({front:null,right:null,left:null,back:null}),[P,D]=c.useState({message:"",type:""}),G=l=>Object.values(l).some(a=>a),M="https://media.flowfitpro.it",C=c.useCallback(l=>{if(!l||typeof l!="object")return l;const a={};for(const[d,o]of Object.entries(l)){if(!o){a[d]=o;continue}/^https?:\/\//i.test(o)?a[d]=o:a[d]=`${M}/${o}`}return a},[M]),I=le(),v=ie().currentUser,{register:i,handleSubmit:K,setValue:q,formState:{isSubmitting:b}}=te();c.useEffect(()=>{if(!v){I("/login");return}(async()=>{try{const a=B(H,`clients/${v.uid}/anamnesi`,"initial"),d=await oe(a);if(d.exists()){const o=d.data(),j=C(o.photoURLs);o.photoURLs=j,g(o),j&&h(j),console.debug("[Anamnesi] Loaded photoURLs:",j),Object.keys(o).forEach(y=>q(y,o[y])),p(!1)}else p(!0)}catch(a){D({message:`Errore: ${a.message}`,type:"error"})}f(!1)})()},[v,I,q]);const E=c.useCallback((l,a="error")=>{D({message:l,type:a}),setTimeout(()=>D({message:"",type:""}),5e3)},[]),L=c.useCallback((l,a)=>{A(d=>({...d,[l]:a})),E(`Foto ${l} caricata!`,"success")},[E]),[$,F]=c.useState(0),X=async l=>{if(!(!v||b)){f(!0),F(0);try{await v.getIdToken(!0);let a=(s==null?void 0:s.photoURLs)||{front:null,right:null,left:null,back:null};const d=Object.entries(k).filter(([,j])=>j!==null);if(d.length>0){const j=100/d.length;let y=0;const Q=d.map(async([O,R],Z)=>{const ee=await he(R,v.uid,"anamnesi_photos",se=>{const ae=Math.min(100,Math.round(y+se.percent/100*j));F(ae)});return y=j*(Z+1),F(Math.min(100,Math.round(y))),{type:O,url:ee}}),Y=await Promise.all(Q);a={...a,...Object.fromEntries(Y.map(({type:O,url:R})=>[O,R]))},console.debug("[Anamnesi] Uploaded photoURLs temp:",a)}const o={...l,photoURLs:C(a),submittedAt:V(),createdAt:V()};await me(B(H,`clients/${v.uid}/anamnesi`,"initial"),o,{merge:!0}),g(o),A({front:null,right:null,left:null,back:null}),h(C(a)),console.debug("[Anamnesi] Saved photoURLs:",C(a)),p(!1),E("Anamnesi salvata!","success")}catch(a){E(`Errore: ${a.message}`,"error")}finally{setTimeout(()=>{f(!1),F(0)},500)}}},_=c.useCallback(()=>{A({front:null,right:null,left:null,back:null}),h((s==null?void 0:s.photoURLs)||{front:null,right:null,left:null,back:null}),p(!1)},[s]);if(m)return e.jsx("div",{className:"min-h-screen flex justify-center items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})});const t="w-full p-2.5 mt-1 bg-slate-700/50 border border-slate-600 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder:text-slate-400",r="block text-sm font-medium text-slate-300",x="bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6 shadow-lg",u="font-bold mb-4 text-lg text-cyan-300 border-b border-cyan-400/20 pb-2 flex items-center gap-2",n=({label:l,value:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400",children:l}),e.jsx("p",{className:"mt-1 p-3 bg-slate-700/50 rounded-lg min-h-[44px] text-white break-words whitespace-pre-wrap shadow-inner",children:a||"Non specificato"})]}),J=({urls:l})=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:["front","right","left","back"].map(a=>e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 capitalize",children:a==="front"?"Frontale":a==="back"?"Posteriore":`Laterale ${a==="left"?"Sinistro":"Destro"}`}),l!=null&&l[a]?e.jsx(S.img,{src:l[a],alt:a,className:"mt-2 rounded-lg w-full h-48 object-cover hover:scale-105 transition-transform",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3}}):e.jsx("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-slate-700/50 rounded-lg text-slate-500",children:e.jsx("span",{children:"Non caricata"})})]},a))});return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx(xe,{message:P.message,type:P.type,onDismiss:()=>D({message:"",type:""})}),e.jsxs("header",{className:"flex justify-between items-center mb-8 flex-col sm:flex-row gap-4",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-white",children:"Anamnesi Cliente"}),e.jsxs("button",{onClick:()=>I("/client/dashboard"),className:"flex items-center gap-2 px-4 py-2 bg-slate-700/50 hover:bg-slate-700/70 text-slate-300 text-sm font-semibold rounded-lg transition-colors border border-slate-600",children:[e.jsx(re,{size:16})," Torna alla dashboard"]})]}),e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},children:T?e.jsxs("form",{onSubmit:K(X),className:"space-y-8",children:[e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(z,{size:16})," Dati Anagrafici e Misure"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Nome"}),e.jsx("input",{...i("firstName"),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Cognome"}),e.jsx("input",{...i("lastName"),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Data di Nascita"}),e.jsx("input",{type:"date",...i("birthDate"),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Che lavoro fai?"}),e.jsx("input",{...i("job"),className:t,placeholder:"Es. Impiegato, studente..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Peso (kg)"}),e.jsx("input",{type:"number",step:"0.1",...i("weight"),className:t,placeholder:"Es. 75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Altezza (cm)"}),e.jsx("input",{type:"number",...i("height"),className:t,placeholder:"Es. 180"})]})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(w,{size:16})," Abitudini Alimentari"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Pasti al giorno"}),e.jsxs("select",{...i("mealsPerDay"),className:t,children:[e.jsx("option",{value:"",children:"Seleziona..."}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Colazione: Dolce o Salata?"}),e.jsxs("select",{...i("breakfastType"),className:t,children:[e.jsx("option",{value:"",children:"Seleziona..."}),e.jsx("option",{value:"dolce",children:"Dolce"}),e.jsx("option",{value:"salato",children:"Salato"}),e.jsx("option",{value:"entrambi",children:"Entrambi/Indifferente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Alimenti che ti piacciono"}),e.jsx("textarea",{...i("desiredFoods"),rows:"3",className:t,placeholder:"Elenca qui gli alimenti che vorresti nel piano..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Cosa non mangi?"}),e.jsx("textarea",{...i("dislikedFoods"),rows:"2",className:t,placeholder:"Elenca qui gli alimenti da evitare..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Allergie o Intolleranze?"}),e.jsx("input",{...i("intolerances"),className:t,placeholder:"Es. Lattosio, nessuna..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Problemi di digestione o gonfiore?"}),e.jsx("input",{...i("digestionIssues"),className:t,placeholder:"Sì/No, e se sì quali..."})]})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(z,{size:16})," Allenamento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Allenamenti a settimana"}),e.jsx("input",{type:"number",...i("workoutsPerWeek"),className:t,placeholder:"Es. 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Dettagli Allenamento"}),e.jsx("textarea",{...i("trainingDetails"),rows:"3",className:t,placeholder:"Es. Bodybuilding in palestra con macchinari e pesi liberi..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Orario e Durata"}),e.jsx("input",{...i("trainingTime"),className:t,placeholder:"Es. La sera dalle 18 alle 19:30"})]})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(w,{size:16})," Salute e Obiettivi"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Infortuni o problematiche"}),e.jsx("textarea",{...i("injuries"),rows:"3",className:t,placeholder:"Es. Mal di schiena, ernie, dolori articolari..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Prendi farmaci?"}),e.jsx("input",{...i("medications"),className:t,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Usi integratori?"}),e.jsx("input",{...i("supplements"),className:t,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Obiettivo Principale"}),e.jsx("textarea",{...i("mainGoal"),rows:"3",className:t,placeholder:"Descrivi in dettaglio cosa vuoi raggiungere..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:r,children:"Durata Percorso"}),e.jsx("input",{...i("programDuration"),className:t,placeholder:"Es. 3 mesi, 6 mesi..."})]})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(w,{size:16})," Foto Iniziali"]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Carica 4 foto per il check iniziale: frontale, laterale destro, laterale sinistro e posteriore. Visibili solo a te e al coach."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(U,{type:"front",label:"Frontale",onFileSelect:L,previewUrl:N.front,disabled:m||b}),e.jsx(U,{type:"right",label:"Laterale Destro",onFileSelect:L,previewUrl:N.right,disabled:m||b}),e.jsx(U,{type:"left",label:"Laterale Sinistro",onFileSelect:L,previewUrl:N.left,disabled:m||b}),e.jsx(U,{type:"back",label:"Posteriore",onFileSelect:L,previewUrl:N.back,disabled:m||b})]})]}),G(k)&&$>0&&e.jsx("div",{className:"w-full bg-slate-700/50 rounded-lg h-3 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-cyan-500 via-cyan-400 to-teal-400 transition-all",style:{width:`${$}%`}})}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsxs(S.button,{type:"submit",disabled:b||m,className:"flex items-center gap-2 px-5 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(ne,{size:16})," ",b?`Upload ${$}%`:"Salva Anamnesi"]}),e.jsxs(S.button,{type:"button",onClick:_,disabled:b||m,className:"flex items-center gap-2 px-5 py-2.5 bg-slate-700/50 hover:bg-slate-700/70 text-white rounded-lg font-semibold border border-slate-600",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(W,{size:16})," Annulla"]})]})]}):s&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(z,{size:16})," Dati Anagrafici"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(n,{label:"Nome",value:s.firstName}),e.jsx(n,{label:"Cognome",value:s.lastName}),e.jsx(n,{label:"Data di Nascita",value:s.birthDate}),e.jsx(n,{label:"Lavoro",value:s.job}),e.jsx(n,{label:"Peso (kg)",value:s.weight}),e.jsx(n,{label:"Altezza (cm)",value:s.height})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(w,{size:16})," Abitudini Alimentari"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{label:"Pasti al giorno",value:s.mealsPerDay}),e.jsx(n,{label:"Tipo Colazione",value:s.breakfastType}),e.jsx(n,{label:"Alimenti preferiti",value:s.desiredFoods}),e.jsx(n,{label:"Alimenti da evitare",value:s.dislikedFoods}),e.jsx(n,{label:"Allergie/Intolleranze",value:s.intolerances}),e.jsx(n,{label:"Problemi di digestione",value:s.digestionIssues})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(z,{size:16})," Allenamento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{label:"Allenamenti a settimana",value:s.workoutsPerWeek}),e.jsx(n,{label:"Dettagli Allenamento",value:s.trainingDetails}),e.jsx(n,{label:"Orario e Durata",value:s.trainingTime})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(w,{size:16})," Salute e Obiettivi"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{label:"Infortuni o problematiche",value:s.injuries}),e.jsx(n,{label:"Farmaci",value:s.medications}),e.jsx(n,{label:"Integratori",value:s.supplements}),e.jsx(n,{label:"Obiettivo Principale",value:s.mainGoal}),e.jsx(n,{label:"Durata Percorso",value:s.programDuration})]})]}),e.jsxs("div",{className:x,children:[e.jsxs("h4",{className:u,children:[e.jsx(w,{size:16})," Foto Iniziali"]}),e.jsx(J,{urls:s.photoURLs})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(S.button,{onClick:()=>p(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-slate-700/50 hover:bg-slate-700/70 text-slate-300 rounded-lg font-semibold border border-slate-600",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(z,{size:16})," Modifica Dati"]})})]})})]})};export{fe as default};
