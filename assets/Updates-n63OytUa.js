import{r as n,j as t}from"./react-CrXOBDSJ.js";import{d as g}from"./index-s4mEkYh8.js";import{D as j,G as J,H as M,Q as O,I as B,J as F}from"./@firebase-Dy5qmm0I.js";import{a as G}from"./react-router-BxpCmtJ-.js";import{m as d,A as L}from"./framer-motion-BAPjnw1b.js";import{k as P,I as T,F as $,X as z}from"./lucide-react-OWEKwkjs.js";import"./core-js-ChGsxLo2.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-CCo3Hvf0.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";function b(s){if(!s)return null;if(typeof(s==null?void 0:s.toDate)=="function")return s.toDate();const a=new Date(s);return isNaN(a)?null:a}const N=({title:s,icon:a,items:l,navigate:p,tab:u,onDismiss:x})=>t.jsxs(d.div,{variants:{hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-4 flex-1 min-w-[280px]",children:[t.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2 text-slate-200",children:[a," ",s]}),t.jsx("div",{className:"space-y-2",children:t.jsx(L,{children:l.length>0?l.map(r=>{var o;return t.jsxs(d.div,{layout:!0,initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.9,transition:{duration:.2}},className:"group flex items-center justify-between p-2 rounded-md hover:bg-white/5",children:[t.jsxs("button",{className:"flex-1 text-left",onClick:()=>p(`/client/${r.clientId}?tab=${u}`),children:[t.jsx("p",{className:"font-medium text-sm text-slate-200 group-hover:text-rose-400 transition-colors",children:r.clientName}),t.jsx("p",{className:"text-xs text-slate-400",children:(o=b(r.date))==null?void 0:o.toLocaleDateString("it-IT",{day:"numeric",month:"long"})})]}),t.jsx("button",{onClick:()=>x(r.id),className:"p-1.5 rounded-full text-slate-500 opacity-0 group-hover:opacity-70 hover:!opacity-100 hover:bg-white/10 hover:text-slate-200 transition-all",title:"Archivia notifica",children:t.jsx(z,{size:14})})]},r.id)}):t.jsx("p",{className:"text-sm text-slate-500 px-2 py-4 text-center",children:"Nessun aggiornamento."})})})]});function pe(){const s=G(),[a,l]=n.useState([]),[p,u]=n.useState([]),[x,r]=n.useState([]),[o,v]=n.useState(()=>{const e=sessionStorage.getItem("dismissedUpdates");return e?JSON.parse(e):[]});n.useEffect(()=>{sessionStorage.setItem("dismissedUpdates",JSON.stringify(o))},[o]),n.useEffect(()=>{const e=j(J(g,"clients"),i=>{l(i.docs.map(m=>({id:m.id,...m.data()})))});return()=>e()},[]);const f=n.useMemo(()=>a.reduce((e,i)=>({...e,[i.id]:i.name}),{}),[a]);n.useEffect(()=>{if(Object.keys(f).length===0)return;const e=(S,I)=>{const U=M(F(g,S),B("createdAt","desc"),O(30));return j(U,E=>{const q=E.docs.map(c=>{const y=c.ref.path.split("/")[1];return{id:c.id,clientId:y,clientName:f[y],date:c.data().createdAt}}).filter(c=>c.clientName);I(q.slice(0,10))})},i=e("checks",u),m=e("anamnesi",r);return()=>{i(),m()}},[f]);const w=n.useMemo(()=>[...a].sort((e,i)=>(b(i.createdAt)||0)-(b(e.createdAt)||0)).slice(0,10).map(e=>({id:e.id,clientId:e.id,clientName:e.name,date:e.createdAt})),[a]),h=e=>{v(i=>[...i,e])},A=w.filter(e=>!o.includes(e.id)),C=p.filter(e=>!o.includes(e.id)),k=x.filter(e=>!o.includes(e.id)),D={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.15}}};return t.jsxs("div",{className:"w-full",children:[t.jsx(d.h1,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"text-3xl font-bold mb-6 text-slate-50",children:"Ultimi Aggiornamenti"}),t.jsxs(d.div,{className:"flex flex-col md:flex-row gap-6",variants:D,initial:"hidden",animate:"visible",children:[t.jsx(N,{title:"Nuovi Clienti",icon:t.jsx(P,{className:"text-rose-400"}),items:A,navigate:s,tab:"anamnesi",onDismiss:h}),t.jsx(N,{title:"Nuovi Check",icon:t.jsx(T,{className:"text-emerald-400"}),items:C,navigate:s,tab:"checks",onDismiss:h}),t.jsx(N,{title:"Nuove Anamnesi",icon:t.jsx($,{className:"text-amber-400"}),items:k,navigate:s,tab:"anamnesi",onDismiss:h})]})]})}export{pe as default};
