import{h as Q,r as n,W as v,V as S,T as U,aO as R,j as e,x as X,U as P,bC as A,a1 as Y,a5 as L,M as Z,aI as ee,f as te,e as se,a9 as ae,ad as le,ac as re,bl as oe,ae as ce,af as ne,ag as ie}from"./.pnpm-C04Ba0Xq.js";import{a as O,d as N}from"./index-DdCoIfwr.js";ae.register(le,re,oe,ce,ne,ie);function me(){const D=Q(),[u,$]=n.useState(!1),[z,q]=n.useState(!0),[d,C]=n.useState(()=>{const t=new Date;return t.setDate(t.getDate()-6),t.toISOString().split("T")[0]}),[x,k]=n.useState(()=>new Date().toISOString().split("T")[0]),[h,B]=n.useState([]),[b,_]=n.useState([]),[f,H]=n.useState([]),[T,W]=n.useState([]),[I,V]=n.useState({});n.useEffect(()=>{(async()=>{if(!O.currentUser){D("/login");return}const s=await te(se(N,"roles","admins")),a=s.exists()?s.data().uids||[]:[];$(a.includes(O.currentUser.uid)),q(!1)})()},[D]),n.useEffect(()=>{if(!u)return;const t=v(S(N,"collaboratori")),s=U(t,a=>{const r={},o=a.docs.map(l=>{var p;const c=l.data();if(!(c.ruolo==="Setter"||c.role==="Setter"))return null;const j=l.id,m=c.nome||c.name||((p=c.email)==null?void 0:p.split("@")[0])||j;return r[j]=m,{uid:j,name:m,photoURL:c.photoURL||"/default-avatar.png",dailyReports:Array.isArray(c.dailyReports)?c.dailyReports:[]}}).filter(Boolean);W(o),V(r)});return()=>s()},[u]),n.useEffect(()=>{if(!u)return;const t=new Date(d),s=new Date(x);s.setHours(23,59,59,999);const a=v(S(N,"salesReports"),R("date",">=",d),R("date","<=",x)),r=v(S(N,"settingReports"),R("date",">=",d),R("date","<=",x)),o=v(S(N,"leads")),l=[U(a,c=>B(c.docs.map(i=>i.data()))),U(r,c=>_(c.docs.map(i=>i.data()))),U(o,c=>{const j=c.docs.map(m=>({id:m.id,...m.data()})).filter(m=>{var M;const p=(M=m.timestamp)==null?void 0:M.toDate();return p&&p>=t&&p<=s});H(j)})];return()=>l.forEach(c=>c())},[u,d,x]);const F=n.useMemo(()=>{const t={};return f.forEach(s=>{const a=s.collaboratoreId||"unknown",r=I[a]||s.collaboratoreNome||"Sconosciuto";t[a]||(t[a]={uid:a,name:r,total:0,showUp:0,chiuso:0}),t[a].total++,s.showUp&&t[a].showUp++,s.chiuso&&t[a].chiuso++}),Object.values(t).sort((s,a)=>a.total-s.total)},[f,I]),E=n.useMemo(()=>{if(T.length===0)return[];const t=new Date(d),s=new Date(x);s.setHours(23,59,59,999);const a=[];return T.forEach(r=>{(Array.isArray(r.dailyReports)?r.dailyReports:[]).forEach(l=>{if(!(l!=null&&l.date)||!l.tracker)return;const c=new Date(l.date);if(c<t||c>s)return;const i=l.tracker;a.push({uid:r.uid,name:r.name,outreachTotale:parseInt(i.outreachTotale)||0,followUpsTotali:parseInt(i.followUpsTotali)||0,risposte:parseInt(i.risposte)||0,callPrenotate:parseInt(i.callPrenotate)||0})})}),a},[T,d,x]),y=n.useMemo(()=>{const t={};return E.forEach(s=>{t[s.uid]||(t[s.uid]={name:s.name,outreachTotale:0,followUpsTotali:0,risposte:0,callPrenotate:0}),t[s.uid].outreachTotale+=s.outreachTotale,t[s.uid].followUpsTotali+=s.followUpsTotali,t[s.uid].risposte+=s.risposte,t[s.uid].callPrenotate+=s.callPrenotate}),Object.values(t)},[E]),g=n.useMemo(()=>{const t=h.reduce((o,l)=>o+(parseInt(l.chiamateFissate)||0),0),s=h.reduce((o,l)=>o+(parseInt(l.chiamateFatte)||0),0),a=h.reduce((o,l)=>o+(parseInt(l.offersFatte)||0),0),r=h.reduce((o,l)=>o+(parseInt(l.chiuse)||0),0);return{fissate:t,fatte:s,offers:a,chiuse:r,showUpRate:t>0?(s/t*100).toFixed(1):"0.0",warmRate:s>0?(a/s*100).toFixed(1):"0.0",closeRate:a>0?(r/a*100).toFixed(1):"0.0"}},[h]),w=n.useMemo(()=>{const t=b.reduce((o,l)=>o+(parseInt(l.dialedFatti)||0),0),s=b.reduce((o,l)=>o+(parseInt(l.dialedRisposte)||0),0),a=b.reduce((o,l)=>o+(parseInt(l.followUpsFatti)||0),0),r=b.reduce((o,l)=>o+(parseInt(l.chiamatePrenotate)||0),0);return{dialed:t,risposte:s,followUps:a,prenotate:r,risposteRate:t>0?(s/t*100).toFixed(1):"0.0",prenotateRate:s>0?(r/s*100).toFixed(1):"0.0"}},[b]),G=f.length,J=f.filter(t=>t.showUp).length,K=f.filter(t=>t.chiuso).length;return z?e.jsx("div",{className:"p-6 text-center text-slate-400",children:"Caricamento..."}):u?e.jsxs("div",{className:"p-3 sm:p-6 max-w-7xl mx-auto space-y-6 sm:space-y-10 mobile-safe-bottom",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4",children:[e.jsxs("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-slate-100 flex items-center gap-2 sm:gap-3",children:[e.jsx(X,{size:24,className:"sm:w-7 sm:h-7 lg:w-8 lg:h-8"})," Statistiche Complete"]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:gap-3 w-full sm:w-auto",children:[e.jsx("input",{type:"date",value:d,onChange:t=>C(t.target.value),className:"px-2 sm:px-4 py-1.5 sm:py-2 bg-slate-800 text-slate-100 rounded-lg border border-slate-700 focus:outline-none focus:border-blue-500 text-xs sm:text-sm flex-1 sm:flex-none"}),e.jsx("span",{className:"text-slate-400 text-xs sm:text-base",children:"â†’"}),e.jsx("input",{type:"date",value:x,onChange:t=>k(t.target.value),className:"px-2 sm:px-4 py-1.5 sm:py-2 bg-slate-800 text-slate-100 rounded-lg border border-slate-700 focus:outline-none focus:border-blue-500 text-xs sm:text-sm flex-1 sm:flex-none"}),e.jsx("button",{onClick:()=>{const t=new Date;t.setDate(t.getDate()-6),C(t.toISOString().split("T")[0]),k(new Date().toISOString().split("T")[0])},className:"px-3 sm:px-4 py-1.5 sm:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-xs sm:text-sm whitespace-nowrap",children:"Ultimi 7 giorni"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-6",children:[e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-5 border border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:"Lead Totali"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-amber-300",children:G})]}),e.jsx(P,{size:24,className:"sm:w-7 sm:h-7 text-amber-400"})]})}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-5 border border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:"Show-Up"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-emerald-300",children:J})]}),e.jsx(A,{size:24,className:"sm:w-7 sm:h-7 text-emerald-400"})]})}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-5 border border-slate-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs sm:text-sm text-slate-400",children:"Chiusi"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-rose-300",children:K})]}),e.jsx(Y,{size:24,className:"sm:w-7 sm:h-7 text-rose-400"})]})})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-3 sm:gap-6",children:[{label:"Call Fissate",value:g.fissate,color:"text-amber-300"},{label:"Call Fatte",value:g.fatte,color:"text-green-300"},{label:"Show-Up",value:`${g.showUpRate}%`,color:"text-emerald-300"},{label:"Warm",value:`${g.warmRate}%`,color:"text-yellow-300"},{label:"Close",value:`${g.closeRate}%`,color:"text-rose-300"}].map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-5 border border-slate-700",children:[e.jsx("p",{className:"text-xs sm:text-sm text-slate-400 truncate",children:t.label}),e.jsx("p",{className:`text-xl sm:text-2xl font-bold ${t.color} truncate`,children:t.value})]},s))}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6",children:[{label:"Dialed",value:w.dialed,color:"text-blue-300"},{label:"Risposte",value:`${w.risposteRate}%`,color:"text-cyan-300"},{label:"Follow-Ups",value:w.followUps,color:"text-green-300"},{label:"Prenotate",value:`${w.prenotateRate}%`,color:"text-rose-300"}].map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-5 border border-slate-700",children:[e.jsx("p",{className:"text-xs sm:text-sm text-slate-400 truncate",children:t.label}),e.jsx("p",{className:`text-xl sm:text-2xl font-bold ${t.color} truncate`,children:t.value})]},s))}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(P,{size:24,className:"sm:w-7 sm:h-7"})," Lead per Setter"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-6",children:[F.map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-5 border border-slate-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-slate-600 rounded-full flex items-center justify-center text-xs font-bold text-slate-300",children:t.name.charAt(0).toUpperCase()}),e.jsx("h3",{className:"text-base sm:text-lg font-semibold text-slate-100 truncate",children:t.name})]})}),e.jsxs("div",{className:"space-y-1.5 sm:space-y-2 text-xs sm:text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Lead Totali"}),e.jsx("span",{className:"font-bold text-amber-300",children:t.total})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Show-Up"}),e.jsxs("span",{className:"font-bold text-emerald-300",children:[t.showUp," (",t.total>0?(t.showUp/t.total*100).toFixed(1):0,"%)"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Chiusi"}),e.jsxs("span",{className:"font-bold text-rose-300",children:[t.chiuso," (",t.total>0?(t.chiuso/t.total*100).toFixed(1):0,"%)"]})]})]})]},s)),F.length===0&&e.jsx("div",{className:"col-span-full text-center py-8 text-slate-400 text-sm",children:"Nessun lead nel periodo"})]})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-8",children:[e.jsxs("h2",{className:"text-xl sm:text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(L,{size:24,className:"sm:w-7 sm:h-7"})," DMS Tracker - Confronto"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-6",children:[{title:"Outreach Totale",key:"outreachTotale",color:"text-amber-300",icon:Z},{title:"Follow-Ups",key:"followUpsTotali",color:"text-green-300",icon:ee},{title:"Risposte",key:"risposte",color:"text-cyan-300",icon:A},{title:"Call Prenotate",key:"callPrenotate",color:"text-rose-300",icon:L}].map((t,s)=>e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-5 border border-slate-700",children:[e.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-slate-100 mb-2 sm:mb-3 flex items-center gap-1.5 sm:gap-2",children:[e.jsx(t.icon,{size:16,className:"sm:w-5 sm:h-5"})," ",e.jsx("span",{className:"truncate",children:t.title})]}),e.jsx("div",{className:"space-y-1.5 sm:space-y-2",children:y.length===0?e.jsx("p",{className:"text-xs text-slate-500 italic text-center",children:"Nessun dato"}):y.sort((a,r)=>r[t.key]-a[t.key]).slice(0,5).map((a,r)=>e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm",children:[e.jsx("span",{className:"text-slate-300 truncate max-w-[120px] sm:max-w-[150px]",children:a.name}),e.jsx("span",{className:`font-bold ${t.color} whitespace-nowrap ml-2`,children:a[t.key]})]},r))})]},s))}),e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-xl p-3 sm:p-6 border border-slate-700",children:[e.jsx("h3",{className:"text-sm sm:text-lg font-semibold text-slate-200 mb-3 sm:mb-4",children:"Tabella Completa DMS"}),e.jsx("div",{className:"mobile-table-wrapper relative -mx-3 sm:mx-0",children:e.jsxs("table",{className:"w-full text-xs sm:text-sm text-left min-w-[500px]",children:[e.jsx("thead",{className:"text-[10px] sm:text-xs uppercase bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3",children:"Setter"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Out"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center hidden sm:table-cell",children:"Follow-Up"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Risp"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Call"})]})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"text-center py-8 text-slate-400",children:"Nessun dato DMS"})}):y.map((t,s)=>e.jsxs("tr",{className:"border-t border-slate-700 hover:bg-slate-700/30",children:[e.jsxs("td",{className:"px-2 sm:px-4 py-2 sm:py-3 flex items-center gap-1 sm:gap-2",children:[e.jsx("div",{className:"w-6 h-6 sm:w-8 sm:h-8 bg-slate-600 rounded-full flex items-center justify-center text-[10px] sm:text-xs font-bold text-slate-300",children:t.name.charAt(0).toUpperCase()}),e.jsx("span",{className:"font-medium text-slate-100 text-xs sm:text-sm truncate",children:t.name})]}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-amber-300 font-bold text-xs sm:text-sm",children:t.outreachTotale}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-green-300 font-bold text-xs sm:text-sm hidden sm:table-cell",children:t.followUpsTotali}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-cyan-300 font-bold text-xs sm:text-sm",children:t.risposte}),e.jsx("td",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center text-rose-300 font-bold text-xs sm:text-sm",children:t.callPrenotate})]},s))})]})})]})]})]}):null}export{me as default};
