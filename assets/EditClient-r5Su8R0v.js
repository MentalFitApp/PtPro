import{h as $,E as I,aK as A,r as g,j as e,q as h,av as j,aL as L,e as N,f as k,u as q,A as F}from"./.pnpm-C04Ba0Xq.js";import{d as S}from"./index-DdCoIfwr.js";const P=a=>{if(!a)return"";try{const t=typeof a.toDate=="function"?a.toDate():new Date(a);if(isNaN(t))return"";const r=t.getFullYear(),b=String(t.getMonth()+1).padStart(2,"0"),c=String(t.getDate()).padStart(2,"0");return`${r}-${b}-${c}`}catch(t){return console.error("Errore in formatDateForInput:",t),""}},T=({message:a,type:t,onDismiss:r})=>e.jsx(F,{children:a&&e.jsxs(h.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${t==="error"?"bg-red-900/80 text-red-300 border-red-500/30":"bg-emerald-900/80 text-emerald-300 border-emerald-500/30"} backdrop-blur-md shadow-lg`,children:[e.jsx("p",{children:a}),e.jsx("button",{onClick:r,className:"p-2 rounded-full hover:bg-white/10 min-w-[44px] min-h-[44px] flex items-center justify-center",children:e.jsx(j,{size:16})})]})});function R(){const a=$(),{clientId:t}=I(),{register:r,handleSubmit:b,reset:c,formState:{isSubmitting:p,errors:i}}=A({defaultValues:{name:"",email:"",phone:"",status:"attivo",scadenza:""}}),[w,z]=g.useState(""),[D,C]=g.useState(!0),[v,f]=g.useState({message:"",type:""}),l=(n,s="error")=>{f({message:n,type:s}),setTimeout(()=>f({message:"",type:""}),6e3)};g.useEffect(()=>{if(!t){l("ID cliente non valido.","error"),a("/clients");return}(async()=>{try{const s=N(S,"clients",t),x=await k(s);if(x.exists()){const o=x.data();z(o.name||"Cliente"),c({name:o.name||"",email:o.email||"",phone:o.phone||"",status:o.status||"attivo",scadenza:P(o.scadenza)})}else l("Cliente non trovato.","error"),a("/clients")}catch(s){console.error("Errore nel caricamento del cliente:",s.code,s.message),l(`Errore nel caricamento del cliente: ${s.message}`,"error"),a("/clients")}finally{C(!1)}})()},[t,c,a]);const E=async n=>{try{const s=N(S,"clients",t),x={name:n.name,email:n.email,phone:n.phone||null,status:n.status,scadenza:n.scadenza?new Date(n.scadenza):null};await q(s,x),l("Cliente aggiornato con successo!","success"),a(`/client/${t}`)}catch(s){console.error("Errore nell'aggiornamento del cliente:",s.code,s.message),s.code==="permission-denied"?l("Permessi insufficienti per aggiornare il cliente.","error"):l(`Errore nell'aggiornamento del cliente: ${s.message}`,"error")}},y=()=>{c(),a(`/client/${t}`)},d="w-full p-2.5 bg-slate-700/50 border border-slate-600 rounded-lg outline-none focus:ring-2 focus:ring-rose-500 transition-all text-slate-200",m="block mb-1.5 text-sm font-medium text-slate-400",u="text-red-500 text-sm mt-1";return D?e.jsx("div",{className:"text-center p-8 text-slate-400",children:"Caricamento dati cliente..."}):e.jsxs(e.Fragment,{children:[e.jsx(T,{message:v.message,type:v.type,onDismiss:()=>f({message:"",type:""})}),e.jsxs(h.div,{className:"w-full max-w-2xl mx-auto bg-slate-900/60 backdrop-blur-xl rounded-xl border border-slate-700 p-6 sm:p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-50",children:"Modifica Cliente"}),e.jsx("p",{className:"text-rose-500 font-semibold",children:w})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 rounded-lg text-sm text-slate-300 transition-colors",children:[e.jsx(j,{size:16})," Annulla"]})]}),e.jsxs("form",{onSubmit:b(E),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Nome e Cognome*"}),e.jsx("input",{...r("name",{required:"Il nome è obbligatorio",minLength:{value:2,message:"Il nome deve essere lungo almeno 2 caratteri"}}),className:d}),i.name&&e.jsx("p",{className:u,children:i.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Email*"}),e.jsx("input",{type:"email",...r("email",{required:"L'email è obbligatoria",pattern:{value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"Inserisci un'email valida"}}),className:d}),i.email&&e.jsx("p",{className:u,children:i.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Telefono (Opzionale)"}),e.jsx("input",{...r("phone",{pattern:{value:/^\+?[0-9]{7,15}$/,message:"Inserisci un numero di telefono valido (7-15 cifre)"}}),className:d}),i.phone&&e.jsx("p",{className:u,children:i.phone.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 pt-5 border-t border-white/10",children:[e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Stato Cliente*"}),e.jsxs("select",{...r("status",{required:"Lo stato è obbligatorio"}),className:d,children:[e.jsx("option",{value:"attivo",children:"Attivo"}),e.jsx("option",{value:"in prova",children:"In Prova"}),e.jsx("option",{value:"sospeso",children:"Sospeso"}),e.jsx("option",{value:"scaduto",children:"Scaduto"})]}),i.status&&e.jsx("p",{className:u,children:i.status.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Data Scadenza*"}),e.jsx("input",{type:"date",...r("scadenza",{required:"La data di scadenza è obbligatoria",validate:n=>{const s=new Date;return s.setHours(0,0,0,0),new Date(n)>=s||"La data di scadenza non può essere nel passato"}}),className:d}),i.scadenza&&e.jsx("p",{className:u,children:i.scadenza.message})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-5",children:[e.jsxs(h.button,{type:"submit",disabled:p,className:"flex items-center gap-2 px-6 py-2.5 bg-rose-600 hover:bg-rose-700 text-white font-semibold rounded-lg transition-colors disabled:bg-rose-900 disabled:cursor-not-allowed",whileHover:{scale:p?1:1.05},whileTap:{scale:p?1:.95},children:[e.jsx(L,{size:18})," ",p?"Salvataggio...":"Salva Modifiche"]}),e.jsxs(h.button,{type:"button",onClick:y,className:"flex items-center gap-2 px-6 py-2.5 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 text-white font-semibold rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(j,{size:18})," Annulla"]})]})]})]})]})}export{R as default};
