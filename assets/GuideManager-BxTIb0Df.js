import{r as a,j as e}from"./react-CrXOBDSJ.js";import{J as $,I as H,H as R,N as xe,A as m,D as N,G as me}from"./@firebase-CuwLCerw.js";import{d as o}from"./index-CD5QvnW-.js";import{P as pe,v as P,j as he,z as ue,ac as ge,ad as be,k as je,y as J,X as O,p as Q,a as X,C as _}from"./lucide-react-CCY59hBS.js";import{m as Ne}from"./framer-motion-BAPjnw1b.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./react-router-BxpCmtJ-.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Bp3EI6Ad.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";function Re(){const[T,B]=a.useState([]),[K,V]=a.useState([]),[W,y]=a.useState(!1),[x,f]=a.useState(null),[u,w]=a.useState(""),[i,g]=a.useState({id:"",name:"",redirectUrl:""}),[v,Y]=a.useState(""),[C,Z]=a.useState("tutti"),[k,ee]=a.useState("tutti"),[p,h]=a.useState(1),[n,S]=a.useState(null),[l,r]=a.useState({}),z=10,[b,L]=a.useState(null),[A,G]=a.useState(""),[M,U]=a.useState(""),[I,D]=a.useState("");a.useEffect(()=>{const s=$(H(o,"guides")),d=R(s,c=>{B(c.docs.map(t=>({id:t.id,...t.data()})))});return()=>d()},[]),a.useEffect(()=>{const s=$(H(o,"guideLeads")),d=R(s,c=>{V(c.docs.map(t=>({id:t.id,...t.data()})))});return()=>d()},[]);const se=async()=>{if(!i.id||!i.name||!i.redirectUrl)return alert("Tutti i campi sono obbligatori");await xe(m(o,"guides",i.id),{name:i.name,redirectUrl:i.redirectUrl,active:!0,postMessage:"",urgencyText:"",countdownDate:null},{merge:!0}),y(!1),g({id:"",name:"",redirectUrl:""}),alert("Guida aggiunta!")},te=async s=>{await N(m(o,"guides",s),{active:!1})},ae=s=>{navigator.clipboard.writeText(`${window.location.origin}/guida/${s}`),alert("Link copiato!")},le=s=>{S(s.id),r({nome:s.nome||"",telefono:s.telefono||"",email:s.email||"",instagram:s.instagram||"",dialed:s.dialed||!1,showUp:s.showUp||!1,chiuso:s.chiuso||!1,importo:s.importo||0,wantsPromo:s.wantsPromo||!1})},ie=async()=>{if(n)try{await N(m(o,"guideLeads",n),l),S(null),r({})}catch{alert("Errore aggiornamento")}},ne=()=>{S(null),r({})},re=async s=>{confirm("Eliminare questo lead?")&&await me(m(o,"guideLeads",s))},de=async()=>{!u||!x||(await N(m(o,"guideLeads",x.id),{chiuso:!0,importo:parseFloat(u)}),f(null),w(""),window.location.href=`/new-client?prefill=${encodeURIComponent(JSON.stringify({name:x.nome,email:x.email,phone:x.telefono,paymentAmount:u}))}`)},ce=async()=>{b&&(await N(m(o,"guides",b.id),{postMessage:A.trim()||null,urgencyText:M.trim()||null,countdownDate:I||null}),L(null),G(""),U(""),D(""))},E=K.filter(s=>{var F,q;const d=((F=s.nome)==null?void 0:F.toLowerCase().includes(v.toLowerCase()))||((q=s.email)==null?void 0:q.toLowerCase().includes(v.toLowerCase())),c=C==="tutti"||(C==="si"?s.chiuso:!s.chiuso),t=k==="tutti"||(k==="si"?s.showUp:!s.showUp);return d&&c&&t}),j=Math.ceil(E.length/z),oe=E.slice((p-1)*z,p*z);return e.jsx("div",{className:"overflow-x-hidden w-full",children:e.jsxs("div",{className:"p-4 sm:p-6 space-y-6 sm:space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white",children:"Gestione Guide & Lead"}),e.jsxs("button",{onClick:()=>y(!0),className:"bg-rose-600 hover:bg-rose-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[e.jsx(pe,{size:18})," Aggiungi Guida"]})]}),e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-6 border border-slate-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-cyan-300 mb-4",children:"Guide Attive"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:T.filter(s=>s.active).map(s=>e.jsxs(Ne.div,{whileHover:{scale:1.02},className:"bg-slate-700/50 p-4 rounded-lg border border-slate-600 relative group",children:[e.jsx("button",{onClick:()=>{L(s),G(s.postMessage||""),U(s.urgencyText||""),D(s.countdownDate||"")},className:"absolute top-2 right-2 text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(P,{size:16})}),e.jsx("h3",{className:"font-bold text-white pr-8",children:s.name}),e.jsxs("p",{className:"text-xs text-slate-400 truncate",children:["ID: ",s.id]}),s.countdownDate&&e.jsxs("div",{className:"mt-2 text-xs text-rose-400 flex items-center gap-1",children:[e.jsx(he,{size:12}),"Scade il: ",new Date(s.countdownDate).toLocaleDateString()]}),s.urgencyText&&e.jsxs("p",{className:"text-xs text-amber-400 mt-1 italic",children:['"',s.urgencyText,'"']}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs("button",{onClick:()=>ae(s.id),className:"flex-1 bg-cyan-600 hover:bg-cyan-700 text-white text-xs py-1 rounded flex items-center justify-center gap-1",children:[e.jsx(ue,{size:14})," Copia"]}),e.jsx("a",{href:s.redirectUrl,target:"_blank",rel:"noopener noreferrer",className:"bg-emerald-600 hover:bg-emerald-700 text-white p-1 rounded",children:e.jsx(ge,{size:14})}),e.jsx("button",{onClick:()=>te(s.id),className:"bg-yellow-600 hover:bg-yellow-700 text-white p-1 rounded",children:e.jsx(be,{size:14})})]})]},s.id))})]}),e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-2 sm:p-6 border border-slate-700 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 mb-3 sm:mb-4",children:[e.jsxs("h2",{className:"text-base sm:text-xl font-semibold text-cyan-300",children:["Lead dalle Guide (",E.length,")"]}),e.jsxs("div",{className:"flex gap-1.5 sm:gap-2 text-[10px] sm:text-xs w-full sm:w-auto",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-slate-700/50 rounded px-2 py-1 flex-1 sm:flex-none",children:[e.jsx(je,{size:12,className:"text-slate-400"}),e.jsx("input",{type:"text",value:v,onChange:s=>{Y(s.target.value),h(1)},placeholder:"Cerca...",className:"bg-transparent outline-none w-full sm:w-24 text-white"})]}),e.jsxs("select",{value:C,onChange:s=>{Z(s.target.value),h(1)},className:"bg-slate-700/50 border border-slate-600 rounded px-2 py-1 text-white flex-1 sm:flex-none",children:[e.jsx("option",{value:"tutti",children:"Tutti"}),e.jsx("option",{value:"si",children:"Chiusi"}),e.jsx("option",{value:"no",children:"No"})]}),e.jsxs("select",{value:k,onChange:s=>{ee(s.target.value),h(1)},className:"bg-slate-700/50 border border-slate-600 rounded px-2 py-1 text-white flex-1 sm:flex-none",children:[e.jsx("option",{value:"tutti",children:"Tutti"}),e.jsx("option",{value:"si",children:"Sì"}),e.jsx("option",{value:"no",children:"No"})]})]})]}),e.jsxs("table",{className:"w-full text-[10px] sm:text-sm text-left text-slate-300",children:[e.jsx("thead",{className:"text-[10px] sm:text-xs uppercase bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Az"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3",children:"Data"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 hidden md:table-cell",children:"Guida"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3",children:"Nome"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3",children:"Tel"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 hidden lg:table-cell",children:"Email"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 hidden lg:table-cell",children:"IG"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center hidden md:table-cell",children:"Promo"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center hidden lg:table-cell",children:"Dialed"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Show"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"Chiuso"}),e.jsx("th",{className:"px-2 sm:px-4 py-2 sm:py-3 text-center",children:"€"})]})}),e.jsx("tbody",{children:oe.map(s=>{var d,c;return e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 text-center",children:n===s.id?e.jsxs("div",{className:"flex gap-0.5 sm:gap-1 justify-center",children:[e.jsxs("button",{onClick:ie,className:"text-green-400",children:[e.jsx(J,{size:12,className:"sm:hidden"}),e.jsx(J,{size:16,className:"hidden sm:block"})]}),e.jsxs("button",{onClick:ne,className:"text-red-400",children:[e.jsx(O,{size:12,className:"sm:hidden"}),e.jsx(O,{size:16,className:"hidden sm:block"})]})]}):e.jsxs("div",{className:"flex gap-0.5 sm:gap-1 justify-center",children:[e.jsxs("button",{onClick:()=>le(s),className:"text-cyan-400",children:[e.jsx(P,{size:12,className:"sm:hidden"}),e.jsx(P,{size:16,className:"hidden sm:block"})]}),e.jsxs("button",{onClick:()=>re(s.id),className:"text-red-400",children:[e.jsx(Q,{size:12,className:"sm:hidden"}),e.jsx(Q,{size:16,className:"hidden sm:block"})]})]})}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 text-[10px] sm:text-xs",children:new Date((d=s.timestamp)==null?void 0:d.toDate()).toLocaleDateString()}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 hidden md:table-cell",children:(c=T.find(t=>t.id===s.guideId))==null?void 0:c.name}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2",children:n===s.id?e.jsx("input",{value:l.nome,onChange:t=>r({...l,nome:t.target.value}),className:"w-full p-1 bg-slate-700/50 border border-slate-600 rounded text-xs"}):s.nome}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2",children:n===s.id?e.jsx("input",{value:l.telefono,onChange:t=>r({...l,telefono:t.target.value}),className:"w-full p-1 bg-slate-700/50 border border-slate-600 rounded text-xs"}):s.telefono}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 hidden lg:table-cell",children:s.email}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 hidden lg:table-cell",children:s.instagram||"—"}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 text-center hidden md:table-cell",children:n===s.id?e.jsx("input",{type:"checkbox",checked:l.wantsPromo,onChange:t=>r({...l,wantsPromo:t.target.checked}),className:"w-4 h-4"}):s.wantsPromo?e.jsx("span",{className:"text-emerald-400 text-xl",children:"Checkmark"}):e.jsx("span",{className:"text-rose-400 text-xl",children:"X"})}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 text-center hidden lg:table-cell",children:n===s.id?e.jsx("input",{type:"checkbox",checked:l.dialed,onChange:t=>r({...l,dialed:t.target.checked}),className:"w-4 h-4"}):e.jsx("span",{className:s.dialed?"text-green-400":"text-yellow-400",children:s.dialed?"Sì":"No"})}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 text-center",children:n===s.id?e.jsx("input",{type:"checkbox",checked:l.showUp,onChange:t=>r({...l,showUp:t.target.checked}),className:"w-4 h-4"}):e.jsx("span",{className:s.showUp?"text-green-400":"text-yellow-400",children:s.showUp?"Sì":"No"})}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 text-center",children:n===s.id?e.jsx("input",{type:"checkbox",checked:l.chiuso,onChange:t=>r({...l,chiuso:t.target.checked}),className:"w-4 h-4"}):e.jsx("button",{onClick:()=>f(s),className:(s.chiuso,"text-green-400"),children:s.chiuso?`€${s.importo}`:"Chiudi"})}),e.jsx("td",{className:"px-2 sm:px-4 py-1.5 sm:py-2 text-center",children:n===s.id?e.jsx("input",{type:"number",value:l.importo||"",onChange:t=>r({...l,importo:parseFloat(t.target.value)||0}),className:"w-16 p-1 bg-slate-700/50 border border-slate-600 rounded text-xs text-center"}):e.jsxs("span",{children:["€",s.importo||0]})})]},s.id)})})]}),j>1&&e.jsxs("div",{className:"flex justify-center gap-3 mt-3 sm:mt-4 text-[10px] sm:text-xs",children:[e.jsxs("button",{onClick:()=>h(s=>Math.max(s-1,1)),disabled:p===1,className:"p-1 text-cyan-300 disabled:opacity-50",children:[e.jsx(X,{size:14,className:"sm:hidden"}),e.jsx(X,{size:16,className:"hidden sm:block"})]}),e.jsxs("span",{className:"text-slate-300",children:["Pag ",p,"/",j]}),e.jsxs("button",{onClick:()=>h(s=>Math.min(s+1,j)),disabled:p===j,className:"p-1 text-cyan-300 disabled:opacity-50",children:[e.jsx(_,{size:14,className:"sm:hidden"}),e.jsx(_,{size:16,className:"hidden sm:block"})]})]})]}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800/95 backdrop-blur-sm rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Nuova Guida"}),e.jsx("input",{placeholder:"ID unico (es: maniglie)",value:i.id,onChange:s=>g({...i,id:s.target.value.toLowerCase().replace(/\s/g,"")}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white mb-3"}),e.jsx("input",{placeholder:"Nome guida",value:i.name,onChange:s=>g({...i,name:s.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white mb-3"}),e.jsx("input",{placeholder:"Link guida",value:i.redirectUrl,onChange:s=>g({...i,redirectUrl:s.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:se,className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg",children:"Aggiungi"}),e.jsx("button",{onClick:()=>y(!1),className:"flex-1 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 text-white py-2 rounded-lg",children:"Annulla"})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800/95 backdrop-blur-sm rounded-xl p-6 w-full max-w-lg",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4",children:["Modifica: ",b.name]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-400",children:"Messaggio Post-Guida"}),e.jsx("textarea",{placeholder:"Es: Complimenti! Hai sbloccato 1 mese omaggio...",value:A,onChange:s=>G(s.target.value),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white h-24 resize-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-400",children:"Testo Urgency"}),e.jsx("input",{type:"text",placeholder:"Es: Offerta valida solo 48 ore!",value:M,onChange:s=>U(s.target.value),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-slate-400",children:"Timer Scadenza"}),e.jsx("input",{type:"datetime-local",value:I,onChange:s=>D(s.target.value),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:ce,className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg",children:"Salva"}),e.jsx("button",{onClick:()=>L(null),className:"flex-1 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 text-white py-2 rounded-lg",children:"Annulla"})]})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800/95 backdrop-blur-sm rounded-xl p-6 w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-4",children:"Chiudi vendita"}),e.jsx("input",{type:"number",placeholder:"Importo (€)",value:u,onChange:s=>w(s.target.value),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white mb-4"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:de,className:"flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded-lg",children:"Conferma"}),e.jsx("button",{onClick:()=>{f(null),w("")},className:"flex-1 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 text-white py-2 rounded-lg",children:"Annulla"})]})]})})]})})}export{Re as default};
