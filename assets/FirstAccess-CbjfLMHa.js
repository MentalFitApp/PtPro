var z=Object.defineProperty;var D=(t,a,r)=>a in t?z(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r;var N=(t,a,r)=>D(t,typeof a!="symbol"?a+"":a,r);import{r as i,j as e,R as L}from"./react-CrXOBDSJ.js";import{g as R,u as T}from"./firebase-Bp3EI6Ad.js";import{B as S,A as x,D as k}from"./@firebase-CuwLCerw.js";import{d as f}from"./index-BoOldJoc.js";import{a as A}from"./react-router-BxpCmtJ-.js";import{m as h,A as U}from"./framer-motion-BAPjnw1b.js";import{N as F,L as B,O as I}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";class q extends L.Component{constructor(){super(...arguments);N(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(r){return{hasError:!0,error:r}}render(){return this.state.hasError?e.jsxs("div",{className:"text-center text-red-400 p-8",children:["Si è verificato un errore: ",this.state.error.message,". Riprova o contatta il supporto."]}):this.props.children}}const K=()=>e.jsx("div",{className:"absolute inset-0 -z-10 overflow-hidden bg-slate-900",children:e.jsx("div",{className:"aurora-background"})}),me=()=>{const[t,a]=i.useState(""),[r,P]=i.useState(""),[g,n]=i.useState(""),[u,b]=i.useState(""),[w,c]=i.useState(!1),[d,v]=i.useState(""),m=A(),s=R().currentUser;i.useEffect(()=>{(async()=>{if(!s){m("/login");return}try{const o=await S(x(f,"clients",s.uid));if(o.exists()&&o.data().firstLogin){v("client");return}const p=await S(x(f,"collaboratori",s.uid));if(p.exists()&&p.data().firstLogin){v("collaboratore");return}m(o.exists()?"/client/dashboard":"/collaboratore/dashboard")}catch{n("Errore verifica account.")}})()},[s,m]);const E=async l=>{if(l.preventDefault(),n(""),b(""),c(!0),!s){n("Utente non autenticato. Effettua nuovamente il login."),setTimeout(()=>m("/login"),3e3),c(!1);return}if(t.length<6){n("La nuova password deve contenere almeno 6 caratteri."),c(!1);return}if(t!==r){n("Le password non coincidono. Riprova."),c(!1);return}try{await T(s,t);const p=x(f,d==="client"?"clients":"collaboratori",s.uid);await k(p,{firstLogin:!1}),console.log(`Campo firstLogin aggiornato a false per ${d}:`,s.uid),await new Promise(C=>setTimeout(C,500)),b("Password aggiornata! Sarai reindirizzato alla dashboard."),setTimeout(()=>{m(d==="client"?"/client/dashboard":"/collaboratore/dashboard")},2e3)}catch(o){console.error("Errore aggiornamento password:",o.code,o.message,{uid:s==null?void 0:s.uid,userType:d}),n("Si è verificato un errore durante l'aggiornamento della password: "+o.message),c(!1)}},y="w-full pl-10 pr-3 py-2.5 mt-1 bg-slate-700/50 border border-slate-600 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200 placeholder:text-slate-500",j="block text-sm font-medium text-slate-300";return d?e.jsx(q,{children:e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[e.jsx(K,{}),e.jsxs(h.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-md bg-slate-900/60 backdrop-blur-xl rounded-2xl border border-slate-700 p-8 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-50",children:"Imposta la tua Password"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Scegli una password personale per i futuri accessi."})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-password",className:j,children:"Nuova Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{id:"new-password",type:"password",required:!0,value:t,onChange:l=>a(l.target.value),className:y})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:j,children:"Conferma Nuova Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{id:"confirm-password",type:"password",required:!0,value:r,onChange:l=>P(l.target.value),className:y})]})]}),e.jsxs(U,{children:[g&&e.jsx(h.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-red-400 text-sm text-center",children:g}),u&&e.jsxs(h.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-emerald-400 text-sm text-center flex items-center justify-center gap-2",children:[e.jsx(I,{size:16}),u]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full px-4 py-2.5 font-bold text-white bg-cyan-600 rounded-lg hover:bg-cyan-700 disabled:opacity-50 transition-colors",disabled:w||!!u,children:u?"Reindirizzamento...":w?"Salvataggio...":"Imposta Nuova Password"})})]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-rose-500"})})};export{me as default};
