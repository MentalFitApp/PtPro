import{r as l,j as t}from"./react-CrXOBDSJ.js";import{H as E,I as j,J as y,U as d,P as D,M as R}from"./@firebase-CuwLCerw.js";import{t as P,d as u}from"./index-BqQ4SUJN.js";import{a as F}from"./react-router-BxpCmtJ-.js";import{u as H,U as O,R as T,P as U,D as B}from"./lucide-react-CCY59hBS.js";import{m as N}from"./framer-motion-BAPjnw1b.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Bp3EI6Ad.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";function pt(){const S=F(),[w,b]=l.useState([]),[h,v]=l.useState(null),[o,x]=l.useState(null),[C,M]=l.useState(!0);l.useEffect(()=>{const s=E(j(u,"clients"),c=>{const m=c.docs.map(e=>({id:e.id,...e.data()})),i={};m.forEach(e=>{const a=P(e.startDate);if(a){const r=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;i[r]||(i[r]={year:a.getFullYear(),month:a.getMonth()+1})}});const p=Object.keys(i).sort((e,a)=>new Date(a.split("-")[0],a.split("-")[1]-1)-new Date(e.split("-")[0],e.split("-")[1]-1));b(p),M(!1)});return()=>s()},[]);const I=async s=>{v(s),x(null);const[c,m]=s.split("-"),i=new Date(parseInt(c),parseInt(m)-1,1),p=new Date(parseInt(c),parseInt(m),1);try{const e=y(j(u,"clients"),d("startDate",">=",i),d("startDate","<",p)),r=(await D(e)).docs.map(n=>({id:n.id,...n.data()})),f=r.filter(n=>n.isOldClient).length,L=r.length-f,k=y(R(u,"payments"),d("paymentDate",">=",i),d("paymentDate","<",p)),z=(await D(k)).docs.filter(n=>!n.ref.parent.parent.data().isOldClient||!n.data().isPast).reduce((n,g)=>n+(g.data().amount||0),0);x({clients:r.length,renewals:f,newClients:L,income:z})}catch(e){console.error("Errore nel recupero stats mese:",e),x({clients:0,renewals:0,newClients:0,income:0})}};return C?t.jsx("div",{className:"flex justify-center items-center h-screen",children:"Caricamento..."}):t.jsxs("div",{className:"p-6",children:[t.jsxs("button",{onClick:()=>S("/"),className:"flex items-center gap-2 mb-6 text-slate-400 hover:text-rose-500",children:[t.jsx(H,{size:16})," Torna alla Dashboard"]}),t.jsx("h1",{className:"text-3xl font-bold text-slate-50 mb-6",children:"Storico Business"}),t.jsx("div",{className:"space-y-4",children:w.map(s=>t.jsx(N.div,{className:"bg-slate-800/60 backdrop-blur-sm p-4 rounded-lg cursor-pointer hover:bg-slate-700/70 border border-slate-700",onClick:()=>I(s),whileHover:{scale:1.02},children:t.jsx("h2",{className:"text-lg font-semibold text-slate-200",children:new Date(s.split("-")[0],s.split("-")[1]-1).toLocaleString("it-IT",{month:"long",year:"numeric"})})},s))}),h&&o&&t.jsxs(N.div,{className:"mt-8 space-y-4",initial:{opacity:0},animate:{opacity:1},children:[t.jsx("h2",{className:"text-2xl font-bold text-slate-50",children:new Date(h.split("-")[0],h.split("-")[1]-1).toLocaleString("it-IT",{month:"long",year:"numeric"})}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(O,{size:20,className:"text-blue-500"}),t.jsxs("p",{children:["Clienti del mese: ",o.clients]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(T,{size:20,className:"text-green-500"}),t.jsxs("p",{children:["Clienti rinnovati: ",o.renewals]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(U,{size:20,className:"text-amber-500"}),t.jsxs("p",{children:["Nuovi clienti: ",o.newClients]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(B,{size:20,className:"text-green-500"}),t.jsxs("p",{children:["Incasso: â‚¬",o.income.toFixed(2)]})]})]})]})]})}export{pt as default};
