import{h as P,r as h,W as k,V as S,T,j as e,q as j,aC as z,au as L,F as R,v as $,aN as q,X as I,ax as B,e as F,f as H}from"./.pnpm-C04Ba0Xq.js";import{a as U,t as G,d as b}from"./index-DdCoIfwr.js";const Q=()=>e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-cyan-400"})});function X(){const r=P(),[g,f]=h.useState([]),[v,p]=h.useState([]),[y,w]=h.useState(""),[A,u]=h.useState(!0);h.useEffect(()=>{if(!U.currentUser){r("/login");return}const t=k(S(b,"clients")),i=T(t,async o=>{const N=o.docs.map(s=>s.id);if(N.length===0){f([]),p([]),u(!1);return}const E=N.map(async s=>{const d=o.docs.find(a=>a.id===s).data().name||"Cliente",l=k(S(b,"clients",s,"checks"),I("createdAt","desc"),q(3));return(await B(l)).docs.map(a=>{const n=a.data();return{clientId:s,clientName:d,date:n.createdAt,weight:n.weight,notes:n.notes}})}),M=N.map(async s=>{const d=o.docs.find(a=>a.id===s).data().name||"Cliente",l=F(b,"clients",s,"anamnesi","initial"),c=await H(l);if(c.exists()){const a=c.data();return{clientId:s,clientName:d,date:a.submittedAt,goal:a.mainGoal}}return null});try{const[s,d]=await Promise.all([Promise.all(E),Promise.all(M)]),l=s.flat(),c=d.filter(Boolean);l.sort((a,n)=>{var x,m;return(((x=n.date)==null?void 0:x.toMillis())||0)-(((m=a.date)==null?void 0:m.toMillis())||0)}),c.sort((a,n)=>{var x,m;return(((x=n.date)==null?void 0:x.toMillis())||0)-(((m=a.date)==null?void 0:m.toMillis())||0)}),f(l.slice(0,5)),p(c.slice(0,5)),u(!1)}catch(s){console.error("Errore batch:",s),u(!1)}},o=>{console.error("Errore snapshot:",o),u(!1)});return()=>i()},[r]);const C=t=>{var i;return((i=G(t))==null?void 0:i.toLocaleDateString("it-IT"))||"N/D"},D=()=>{f([]),p([]),w("Notifiche svuotate!"),setTimeout(()=>w(""),3e3)};return A?e.jsx(Q,{}):e.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-50",children:"Anamnesi & Check"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>r("/coach/clients"),className:"flex items-center gap-2 text-sm text-slate-400 hover:text-cyan-400",children:[e.jsx(z,{size:16})," Indietro"]}),e.jsxs("button",{onClick:D,className:"flex items-center gap-2 text-sm text-slate-400 hover:text-rose-400",title:"Svuota notifiche",children:[e.jsx(L,{size:16})," Svuota notifiche"]})]})]}),y&&e.jsx("div",{className:"mb-3 text-center text-sm font-medium text-rose-400",children:y}),e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl rounded-xl border border-slate-700 p-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-cyan-300 flex items-center gap-2 mb-3",children:[e.jsx(R,{size:18})," Ultimi Check"]}),g.length>0?e.jsx("div",{className:"space-y-2",children:g.map(t=>{var i;return e.jsx(j.div,{whileHover:{scale:1.02},className:"p-2 bg-slate-800/50 rounded-lg border border-white/10 cursor-pointer",onClick:()=>r(`/coach/client/${t.clientId}`),children:e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.clientName}),e.jsx("p",{className:"text-slate-400",children:C(t.date)})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-emerald-400",children:[t.weight," kg"]}),t.notes&&e.jsx("p",{className:"text-xs text-slate-400 line-clamp-1",children:t.notes})]})]})},`${t.clientId}-${(i=t.date)==null?void 0:i.toMillis()}`)})}):e.jsx("p",{className:"text-center text-slate-500 text-xs py-4",children:"Nessun check"})]}),e.jsxs("div",{className:"bg-slate-900/60 backdrop-blur-xl rounded-xl border border-slate-700 p-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-amber-300 flex items-center gap-2 mb-3",children:[e.jsx($,{size:18})," Nuove Anamnesi"]}),v.length>0?e.jsx("div",{className:"space-y-2",children:v.map(t=>e.jsx(j.div,{whileHover:{scale:1.02},className:"p-2 bg-slate-800/50 rounded-lg border border-white/10 cursor-pointer",onClick:()=>r(`/coach/client/${t.clientId}`),children:e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.clientName}),e.jsx("p",{className:"text-slate-400",children:C(t.date)})]}),e.jsx("p",{className:"text-amber-400 text-right line-clamp-1 max-w-[120px]",children:t.goal||"Nessun obiettivo"})]})},t.clientId))}):e.jsx("p",{className:"text-center text-slate-500 text-xs py-4",children:"Nessuna anamnesi"})]})]})}export{X as default};
