import{h as M,r as l,f as R,e as u,j as e,q as m,bV as U,bJ as v,M as L,a2 as S,A as z,u as F,a7 as j,a6 as I}from"./.pnpm-C04Ba0Xq.js";import{a as P,d as h}from"./index-DdCoIfwr.js";import{M as D}from"./MediaUploadButton-D_7Hu4y-.js";import"./cloudflareStorage-DUIVXCyJ.js";function _(){const r=M(),[o,y]=l.useState(null),[i,n]=l.useState(1),[p,N]=l.useState(!1),[a,b]=l.useState({photoURL:"",welcomeMessage:""}),[f,g]=l.useState(!1),w="https://www.youtube.com/embed/dQw4w9WgXcQ";l.useEffect(()=>{const t=P.onAuthStateChanged(async s=>{if(s){y(s);const c=await R(u(h,"users",s.uid));c.exists()&&c.data().onboardingCompleted&&r("/dashboard")}else r("/login")});return()=>t()},[r]);const C=t=>{t&&t.length>0&&b(s=>({...s,photoURL:t[0]}))},k=async()=>{if(o){g(!0);try{await F(u(h,"users",o.uid),{photoURL:a.photoURL,onboardingCompleted:!0,onboardingCompletedAt:j()});const t=u(h,"community_posts",`welcome_${o.uid}`);await I(t,{authorId:o.uid,authorName:o.displayName||"Nuovo Membro",authorPhotoURL:a.photoURL,authorTotalLikes:0,content:a.welcomeMessage,channel:"vittorie",likes:[],likesCount:0,commentsCount:0,createdAt:j()}),r("/first-access")}catch(t){console.error("Errore completamento onboarding:",t),alert("Errore durante il completamento. Riprova.")}finally{g(!1)}}},d=[{id:1,title:"Benvenuto in MentalFit!",icon:U,description:"Guarda il video di benvenuto di Maurizio"},{id:2,title:"Foto Profilo",icon:v,description:"Carica la tua foto profilo"},{id:3,title:"Presentati",icon:L,description:"Scrivi un messaggio di presentazione alla community"}];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center p-6",children:e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-4xl w-full bg-slate-800/60 backdrop-blur-md rounded-2xl shadow-2xl border border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"bg-slate-900/50 p-6 border-b border-slate-700",children:[e.jsx("div",{className:"flex justify-between mb-4",children:d.map(t=>{const s=t.icon,c=i===t.id,x=i>t.id;return e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-full transition-all ${x?"bg-gradient-to-r from-green-500 to-emerald-500":c?"bg-gradient-to-r from-rose-600 to-pink-600":"bg-slate-700"}`,children:x?e.jsx(S,{className:"text-white",size:24}):e.jsx(s,{className:"text-white",size:24})}),t.id<d.length&&e.jsx("div",{className:`flex-1 h-1 mx-2 transition-all ${x?"bg-gradient-to-r from-green-500 to-emerald-500":"bg-slate-700"}`})]},t.id)})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-100 mb-2",children:d[i-1].title}),e.jsx("p",{className:"text-slate-400",children:d[i-1].description})]})]}),e.jsx("div",{className:"p-8",children:e.jsxs(z,{mode:"wait",children:[i===1&&e.jsxs(m.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsx("div",{className:"aspect-video bg-slate-900 rounded-xl overflow-hidden shadow-2xl",children:e.jsx("iframe",{src:w,className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Video Benvenuto MentalFit"})}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-700/50 p-4 rounded-lg",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:t=>N(t.target.checked),className:"w-5 h-5 text-rose-600 rounded focus:ring-rose-500"}),e.jsx("label",{className:"text-slate-200 font-medium",children:"Ho guardato il video e sono pronto a iniziare!"})]}),e.jsx("button",{onClick:()=>n(2),disabled:!p,className:"w-full py-4 bg-gradient-to-r from-rose-600 to-pink-600 hover:from-rose-700 hover:to-pink-700 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white rounded-xl font-bold text-lg transition-all shadow-lg",children:"Continua"})]},"step1"),i===2&&e.jsxs(m.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-6 flex justify-center",children:a.photoURL?e.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-32 h-32 rounded-full object-cover border-4 border-rose-500 shadow-2xl"}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-slate-700 flex items-center justify-center border-4 border-slate-600",children:e.jsx(v,{className:"text-slate-400",size:48})})}),e.jsx(D,{userId:o==null?void 0:o.uid,onUploadComplete:C,folder:"profile_photos",acceptedFileTypes:"image/*",label:a.photoURL?"Cambia Foto":"Carica Foto Profilo"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>n(1),className:"flex-1 py-3 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-xl font-semibold transition-all",children:"Indietro"}),e.jsx("button",{onClick:()=>n(3),disabled:!a.photoURL,className:"flex-1 py-3 bg-gradient-to-r from-rose-600 to-pink-600 hover:from-rose-700 hover:to-pink-700 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white rounded-xl font-semibold transition-all",children:"Continua"})]})]},"step2"),i===3&&e.jsxs(m.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-slate-200 font-semibold mb-3 text-lg",children:"Presentati alla Community ðŸŽ‰"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Condividi i tuoi obiettivi personali e fisici con gli altri membri della community MentalFit!"}),e.jsx("textarea",{value:a.welcomeMessage,onChange:t=>b(s=>({...s,welcomeMessage:t.target.value})),placeholder:"Es: Ciao a tutti! Sono [nome] e sono entusiasta di iniziare questo percorso con MentalFit. Il mio obiettivo Ã¨...",className:"w-full h-48 px-4 py-3 bg-slate-700/50 text-slate-100 border border-slate-600 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 resize-none",maxLength:500}),e.jsxs("div",{className:"text-right text-sm text-slate-400 mt-2",children:[a.welcomeMessage.length,"/500"]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>n(2),className:"flex-1 py-3 bg-slate-700 hover:bg-slate-600 text-slate-200 rounded-xl font-semibold transition-all",children:"Indietro"}),e.jsx("button",{onClick:k,disabled:!a.welcomeMessage.trim()||f,className:"flex-1 py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 disabled:from-slate-700 disabled:to-slate-700 disabled:text-slate-500 text-white rounded-xl font-bold transition-all shadow-lg",children:f?"Caricamento...":"Completa e Inizia! ðŸš€"})]})]},"step3")]})})]})})}export{_ as default};
