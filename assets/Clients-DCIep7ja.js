import{h as Ue,r as d,G as le,V as ie,T as Qe,ai as Xe,aj as oe,ak as _e,j as e,al as R,am as ce,an as de,ao as xe,ap as me,a2 as W,a8 as pe,aq as Q,v as q,s as He,ar as he,as as ue,C as be,at as ge,au as je,A as Y,q as I,av as ve,aw as T,f as Je,e as fe,ax as Ke,l as We,$ as Ye,ay as Ze,az as et,F as tt,aA as st,aB as at}from"./.pnpm-C04Ba0Xq.js";import{t as i,a as Ne,d as U,c as Ce,u as rt}from"./index-DdCoIfwr.js";const nt=({message:c,type:x,onDismiss:j})=>e.jsx(Y,{children:c&&e.jsxs(I.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${x==="error"?"bg-red-900/80 text-red-300 border-red-500/30":"bg-emerald-900/80 text-emerald-300 border-emerald-500/30"} backdrop-blur-md shadow-lg`,children:[e.jsx(Q,{className:x==="error"?"text-red-400":"text-emerald-400"}),e.jsx("p",{children:c}),e.jsx("button",{onClick:j,className:"p-2 rounded-full hover:bg-white/10 min-w-[44px] min-h-[44px] flex items-center justify-center",children:e.jsx(ve,{size:16})})]})}),ye=c=>{const x=c.map(m=>{var f,N;return{Nome:m.name||"N/D",Email:m.email||"N/D",Telefono:m.phone||"N/D",Scadenza:((f=i(m.scadenza))==null?void 0:f.toLocaleDateString("it-IT"))||"N/D",Stato:m.statoPercorso||Ce(m.scadenza),Pagamenti:m.payments?m.payments.reduce((E,o)=>E+(o.amount||0),0):0,"Data Inizio":((N=i(m.startDate))==null?void 0:N.toLocaleDateString("it-IT"))||"N/D"}}),j=et.unparse(x),M=new Blob([j],{type:"text/csv;charset=utf-8;"}),g=document.createElement("a");g.href=URL.createObjectURL(M),g.download="clienti.csv",g.click()},we=({hasAnamnesi:c})=>e.jsxs("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full flex items-center gap-1 border transition-all ${c?"bg-emerald-900/40 text-emerald-300 border-emerald-600/50 hover:bg-emerald-900/60":"bg-slate-800/50 text-slate-400 border-slate-700 hover:bg-slate-700/70"}`,children:[e.jsx(tt,{size:12})," ",c?"Inviata":"Non Inviata"]}),lt=({isOpen:c,onClose:x,onConfirm:j,clientName:M})=>e.jsx(Y,{children:c&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:x,className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:e.jsxs(I.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:g=>g.stopPropagation(),className:"w-full max-w-md bg-slate-800/60 backdrop-blur-sm rounded-xl border border-slate-700 p-6 text-center shadow-xl",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-900/40 mb-4",children:e.jsx(Q,{className:"h-6 w-6 text-red-400"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-100",children:"Conferma Eliminazione"}),e.jsxs("p",{className:"text-sm text-slate-400 mt-2",children:["Sei sicuro di voler eliminare il cliente ",e.jsx("strong",{className:"text-rose-400",children:M}),"? L'operazione è irreversibile."]}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx("button",{onClick:x,className:"px-6 py-2 text-sm font-semibold text-slate-300 bg-slate-700/50 hover:bg-slate-700/70 rounded-lg transition-colors border border-slate-600",children:"Annulla"}),e.jsx("button",{onClick:j,className:"px-6 py-2 text-sm font-semibold text-white bg-rose-600 hover:bg-rose-700 rounded-lg transition-colors",children:"Elimina"})]})]})})});function dt(){const c=Ue(),[x,j]=d.useState([]),[M,g]=d.useState(!0),[m,f]=d.useState(null),[N,E]=d.useState(""),[o,u]=d.useState("all"),[y,Z]=d.useState("startDate"),[F,X]=d.useState("desc"),[v,ze]=d.useState({}),[z,O]=d.useState("list"),[ee,_]=d.useState({message:"",type:""}),[k,te]=d.useState(new Date),[D,se]=d.useState(!0),[C,ae]=d.useState("iscrizioni"),[H,ke]=d.useState({}),[De,J]=d.useState(!1),[re,Se]=d.useState(null),[ne,$e]=d.useState([]),[S,Te]=d.useState({total:0,expiring:0,expired:0}),Me=t=>{let s;o==="expiring"||o==="expired"?s=w.filter(a=>{const n=i(a.scadenza);return n&&T(n,t)}):C==="scadenze"?s=w.filter(a=>{const n=i(a.scadenza);return n&&T(n,t)}):s=w.filter(a=>{const n=i(a.createdAt),r=i(a.startDate),l=n||r;return l&&T(l,t)}),Se(t),$e(s),J(!0)},Le=e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>se(t=>!t),className:`flex items-center gap-2 px-3 py-1.5 text-sm rounded-lg transition-colors ${D?"bg-rose-600 text-white":"bg-slate-700 text-slate-300"}`,children:[e.jsx(q,{size:14})," Calendario"]}),D&&e.jsxs("div",{className:"flex gap-1 bg-slate-700/50 rounded-lg p-0.5",children:[e.jsx("button",{onClick:()=>ae("iscrizioni"),className:`px-2 py-1 text-xs rounded transition-colors ${C==="iscrizioni"?"bg-rose-600 text-white":"text-slate-300"}`,children:"Iscrizioni"}),e.jsx("button",{onClick:()=>ae("scadenze"),className:`px-2 py-1 text-xs rounded transition-colors ${C==="scadenze"?"bg-amber-600 text-white":"text-slate-300"}`,children:"Scadenze"})]})]}),L=(t,s="error")=>{_({message:t,type:s}),setTimeout(()=>_({message:"",type:""}),6e3)},Ae=async()=>{try{await le(Ne),c("/login")}catch(t){L(`Errore logout: ${t.message}`,"error")}};d.useEffect(()=>{if(sessionStorage.getItem("app_role")!=="admin"){le(Ne).then(()=>c("/login"));return}const s=ie(U,"clients"),a=Qe(s,async n=>{try{const r=n.docs.map(p=>{const h=p.data();return{id:p.id,name:h.name,email:h.email,phone:h.phone,scadenza:h.scadenza,startDate:h.startDate,createdAt:h.createdAt,statoPercorso:h.statoPercorso||Ce(h.scadenza),payments:h.payments||[],rate:h.rate||[]}}),l=r.map(p=>Je(fe(U,`clients/${p.id}/anamnesi`,"initial")).catch(()=>({exists:()=>!1}))),$=await Promise.all(l),b={};r.forEach((p,h)=>{b[p.id]=$[h].exists()}),ze(b);const A={},B=r.map(async p=>{const Be=(Array.isArray(p.rate)?p.rate:[]).filter(P=>P.paid).reduce((P,K)=>P+(Number(K.amount)||0),0),Re=(await Ke(ie(U,"clients",p.id,"payments"))).docs.reduce((P,K)=>{const qe=K.data();return P+(Number(qe.amount)||0)},0);A[p.id]=Be+Re});await Promise.all(B),ke(A),r.forEach(p=>rt(p.id)),j(r),g(!1)}catch{L("Errore caricamento clienti","error"),g(!1)}},n=>{L("Errore connessione","error"),g(!1)});return()=>a()},[c]);const Pe=async()=>{if(m)try{await We(fe(U,"clients",m.id)),j(t=>t.filter(s=>s.id!==m.id)),L("Cliente eliminato!","success")}catch(t){L(`Errore: ${t.message}`,"error")}finally{f(null)}},V=t=>{y===t?X(s=>s==="desc"?"asc":"desc"):(Z(t),X("desc"))},G=t=>y!==t?null:F==="desc"?e.jsx(st,{size:14}):e.jsx(at,{size:14});d.useEffect(()=>{const t=new Date,s=x.length;let a=0,n=0;x.forEach(r=>{const l=i(r.scadenza);if(l){const $=Math.ceil((l-t)/864e5);$<0?n++:$<=15&&a++}}),Te({total:s,expiring:a,expired:n})},[x]);const w=d.useMemo(()=>{let t=x.filter(s=>{if(!((s.name||"").toLowerCase().includes(N.toLowerCase())||(s.email||"").toLowerCase().includes(N.toLowerCase())))return!1;const n=new Date,r=i(s.scadenza),l=r?Math.ceil((r-n)/(1e3*60*60*24)):null;switch(o){case"active":return r&&r>n;case"expiring":return r&&l<=15&&l>0;case"expired":return r&&r<n;case"no-check":return!v[s.id];case"has-check":return v[s.id];case"recent":return!0;default:return!0}});return t.sort((s,a)=>{let n,r;switch(y){case"name":n=s.name||"",r=a.name||"";break;case"startDate":n=i(s.startDate)||new Date(0),r=i(a.startDate)||new Date(0);break;case"expiry":n=i(s.scadenza)||new Date(0),r=i(a.scadenza)||new Date(0);break;case"lastCheck":n=v[s.id]?1:0,r=v[a.id]?1:0;break;case"recent":n=i(s.startDate)||new Date(0),r=i(a.startDate)||new Date(0);break;default:n=0,r=0}return n<r?F==="desc"?1:-1:n>r?F==="desc"?-1:1:0}),t},[x,N,o,y,F,v]),Ie=Xe({start:oe(k),end:_e(k)}),Ee=t=>o==="expiring"||o==="expired"?x.filter(s=>{const a=i(s.scadenza);if(!a||!T(a,t))return!1;const r=Math.ceil((a-new Date)/(1e3*60*60*24));return o==="expiring"?r<=15&&r>0:o==="expired"?r<0:!1}):C==="scadenze"?x.filter(s=>{const a=i(s.scadenza);return a&&T(a,t)}):w.filter(s=>{const a=i(s.createdAt),n=i(s.startDate),r=a||n;return r&&T(r,t)}),Fe=e.jsxs("div",{className:"flex items-center gap-1 bg-slate-700/50 border border-slate-600 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>O("list"),className:`p-2 rounded-md transition-colors ${z==="list"?"bg-rose-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Lista",children:e.jsx(xe,{size:16})}),e.jsx("button",{onClick:()=>O("card"),className:`p-2 rounded-md transition-colors ${z==="card"?"bg-rose-600 text-white":"text-slate-400 hover:text-slate-200"}`,title:"Schede",children:e.jsx(me,{size:16})})]}),Oe=e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{value:N,onChange:t=>E(t.target.value),className:"bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2 pl-10 w-full min-w-48 outline-none focus:ring-2 focus:ring-rose-500 text-sm text-slate-200 placeholder:text-slate-500",placeholder:"Cerca..."})]}),e.jsxs("button",{onClick:()=>c("/new-client"),className:"flex items-center gap-2 px-3 py-2 bg-rose-600 hover:bg-rose-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(ce,{size:16})," Nuovo"]}),e.jsxs("button",{onClick:()=>ye(x),className:"flex items-center gap-2 px-3 py-2 bg-cyan-600 hover:bg-cyan-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(de,{size:16})," CSV"]}),e.jsxs("button",{onClick:Ae,className:"flex items-center gap-2 px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(Ye,{size:16})," Logout"]}),e.jsxs("div",{className:"flex gap-2 ml-2",children:[Le,Fe]})]}),Ve=e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>u("all"),className:`px-3 py-1.5 text-sm rounded-lg transition-colors ${o==="all"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:"Tutti"}),e.jsxs("button",{onClick:()=>u("active"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${o==="active"?"bg-emerald-600 text-white":"text-emerald-400 hover:bg-emerald-900/30"}`,children:[e.jsx(W,{size:14})," Attivi"]}),e.jsxs("button",{onClick:()=>u("expiring"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${o==="expiring"?"bg-amber-600 text-white":"text-amber-400 hover:bg-amber-900/30"}`,children:[e.jsx(pe,{size:14})," In Scadenza"]}),e.jsxs("button",{onClick:()=>u("expired"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${o==="expired"?"bg-red-600 text-white":"text-red-400 hover:bg-red-900/30"}`,children:[e.jsx(Q,{size:14})," Scaduti"]}),e.jsxs("button",{onClick:()=>u("has-check"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${o==="has-check"?"bg-cyan-600 text-white":"text-cyan-400 hover:bg-cyan-900/30"}`,children:[e.jsx(W,{size:14})," Con Anamnesi"]}),e.jsxs("button",{onClick:()=>u("no-check"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${o==="no-check"?"bg-gray-600 text-white":"text-gray-400 hover:bg-gray-900/30"}`,children:[e.jsx(Ze,{size:14})," Senza Anamnesi"]}),e.jsxs("button",{onClick:()=>{u("recent"),Z("recent"),X("desc")},className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${o==="recent"?"bg-purple-600 text-white":"text-purple-400 hover:bg-purple-900/30"}`,children:[e.jsx(q,{size:14})," Più Recenti"]})]}),Ge=e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>V("name"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${y==="name"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:["Nome ",G("name")]}),e.jsxs("button",{onClick:()=>V("startDate"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${y==="startDate"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:["Inizio ",G("startDate")]}),e.jsxs("button",{onClick:()=>V("expiry"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${y==="expiry"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:["Scadenza ",G("expiry")]}),e.jsxs("button",{onClick:()=>V("lastCheck"),className:`px-3 py-1.5 text-sm rounded-lg flex items-center gap-1 transition-colors ${y==="lastCheck"?"bg-rose-600 text-white":"text-slate-400 hover:bg-white/10"}`,children:["Anamnesi ",G("lastCheck")]})]});return M?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-b from-[#1b2735] to-[#090a0f]",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-rose-500"})}):e.jsxs("div",{className:"overflow-x-hidden w-full",children:[e.jsx(nt,{message:ee.message,type:ee.type,onDismiss:()=>_({message:"",type:""})}),e.jsx(lt,{isOpen:!!m,onClose:()=>f(null),onConfirm:Pe,clientName:m==null?void 0:m.name}),e.jsxs("div",{className:"mobile-container py-4 sm:py-6 space-y-4 sm:space-y-6 mobile-safe-bottom",children:[e.jsxs("div",{className:"md:hidden bg-slate-800/60 backdrop-blur-sm border border-slate-700 rounded-2xl p-4 mx-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100 mb-2",children:"Clienti"}),e.jsxs("div",{className:"flex gap-3 mb-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-slate-400"}),e.jsxs("span",{className:"text-slate-300",children:["Tot: ",e.jsx("strong",{className:"text-white",children:S.total})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-amber-400"}),e.jsxs("span",{className:"text-slate-300",children:["Scad: ",e.jsx("strong",{className:"text-amber-400",children:S.expiring})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-red-400"}),e.jsxs("span",{className:"text-slate-300",children:["Scad: ",e.jsx("strong",{className:"text-red-400",children:S.expired})]})]})]}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{value:N,onChange:t=>E(t.target.value),className:"bg-slate-700/50 border border-slate-600 rounded-lg px-3 py-2.5 pl-10 w-full outline-none focus:ring-2 focus:ring-rose-500 text-sm text-slate-200 placeholder:text-slate-500",placeholder:"Cerca clienti..."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsxs("button",{onClick:()=>c("/new-client"),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-rose-600 hover:bg-rose-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(ce,{size:16})," Nuovo"]}),e.jsxs("button",{onClick:()=>ye(x),className:"flex items-center justify-center gap-2 px-3 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white text-sm font-medium rounded-lg transition-colors",children:[e.jsx(de,{size:16})," CSV"]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1 bg-slate-700/50 border border-slate-600 rounded-lg p-1 mb-3",children:[e.jsxs("button",{onClick:()=>O("list"),className:`flex-1 flex items-center justify-center gap-1.5 p-2 rounded-md transition-colors text-xs ${z==="list"?"bg-rose-600 text-white":"text-slate-400"}`,children:[e.jsx(xe,{size:14})," Lista"]}),e.jsxs("button",{onClick:()=>O("card"),className:`flex-1 flex items-center justify-center gap-1.5 p-2 rounded-md transition-colors text-xs ${z==="card"?"bg-rose-600 text-white":"text-slate-400"}`,children:[e.jsx(me,{size:14})," Schede"]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hidden",children:[e.jsx("button",{onClick:()=>u("all"),className:`px-3 py-1.5 text-xs rounded-full whitespace-nowrap transition-colors ${o==="all"?"bg-rose-600 text-white":"bg-slate-700 text-slate-300"}`,children:"Tutti"}),e.jsxs("button",{onClick:()=>u("active"),className:`px-3 py-1.5 text-xs rounded-full whitespace-nowrap transition-colors flex items-center gap-1 ${o==="active"?"bg-emerald-600 text-white":"bg-slate-700 text-emerald-400"}`,children:[e.jsx(W,{size:12})," Attivi"]}),e.jsxs("button",{onClick:()=>u("expiring"),className:`px-3 py-1.5 text-xs rounded-full whitespace-nowrap transition-colors flex items-center gap-1 ${o==="expiring"?"bg-amber-600 text-white":"bg-slate-700 text-amber-400"}`,children:[e.jsx(pe,{size:12})," Scadenza"]}),e.jsxs("button",{onClick:()=>u("expired"),className:`px-3 py-1.5 text-xs rounded-full whitespace-nowrap transition-colors flex items-center gap-1 ${o==="expired"?"bg-red-600 text-white":"bg-slate-700 text-red-400"}`,children:[e.jsx(Q,{size:12})," Scaduti"]})]})]}),e.jsxs("div",{className:"hidden md:block bg-slate-800/60 backdrop-blur-sm border border-slate-700 rounded-2xl p-5 space-y-5 mx-3 sm:mx-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-100 mb-3",children:"Gestione Clienti"}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-400"}),e.jsxs("span",{className:"text-slate-300",children:["Totale: ",e.jsx("strong",{className:"text-white",children:S.total})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-400"}),e.jsxs("span",{className:"text-slate-300",children:["In Scadenza: ",e.jsx("strong",{className:"text-amber-400",children:S.expiring})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-400"}),e.jsxs("span",{className:"text-slate-300",children:["Scaduti: ",e.jsx("strong",{className:"text-red-400",children:S.expired})]})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:Oe})]}),e.jsx("div",{className:"border-t border-white/10"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-400 uppercase mb-3",children:"Filtri"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ve})]}),e.jsx("div",{className:"border-t border-white/10"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-slate-400 uppercase mb-3",children:"Ordinamento"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ge})]})]}),e.jsx("div",{className:"md:hidden mx-3",children:e.jsxs("button",{onClick:()=>se(!D),className:`w-full flex items-center justify-center gap-2 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors ${D?"bg-rose-600 text-white":"bg-slate-700 text-slate-300"}`,children:[e.jsx(q,{size:16})," ",D?"Nascondi":"Mostra"," Calendario"]})}),D&&e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-4 md:p-6 border border-slate-700 shadow-xl mx-3 sm:mx-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("button",{onClick:()=>te(he(k,-1)),className:"p-2 hover:bg-slate-700 rounded-lg transition",children:e.jsx(He,{size:18,className:"text-slate-400"})}),e.jsxs("h3",{className:"text-base md:text-lg font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(q,{size:18,className:"md:block hidden"})," ",ue(k,"MMMM yyyy")]}),e.jsx("button",{onClick:()=>te(he(k,1)),className:"p-2 hover:bg-slate-700 rounded-lg transition",children:e.jsx(be,{size:18,className:"text-slate-400"})})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 md:gap-3 text-center text-xs md:text-sm",children:[["D","L","M","M","G","V","S"].map((t,s)=>e.jsxs("div",{className:"font-bold text-slate-400 py-2",children:[e.jsx("span",{className:"md:hidden",children:t}),e.jsx("span",{className:"hidden md:inline",children:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"][s]})]},t+"-"+s)),Array.from({length:oe(k).getDay()},(t,s)=>e.jsx("div",{},`empty-${s}`)),Ie.map(t=>{const s=Ee(t),a=o==="expiring"||o==="expired"||C==="scadenze",n=a?s.length>0?"bg-amber-900/40 border-amber-600 hover:bg-amber-900/60":"bg-slate-800/50 border-slate-700 hover:bg-slate-700/70":s.length>0?"bg-rose-900/40 border-rose-600 hover:bg-rose-900/60":"bg-slate-800/50 border-slate-700 hover:bg-slate-700/70",r=a?"from-amber-600/30 to-orange-600/30":"from-rose-600/30 to-purple-600/30",l=a?"text-amber-300":"text-rose-300",$=a?"bg-amber-500":"bg-rose-500";return e.jsxs("div",{onClick:()=>Me(t),className:`min-h-16 md:min-h-28 p-1 md:p-3 rounded-lg md:rounded-xl border transition-all cursor-pointer ${n}`,children:[e.jsx("p",{className:"text-xs md:text-sm font-bold text-slate-300 mb-0.5 md:mb-1",children:ue(t,"d")}),e.jsxs("div",{className:"space-y-1 md:space-y-1.5 max-h-12 md:max-h-20 overflow-y-auto",children:[s.slice(0,2).map(b=>{var A,B;return e.jsxs("div",{className:`hidden md:flex bg-gradient-to-r ${r} p-2 rounded-lg text-xs justify-between items-center`,children:[e.jsxs("div",{children:[e.jsx("p",{className:`font-semibold ${l}`,children:b.name}),e.jsx("p",{className:"text-cyan-300",children:C==="scadenze"?(A=i(b.scadenza))==null?void 0:A.toLocaleDateString("it-IT"):(B=i(b.startDate)||i(b.createdAt))==null?void 0:B.toLocaleDateString("it-IT")})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),c(`/edit/${b.id}`)},className:"text-cyan-400 hover:text-cyan-300",children:e.jsx(ge,{size:14})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),f(b)},className:"text-red-400 hover:text-red-300",children:e.jsx(je,{size:14})})]})]},b.id)}),s.length>0&&e.jsx("div",{className:`md:hidden w-2 h-2 ${$} rounded-full mx-auto`})]}),s.length===0&&e.jsx("p",{className:"hidden md:block text-xs text-slate-500 italic mt-2",children:a?"Nessuna scadenza":"Nessuna iscrizione"})]},t.toISOString())})]})]}),z==="list"&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-3 md:p-6 border border-slate-700 shadow-xl mx-3 sm:mx-6",children:e.jsxs("div",{className:"mobile-table-wrapper relative -mx-3 md:mx-0 overflow-x-auto",children:[e.jsx("div",{className:"md:hidden absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none z-10 bg-gradient-to-l from-slate-800/90 to-transparent pl-8 pr-2",children:e.jsx(be,{size:20,className:"text-slate-400 animate-pulse"})}),e.jsxs("table",{className:"w-full min-w-[800px] text-xs md:text-sm text-left text-slate-300",children:[e.jsx("thead",{className:"text-slate-400 uppercase text-[10px] md:text-xs",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 md:p-4 min-w-[150px] md:min-w-[180px] font-bold sticky left-0 bg-slate-800/95 z-10",children:"Nome"}),e.jsx("th",{className:"p-2 md:p-4 min-w-[100px] md:min-w-[140px] font-bold",children:"Inizio"}),e.jsx("th",{className:"p-2 md:p-4 min-w-[120px] md:min-w-[160px] font-bold",children:"Scadenza"}),e.jsx("th",{className:"p-2 md:p-4 min-w-[120px] md:min-w-[160px] font-bold",children:"Anamnesi"}),e.jsx("th",{className:"p-2 md:p-4 text-right min-w-[100px] md:min-w-[120px] font-bold sticky right-0 bg-slate-800/95 z-10",children:"Azioni"})]})}),e.jsxs("tbody",{children:[w.map(t=>{var r;const s=i(t.scadenza),a=s?Math.ceil((s-new Date)/(1e3*60*60*24)):null,n=H[t.id]??0;return e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/10 transition-all",children:[e.jsx("td",{className:"p-2 md:p-4 font-medium min-w-[150px] md:min-w-[180px] sticky left-0 bg-slate-800/95",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 md:gap-3",children:[e.jsx("button",{onClick:()=>c(`/client/${t.id}`),className:"text-left hover:text-rose-400 transition-colors truncate",children:t.name||"-"}),e.jsxs("span",{className:"text-[10px] md:text-xs px-1.5 md:px-2 py-0.5 md:py-1 rounded-full bg-cyan-900/40 text-cyan-300 border border-cyan-600/50 whitespace-nowrap",children:["€",n.toFixed(2)]})]})}),e.jsx("td",{className:"p-2 md:p-4 min-w-[100px] md:min-w-[140px] text-[10px] md:text-xs",children:((r=i(t.startDate))==null?void 0:r.toLocaleDateString("it-IT"))||"N/D"}),e.jsx("td",{className:"p-2 md:p-4 min-w-[120px] md:min-w-[160px]",children:s?e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[e.jsx("span",{className:`font-medium ${a<0?"text-red-400":a<=7?"text-amber-400":"text-emerald-400"}`,children:s.toLocaleDateString("it-IT")}),a!==null&&e.jsx("span",{className:`text-[10px] md:text-xs px-1.5 md:px-2 py-0.5 md:py-1 rounded-full font-medium whitespace-nowrap ${a<0?"bg-red-900/40 text-red-300 border border-red-600/50":a<=7?"bg-amber-900/40 text-amber-300 border border-amber-600/50":"bg-emerald-900/40 text-emerald-300 border border-emerald-600/50"}`,children:a<0?"Scaduto":`${a} gg`})]}):e.jsx("span",{className:"text-slate-500",children:"N/D"})}),e.jsx("td",{className:"p-2 md:p-4 min-w-[120px] md:min-w-[160px]",children:e.jsx(we,{hasAnamnesi:v[t.id]})}),e.jsx("td",{className:"p-2 md:p-4 text-right min-w-[100px] md:min-w-[120px] sticky right-0 bg-slate-800/95",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 md:gap-2",children:[e.jsx("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),c(`/edit/${t.id}`)},className:"p-1.5 md:p-2 text-amber-400 hover:bg-white/10 rounded-lg transition-all min-w-[36px] min-h-[36px] md:min-w-[44px] md:min-h-[44px] flex items-center justify-center",title:"Modifica",children:e.jsx(ge,{size:14})}),e.jsx("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),f(t)},className:"p-1.5 md:p-2 text-red-400 hover:bg-white/10 rounded-lg transition-all min-w-[36px] min-h-[36px] md:min-w-[44px] md:min-h-[44px] flex items-center justify-center",title:"Elimina",children:e.jsx(je,{size:14})})]})})]},t.id)}),w.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center py-12 text-slate-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(R,{size:48,className:"mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Nessun cliente trovato"})]})})})]})]})]})})}),z==="card"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mx-3 sm:mx-6",children:[w.map(t=>{var r;const s=i(t.scadenza),a=s?Math.ceil((s-new Date)/(1e3*60*60*24)):null,n=H[t.id]??0;return e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-5 border border-slate-700 hover:border-slate-600 transition-all",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:t.name}),e.jsx("p",{className:"text-xs text-rose-400",children:t.email}),e.jsx("p",{className:"text-xs text-slate-500",children:t.phone||"N/D"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),c(`/client/${t.id}`)},className:"text-xs text-cyan-400 hover:text-cyan-300",children:"Dettagli"}),e.jsx("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),f(t)},className:"text-xs text-red-400 hover:text-red-300",children:"Elimina"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Inizio"}),e.jsx("span",{className:"text-slate-300",children:((r=i(t.startDate))==null?void 0:r.toLocaleDateString("it-IT"))||"N/D"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Scadenza"}),e.jsx("span",{className:`font-medium ${a<0?"text-red-400":a<=7?"text-amber-400":"text-emerald-400"}`,children:(s==null?void 0:s.toLocaleDateString("it-IT"))||"N/D"})]}),a!==null&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Giorni"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium ${a<0?"bg-red-900/40 text-red-300 border border-red-600/50":a<=7?"bg-amber-900/40 text-amber-300 border border-amber-600/50":"bg-emerald-900/40 text-emerald-300 border border-emerald-600/50"}`,children:a<0?"Scaduto":`${a} gg`})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"Pagamenti"}),e.jsxs("span",{className:"font-medium text-cyan-400",children:["€",n.toFixed(2)]})]})]}),e.jsx("div",{className:"mt-4 pt-3 border-t border-white/10",children:e.jsx(we,{hasAnamnesi:v[t.id]})}),e.jsx("div",{className:"mt-4 flex gap-2",children:e.jsx("button",{type:"button",onClick:l=>{l.preventDefault(),l.stopPropagation(),c(`/edit/${t.id}`)},className:"flex-1 py-2 bg-rose-600 text-white text-xs rounded-lg hover:bg-rose-700 transition font-medium",children:"Modifica"})})]},t.id)}),w.length===0&&e.jsxs("div",{className:"col-span-full text-center py-12 text-slate-500",children:[e.jsx(R,{size:48,className:"mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Nessun cliente trovato"})]})]})]}),e.jsx(Y,{children:De&&e.jsx(I.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>J(!1),className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:e.jsxs(I.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:t=>t.stopPropagation(),className:"w-full max-w-2xl bg-slate-800/60 backdrop-blur-sm rounded-xl border border-slate-700 p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-100",children:[o==="expiring"||o==="expired"||C==="scadenze"?"Scadenze del":"Clienti aggiunti il"," ",re?new Date(re).toLocaleDateString("it-IT"):""]}),e.jsx("button",{onClick:()=>J(!1),className:"p-1.5 rounded-full hover:bg-white/10",children:e.jsx(ve,{size:18,className:"text-slate-300"})})]}),ne.length>0?e.jsx("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto",children:ne.map(t=>{var s,a;return e.jsxs("div",{className:"bg-slate-800/60 border border-slate-700 rounded-xl p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-slate-100 font-semibold",children:t.name}),e.jsx("p",{className:"text-xs text-rose-300",children:t.email}),e.jsxs("div",{className:"flex gap-3 text-xs text-slate-400",children:[e.jsxs("span",{children:["Inizio: ",((s=i(t.startDate))==null?void 0:s.toLocaleDateString("it-IT"))||"N/D"]}),e.jsxs("span",{children:["Scadenza: ",((a=i(t.scadenza))==null?void 0:a.toLocaleDateString("it-IT"))||"N/D"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full bg-cyan-900/40 text-cyan-300 border border-cyan-600/50",children:["€",(H[t.id]??0).toFixed(2)]}),e.jsx("button",{onClick:()=>c(`/client/${t.id}`),className:"px-3 py-1.5 text-xs rounded-lg bg-rose-600 hover:bg-rose-700 text-white transition-colors",children:"Dettagli"})]})]},t.id)})}):e.jsx("p",{className:"text-slate-400 text-sm",children:"Nessun cliente aggiunto in questa data."})]})})}),e.jsx("button",{onClick:()=>c("/new-client"),className:"hidden md:flex fixed bottom-6 right-6 w-14 h-14 bg-rose-600 text-white rounded-full shadow-lg hover:bg-rose-700 transition items-center justify-center text-3xl font-bold z-40",children:"+"})]})}export{dt as default};
