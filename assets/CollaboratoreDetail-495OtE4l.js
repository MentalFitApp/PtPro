import{h as Z,k as K,r as x,o as J,W as Y,X as ee,aO as se,V as te,T as q,e as S,j as e,q as D,U as ae,aH as le,aI as re,Z as oe,a5 as ne,v as $,bk as ie,a4 as ce,aL as de,av as xe,aD as me,u as he,f as G,a9 as pe,ad as ue,ac as be,bl as ge,aa as je,ab as fe,ae as Ne,af as ye,ag as ve}from"./.pnpm-C04Ba0Xq.js";import{d as f,a as we}from"./index-DdCoIfwr.js";import{Q as ke}from"./QuickNotifyButton-C9ZkEGbZ.js";pe.register(ue,be,ge,je,fe,Ne,ye,ve);function ze(){var O,A;const N=Z(),h=K(),[p,R]=x.useState(null),[n,z]=x.useState(""),[H,g]=x.useState(!0),[E,j]=x.useState(""),[P,Q]=x.useState(!1),[y,U]=x.useState("daily"),[_,I]=x.useState(!1),[v,W]=x.useState([]),[w,L]=x.useState([]);x.useEffect(()=>{const s=J(we,async a=>{var c;if(!a){N("/login");return}const l=(c=h.state)==null?void 0:c.collaboratoreId;if(!l){j("Nessun collaboratore selezionato."),g(!1);return}const o=await G(S(f,"roles","admins")),i=(o.exists()?o.data().uids||[]:[]).includes(a.uid);if(Q(i),!i&&a.uid!==l){j("Non hai i permessi per visualizzare questo collaboratore."),g(!1);return}try{const d=S(f,"collaboratori",l),m=await G(d);if(!m.exists()){j("Collaboratore non trovato."),g(!1);return}const r=m.data();R(r),z(r.role||""),L(r.dailyReports||[]),g(!1)}catch{j("Errore nel caricamento dei dati."),g(!1)}});return()=>s()},[N,h.state]),x.useEffect(()=>{var l;if(!((l=h.state)!=null&&l.collaboratoreId))return;const s=Y(te(f,"leads"),se("collaboratoreId","==",h.state.collaboratoreId),ee("timestamp","desc")),a=q(s,o=>{W(o.docs.map(t=>({id:t.id,...t.data()})))});return()=>a()},[(O=h.state)==null?void 0:O.collaboratoreId]),x.useEffect(()=>{var l;if(!((l=h.state)!=null&&l.collaboratoreId))return;const s=S(f,"collaboratori",h.state.collaboratoreId),a=q(s,o=>{if(o.exists()){const t=o.data();L(t.dailyReports||[])}});return()=>a()},[(A=h.state)==null?void 0:A.collaboratoreId]);const k=(()=>{const s=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()-a.getDay());const l=new Date(s.slice(0,7)+"-01");let o=0,t=0,i=0,c=0,d=0;w.forEach(r=>{var B,V;const u=r.date,C=parseInt(((B=r.tracker)==null?void 0:B.callPrenotate)||0),b=parseInt(((V=r.tracker)==null?void 0:V.callChiuse)||0);c+=C,d+=b,u===s&&(o+=b),new Date(u)>=a&&(t+=b),new Date(u)>=l&&(i+=b)});const m=c>0?(d/c*100).toFixed(1):0;return{today:o,week:t,month:i,callsBooked:c,callsClosed:d,conversion:m,totalLeads:v.length,leadsClosed:v.filter(r=>r.chiuso).length}})(),F=(()=>{const s={};w.forEach(t=>{var d,m;let i="";if(y==="daily")i=t.date;else if(y==="weekly"){const r=new Date(t.date),u=new Date(r);u.setDate(r.getDate()-r.getDay()+1),i=u.toISOString().split("T")[0]}else i=t.date.substring(0,7);const c=parseInt(n==="Marketing"?((d=t.tracker)==null?void 0:d.volumeLeads24h)||0:((m=t.tracker)==null?void 0:m.callChiuse)||0);s[i]=(s[i]||0)+c});const a=Object.keys(s).sort(),l=a,o=a.map(t=>s[t]);return{labels:l,data:o}})(),T={labels:F.labels,datasets:[{label:n==="Marketing"?"Leads Generati":"Chiamate Chiuse",data:F.data,backgroundColor:n==="Marketing"?"rgba(34, 197, 94, 0.6)":"rgba(239, 68, 68, 0.6)",borderColor:n==="Marketing"?"#22c55e":"#ef4444",borderWidth:2,borderRadius:4}]},M={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0},x:{grid:{display:!1}}}},X=async()=>{if(P)try{await he(S(f,"collaboratori",h.state.collaboratoreId),{role:n}),R(s=>({...s,role:n})),I(!1)}catch{j("Errore aggiornamento ruolo.")}};return H?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-rose-500"})}):E?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-red-500 p-4",children:[e.jsx("p",{children:E}),e.jsx("button",{onClick:()=>N("/collaboratori"),className:"mt-4 px-4 py-2 bg-rose-600 text-white rounded-lg",children:"Torna indietro"})]}):e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-50 flex items-center gap-3",children:[e.jsx(ae,{size:32}),p.name||p.email.split("@")[0],e.jsxs("span",{className:"text-lg font-normal text-slate-400",children:["(",p.role,")"]})]}),e.jsx(ke,{userId:p.uid,userName:p.name||p.email.split("@")[0],userType:"collaboratore"}),p.firstLogin&&e.jsx(D.button,{onClick:()=>{const s=`Email: ${p.email}
Password: ${p.tempPassword||"generata al login"}
Link: https://MentalFitApp.github.io/PtPro/#/login`;navigator.clipboard.writeText(s),alert("Credenziali copiate!")},className:"p-2 text-green-400 hover:text-green-300",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx(le,{size:20})})]}),e.jsx("button",{onClick:()=>N("/collaboratori"),className:"text-slate-400 hover:text-rose-400 transition-colors",children:"Torna"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:n==="Setter"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Oggi"}),e.jsx("p",{className:"text-2xl font-bold text-rose-500",children:k.today})]}),e.jsx(re,{className:"text-rose-500",size:28})]})}),e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Settimana"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:k.week})]}),e.jsx(oe,{className:"text-green-500",size:28})]})}),e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Conversione"}),e.jsxs("p",{className:"text-2xl font-bold text-cyan-500",children:[k.conversion,"%"]})]}),e.jsx(ne,{className:"text-cyan-500",size:28})]})}),e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Prenotate"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:k.callsBooked})]}),e.jsx($,{className:"text-yellow-500",size:28})]})})]})}),n==="Setter"&&e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Lead Prenotati"}),e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:e.jsxs("table",{className:"w-full text-xs sm:text-sm text-left text-slate-300",children:[e.jsx("thead",{className:"text-[10px] sm:text-xs uppercase bg-slate-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-4 py-2",children:"Nome"}),e.jsx("th",{className:"px-3 sm:px-4 py-2",children:"Numero"}),e.jsx("th",{className:"px-3 sm:px-4 py-2",children:"Prenotato"}),e.jsx("th",{className:"px-3 sm:px-4 py-2 text-center",children:"Stato"})]})}),e.jsx("tbody",{children:v.length>0?v.map(s=>e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"px-3 sm:px-4 py-2 font-medium text-slate-100",children:s.name}),e.jsx("td",{className:"px-3 sm:px-4 py-2",children:s.number}),e.jsxs("td",{className:"px-3 sm:px-4 py-2 whitespace-nowrap",children:[s.dataPrenotazione," ",s.oraPrenotazione]}),e.jsx("td",{className:"px-3 sm:px-4 py-2 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] sm:text-xs ${s.chiuso?"bg-green-600 text-white":"bg-yellow-600 text-white"}`,children:s.chiuso?"Chiuso":"In attesa"})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 sm:px-4 py-8 text-center text-slate-400",children:"Nessun lead"})})})]})})]}),e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200",children:"Performance"}),e.jsx("div",{className:"flex gap-2",children:["daily","weekly","monthly"].map(s=>e.jsx("button",{onClick:()=>U(s),className:`px-3 py-1 rounded text-sm transition-colors ${y===s?"bg-rose-600 text-white":"bg-slate-700/50 text-slate-400 hover:bg-slate-700/70"}`,children:s==="daily"?"Giorno":s==="weekly"?"Settimana":"Mese"},s))})]}),e.jsx("div",{className:"h-64",children:y==="daily"?e.jsx(ie,{data:T,options:M}):e.jsx(ce,{data:T,options:M})})]}),e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Ruolo"}),e.jsx("div",{className:"flex gap-3 items-center",children:_?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:n,onChange:s=>z(s.target.value),className:"p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-200 focus:outline-none focus:border-rose-500",children:[e.jsx("option",{value:"Setter",children:"Setter"}),e.jsx("option",{value:"Marketing",children:"Marketing"}),e.jsx("option",{value:"Vendita",children:"Vendita"})]}),e.jsxs(D.button,{onClick:X,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(de,{size:16})," Salva"]}),e.jsx("button",{onClick:()=>I(!1),className:"p-2 text-red-400 hover:text-red-300",children:e.jsx(xe,{size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg text-slate-300",children:n}),P&&e.jsx("button",{onClick:()=>I(!0),className:"p-2 text-cyan-400 hover:text-cyan-300",children:e.jsx(me,{size:16})})]})})]}),e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Report Giornalieri"}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w.length>0?w.slice().reverse().map((s,a)=>{var l,o,t,i,c,d,m,r,u,C,b;return e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-700/50 rounded-lg p-4 border border-slate-600",children:[e.jsxs("p",{className:"font-medium text-slate-300 flex items-center gap-2",children:[e.jsx($,{size:16})," ",s.date]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-2 text-sm",children:[n!=="Marketing"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Focus:"})," ",((l=s.eodReport)==null?void 0:l.focus)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Skills:"})," ",((o=s.eodReport)==null?void 0:o.skills)||"—"]}),e.jsxs("p",{className:"col-span-2",children:[e.jsx("strong",{children:"Successi:"})," ",((t=s.eodReport)==null?void 0:t.successi)||"—"]}),e.jsxs("p",{className:"col-span-2",children:[e.jsx("strong",{children:"Difficoltà:"})," ",((i=s.eodReport)==null?void 0:i.difficolta)||"—"]}),e.jsxs("p",{className:"col-span-2",children:[e.jsx("strong",{children:"Soluzioni:"})," ",((c=s.eodReport)==null?void 0:c.soluzioni)||"—"]})]}),n==="Setter"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Chiamate Chiuse:"})," ",((d=s.tracker)==null?void 0:d.callChiuse)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Prenotate:"})," ",((m=s.tracker)==null?void 0:m.callPrenotate)||0]})]}),n==="Marketing"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Views 24h:"})," ",((r=s.tracker)==null?void 0:r.volumeViews24h)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Leads 24h:"})," ",((u=s.tracker)==null?void 0:u.volumeLeads24h)||0]})]}),n==="Vendita"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Chiamate Effettuate:"})," ",((C=s.tracker)==null?void 0:C.callFatte)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Chiusi:"})," ",((b=s.tracker)==null?void 0:b.callChiuse)||0]})]})]})]},a)}):e.jsx("p",{className:"text-slate-500 text-center py-8",children:"Nessun report disponibile."})})]})]})}export{ze as default};
