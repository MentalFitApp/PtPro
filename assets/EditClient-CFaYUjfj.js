import{r as g,j as e}from"./react-CrXOBDSJ.js";import{u as I}from"./react-hook-form-yCRcHKQw.js";import{d as N}from"./index-CYfn4HI_.js";import{A as S,B as $,D as A}from"./@firebase-CuwLCerw.js";import{a as k,g as L}from"./react-router-BxpCmtJ-.js";import{m as h,A as F}from"./framer-motion-BAPjnw1b.js";import{X as j,I as q}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Bp3EI6Ad.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const P=a=>{if(!a)return"";try{const s=typeof a.toDate=="function"?a.toDate():new Date(a);if(isNaN(s))return"";const i=s.getFullYear(),b=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0");return`${i}-${b}-${c}`}catch(s){return console.error("Errore in formatDateForInput:",s),""}},T=({message:a,type:s,onDismiss:i})=>e.jsx(F,{children:a&&e.jsxs(h.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${s==="error"?"bg-red-900/80 text-red-300 border-red-500/30":"bg-emerald-900/80 text-emerald-300 border-emerald-500/30"} backdrop-blur-md shadow-lg`,children:[e.jsx("p",{children:a}),e.jsx("button",{onClick:i,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(j,{size:16})})]})});function ne(){const a=k(),{clientId:s}=L(),{register:i,handleSubmit:b,reset:c,formState:{isSubmitting:u,errors:o}}=I({defaultValues:{name:"",email:"",phone:"",status:"attivo",scadenza:""}}),[w,z]=g.useState(""),[D,C]=g.useState(!0),[v,f]=g.useState({message:"",type:""}),n=(r,t="error")=>{f({message:r,type:t}),setTimeout(()=>f({message:"",type:""}),6e3)};g.useEffect(()=>{if(!s){n("ID cliente non valido.","error"),a("/clients");return}(async()=>{try{const t=S(N,"clients",s),x=await $(t);if(x.exists()){const l=x.data();z(l.name||"Cliente"),c({name:l.name||"",email:l.email||"",phone:l.phone||"",status:l.status||"attivo",scadenza:P(l.scadenza)})}else n("Cliente non trovato.","error"),a("/clients")}catch(t){console.error("Errore nel caricamento del cliente:",t.code,t.message),n(`Errore nel caricamento del cliente: ${t.message}`,"error"),a("/clients")}finally{C(!1)}})()},[s,c,a]);const E=async r=>{try{const t=S(N,"clients",s),x={name:r.name,email:r.email,phone:r.phone||null,status:r.status,scadenza:r.scadenza?new Date(r.scadenza):null};await A(t,x),n("Cliente aggiornato con successo!","success"),a(`/client/${s}`)}catch(t){console.error("Errore nell'aggiornamento del cliente:",t.code,t.message),t.code==="permission-denied"?n("Permessi insufficienti per aggiornare il cliente.","error"):n(`Errore nell'aggiornamento del cliente: ${t.message}`,"error")}},y=()=>{c(),a(`/client/${s}`)},d="w-full p-2.5 bg-slate-700/50 border border-slate-600 rounded-lg outline-none focus:ring-2 focus:ring-rose-500 transition-all text-slate-200",m="block mb-1.5 text-sm font-medium text-slate-400",p="text-red-500 text-sm mt-1";return D?e.jsx("div",{className:"text-center p-8 text-slate-400",children:"Caricamento dati cliente..."}):e.jsxs(e.Fragment,{children:[e.jsx(T,{message:v.message,type:v.type,onDismiss:()=>f({message:"",type:""})}),e.jsxs(h.div,{className:"w-full max-w-2xl mx-auto bg-slate-900/60 backdrop-blur-xl rounded-xl border border-slate-700 p-6 sm:p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-50",children:"Modifica Cliente"}),e.jsx("p",{className:"text-rose-500 font-semibold",children:w})]}),e.jsxs("button",{onClick:y,className:"flex items-center gap-2 px-3 py-1.5 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 rounded-lg text-sm text-slate-300 transition-colors",children:[e.jsx(j,{size:16})," Annulla"]})]}),e.jsxs("form",{onSubmit:b(E),className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Nome e Cognome*"}),e.jsx("input",{...i("name",{required:"Il nome è obbligatorio",minLength:{value:2,message:"Il nome deve essere lungo almeno 2 caratteri"}}),className:d}),o.name&&e.jsx("p",{className:p,children:o.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Email*"}),e.jsx("input",{type:"email",...i("email",{required:"L'email è obbligatoria",pattern:{value:/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/,message:"Inserisci un'email valida"}}),className:d}),o.email&&e.jsx("p",{className:p,children:o.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Telefono (Opzionale)"}),e.jsx("input",{...i("phone",{pattern:{value:/^\+?[0-9]{7,15}$/,message:"Inserisci un numero di telefono valido (7-15 cifre)"}}),className:d}),o.phone&&e.jsx("p",{className:p,children:o.phone.message})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5 pt-5 border-t border-white/10",children:[e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Stato Cliente*"}),e.jsxs("select",{...i("status",{required:"Lo stato è obbligatorio"}),className:d,children:[e.jsx("option",{value:"attivo",children:"Attivo"}),e.jsx("option",{value:"in prova",children:"In Prova"}),e.jsx("option",{value:"sospeso",children:"Sospeso"}),e.jsx("option",{value:"scaduto",children:"Scaduto"})]}),o.status&&e.jsx("p",{className:p,children:o.status.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:m,children:"Data Scadenza*"}),e.jsx("input",{type:"date",...i("scadenza",{required:"La data di scadenza è obbligatoria",validate:r=>{const t=new Date;return t.setHours(0,0,0,0),new Date(r)>=t||"La data di scadenza non può essere nel passato"}}),className:d}),o.scadenza&&e.jsx("p",{className:p,children:o.scadenza.message})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-5",children:[e.jsxs(h.button,{type:"submit",disabled:u,className:"flex items-center gap-2 px-6 py-2.5 bg-rose-600 hover:bg-rose-700 text-white font-semibold rounded-lg transition-colors disabled:bg-rose-900 disabled:cursor-not-allowed",whileHover:{scale:u?1:1.05},whileTap:{scale:u?1:.95},children:[e.jsx(q,{size:18})," ",u?"Salvataggio...":"Salva Modifiche"]}),e.jsxs(h.button,{type:"button",onClick:y,className:"flex items-center gap-2 px-6 py-2.5 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600 text-white font-semibold rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(j,{size:18})," Annulla"]})]})]})]})]})}export{ne as default};
