import{r as d,j as e}from"./react-CrXOBDSJ.js";import{u as Y}from"./react-hook-form-yCRcHKQw.js";import{g as J}from"./firebase-Bp3EI6Ad.js";import{x as K,A as $,B as Z,R as ee,W as se,Q as ae,O,N as le}from"./@firebase-CuwLCerw.js";import{d as q}from"./index-BqQ4SUJN.js";import{a as ie}from"./react-router-BxpCmtJ-.js";import{u as te,o as k,Y as N,I as re,X as V,_ as ne}from"./lucide-react-CCY59hBS.js";import{m as y,A as oe}from"./framer-motion-BAPjnw1b.js";import{v as ce}from"./uuid-CtRu48qb.js";import"./core-js-ChGsxLo2.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const de=({message:s,type:j,onDismiss:o})=>e.jsx(oe,{children:s&&e.jsxs(y.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${j==="success"?"bg-emerald-900/80 text-emerald-300 border-emerald-500/30":"bg-red-900/80 text-red-300 border-red-500/30"} backdrop-blur-md shadow-lg`,children:[e.jsx("p",{children:s}),e.jsx("button",{onClick:o,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(V,{size:16})})]})}),E=({type:s,label:j,onFileSelect:o,previewUrl:w,disabled:F})=>{const[h,L]=d.useState(w),S=f=>{const c=f.target.files[0];if(!c)return;if(c.size>5*1024*1024){alert(`File troppo grande: ${c.name}`);return}if(!c.type.startsWith("image/")){alert(`File non valido: ${c.name}`);return}const A=URL.createObjectURL(c);L(A),o(s,c)};return e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:j}),e.jsxs("div",{className:"mt-2 relative group",children:[e.jsx("div",{className:"flex justify-center items-center w-full h-48 bg-slate-700/30 rounded-lg border-2 border-dashed border-slate-600 group-hover:border-cyan-500 transition-colors cursor-pointer",children:h?e.jsx("img",{src:h,alt:j,className:"h-full w-full object-contain rounded-lg p-1"}):e.jsxs("div",{className:"flex flex-col items-center text-slate-400 group-hover:text-cyan-400",children:[e.jsx(ne,{size:32}),e.jsx("p",{className:"mt-2 text-sm",children:"Clicca per caricare"})]})}),e.jsx("input",{type:"file",accept:"image/*",onChange:S,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:F})]})]})},Te=()=>{const[s,j]=d.useState(null),[o,w]=d.useState(!0),[F,h]=d.useState(!1),[L,S]=d.useState({front:null,right:null,left:null,back:null}),[f,c]=d.useState({front:null,right:null,left:null,back:null}),[A,z]=d.useState({message:"",type:""}),U=ie(),b=J().currentUser,W=K(),{register:l,handleSubmit:B,setValue:T,formState:{isSubmitting:u}}=Y();d.useEffect(()=>{if(!b){U("/login");return}(async()=>{try{const a=$(q,`clients/${b.uid}/anamnesi`,"initial"),g=await Z(a);if(g.exists()){const p=g.data();j(p),p.photoURLs&&c(p.photoURLs),Object.keys(p).forEach(v=>T(v,p[v])),h(!1)}else h(!0)}catch(a){z({message:`Errore: ${a.message}`,type:"error"})}w(!1)})()},[b,U,T]);const P=d.useCallback((n,a="error")=>{z({message:n,type:a}),setTimeout(()=>z({message:"",type:""}),5e3)},[]),D=d.useCallback((n,a)=>{S(g=>({...g,[n]:a})),P(`Foto ${n} caricata!`,"success")},[P]),H=async n=>{if(!(!b||u)){w(!0);try{await b.getIdToken(!0);let a=(s==null?void 0:s.photoURLs)||{front:null,right:null,left:null,back:null};const g=Object.entries(L).filter(([,v])=>v!==null);if(g.length>0){const v=g.map(async([C,I])=>{const Q=`clients/${b.uid}/anamnesi_photos/${C}-${ce()}.jpg`,R=ee(W,Q);await se(R,I);const X=await ae(R);return{type:C,url:X}}),_=await Promise.all(v);a={...a,...Object.fromEntries(_.map(({type:C,url:I})=>[C,I]))}}const p={...n,photoURLs:a,submittedAt:O(),createdAt:O()};await le($(q,`clients/${b.uid}/anamnesi`,"initial"),p,{merge:!0}),j(p),S({front:null,right:null,left:null,back:null}),c(a),h(!1),P("Anamnesi salvata!","success")}catch(a){P(`Errore: ${a.message}`,"error")}finally{w(!1)}}},M=d.useCallback(()=>{S({front:null,right:null,left:null,back:null}),c((s==null?void 0:s.photoURLs)||{front:null,right:null,left:null,back:null}),h(!1)},[s]);if(o)return e.jsx("div",{className:"min-h-screen flex justify-center items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})});const i="w-full p-2.5 mt-1 bg-slate-700/50 border border-slate-600 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-white placeholder:text-slate-400",t="block text-sm font-medium text-slate-300",m="bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6 shadow-lg",x="font-bold mb-4 text-lg text-cyan-300 border-b border-cyan-400/20 pb-2 flex items-center gap-2",r=({label:n,value:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400",children:n}),e.jsx("p",{className:"mt-1 p-3 bg-slate-700/50 rounded-lg min-h-[44px] text-white break-words whitespace-pre-wrap shadow-inner",children:a||"Non specificato"})]}),G=({urls:n})=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:["front","right","left","back"].map(a=>e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 capitalize",children:a==="front"?"Frontale":a==="back"?"Posteriore":`Laterale ${a==="left"?"Sinistro":"Destro"}`}),n!=null&&n[a]?e.jsx(y.img,{src:n[a],alt:a,className:"mt-2 rounded-lg w-full h-48 object-cover hover:scale-105 transition-transform",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3}}):e.jsx("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-slate-700/50 rounded-lg text-slate-500",children:e.jsx("span",{children:"Non caricata"})})]},a))});return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8",children:[e.jsx(de,{message:A.message,type:A.type,onDismiss:()=>z({message:"",type:""})}),e.jsxs("header",{className:"flex justify-between items-center mb-8 flex-col sm:flex-row gap-4",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-white",children:"Anamnesi Cliente"}),e.jsxs("button",{onClick:()=>U("/client/dashboard"),className:"flex items-center gap-2 px-4 py-2 bg-slate-700/50 hover:bg-slate-700/70 text-slate-300 text-sm font-semibold rounded-lg transition-colors border border-slate-600",children:[e.jsx(te,{size:16})," Torna alla dashboard"]})]}),e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},children:F?e.jsxs("form",{onSubmit:B(H),className:"space-y-8",children:[e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(k,{size:16})," Dati Anagrafici e Misure"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Nome"}),e.jsx("input",{...l("firstName"),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Cognome"}),e.jsx("input",{...l("lastName"),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Data di Nascita"}),e.jsx("input",{type:"date",...l("birthDate"),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Che lavoro fai?"}),e.jsx("input",{...l("job"),className:i,placeholder:"Es. Impiegato, studente..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Peso (kg)"}),e.jsx("input",{type:"number",step:"0.1",...l("weight"),className:i,placeholder:"Es. 75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Altezza (cm)"}),e.jsx("input",{type:"number",...l("height"),className:i,placeholder:"Es. 180"})]})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(N,{size:16})," Abitudini Alimentari"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Pasti al giorno"}),e.jsxs("select",{...l("mealsPerDay"),className:i,children:[e.jsx("option",{value:"",children:"Seleziona..."}),e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Colazione: Dolce o Salata?"}),e.jsxs("select",{...l("breakfastType"),className:i,children:[e.jsx("option",{value:"",children:"Seleziona..."}),e.jsx("option",{value:"dolce",children:"Dolce"}),e.jsx("option",{value:"salato",children:"Salato"}),e.jsx("option",{value:"entrambi",children:"Entrambi/Indifferente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Alimenti che ti piacciono"}),e.jsx("textarea",{...l("desiredFoods"),rows:"3",className:i,placeholder:"Elenca qui gli alimenti che vorresti nel piano..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Cosa non mangi?"}),e.jsx("textarea",{...l("dislikedFoods"),rows:"2",className:i,placeholder:"Elenca qui gli alimenti da evitare..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Allergie o Intolleranze?"}),e.jsx("input",{...l("intolerances"),className:i,placeholder:"Es. Lattosio, nessuna..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Problemi di digestione o gonfiore?"}),e.jsx("input",{...l("digestionIssues"),className:i,placeholder:"Sì/No, e se sì quali..."})]})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(k,{size:16})," Allenamento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Allenamenti a settimana"}),e.jsx("input",{type:"number",...l("workoutsPerWeek"),className:i,placeholder:"Es. 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Dettagli Allenamento"}),e.jsx("textarea",{...l("trainingDetails"),rows:"3",className:i,placeholder:"Es. Bodybuilding in palestra con macchinari e pesi liberi..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Orario e Durata"}),e.jsx("input",{...l("trainingTime"),className:i,placeholder:"Es. La sera dalle 18 alle 19:30"})]})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(N,{size:16})," Salute e Obiettivi"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Infortuni o problematiche"}),e.jsx("textarea",{...l("injuries"),rows:"3",className:i,placeholder:"Es. Mal di schiena, ernie, dolori articolari..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Prendi farmaci?"}),e.jsx("input",{...l("medications"),className:i,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Usi integratori?"}),e.jsx("input",{...l("supplements"),className:i,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Obiettivo Principale"}),e.jsx("textarea",{...l("mainGoal"),rows:"3",className:i,placeholder:"Descrivi in dettaglio cosa vuoi raggiungere..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:t,children:"Durata Percorso"}),e.jsx("input",{...l("programDuration"),className:i,placeholder:"Es. 3 mesi, 6 mesi..."})]})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(N,{size:16})," Foto Iniziali"]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Carica 4 foto per il check iniziale: frontale, laterale destro, laterale sinistro e posteriore. Visibili solo a te e al coach."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(E,{type:"front",label:"Frontale",onFileSelect:D,previewUrl:f.front,disabled:o||u}),e.jsx(E,{type:"right",label:"Laterale Destro",onFileSelect:D,previewUrl:f.right,disabled:o||u}),e.jsx(E,{type:"left",label:"Laterale Sinistro",onFileSelect:D,previewUrl:f.left,disabled:o||u}),e.jsx(E,{type:"back",label:"Posteriore",onFileSelect:D,previewUrl:f.back,disabled:o||u})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsxs(y.button,{type:"submit",disabled:u||o,className:"flex items-center gap-2 px-5 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg font-semibold disabled:opacity-50",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(re,{size:16})," ",u?"Salvataggio...":"Salva Anamnesi"]}),e.jsxs(y.button,{type:"button",onClick:M,disabled:u||o,className:"flex items-center gap-2 px-5 py-2.5 bg-slate-700/50 hover:bg-slate-700/70 text-white rounded-lg font-semibold border border-slate-600",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(V,{size:16})," Annulla"]})]})]}):s&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(k,{size:16})," Dati Anagrafici"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Nome",value:s.firstName}),e.jsx(r,{label:"Cognome",value:s.lastName}),e.jsx(r,{label:"Data di Nascita",value:s.birthDate}),e.jsx(r,{label:"Lavoro",value:s.job}),e.jsx(r,{label:"Peso (kg)",value:s.weight}),e.jsx(r,{label:"Altezza (cm)",value:s.height})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(N,{size:16})," Abitudini Alimentari"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Pasti al giorno",value:s.mealsPerDay}),e.jsx(r,{label:"Tipo Colazione",value:s.breakfastType}),e.jsx(r,{label:"Alimenti preferiti",value:s.desiredFoods}),e.jsx(r,{label:"Alimenti da evitare",value:s.dislikedFoods}),e.jsx(r,{label:"Allergie/Intolleranze",value:s.intolerances}),e.jsx(r,{label:"Problemi di digestione",value:s.digestionIssues})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(k,{size:16})," Allenamento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Allenamenti a settimana",value:s.workoutsPerWeek}),e.jsx(r,{label:"Dettagli Allenamento",value:s.trainingDetails}),e.jsx(r,{label:"Orario e Durata",value:s.trainingTime})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(N,{size:16})," Salute e Obiettivi"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Infortuni o problematiche",value:s.injuries}),e.jsx(r,{label:"Farmaci",value:s.medications}),e.jsx(r,{label:"Integratori",value:s.supplements}),e.jsx(r,{label:"Obiettivo Principale",value:s.mainGoal}),e.jsx(r,{label:"Durata Percorso",value:s.programDuration})]})]}),e.jsxs("div",{className:m,children:[e.jsxs("h4",{className:x,children:[e.jsx(N,{size:16})," Foto Iniziali"]}),e.jsx(G,{urls:s.photoURLs})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(y.button,{onClick:()=>h(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-slate-700/50 hover:bg-slate-700/70 text-slate-300 rounded-lg font-semibold border border-slate-600",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(k,{size:16})," Modifica Dati"]})})]})})]})};export{Te as default};
