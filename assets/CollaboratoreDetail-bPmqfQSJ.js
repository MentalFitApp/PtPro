import{r as x,j as e}from"./react-CrXOBDSJ.js";import{J as W,K as X,U as Z,I as Y,H as G,A as S,D as ee,B as U}from"./@firebase-CuwLCerw.js";import{o as te}from"./firebase-Bp3EI6Ad.js";import{d as f,a as se}from"./index-CYfn4HI_.js";import{Q as ae}from"./QuickNotifyButton-Dj8Z2seh.js";import{C as re,c as le,b as oe,f as ie,a as ne,P as ce,p as de,d as xe,e as me}from"./chart.js-m_wzuIQ6.js";import{B as pe,L as he}from"./react-chartjs-2-DgEolIMQ.js";import{a as ue,b as be}from"./react-router-BxpCmtJ-.js";import{m as D}from"./framer-motion-BAPjnw1b.js";import{U as je,z as ge,G as fe,T as Ne,i as ye,b as $,I as ve,X as we,v as ke}from"./lucide-react-CCY59hBS.js";import"./core-js-ChGsxLo2.js";import"./idb-Bn1DMRyg.js";import"./tslib-BGVaTf34.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./@kurkle-D8fDXNIl.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";re.register(le,oe,ie,ne,ce,de,xe,me);function Ye(){var B,A;const N=ue(),p=be(),[h,R]=x.useState(null),[i,z]=x.useState(""),[q,j]=x.useState(!0),[P,g]=x.useState(""),[E,H]=x.useState(!1),[y,Q]=x.useState("daily"),[_,I]=x.useState(!1),[v,K]=x.useState([]),[w,L]=x.useState([]);x.useEffect(()=>{const t=te(se,async a=>{var c;if(!a){N("/login");return}const r=(c=p.state)==null?void 0:c.collaboratoreId;if(!r){g("Nessun collaboratore selezionato."),j(!1);return}const o=await U(S(f,"roles","admins")),n=(o.exists()?o.data().uids||[]:[]).includes(a.uid);if(H(n),!n&&a.uid!==r){g("Non hai i permessi per visualizzare questo collaboratore."),j(!1);return}try{const d=S(f,"collaboratori",r),m=await U(d);if(!m.exists()){g("Collaboratore non trovato."),j(!1);return}const l=m.data();R(l),z(l.role||""),L(l.dailyReports||[]),j(!1)}catch{g("Errore nel caricamento dei dati."),j(!1)}});return()=>t()},[N,p.state]),x.useEffect(()=>{var r;if(!((r=p.state)!=null&&r.collaboratoreId))return;const t=W(Y(f,"leads"),Z("collaboratoreId","==",p.state.collaboratoreId),X("timestamp","desc")),a=G(t,o=>{K(o.docs.map(s=>({id:s.id,...s.data()})))});return()=>a()},[(B=p.state)==null?void 0:B.collaboratoreId]),x.useEffect(()=>{var r;if(!((r=p.state)!=null&&r.collaboratoreId))return;const t=S(f,"collaboratori",p.state.collaboratoreId),a=G(t,o=>{if(o.exists()){const s=o.data();L(s.dailyReports||[])}});return()=>a()},[(A=p.state)==null?void 0:A.collaboratoreId]);const k=(()=>{const t=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()-a.getDay());const r=new Date(t.slice(0,7)+"-01");let o=0,s=0,n=0,c=0,d=0;w.forEach(l=>{var O,V;const u=l.date,C=parseInt(((O=l.tracker)==null?void 0:O.callPrenotate)||0),b=parseInt(((V=l.tracker)==null?void 0:V.callChiuse)||0);c+=C,d+=b,u===t&&(o+=b),new Date(u)>=a&&(s+=b),new Date(u)>=r&&(n+=b)});const m=c>0?(d/c*100).toFixed(1):0;return{today:o,week:s,month:n,callsBooked:c,callsClosed:d,conversion:m,totalLeads:v.length,leadsClosed:v.filter(l=>l.chiuso).length}})(),F=(()=>{const t={};w.forEach(s=>{var d,m;let n="";if(y==="daily")n=s.date;else if(y==="weekly"){const l=new Date(s.date),u=new Date(l);u.setDate(l.getDate()-l.getDay()+1),n=u.toISOString().split("T")[0]}else n=s.date.substring(0,7);const c=parseInt(i==="Marketing"?((d=s.tracker)==null?void 0:d.volumeLeads24h)||0:((m=s.tracker)==null?void 0:m.callChiuse)||0);t[n]=(t[n]||0)+c});const a=Object.keys(t).sort(),r=a,o=a.map(s=>t[s]);return{labels:r,data:o}})(),T={labels:F.labels,datasets:[{label:i==="Marketing"?"Leads Generati":"Chiamate Chiuse",data:F.data,backgroundColor:i==="Marketing"?"rgba(34, 197, 94, 0.6)":"rgba(239, 68, 68, 0.6)",borderColor:i==="Marketing"?"#22c55e":"#ef4444",borderWidth:2,borderRadius:4}]},M={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{y:{beginAtZero:!0},x:{grid:{display:!1}}}},J=async()=>{if(E)try{await ee(S(f,"collaboratori",p.state.collaboratoreId),{role:i}),R(t=>({...t,role:i})),I(!1)}catch{g("Errore aggiornamento ruolo.")}};return q?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-rose-500"})}):P?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-red-500 p-4",children:[e.jsx("p",{children:P}),e.jsx("button",{onClick:()=>N("/collaboratori"),className:"mt-4 px-4 py-2 bg-rose-600 text-white rounded-lg",children:"Torna indietro"})]}):e.jsxs(D.div,{initial:{opacity:0},animate:{opacity:1},className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("h1",{className:"text-3xl font-bold text-slate-50 flex items-center gap-3",children:[e.jsx(je,{size:32}),h.name||h.email.split("@")[0],e.jsxs("span",{className:"text-lg font-normal text-slate-400",children:["(",h.role,")"]})]}),e.jsx(ae,{userId:h.uid,userName:h.name||h.email.split("@")[0],userType:"collaboratore"}),h.firstLogin&&e.jsx(D.button,{onClick:()=>{const t=`Email: ${h.email}
Password: ${h.tempPassword||"generata al login"}
Link: https://MentalFitApp.github.io/PtPro/#/login`;navigator.clipboard.writeText(t),alert("Credenziali copiate!")},className:"p-2 text-green-400 hover:text-green-300",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx(ge,{size:20})})]}),e.jsx("button",{onClick:()=>N("/collaboratori"),className:"text-slate-400 hover:text-rose-400 transition-colors",children:"Torna"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:i==="Setter"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Oggi"}),e.jsx("p",{className:"text-2xl font-bold text-rose-500",children:k.today})]}),e.jsx(fe,{className:"text-rose-500",size:28})]})}),e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Settimana"}),e.jsx("p",{className:"text-2xl font-bold text-green-500",children:k.week})]}),e.jsx(Ne,{className:"text-green-500",size:28})]})}),e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Conversione"}),e.jsxs("p",{className:"text-2xl font-bold text-cyan-500",children:[k.conversion,"%"]})]}),e.jsx(ye,{className:"text-cyan-500",size:28})]})}),e.jsx("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-5 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-400 text-sm",children:"Prenotate"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-500",children:k.callsBooked})]}),e.jsx($,{className:"text-yellow-500",size:28})]})})]})}),i==="Setter"&&e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Lead Prenotati"}),e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:e.jsxs("table",{className:"w-full text-xs sm:text-sm text-left text-slate-300",children:[e.jsx("thead",{className:"text-[10px] sm:text-xs uppercase bg-slate-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 sm:px-4 py-2",children:"Nome"}),e.jsx("th",{className:"px-3 sm:px-4 py-2",children:"Numero"}),e.jsx("th",{className:"px-3 sm:px-4 py-2",children:"Prenotato"}),e.jsx("th",{className:"px-3 sm:px-4 py-2 text-center",children:"Stato"})]})}),e.jsx("tbody",{children:v.length>0?v.map(t=>e.jsxs("tr",{className:"border-b border-white/10",children:[e.jsx("td",{className:"px-3 sm:px-4 py-2 font-medium text-slate-100",children:t.name}),e.jsx("td",{className:"px-3 sm:px-4 py-2",children:t.number}),e.jsxs("td",{className:"px-3 sm:px-4 py-2 whitespace-nowrap",children:[t.dataPrenotazione," ",t.oraPrenotazione]}),e.jsx("td",{className:"px-3 sm:px-4 py-2 text-center",children:e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] sm:text-xs ${t.chiuso?"bg-green-600 text-white":"bg-yellow-600 text-white"}`,children:t.chiuso?"Chiuso":"In attesa"})})]},t.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-3 sm:px-4 py-8 text-center text-slate-400",children:"Nessun lead"})})})]})})]}),e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200",children:"Performance"}),e.jsx("div",{className:"flex gap-2",children:["daily","weekly","monthly"].map(t=>e.jsx("button",{onClick:()=>Q(t),className:`px-3 py-1 rounded text-sm transition-colors ${y===t?"bg-rose-600 text-white":"bg-slate-700/50 text-slate-400 hover:bg-slate-700/70"}`,children:t==="daily"?"Giorno":t==="weekly"?"Settimana":"Mese"},t))})]}),e.jsx("div",{className:"h-64",children:y==="daily"?e.jsx(pe,{data:T,options:M}):e.jsx(he,{data:T,options:M})})]}),e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Ruolo"}),e.jsx("div",{className:"flex gap-3 items-center",children:_?e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:i,onChange:t=>z(t.target.value),className:"p-2 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-200 focus:outline-none focus:border-rose-500",children:[e.jsx("option",{value:"Setter",children:"Setter"}),e.jsx("option",{value:"Marketing",children:"Marketing"}),e.jsx("option",{value:"Vendita",children:"Vendita"})]}),e.jsxs(D.button,{onClick:J,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(ve,{size:16})," Salva"]}),e.jsx("button",{onClick:()=>I(!1),className:"p-2 text-red-400 hover:text-red-300",children:e.jsx(we,{size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg text-slate-300",children:i}),E&&e.jsx("button",{onClick:()=>I(!0),className:"p-2 text-cyan-400 hover:text-cyan-300",children:e.jsx(ke,{size:16})})]})})]}),e.jsxs("div",{className:"bg-slate-700/50 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-200 mb-4",children:"Report Giornalieri"}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w.length>0?w.slice().reverse().map((t,a)=>{var r,o,s,n,c,d,m,l,u,C,b;return e.jsxs(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-700/50 rounded-lg p-4 border border-slate-600",children:[e.jsxs("p",{className:"font-medium text-slate-300 flex items-center gap-2",children:[e.jsx($,{size:16})," ",t.date]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mt-2 text-sm",children:[i!=="Marketing"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Focus:"})," ",((r=t.eodReport)==null?void 0:r.focus)||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Skills:"})," ",((o=t.eodReport)==null?void 0:o.skills)||"—"]}),e.jsxs("p",{className:"col-span-2",children:[e.jsx("strong",{children:"Successi:"})," ",((s=t.eodReport)==null?void 0:s.successi)||"—"]}),e.jsxs("p",{className:"col-span-2",children:[e.jsx("strong",{children:"Difficoltà:"})," ",((n=t.eodReport)==null?void 0:n.difficolta)||"—"]}),e.jsxs("p",{className:"col-span-2",children:[e.jsx("strong",{children:"Soluzioni:"})," ",((c=t.eodReport)==null?void 0:c.soluzioni)||"—"]})]}),i==="Setter"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Chiamate Chiuse:"})," ",((d=t.tracker)==null?void 0:d.callChiuse)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Prenotate:"})," ",((m=t.tracker)==null?void 0:m.callPrenotate)||0]})]}),i==="Marketing"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Views 24h:"})," ",((l=t.tracker)==null?void 0:l.volumeViews24h)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Leads 24h:"})," ",((u=t.tracker)==null?void 0:u.volumeLeads24h)||0]})]}),i==="Vendita"&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Chiamate Effettuate:"})," ",((C=t.tracker)==null?void 0:C.callFatte)||0]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Chiusi:"})," ",((b=t.tracker)==null?void 0:b.callChiuse)||0]})]})]})]},a)}):e.jsx("p",{className:"text-slate-500 text-center py-8",children:"Nessun report disponibile."})})]})]})}export{Ye as default};
