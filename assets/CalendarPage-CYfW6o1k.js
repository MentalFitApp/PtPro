import{d as je,bG as Ke,bn as Ge,a6 as Qe,e as P,h as Xe,r as h,j as e,q as k,B as _e,bm as Ze,s as Je,C as et,a0 as se,A as he,av as pe,R as tt,aI as ne,U as at,aD as be,au as st,aL as nt,u as le,f as fe,V,T as lt,aU as rt,l as it,ax as ot,W as ct,X as dt}from"./.pnpm-C04Ba0Xq.js";import{d as y,a as w}from"./index-DdCoIfwr.js";const mt="BPBjZH1KnB4fCdqy5VobaJvb_mC5UTPKxodeIhyhl6PrRBZ1r6bd6nFqoloeDXSXKb4uffOVSupUGHQ4Q0l9Ato",ut=async f=>{try{if(!("Notification"in window))return console.log("Browser non supporta notifiche"),null;if(await Notification.requestPermission()!=="granted")return console.log("Permesso notifiche negato"),null;const g=je(),S=await Ge(g,{vapidKey:mt});return S?(await Qe(P(y,"fcmTokens",f),{token:S,userId:f,updatedAt:new Date}),console.log("Token FCM ottenuto:",S),S):null}catch(r){return console.error("Errore richiesta permesso notifiche:",r),null}},xt=()=>"Notification"in window?Notification.permission:"not-supported",Ne=(f,r={})=>{if(Notification.permission==="granted"){const g=new Notification(f,{icon:"/icon-192.png",badge:"/icon-192.png",...r});return setTimeout(()=>g.close(),5e3),g}},gt=(f,r)=>{Ne("ðŸ“ž Chiamata imminente",{body:`${f} tra ${r} minuti`,tag:"upcoming-call",requireInteraction:!0,vibrate:[200,100,200]})},ht=f=>{const r=je();return Ke(r,g=>{console.log("Messaggio ricevuto in foreground:",g),g.notification&&Ne(g.notification.title,{body:g.notification.body,icon:g.notification.icon,data:g.data}),f&&f(g)})},ve=f=>{f.forEach(r=>{const[g,S]=r.time.split(":").map(Number),Y=new Date(r.date);Y.setHours(g,S,0,0);const C=new Date(Y.getTime()-30*60*1e3),E=new Date;if(C>E){const K=C.getTime()-E.getTime();setTimeout(()=>{gt(r.title,30)},K)}})};function vt(){var xe,ge;const f=Xe(),[r,g]=h.useState(new Date),[S,Y]=h.useState([]),[C,E]=h.useState(null),[K,D]=h.useState(!1),[d,v]=h.useState({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[]}),[H,T]=h.useState(null),[we,ye]=h.useState(""),[U,Se]=h.useState(!1),[G,re]=h.useState(!1),[j,Q]=h.useState("month"),[pt,De]=h.useState([]),[z,X]=h.useState(!1),[$,_]=h.useState(null),[I,q]=h.useState(null),[x,O]=h.useState(null),[Me,F]=h.useState(!1),[ie,Z]=h.useState(!1),[s,b]=h.useState({name:"",number:"",email:"",source:"",note:"",date:"",time:""}),[ke,L]=h.useState(!0);h.useEffect(()=>{if(!w.currentUser){f("/login");return}let t,a;return(async()=>{var p;const i=await fe(P(y,"collaboratori",w.currentUser.uid));i.exists()&&ye(i.data().role||"");const l=await fe(P(y,"roles","admins")),o=l.exists()&&((p=l.data().uids)==null?void 0:p.includes(w.currentUser.uid));Se(o);const u=xt();re(u==="granted"),a=ht(M=>{console.log("Notifica ricevuta:",M)});let c;o?c=V(y,"calendarEvents"):c=V(y,"calendarEvents"),t=lt(c,M=>{const N=M.docs.map(m=>({id:m.id,...m.data(),date:m.data().date}));Y(N);const B=new Date().toISOString().split("T")[0],W=N.filter(m=>m.date===B);u==="granted"&&W.length>0&&ve(W)})})(),()=>{t&&t(),a&&a()}},[f]);const Ce=t=>{const a=t.getFullYear(),n=t.getMonth(),i=new Date(a,n,1),o=new Date(a,n+1,0).getDate(),u=i.getDay(),c=[];for(let p=0;p<u;p++)c.push(null);for(let p=1;p<=o;p++)c.push(p);return c},R=t=>{const a=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),i=String(t).padStart(2,"0");return`${a}-${n}-${i}`},J=t=>{if(!t)return[];const a=R(t);return S.filter(n=>n.date===a)},oe=t=>{const a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${a}-${n}-${i}`},Ee=t=>{const a=t.getDay(),n=new Date(t);return n.setHours(0,0,0,0),n.setDate(t.getDate()-a),n},Te=t=>{const a=Ee(t);return Array.from({length:7},(n,i)=>{const l=new Date(a);return l.setDate(a.getDate()+i),l})},ce=t=>{const a=oe(t);return S.filter(n=>n.date===a).sort((n,i)=>(n.time||"").localeCompare(i.time||""))},$e=()=>{g(new Date(r.getFullYear(),r.getMonth()-1))},Ie=()=>{g(new Date(r.getFullYear(),r.getMonth()+1))},Le=()=>{if(j==="month")return $e();if(j==="week")return g(new Date(r.getFullYear(),r.getMonth(),r.getDate()-7));if(j==="day")return g(new Date(r.getFullYear(),r.getMonth(),r.getDate()-1))},Ue=()=>{if(j==="month")return Ie();if(j==="week")return g(new Date(r.getFullYear(),r.getMonth(),r.getDate()+7));if(j==="day")return g(new Date(r.getFullYear(),r.getMonth(),r.getDate()+1))},Fe=t=>{var a;t&&(E(t),D(!0),T(null),v({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[((a=w.currentUser)==null?void 0:a.uid)||""]}),L(!0))},Pe=async()=>{var t;if(!d.title||!d.time){alert("Inserisci titolo e ora");return}try{const a=R(C);let n=d.durationMinutes||30;if(d.endTime){const[i,l]=(d.time||"00:00").split(":").map(Number),[o,u]=(d.endTime||"00:00").split(":").map(Number),c=i*60+l,p=o*60+u;if(p<=c){alert("L'ora di fine deve essere successiva all'inizio");return}n=p-c}await rt(V(y,"calendarEvents"),{title:d.title,time:d.time,type:d.type,note:d.note,durationMinutes:n,date:a,createdBy:w.currentUser.uid,participants:[],timestamp:new Date}),D(!1),v({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[((t=w.currentUser)==null?void 0:t.uid)||""]}),L(!0)}catch(a){console.error("Errore aggiunta evento:",a),alert("Errore nell'aggiungere l'evento")}},ze=async()=>{var t;if(!(!H||!d.title||!d.time))try{let a=d.durationMinutes||30;if(d.endTime){const[n,i]=(d.time||"00:00").split(":").map(Number),[l,o]=(d.endTime||"00:00").split(":").map(Number),u=n*60+i,c=l*60+o;if(c<=u){alert("L'ora di fine deve essere successiva all'inizio");return}a=c-u}await le(P(y,"calendarEvents",H.id),{title:d.title,time:d.time,type:d.type,note:d.note,durationMinutes:a}),D(!1),T(null),v({title:"",time:"",endTime:"",type:"call",note:"",durationMinutes:30,participants:[((t=w.currentUser)==null?void 0:t.uid)||""]}),L(!0)}catch(a){console.error("Errore aggiornamento evento:",a)}},Ae=async t=>{if(confirm("Eliminare questo evento?"))try{await it(P(y,"calendarEvents",t))}catch(a){console.error("Errore eliminazione evento:",a)}},de=t=>{var a;T(t),v({title:t.title,time:t.time,endTime:(()=>{const[n,i]=(t.time||"00:00").split(":").map(Number),l=n*60+i+(t.durationMinutes||30),o=String(Math.floor(l/60)).padStart(2,"0"),u=String(l%60).padStart(2,"0");return`${o}:${u}`})(),type:t.type||"call",note:t.note||"",durationMinutes:t.durationMinutes||30,participants:t.participants||[((a=w.currentUser)==null?void 0:a.uid)||""]})},He=async()=>{if(G)alert("Le notifiche sono attive! Puoi disattivarle dalle impostazioni del browser.");else if(await ut(w.currentUser.uid)){re(!0),alert("âœ… Notifiche attivate! Riceverai promemoria per le tue chiamate.");const a=new Date().toISOString().split("T")[0],n=S.filter(i=>i.date===a);n.length>0&&ve(n)}else alert("âŒ Permesso notifiche negato. Abilitale dalle impostazioni del browser.")},Be=new Intl.DateTimeFormat("it-IT",{month:"long",year:"numeric"}).format(r),ee=Te(r),Ye=`${ee[0].toLocaleDateString("it-IT",{day:"2-digit",month:"short"})} - ${ee[6].toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})}`,qe=r.toLocaleDateString("it-IT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"}),Oe=Ce(r),te=new Date,me=`${te.getFullYear()}-${String(te.getMonth()+1).padStart(2,"0")}-${String(te.getDate()).padStart(2,"0")}`;h.useEffect(()=>{(async()=>{if(U)try{const a=await ot(ct(V(y,"collaboratori"),dt("nome")));De(a.docs.map(n=>({id:n.id,...n.data()||{}})))}catch(a){console.error("Errore caricamento collaboratori:",a)}})()},[U]);const ue=()=>{var N;const t=new Date,a=t.getMinutes(),n=Math.ceil(a/15)*15;n===60&&t.setHours(t.getHours()+1);const i=String(t.getHours()).padStart(2,"0"),l=String(n===60?0:n).padStart(2,"0"),o=`${i}:${l}`,c=parseInt(i)*60+parseInt(l)+60,p=String(Math.floor(c/60)).padStart(2,"0"),M=String(c%60).padStart(2,"0");E(r.getDate()),T(null),v({title:"",time:o,endTime:`${p}:${M}`,type:"meeting",note:"",durationMinutes:60,participants:[((N=w.currentUser)==null?void 0:N.uid)||""]}),L(!1),D(!0)};return e.jsxs("div",{className:"mobile-container py-4 sm:py-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-6 min-w-0",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-50",children:"Calendario"}),e.jsxs("div",{className:"flex items-center gap-4 flex-wrap min-w-0",children:[e.jsxs("div",{className:"flex items-center bg-slate-800/50 border border-slate-700 rounded-xl overflow-hidden text-xs sm:text-sm",children:[e.jsx("button",{onClick:()=>Q("month"),className:`px-3 py-1.5 ${j==="month"?"bg-slate-700 text-white":"text-slate-300 hover:text-white"}`,children:"Mese"}),e.jsx("button",{onClick:()=>Q("week"),className:`px-3 py-1.5 border-l border-slate-700 ${j==="week"?"bg-slate-700 text-white":"text-slate-300 hover:text-white"}`,children:"Settimana"}),e.jsx("button",{onClick:()=>Q("day"),className:`px-3 py-1.5 border-l border-slate-700 ${j==="day"?"bg-slate-700 text-white":"text-slate-300 hover:text-white"}`,children:"Giorno"})]}),e.jsx(k.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:He,className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all ${G?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/25":"bg-slate-800/50 text-slate-300 hover:bg-slate-700/50 border border-slate-700"}`,children:G?e.jsxs(e.Fragment,{children:[e.jsx(_e,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Notifiche Attive"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Attiva Notifiche"})]})}),e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("button",{onClick:Le,className:"p-2 bg-slate-700/50 hover:bg-slate-700/70 text-slate-200 rounded-lg border border-slate-600",children:e.jsx(Je,{size:20})}),e.jsx("span",{className:"flex-1 min-w-0 text-sm sm:text-xl font-semibold text-slate-200 text-center capitalize truncate",children:j==="month"?Be:j==="week"?Ye:qe}),e.jsx("button",{onClick:Ue,className:"p-2 bg-slate-700/50 hover:bg-slate-700/70 text-slate-200 rounded-lg border border-slate-600",children:e.jsx(et,{size:20})}),e.jsx("button",{onClick:()=>g(new Date),className:"px-3 py-1.5 bg-slate-700/50 hover:bg-slate-700/70 text-slate-200 rounded-lg border border-slate-600 text-xs sm:text-sm",children:"Oggi"}),U&&e.jsxs(k.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:ue,className:"hidden sm:flex items-center gap-2 px-4 py-2 rounded-xl font-medium transition-all bg-gradient-to-r from-rose-600 to-pink-600 text-white shadow-lg shadow-rose-500/25",children:[e.jsx(se,{className:"w-5 h-5"})," Nuovo evento"]})]})]})]}),U&&e.jsx("div",{className:"sm:hidden mb-4",children:e.jsxs("button",{onClick:ue,className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl font-medium bg-gradient-to-r from-rose-600 to-pink-600 text-white",children:[e.jsx(se,{className:"w-5 h-5"})," Nuovo evento"]})}),j==="month"&&e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl p-4 sm:p-6 border border-slate-700",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"].map(t=>e.jsx("div",{className:"text-center text-slate-400 font-semibold text-[11px] sm:text-sm py-2",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:Oe.map((t,a)=>{const n=t?R(t):"",i=t?J(t):[],l=n===me;return e.jsx(k.div,{whileHover:t?{scale:1.02}:{},className:`min-h-[80px] sm:min-h-[100px] p-2 rounded-lg border transition-colors min-w-0 ${t?l?"bg-rose-900/30 border-rose-500/50 cursor-pointer hover:bg-rose-900/40":"bg-slate-700/50 border-slate-600 cursor-pointer hover:bg-slate-700/70":"bg-transparent border-transparent"}`,onClick:()=>Fe(t),children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`text-sm font-semibold mb-1 ${l?"text-rose-300":"text-slate-200"}`,children:t}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:i.map((o,u)=>e.jsx("div",{onClick:c=>{o.type==="lead"&&(c.stopPropagation(),O(o),F(!0))},className:`w-2 h-2 rounded-full ${o.type==="lead"?"bg-emerald-500 cursor-pointer hover:ring-2 hover:ring-emerald-400":o.type==="call"?"bg-blue-500":"bg-purple-500"}`,title:`${o.time} - ${o.title}`},o.id))})]})},a)})})]}),j==="week"&&e.jsx("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl p-4 sm:p-6 border border-slate-700",children:e.jsx("div",{className:"grid grid-cols-7 gap-2 sm:gap-3",children:ee.map((t,a)=>{const n=oe(t),i=ce(t),l=n===me;return e.jsxs("div",{className:`p-2 sm:p-3 rounded-lg border ${l?"bg-rose-900/30 border-rose-500/50":"bg-slate-700/50 border-slate-600"}`,children:[e.jsxs("div",{className:"flex items-baseline justify-between mb-2",children:[e.jsx("div",{className:"text-[11px] sm:text-sm font-semibold text-slate-200 capitalize",children:t.toLocaleDateString("it-IT",{weekday:"short"})}),e.jsx("div",{className:`text-[11px] sm:text-sm font-bold ${l?"text-rose-300":"text-slate-100"}`,children:t.getDate()})]}),e.jsx("div",{className:"space-y-2",children:i.length===0?e.jsx("div",{className:"text-xs text-slate-400 italic",children:"Nessun evento"}):i.map(o=>e.jsxs("div",{onClick:()=>{o.type==="lead"&&(O(o),F(!0))},className:`px-2 py-1 rounded cursor-pointer ${o.type==="lead"?"bg-emerald-600/80 text-emerald-100 hover:bg-emerald-500/80":o.type==="call"?"bg-blue-600/80 text-blue-100":"bg-purple-600/80 text-purple-100"}`,title:o.title,children:[e.jsx("div",{className:"text-[11px] font-mono opacity-90",children:o.time}),e.jsx("div",{className:"text-xs truncate",children:o.title})]},o.id))})]},a)})})}),j==="day"&&e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl p-4 sm:p-6 border border-slate-700",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-slate-300 text-sm",children:r.toLocaleDateString("it-IT",{weekday:"long"})}),e.jsx("div",{className:"text-2xl font-bold text-slate-100",children:r.toLocaleDateString("it-IT")})]}),e.jsx("div",{className:"relative max-h-[70vh] overflow-auto rounded-lg border border-slate-700 select-none",onMouseUp:()=>{if(!z||$===null||I===null)return;const t=Math.min($,I),a=Math.max($,I)+15,n=String(Math.floor(t/60)).padStart(2,"0"),i=String(t%60).padStart(2,"0"),l=String(Math.floor(a/60)).padStart(2,"0"),o=String(a%60).padStart(2,"0");X(!1),_(null),q(null),E(r.getDate()),T(null),v({title:"",time:`${n}:${i}`,endTime:`${l}:${o}`,type:"meeting",note:"",durationMinutes:a-t}),L(!1),D(!0)},onMouseLeave:()=>{if(!z||$===null||I===null)return;const t=Math.min($,I),a=Math.max($,I)+15,n=String(Math.floor(t/60)).padStart(2,"0"),i=String(t%60).padStart(2,"0"),l=String(Math.floor(a/60)).padStart(2,"0"),o=String(a%60).padStart(2,"0");X(!1),_(null),q(null),E(r.getDate()),T(null),v({title:"",time:`${n}:${i}`,endTime:`${l}:${o}`,type:"meeting",note:"",durationMinutes:a-t}),L(!1),D(!0)},children:(()=>{const t=ce(r).map(n=>({...n,startMin:(()=>{const[i,l]=(n.time||"00:00").split(":").map(Number);return i*60+l})(),dur:n.durationMinutes||30})),a=Array.from({length:24},(n,i)=>i);return e.jsx("div",{children:a.map(n=>{const i=String(n).padStart(2,"0")+":00",l=n*60,o=[0,15,30,45];return e.jsxs("div",{className:"grid grid-cols-[70px,1fr] border-b border-slate-700/60",children:[e.jsx("div",{className:"px-2 py-4 text-xs text-slate-400 font-mono select-none cursor-pointer hover:text-slate-200",onClick:()=>{const u=l,c=l+60,p=String(Math.floor(u/60)).padStart(2,"0"),M=String(u%60).padStart(2,"0"),N=String(Math.floor(c/60)).padStart(2,"0"),B=String(c%60).padStart(2,"0");E(r.getDate()),T(null),v({title:"",time:`${p}:${M}`,endTime:`${N}:${B}`,type:"meeting",note:"",durationMinutes:c-u}),L(!1),D(!0)},children:i}),e.jsx("div",{className:"py-1 pr-2",children:e.jsx("div",{className:"grid grid-rows-4 gap-0.5",children:o.map(u=>{const c=l+u,p=c+15,M=t.filter(m=>{const A=m.startMin+m.dur;return m.startMin<p&&A>c}),N=M.filter(m=>m.startMin>=c&&m.startMin<p),B=M.filter(m=>m.startMin<c),W=z&&$!==null&&I!==null&&c>=Math.min($,I)&&c<Math.max($,I);return`${String(n).padStart(2,"0")}${String(u).padStart(2,"0")}`,e.jsx("div",{className:`relative rounded ${W?"bg-rose-500/20":"bg-slate-900/20"} border border-slate-800/50 h-10`,onMouseDown:()=>{X(!0),_(c),q(c)},onMouseEnter:()=>{z&&q(c)},onMouseUp:()=>{},onClick:()=>{if(z)return;const m=c,A=c+30,ae=String(Math.floor(m/60)).padStart(2,"0"),Re=String(m%60).padStart(2,"0"),We=String(Math.floor(A/60)).padStart(2,"0"),Ve=String(A%60).padStart(2,"0");E(r.getDate()),T(null),v({title:"",time:`${ae}:${Re}`,endTime:`${We}:${Ve}`,type:"call",note:"",durationMinutes:A-m}),L(!1),D(!0)},children:N.length>0?e.jsx("div",{className:"absolute inset-0 m-0.5 flex gap-0.5 overflow-hidden",children:N.map((m,A)=>e.jsxs("div",{className:`flex-1 p-1.5 rounded-lg text-[10px] sm:text-xs shadow cursor-pointer ${m.type==="lead"?"bg-emerald-600/80 text-emerald-100 hover:bg-emerald-600/90":m.type==="call"?"bg-blue-600/80 text-blue-100 hover:bg-blue-600/90":"bg-purple-600/80 text-purple-100 hover:bg-purple-600/90"}`,style:{minWidth:N.length>1?`${100/N.length}%`:"100%"},onClick:ae=>{ae.stopPropagation(),m.type==="lead"?(O(m),F(!0)):(de(m),L(!1),D(!0))},children:[e.jsx("div",{className:"font-semibold truncate",children:m.title}),e.jsx("div",{className:"text-[9px] opacity-90 font-mono mt-0.5",children:m.time})]},m.id))}):B.length>0?e.jsx("div",{className:"absolute inset-y-0 left-0 right-0 mx-1 my-2 rounded bg-slate-200/10"}):null},u)})})})]},n)})})})()})]}),e.jsx(he,{children:K&&C&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs(k.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"bg-slate-900/95 rounded-2xl border border-slate-700 p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-slate-100",children:[R(C)," - ",new Date(r.getFullYear(),r.getMonth(),C).toLocaleDateString("it-IT",{weekday:"long"})]}),e.jsx("button",{onClick:()=>{D(!1),T(null)},className:"text-slate-400 hover:text-rose-400",children:e.jsx(pe,{size:24})})]}),ke&&e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h4",{className:"text-lg font-semibold text-slate-200",children:"Eventi del giorno"})}),e.jsx("div",{className:"space-y-2",children:J(C).length===0?e.jsx("p",{className:"text-slate-400 text-sm italic",children:"Nessun evento"}):(()=>{const t=J(C).sort((l,o)=>{const u=l.time||"00:00",c=o.time||"00:00";return u.localeCompare(c)}),a=new Date,n=`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`;let i=!1;return t.map((l,o)=>{const u=!i&&l.time>n;return u&&(i=!0),e.jsxs(tt.Fragment,{children:[u&&e.jsxs("div",{className:"flex items-center gap-2 py-2",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-rose-500 to-transparent"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-rose-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-rose-400 font-mono font-semibold",children:n})]}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-rose-500 via-transparent to-transparent"})]}),e.jsxs("div",{onClick:()=>{l.type==="lead"&&(O(l),F(!0))},className:`bg-slate-800/70 p-3 rounded-lg border border-slate-600 flex justify-between items-start ${l.type==="lead"?"cursor-pointer hover:bg-slate-800/90":""}`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.type==="lead"?e.jsx(ne,{size:16,className:"text-emerald-400"}):l.type==="call"?e.jsx(ne,{size:16,className:"text-blue-400"}):e.jsx(at,{size:16,className:"text-purple-400"}),e.jsx("span",{className:"text-sm font-mono text-slate-400",children:l.time}),e.jsx("span",{className:"font-semibold text-slate-100",children:l.title}),l.type==="lead"&&e.jsx("span",{className:"text-xs bg-emerald-500/20 text-emerald-300 px-2 py-0.5 rounded-full",children:"LEAD"})]}),l.note&&e.jsx("p",{className:"text-sm text-slate-300 mt-1",children:l.note}),l.type==="lead"&&l.leadData&&e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Click per dettagli â†’"})]}),l.type!=="lead"&&(U||we)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>de(l),className:"text-cyan-400 hover:text-cyan-300",title:"Modifica",children:e.jsx(be,{size:16})}),e.jsx("button",{onClick:()=>Ae(l.id),className:"text-red-400 hover:text-red-300",title:"Elimina",children:e.jsx(st,{size:16})})]})]}),!i&&o===t.length-1&&e.jsxs("div",{className:"flex items-center gap-2 py-2",children:[e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-transparent via-rose-500 to-transparent"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-2 h-2 bg-rose-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-rose-400 font-mono font-semibold",children:n})]}),e.jsx("div",{className:"flex-1 h-px bg-gradient-to-r from-rose-500 via-transparent to-transparent"})]})]},l.id)})})()})]}),e.jsxs("div",{className:"border-t border-slate-700 pt-6",children:[e.jsx("h4",{className:"text-lg font-semibold text-slate-200 mb-4",children:H?"Modifica evento":"Nuovo evento"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",value:d.title,onChange:t=>v({...d,title:t.target.value}),placeholder:"Titolo evento",className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500"}),e.jsx("input",{type:"time",value:d.time,onChange:t=>v({...d,time:t.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500"}),e.jsx("input",{type:"time",value:d.endTime||"",onChange:t=>v({...d,endTime:t.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500",placeholder:"Ora fine"}),e.jsxs("select",{value:d.type,onChange:t=>v({...d,type:t.target.value}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500",children:[e.jsx("option",{value:"call",children:"Chiamata"}),e.jsx("option",{value:"meeting",children:"Riunione"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Durata"}),e.jsxs("select",{value:d.durationMinutes,onChange:t=>v({...d,durationMinutes:parseInt(t.target.value,10)}),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500",children:[e.jsx("option",{value:15,children:"15 minuti"}),e.jsx("option",{value:30,children:"30 minuti"}),e.jsx("option",{value:45,children:"45 minuti"}),e.jsx("option",{value:60,children:"60 minuti"}),e.jsx("option",{value:90,children:"90 minuti"}),e.jsx("option",{value:120,children:"120 minuti"})]})]})}),e.jsx("textarea",{value:d.note,onChange:t=>v({...d,note:t.target.value}),placeholder:"Note (opzionale)",rows:"3",className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-100 focus:outline-none focus:border-rose-500"}),e.jsx("button",{onClick:H?ze:Pe,className:"w-full bg-rose-600 hover:bg-rose-700 text-white py-3 rounded-lg font-semibold flex items-center justify-center gap-2",children:H?e.jsxs(e.Fragment,{children:[e.jsx(nt,{size:20})," Salva Modifiche"]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{size:20})," Aggiungi Evento"]})})]})]})]})})}),e.jsx(he,{children:Me&&x&&e.jsx(k.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",onClick:()=>F(!1),children:e.jsxs(k.div,{initial:{scale:.9,y:20},animate:{scale:1,y:0},exit:{scale:.9,y:20},onClick:t=>t.stopPropagation(),className:"bg-gradient-to-br from-slate-900 to-slate-800 rounded-2xl border border-emerald-500/30 shadow-2xl shadow-emerald-500/10 p-6 w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-emerald-500/20 rounded-xl",children:e.jsx(ne,{className:"w-6 h-6 text-emerald-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-100",children:"Dettagli Lead"}),e.jsx("p",{className:"text-sm text-emerald-400",children:"Chiamata Programmata"})]})]}),e.jsx("button",{onClick:()=>F(!1),className:"text-slate-400 hover:text-rose-400 transition-colors",children:e.jsx(pe,{size:24})})]}),x.leadData&&!ie&&e.jsxs("div",{className:"space-y-4",children:[!U&&x.createdBy!==(((xe=w.currentUser)==null?void 0:xe.uid)||"")&&e.jsx("div",{className:"text-xs text-amber-300 bg-amber-900/30 border border-amber-700/40 px-3 py-2 rounded-lg",children:"Solo lettura: non puoi modificare questo lead."}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Nome"}),e.jsx("p",{className:"text-lg font-semibold text-slate-100 mt-1",children:x.leadData.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Data"}),e.jsx("p",{className:"text-sm font-medium text-slate-100 mt-1",children:new Date(x.date).toLocaleDateString("it-IT")})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Ora"}),e.jsx("p",{className:"text-sm font-medium text-slate-100 mt-1",children:x.time})]})]}),e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Telefono"}),e.jsx("p",{className:"text-lg font-mono text-emerald-400 mt-1",children:x.leadData.number})]}),x.leadData.email&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Email"}),e.jsx("p",{className:"text-sm text-slate-100 mt-1",children:x.leadData.email})]}),x.leadData.source&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Provenienza"}),e.jsx("p",{className:"text-sm text-slate-100 mt-1",children:x.leadData.source})]}),x.leadData.note&&e.jsxs("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700",children:[e.jsx("label",{className:"text-xs text-slate-400 uppercase tracking-wide",children:"Note"}),e.jsx("p",{className:"text-sm text-slate-300 mt-1 whitespace-pre-wrap",children:x.leadData.note})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[(U||x.createdBy===(((ge=w.currentUser)==null?void 0:ge.uid)||""))&&e.jsxs(k.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{Z(!0),b({name:x.leadData.name||"",number:x.leadData.number||"",email:x.leadData.email||"",source:x.leadData.source||"",note:x.leadData.note||"",date:x.date||"",time:x.time||""})},className:"w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-semibold py-3 rounded-xl shadow-lg shadow-emerald-500/25 flex items-center justify-center gap-2 transition-all",children:[e.jsx(be,{className:"w-5 h-5"}),"Modifica qui"]}),e.jsx(k.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{F(!1),f(U?"/collaboratori":"/collaboratore/dashboard")},className:"w-full bg-slate-800/60 hover:bg-slate-800 text-white border border-slate-700 font-semibold py-3 rounded-xl flex items-center justify-center gap-2 transition-all",children:"Apri in dashboard"})]})]}),x.leadData&&ie&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Nome",value:s.name,onChange:t=>b({...s,name:t.target.value})}),e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Telefono",value:s.number,onChange:t=>b({...s,number:t.target.value})}),e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Email",value:s.email,onChange:t=>b({...s,email:t.target.value})}),e.jsx("input",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Provenienza",value:s.source,onChange:t=>b({...s,source:t.target.value})}),e.jsx("textarea",{className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",placeholder:"Note",rows:"3",value:s.note,onChange:t=>b({...s,note:t.target.value})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"date",className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:s.date,onChange:t=>b({...s,date:t.target.value})}),e.jsx("input",{type:"time",className:"p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:s.time,onChange:t=>b({...s,time:t.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Dialed"}),e.jsx("input",{type:"number",min:"0",className:"w-full p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:s.dialed??0,onChange:t=>b({...s,dialed:parseInt(t.target.value||"0",10)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Importo (cash)"}),e.jsx("input",{type:"number",min:"0",className:"w-full p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:s.amount??"",onChange:t=>b({...s,amount:t.target.value===""?"":parseFloat(t.target.value)})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-slate-400 mb-1",children:"Mesi"}),e.jsx("input",{type:"number",min:"0",className:"w-full p-3 bg-slate-800/60 border border-slate-700 rounded-lg text-slate-100",value:s.mesi??"",onChange:t=>b({...s,mesi:t.target.value===""?"":parseInt(t.target.value,10)})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 items-center",children:[e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!s.offer,onChange:t=>b({...s,offer:t.target.checked})})," Warm"]}),e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!s.showUp,onChange:t=>b({...s,showUp:t.target.checked})})," Show Up"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!s.chiuso,onChange:t=>b({...s,chiuso:t.target.checked})})," Chiuso"]}),e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!s.riprenotato,onChange:t=>b({...s,riprenotato:t.target.checked})})," Riprenotato"]}),e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!s.settingCall,onChange:t=>b({...s,settingCall:t.target.checked})})," Setting Call"]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-2 text-slate-200",children:[e.jsx("input",{type:"checkbox",checked:!!s.target,onChange:t=>b({...s,target:t.target.checked})})," Target"]})})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(k.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:async()=>{try{if(!x.leadId){alert("Lead non collegato (leadId mancante).");return}await le(P(y,"leads",x.leadId),{name:s.name,number:s.number,email:s.email,source:s.source,note:s.note,dataPrenotazione:s.date,oraPrenotazione:s.time,dialed:s.dialed??0,amount:s.amount===""?null:s.amount,mesi:s.mesi===""?null:s.mesi,chiuso:!!s.chiuso,showUp:!!s.showUp,offer:!!s.offer,riprenotato:!!s.riprenotato,target:!!s.target,settingCall:!!s.settingCall}),await le(P(y,"calendarEvents",x.id),{title:`ðŸ“ž ${s.name}`,date:s.date,time:s.time,leadData:{name:s.name,number:s.number,email:s.email,source:s.source,note:s.note}}),Z(!1)}catch(t){console.error("Errore aggiornamento lead/evento:",t),alert("Errore nel salvataggio.")}},className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 rounded-xl",children:"Salva"}),e.jsx("button",{onClick:()=>Z(!1),className:"flex-1 bg-slate-700/70 hover:bg-slate-700 text-white font-semibold py-3 rounded-xl",children:"Annulla"})]})]})]})})})]})}export{vt as default};
