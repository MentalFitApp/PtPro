import{r as l,j as e}from"./react-CrXOBDSJ.js";import{d as p,a as B}from"./index-CqnSUkzk.js";import{P as S,I as b,J as L,U as V,K as _,V as Q,a1 as W,O as X}from"./@firebase-CuwLCerw.js";import{B as Y,K as E,j as Z,$ as ee,U as te}from"./lucide-react-CCY59hBS.js";import{m as se}from"./framer-motion-BAPjnw1b.js";import"./core-js-ChGsxLo2.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./react-router-BxpCmtJ-.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-Bp3EI6Ad.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const T={scadenza:{title:"â° Scadenza Imminente",body:"Ciao {name}, il tuo abbonamento scade tra pochi giorni. Contattaci per rinnovare!",icon:"â°"},benvenuto:{title:"ðŸ‘‹ Benvenuto!",body:"Ciao {name}, benvenuto in MentalFit! Inizia compilando la tua anamnesi.",icon:"ðŸ‘‹"},check:{title:"ðŸ“Š Tempo di Check",body:"Ciao {name}, Ã¨ ora di fare il check settimanale! Non dimenticare di inviare foto e misure.",icon:"ðŸ“Š"},motivazione:{title:"ðŸ’ª Continua CosÃ¬!",body:"Ciao {name}, stai facendo un ottimo lavoro! Continua cosÃ¬!",icon:"ðŸ’ª"},reportMancante:{title:"âš ï¸ Report Mancante",body:"Ciao {name}, ricordati di inviare il report giornaliero. Ãˆ importante per monitorare i progressi!",icon:"âš ï¸"},appuntamento:{title:"ðŸ“… Promemoria Appuntamento",body:"Ciao {name}, ti ricordo l'appuntamento di domani. Ci vediamo!",icon:"ðŸ“…"}};function Se(){const[o,h]=l.useState("manual"),[n,D]=l.useState([]),[c,P]=l.useState([]),[i,d]=l.useState([]),[r,f]=l.useState("clients"),[g,j]=l.useState(""),[N,v]=l.useState(""),[z,$]=l.useState(""),[y,R]=l.useState(""),[w,M]=l.useState(""),[m,I]=l.useState(!1),[C,x]=l.useState({type:"",text:""}),[ae,U]=l.useState([]);l.useEffect(()=>{O(),A()},[]);const O=async()=>{try{const t=await S(b(p,"clients")),s=await S(b(p,"collaboratori"));D(t.docs.map(a=>({id:a.id,...a.data(),type:"client"}))),P(s.docs.map(a=>({id:a.id,...a.data(),type:"collaboratore"})))}catch(t){console.error("Errore caricamento utenti:",t)}},A=async()=>{try{const t=L(b(p,"notifications"),V("sentBy","==",B.currentUser.uid),_("sentAt","desc")),s=await S(t);U(s.docs.map(a=>({id:a.id,...a.data()})))}catch(t){console.error("Errore caricamento notifiche inviate:",t)}},F=t=>{const s=T[t];$(t),j(s.title),v(s.body)},q=t=>{d(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},G=()=>{const t=r==="clients"?n.map(s=>s.id):r==="collaboratori"?c.map(s=>s.id):[...n.map(s=>s.id),...c.map(s=>s.id)];d(t)},u=()=>d([]),H=async()=>{if(!g||!N){x({type:"error",text:"Inserisci titolo e messaggio"});return}if(i.length===0){x({type:"error",text:"Seleziona almeno un destinatario"});return}I(!0);try{const t=[...n,...c],s=i.map(a=>t.find(k=>k.id===a));for(const a of s){const k=g.replace("{name}",a.name||"utente"),K=N.replace("{name}",a.name||"utente");await Q(b(p,"notifications"),{userId:a.id,userType:a.type,title:k,body:K,read:!1,sentAt:o==="scheduled"&&y&&w?W.fromDate(new Date(`${y}T${w}`)):X(),sentBy:B.currentUser.uid,preset:z||null,scheduled:o==="scheduled"})}x({type:"success",text:`Notifica inviata a ${s.length} utenti!`}),j(""),v(""),d([]),$(""),A()}catch(t){console.error("Errore invio notifiche:",t),x({type:"error",text:"Errore durante l'invio"})}finally{I(!1)}},J=r==="clients"?n:r==="collaboratori"?c:[...n,...c];return e.jsxs("div",{className:"w-full max-w-7xl mx-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("h1",{className:"text-3xl font-bold text-slate-50 flex items-center gap-3",children:[e.jsx(Y,{className:"text-rose-400",size:32}),"Gestione Notifiche"]})}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsxs("button",{onClick:()=>h("manual"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="manual"?"bg-rose-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"}`,children:[e.jsx(E,{size:18,className:"inline mr-2"}),"Invio Manuale"]}),e.jsxs("button",{onClick:()=>h("scheduled"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="scheduled"?"bg-rose-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"}`,children:[e.jsx(Z,{size:18,className:"inline mr-2"}),"Programmate"]}),e.jsxs("button",{onClick:()=>h("auto"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${o==="auto"?"bg-rose-600 text-white":"bg-slate-800 text-slate-300 hover:bg-slate-700"}`,children:[e.jsx(ee,{size:18,className:"inline mr-2"}),"Automatiche"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:o==="manual"||o==="scheduled"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-200",children:"ðŸ“ Preset Rapidi"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:Object.keys(T).map(t=>e.jsxs("button",{onClick:()=>F(t),className:`p-3 rounded-lg border transition-all ${z===t?"bg-rose-600/20 border-rose-500 text-rose-300":"bg-slate-700/50 border-slate-600 text-slate-300 hover:border-rose-500/50"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:T[t].icon}),e.jsx("div",{className:"text-xs font-medium",children:t})]},t))})]}),e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-200",children:"âœ‰ï¸ Messaggio"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Titolo"}),e.jsx("input",{type:"text",value:g,onChange:t=>j(t.target.value),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-rose-500 outline-none",placeholder:"Es: Benvenuto!"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Messaggio"}),e.jsx("textarea",{value:N,onChange:t=>v(t.target.value),rows:4,className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-rose-500 outline-none",placeholder:"Scrivi il messaggio... Usa {name} per personalizzare"}),e.jsxs("p",{className:"text-xs text-slate-400 mt-1",children:["ðŸ’¡ Usa ",e.jsx("code",{className:"bg-slate-700 px-1 rounded",children:"{name}"})," per inserire il nome del destinatario"]})]}),o==="scheduled"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Data"}),e.jsx("input",{type:"date",value:y,onChange:t=>R(t.target.value),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-rose-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Ora"}),e.jsx("input",{type:"time",value:w,onChange:t=>M(t.target.value),className:"w-full p-3 bg-slate-700/50 border border-slate-600 rounded-lg text-slate-200 focus:ring-2 focus:ring-rose-500 outline-none"})]})]})]})]}),e.jsxs(se.button,{onClick:H,disabled:m,whileHover:{scale:m?1:1.02},whileTap:{scale:m?1:.98},className:"w-full py-4 bg-rose-600 hover:bg-rose-700 text-white font-bold rounded-xl transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(E,{size:20}),m?"Invio in corso...":`Invia a ${i.length} destinatari`]}),C.text&&e.jsx("div",{className:`p-4 rounded-lg ${C.type==="success"?"bg-emerald-900/50 text-emerald-300":"bg-red-900/50 text-red-300"}`,children:C.text})]}):e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-slate-200",children:"ðŸ¤– Notifiche Automatiche"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg border border-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-200",children:"Scadenza Imminente (3 giorni)"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-rose-600"})]})]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Notifica automatica 3 giorni prima della scadenza abbonamento"})]}),e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg border border-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-200",children:"Report Collaboratore Mancante"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",defaultChecked:!0}),e.jsx("div",{className:"w-11 h-6 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-rose-600"})]})]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Notifica se un collaboratore non invia il report giornaliero entro le 23:00"})]}),e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg border border-slate-600",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-slate-200",children:"Check Settimanale Cliente"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-rose-600"})]})]}),e.jsx("p",{className:"text-sm text-slate-400",children:"Promemoria automatico ogni 7 giorni per il check settimanale"})]})]})]})}),e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-4 text-slate-200 flex items-center gap-2",children:[e.jsx(te,{size:20}),"Destinatari (",i.length,")"]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:()=>{f("clients"),u()},className:`flex-1 py-2 rounded-lg text-sm font-medium transition-colors ${r==="clients"?"bg-rose-600 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:"Clienti"}),e.jsx("button",{onClick:()=>{f("collaboratori"),u()},className:`flex-1 py-2 rounded-lg text-sm font-medium transition-colors ${r==="collaboratori"?"bg-rose-600 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:"Collaboratori"}),e.jsx("button",{onClick:()=>{f("all"),u()},className:`flex-1 py-2 rounded-lg text-sm font-medium transition-colors ${r==="all"?"bg-rose-600 text-white":"bg-slate-700/50 text-slate-300 hover:bg-slate-700"}`,children:"Tutti"})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{onClick:G,className:"flex-1 py-2 bg-slate-700/50 hover:bg-slate-700 text-slate-300 rounded-lg text-sm font-medium transition-colors",children:"Seleziona Tutti"}),e.jsx("button",{onClick:u,className:"flex-1 py-2 bg-slate-700/50 hover:bg-slate-700 text-slate-300 rounded-lg text-sm font-medium transition-colors",children:"Deseleziona"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-2",children:J.map(t=>e.jsxs("label",{className:`flex items-center gap-3 p-3 rounded-lg cursor-pointer transition-colors ${i.includes(t.id)?"bg-rose-600/20 border border-rose-500":"bg-slate-700/30 border border-slate-600 hover:border-slate-500"}`,children:[e.jsx("input",{type:"checkbox",checked:i.includes(t.id),onChange:()=>q(t.id),className:"w-4 h-4 text-rose-600 bg-slate-700 border-slate-600 rounded focus:ring-rose-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-slate-200 text-sm",children:t.name}),e.jsx("div",{className:"text-xs text-slate-400",children:t.email})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-slate-700 text-slate-300",children:t.type==="client"?"ðŸ‘¤":"ðŸ”§"})]},t.id))})]})})]})]})}export{Se as default};
