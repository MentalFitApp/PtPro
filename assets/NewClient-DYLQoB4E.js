import{r as u,j as e}from"./react-FJB7Hj_2.js";import{u as O}from"./react-hook-form-CR94GzZN.js";import{f as U,d as N}from"./index-C1w-7Ivh.js";import{g as B,c as R}from"./firebase-CiybzbB3.js";import{v as G,N as H,y as S,K as P,D as K,O as Q}from"./@firebase-D5dUFubL.js";import{a as V}from"./react-router-DF4cN2Hx.js";import{m,A as T}from"./framer-motion-Bo7GrDk8.js";import{A as W,D as X,r as J,s as Y,t as Z,o as _,X as ee}from"./lucide-react-BYK_Rxhn.js";import"./papaparse-BHXrM2Hc.js";import"./react-dom-BrtcLnxQ.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-udQfSOCw.js";import"./@remix-run-CjG9tKj3.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const se=({message:l,type:t,onDismiss:n})=>e.jsx(T,{children:l&&e.jsxs(m.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${t==="error"?"bg-red-900/80 text-red-300 border-red-500/30":""} backdrop-blur-md shadow-lg`,children:[e.jsx(_,{className:"text-red-400"}),e.jsx("p",{children:l}),e.jsx("button",{onClick:n,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(ee,{size:16})})]})}),te=()=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let n="";for(let p=0,x=t.length;p<8;++p)n+=t.charAt(Math.floor(Math.random()*x));return n};function ye(){const l=V(),{register:t,handleSubmit:n,reset:p,formState:{isSubmitting:x}}=O(),[k,w]=u.useState(!1),[c,D]=u.useState(null),[M,v]=u.useState(!1),[C,h]=u.useState({message:"",type:""}),g=(s,o="error")=>{h({message:s,type:o}),setTimeout(()=>h({message:"",type:""}),6e3)},E=async s=>{const o=te(),z=G(U,`user-creation-${Date.now()}`),L=B(z);try{const A=(await R(L,s.email,o)).user.uid,f=H(N),I=S(N,"clients",A),y=parseInt(s.duration,10),d=new Date;if(d.setMonth(d.getMonth()+y),d.setDate(d.getDate()+7),f.set(I,{name:s.name,name_lowercase:s.name.toLowerCase(),email:s.email,phone:s.phone||null,status:"attivo",planType:s.planType,createdAt:P(),scadenza:d,isClient:!0,firstLogin:!0,tempPassword:o}),s.paymentAmount){const q=S(K(N,"clients",A,"payments"));f.set(q,{amount:parseFloat(s.paymentAmount),duration:`${y} mes${y>1?"i":"e"}`,paymentMethod:s.paymentMethod||null,paymentDate:P()})}await f.commit(),D({name:s.name,email:s.email,password:o}),w(!0)}catch(r){console.error("Errore nella creazione del cliente:",r.code,r.message),r.code==="permission-denied"||r.message.includes("permission-denied")?g("Permessi insufficienti. Assicurati che il tuo UID admin sia nelle regole di sicurezza di Firestore."):r.code==="auth/email-already-in-use"?g("Questa email è già in uso da un altro utente."):g("Si è verificato un errore imprevisto.")}finally{await Q(z)}},F=()=>{const o=`Ciao ${c.name},

Benvenuto in PT Manager, la tua area personale per monitorare i progressi e comunicare con il tuo coach!

Ecco le credenziali per il tuo primo accesso:

Link: https://MentalFitApp.github.io/PtPro/#/client-login
Email: ${c.email}
Password Temporanea: ${c.password}

Al primo accesso ti verrà chiesto di impostare una password personale.
A presto!`;navigator.clipboard.writeText(o),v(!0),setTimeout(()=>v(!1),2500)},$=()=>{w(!1),p(),l("/clients")},i="w-full p-2.5 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-rose-500 text-slate-200 placeholder:text-slate-500",a="block mb-1 text-sm font-medium text-slate-300",j="bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6",b="font-bold mb-4 text-lg text-rose-300 border-b border-rose-400/20 pb-2 flex items-center gap-2";return e.jsxs(e.Fragment,{children:[e.jsx(se,{message:C.message,type:C.type,onDismiss:()=>h({message:"",type:""})}),e.jsxs(m.div,{className:"w-full max-w-2xl mx-auto",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-50",children:"Onboarding Nuovo Cliente"}),e.jsxs("button",{onClick:()=>l("/clients"),className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm rounded-lg transition-colors",children:[e.jsx(W,{size:16})," Torna Indietro"]})]}),e.jsxs("form",{onSubmit:n(E),className:"space-y-6",children:[e.jsxs("div",{className:j,children:[e.jsx("h4",{className:b,children:"1. Anagrafica"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:a,children:"Nome e Cognome*"}),e.jsx("input",{...t("name",{required:!0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:a,children:"Email (sarà il suo username)*"}),e.jsx("input",{type:"email",...t("email",{required:!0}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:a,children:"Telefono (Opzionale)"}),e.jsx("input",{...t("phone"),className:i})]})]})]}),e.jsxs("div",{className:j,children:[e.jsx("h4",{className:b,children:"2. Dettagli Percorso"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:a,children:"Tipo di Percorso*"}),e.jsxs("select",{...t("planType",{required:!0}),className:i,children:[e.jsx("option",{value:"allenamento",children:"Solo Allenamento"}),e.jsx("option",{value:"alimentazione",children:"Solo Alimentazione"}),e.jsx("option",{value:"completo",children:"Completo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:a,children:"Durata del Percorso*"}),e.jsxs("select",{...t("duration",{required:!0}),className:i,children:[e.jsx("option",{value:"",children:"Seleziona durata"}),[...Array(24).keys()].map(s=>e.jsxs("option",{value:s+1,children:[s+1," mes",s>0?"i":"e"]},s+1))]})]})]})]}),e.jsxs("div",{className:j,children:[e.jsxs("h4",{className:b,children:[e.jsx(X,{size:20})," 3. Primo Pagamento (Opzionale)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:a,children:"Importo Pagato (€)"}),e.jsx("input",{type:"number",step:"0.01",...t("paymentAmount"),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:a,children:"Metodo di Pagamento"}),e.jsx("input",{...t("paymentMethod"),className:i,placeholder:"Es. Bonifico"})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:x,className:"flex items-center gap-2 px-5 py-2.5 bg-rose-600 hover:bg-rose-700 text-white rounded-lg transition disabled:opacity-50 font-semibold disabled:cursor-not-allowed",children:[e.jsx(J,{size:16})," ",x?"Creazione in corso...":"Crea Cliente e Genera Password"]})})]})]}),e.jsx(T,{children:k&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:e.jsxs(m.div,{className:"bg-zinc-950/80 rounded-2xl gradient-border p-6 text-center w-full max-w-md shadow-2xl shadow-black/40",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("h2",{className:"text-xl font-bold text-slate-50",children:"Cliente Creato!"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Copia e invia le credenziali al cliente."}),e.jsxs("div",{className:"my-6 space-y-3 text-left",children:[e.jsxs("div",{className:"bg-zinc-900 p-3 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Email (Username)"}),e.jsx("p",{className:"font-mono text-slate-200",children:c.email})]}),e.jsxs("div",{className:"bg-zinc-900 p-3 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Password Temporanea"}),e.jsx("p",{className:"font-mono text-slate-200",children:c.password})]})]}),e.jsx(m.button,{onClick:F,className:"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg flex items-center justify-center gap-2 transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:M?e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:18})," Copiato!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:16})," Copia Credenziali"]})}),e.jsx("button",{onClick:$,className:"w-full mt-3 py-2 text-slate-400 hover:text-white text-sm text-center transition-colors",children:"Chiudi"})]})})})]})}export{ye as default};
