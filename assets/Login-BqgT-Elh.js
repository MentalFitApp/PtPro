import{r as d,h as q,e as i,f as l,G as R,j as e,q as u,I as M,L as X,J as V,K as G,P as H,Q as J}from"./.pnpm-C04Ba0Xq.js";import{a as f,d as r}from"./index-DdCoIfwr.js";const T=()=>{const[h,L]=d.useState(""),[S,P]=d.useState(""),[I,t]=d.useState(""),[A,k]=d.useState(!0),[C,_]=d.useState(!1),a=q();d.useEffect(()=>{const o=f.onAuthStateChanged(async s=>{var p,b;if(s)try{const g=i(r,"roles","admins"),D=i(r,"roles","coaches"),v=i(r,"clients",s.uid),w=i(r,"collaboratori",s.uid),[n,m,x,c]=await Promise.all([l(g).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),l(D).catch(()=>({exists:()=>!1,data:()=>({uids:[]})})),l(v).catch(()=>({exists:()=>!1,data:()=>({})})),l(w).catch(()=>({exists:()=>!1,data:()=>({})}))]),j=n.exists()&&n.data().uids.includes(s.uid),y=m.exists()&&m.data().uids.includes(s.uid),z=x.exists()&&x.data().isClient===!0,E=c.exists();if(console.log("ðŸ” Login check:",{uid:s.uid,isAdmin:j,isCoach:y,isClient:z,isCollaboratore:E,collabData:c.exists()?c.data():"N/A"}),j)sessionStorage.setItem("app_role","admin"),a("/");else if(y)sessionStorage.setItem("app_role","coach"),a("/coach");else if(E){sessionStorage.setItem("app_role","collaboratore");const N=((p=c.data())==null?void 0:p.firstLogin)===!0;console.log("ðŸ‘¤ Collaboratore login, firstLogin:",N),a(N?"/collaboratore/first-access":"/collaboratore/dashboard")}else if(z){sessionStorage.setItem("app_role","client");const N=((b=x.data())==null?void 0:b.firstLogin)===!0;a(N?"/client/first-access":"/client/dashboard")}else console.error("âŒ Nessun ruolo trovato per:",s.uid),t("Accesso non autorizzato. Contatta l'amministratore."),await R(f)}catch{t("Errore verifica ruolo. Riprova.")}k(!1)});return()=>o()},[a]);const F=async o=>{o.preventDefault(),t("");try{const s=await H(f,h,S),p=i(r,"roles","admins"),b=i(r,"roles","coaches"),g=i(r,"clients",s.user.uid),D=i(r,"collaboratori",s.user.uid),[v,w,n,m]=await Promise.all([l(p),l(b),l(g),l(D)]),x=v.exists()&&v.data().uids.includes(s.user.uid),c=w.exists()&&w.data().uids.includes(s.user.uid),j=n.exists()&&n.data().isClient===!0,y=m.exists();x?(sessionStorage.setItem("app_role","admin"),a("/")):c?(sessionStorage.setItem("app_role","coach"),a("/coach")):y?(sessionStorage.setItem("app_role","collaboratore"),a(m.data().firstLogin?"/collaboratore/first-access":"/collaboratore/dashboard")):j?(sessionStorage.setItem("app_role","client"),a(n.data().firstLogin?"/client/first-access":"/client/dashboard")):(t("Accesso non autorizzato. Contatta l'amministratore."),await R(f))}catch(s){s.code==="auth/wrong-password"?t("Password errata. Riprova o reimposta la password."):s.code==="auth/user-not-found"?t("Utente non trovato. Verifica l'email."):s.code==="auth/invalid-credential"?t("Credenziali non valide. Verifica email e password."):t("Errore login: "+s.message)}},O=async()=>{if(!h){t("Inserisci un'email per reimpostare la password.");return}try{await J(f,h),t("Email di reimpostazione inviata. Controlla la posta.")}catch(o){t("Errore invio email: "+o.message)}};return A?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-900",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-[#ef4444]"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-gradient-to-b from-[#1b2735] to-[#090a0f] -z-10"}),e.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:e.jsxs(u.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"relative w-full max-w-md z-10",children:[e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-1"}),e.jsx("div",{className:"absolute -inset-1 rounded-3xl blur-xl opacity-50 animate-glow-line-2"}),e.jsxs("div",{className:"relative bg-white/3 backdrop-blur-lg border border-white/8 rounded-3xl p-8 shadow-xl",children:[e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-1 opacity-30"}),e.jsx("div",{className:"absolute inset-0 rounded-3xl animate-glow-line-2 opacity-30"}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(u.div,{className:"flex justify-center mb-8",children:e.jsxs("h1",{className:"text-4xl font-bold text-slate-100 relative",children:[e.jsx("span",{className:"relative z-10",children:"MentalFit"}),e.jsx(u.span,{className:"absolute inset-x-0 -bottom-1 h-1 bg-[#ef4444] rounded-full",initial:{scaleX:0,opacity:0},animate:{scaleX:1,opacity:[.6,1,.6]},transition:{scaleX:{duration:.8,ease:"easeOut"},opacity:{duration:2,repeat:1/0,ease:"easeInOut"}},style:{filter:"blur(4px)"}}),e.jsx(u.span,{className:"absolute inset-x-0 -bottom-2 h-2 bg-[#ef4444] rounded-full",animate:{opacity:[.3,.7,.3]},transition:{duration:2,repeat:1/0},style:{filter:"blur(8px)"}})]})}),e.jsx("div",{className:"flex items-center justify-center mb-8",children:e.jsx("h2",{className:"text-xl font-medium text-slate-300",children:"Accedi al tuo account"})}),e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:"email",value:h,onChange:o=>L(o.target.value),className:"w-full pl-12 pr-4 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"tuo@email.com",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400",size:20}),e.jsx("input",{type:C?"text":"password",value:S,onChange:o=>P(o.target.value),className:"w-full pl-12 pr-14 py-3.5 bg-white/5 border border-white/10 rounded-xl text-slate-200 placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-[#ef4444]/50 focus:border-[#ef4444]/30 transition-all",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>_(!C),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 hover:text-[#ef4444] transition-colors",children:C?e.jsx(V,{size:20}):e.jsx(G,{size:20})})]})]}),I&&e.jsx(u.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-[#ef4444] text-sm text-center font-medium",children:I}),e.jsx(u.button,{whileHover:{scale:1.02},whileTap:{scale:.98},type:"submit",className:"w-full py-4 bg-[#ef4444] hover:bg-[#dc2626] text-white font-bold rounded-xl shadow-lg hover:shadow-[#ef4444]/50 transition-all duration-300",children:"Accedi a MentalFit"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("button",{onClick:O,className:"text-sm text-slate-400 hover:text-[#ef4444] transition-colors",children:"Password dimenticata?"})})]})]})]})})]})};export{T as default};
