import{r as d,j as e}from"./react-CrXOBDSJ.js";import{d as u}from"./index-N1e7O3cw.js";import{H as me,I as pe,J as xe,D as C,z as ue,G as M,B as he,y as v,K as P,M as S}from"./@firebase-Dy5qmm0I.js";import{f as x,s as k,e as ge,a as be,b as O,i as fe}from"./date-fns-K6w5eF5u.js";import{D as ve,T as je,a as $,b as G,C as L,a4 as R,o as U}from"./lucide-react-KKSnr5ly.js";import{m as ye}from"./framer-motion-BAPjnw1b.js";import"./core-js-ChGsxLo2.js";import"./react-dom-BpmKF3Ga.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-9rcY47vU.js";import"./react-router-BxpCmtJ-.js";import"./@remix-run-CjG9tKj3.js";import"./jspdf-7Jyqi_bl.js";import"./@babel-Cvov1XSu.js";import"./fflate-XZmX483V.js";import"./fast-png-CUrN0NP5.js";import"./iobuffer-DZ1zOcUT.js";import"./pako-B9FS3IR_.js";import"./firebase-CCo3Hvf0.js";import"./tslib-BGVaTf34.js";import"./idb-Bn1DMRyg.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const h=p=>{if(p==null)return"€0,00";const N=typeof p=="string"?parseFloat(p):p;return isNaN(N)?"€0,00":new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR",minimumFractionDigits:2}).format(N)},Ne=["Setter","Coach","Admin","Manager","Altro"],Je=()=>{const[p,N]=d.useState([]),[w,V]=d.useState([]),[q,H]=d.useState(!0),[j,J]=d.useState(0),[D,K]=d.useState(!1),[g,I]=d.useState(new Date),[s,c]=d.useState({nome:"",nominativo:"",iban:"",tipo:"percentuale",percentuale:"",fissi:[],ruolo:"Setter"}),[y,F]=d.useState(null),[l,b]=d.useState({dipId:"",importoBase:"",percentualeDaPagare:100,bonus:"",data:x(new Date,"yyyy-MM-dd"),note:""}),[A,B]=d.useState(null),[f,Q]=d.useState(x(new Date,"yyyy-MM"));d.useEffect(()=>{const t=k(new Date),a=me(xe(u,"payments"),pe("paymentDate","desc")),n=C(a,async i=>{var r;let o=0;for(const m of i.docs){const _=(r=m.data().paymentDate)==null?void 0:r.toDate();if(_&&_>=t){const ce=m.ref.parent.parent,E=await ue(ce);E.exists()&&!E.data().isOldClient&&!m.data().isPast&&(o+=m.data().amount||0)}}J(o)});return()=>n()},[]),d.useEffect(()=>{const t=C(M(u,"dipendenti_provvigioni"),n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),percentuale:o.data().percentuale||0,fissi:o.data().fissi||[],ruolo:o.data().ruolo||"Setter",nominativo:o.data().nominativo||"",archived:o.data().archived||!1}));N(i),H(!1)}),a=C(M(u,"pagamenti_dipendenti"),n=>{const i=n.docs.map(o=>({id:o.id,...o.data(),data:o.data().data.toDate()}));V(i)});return()=>{t(),a()}},[]);const W=d.useMemo(()=>{const t=new Map;return p.forEach(a=>t.set(a.id,a)),t},[p]),{provvigioniTotali:X,pagatiTotali:Y,daPagareTotali:z,utileNetto:Z}=d.useMemo(()=>{let t=0,a=0;p.filter(i=>!i.archived).forEach(i=>{if(i.tipo==="percentuale")t+=j*i.percentuale/100;else{const o=i.fissi.filter(r=>x(new Date(r.data),"yyyy-MM")===f).reduce((r,m)=>r+m.importo,0);t+=o}a+=w.filter(o=>o.dipId===i.id&&x(o.data,"yyyy-MM")===f).reduce((o,r)=>o+r.importo,0)});const n=j-a;return{provvigioniTotali:t,pagatiTotali:a,daPagareTotali:t-a,utileNetto:n}},[p,j,w,f]),ee=ge({start:k(g),end:be(g)}),te=t=>w.filter(a=>fe(a.data,t)),T=()=>{c({nome:"",nominativo:"",iban:"",tipo:"percentuale",percentuale:"",fissi:[],ruolo:"Setter"}),F(null)},se=async()=>{if(!s.nome.trim())return;const t=y?v(u,"dipendenti_provvigioni",y.id):v(M(u,"dipendenti_provvigioni")),a={nome:s.nome.trim(),nominativo:s.nominativo.trim(),iban:s.iban.trim(),tipo:s.tipo,percentuale:s.tipo==="percentuale"&&parseFloat(s.percentuale)||0,fissi:s.tipo==="fisso"?s.fissi.map(n=>({importo:parseFloat(n.importo)||0,data:n.data})).filter(n=>n.importo>0&&n.data):[],ruolo:s.ruolo,updatedAt:S()};y||(a.createdAt=S()),await P(t,a,{merge:!0}),T()},ae=async t=>{confirm(`Archiviare ${t.nome}?`)&&await P(v(u,"dipendenti_provvigioni",t.id),{archived:!0},{merge:!0})},ne=async()=>{if(!l.dipId||!l.importoBase||!l.data)return;const t=parseFloat(l.importoBase)+(parseFloat(l.bonus)||0),a=A?v(u,"pagamenti_dipendenti",A.id):v(M(u,"pagamenti_dipendenti"));await P(a,{dipId:l.dipId,importo:t,importoBase:parseFloat(l.importoBase),percentualePagata:l.percentualeDaPagare,bonus:parseFloat(l.bonus)||0,data:new Date(l.data),note:l.note.trim(),updatedAt:S()},{merge:!0}),b({...l,importoBase:"",percentualeDaPagare:100,bonus:"",note:""}),B(null)},oe=async t=>{confirm("Eliminare pagamento?")&&await he(v(u,"pagamenti_dipendenti",t))},re=t=>{B(t),b({dipId:t.dipId,importoBase:t.importoBase.toString(),percentualeDaPagare:t.percentualePagata,bonus:t.bonus.toString(),data:x(t.data,"yyyy-MM-dd"),note:t.note||""})},ie=()=>{c({...s,fissi:[...s.fissi,{importo:"",data:x(new Date,"yyyy-MM-dd")}]})},le=t=>{c({...s,fissi:s.fissi.filter((a,n)=>n!==t)})};if(q)return e.jsx("div",{className:"p-6 text-center text-slate-400",children:"Caricamento..."});const de=p.filter(t=>D?t.archived:!t.archived);return e.jsxs("div",{className:"p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-slate-100",children:"Dipendenti & Provvigioni"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"month",value:f,onChange:t=>Q(t.target.value),className:"px-4 py-2 bg-slate-800 text-slate-100 rounded-lg border border-slate-700 focus:outline-none focus:border-rose-500 text-sm"}),e.jsx("button",{onClick:()=>K(!D),className:`px-4 py-2 text-sm rounded-lg transition ${D?"bg-rose-600 text-white":"bg-slate-700 text-slate-300"}`,children:D?"Attivi":"Archiviati"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-800 p-6 rounded-xl text-white shadow-lg",children:[e.jsxs("p",{className:"text-sm opacity-90 flex items-center gap-1",children:[e.jsx(ve,{size:16})," Incasso Mese"]}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:h(j)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-600 to-purple-800 p-6 rounded-xl text-white shadow-lg",children:[e.jsxs("p",{className:"text-sm opacity-90 flex items-center gap-1",children:[e.jsx(je,{size:16})," Utile Netto"]}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:h(Z)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-600 to-emerald-800 p-6 rounded-xl text-white shadow-lg",children:[e.jsx("p",{className:"text-sm opacity-90",children:"Provvigioni"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:h(X)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-amber-600 to-amber-800 p-6 rounded-xl text-white shadow-lg",children:[e.jsx("p",{className:"text-sm opacity-90",children:"Pagati"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:h(Y)})]}),e.jsxs("div",{className:`p-6 rounded-xl text-white shadow-lg ${z>0?"bg-gradient-to-br from-rose-600 to-rose-800":"bg-gradient-to-br from-green-600 to-green-800"}`,children:[e.jsx("p",{className:"text-sm opacity-90",children:"Da Pagare"}),e.jsx("p",{className:"text-2xl font-bold mt-1",children:h(z)})]})]}),e.jsxs("div",{className:"bg-slate-800/60 backdrop-blur-sm rounded-xl p-3 sm:p-6 border border-slate-700 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3 sm:mb-4",children:[e.jsxs("button",{onClick:()=>I(O(g,-1)),className:"p-1.5 sm:p-2 hover:bg-slate-700 rounded-lg transition",children:[e.jsx($,{size:16,className:"text-slate-400 sm:hidden"}),e.jsx($,{size:20,className:"text-slate-400 hidden sm:block"})]}),e.jsxs("h3",{className:"text-sm sm:text-lg font-bold text-slate-100 flex items-center gap-1 sm:gap-2",children:[e.jsx(G,{size:16,className:"sm:hidden"}),e.jsx(G,{size:20,className:"hidden sm:block"})," ",x(g,"MMMM yyyy")]}),e.jsxs("button",{onClick:()=>I(O(g,1)),className:"p-1.5 sm:p-2 hover:bg-slate-700 rounded-lg transition",children:[e.jsx(L,{size:16,className:"text-slate-400 sm:hidden"}),e.jsx(L,{size:20,className:"text-slate-400 hidden sm:block"})]})]}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 sm:gap-3 text-center text-[10px] sm:text-sm",children:[["D","L","M","M","G","V","S"].map((t,a)=>e.jsxs("div",{className:"font-bold text-slate-400 py-1 sm:py-2",children:[e.jsx("span",{className:"sm:hidden",children:t}),e.jsx("span",{className:"hidden sm:inline",children:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"][a]})]},t)),Array.from({length:k(g).getDay()},(t,a)=>e.jsx("div",{},`empty-${a}`)),ee.map(t=>{const a=te(t);return e.jsxs("div",{className:`min-h-16 sm:min-h-28 p-1.5 sm:p-3 rounded-lg sm:rounded-xl border sm:border-2 transition-all cursor-pointer
                  ${a.length>0?"bg-emerald-900/40 border-emerald-600 hover:bg-emerald-900/60":"bg-slate-800/50 border-slate-700 hover:bg-slate-700/70"}`,children:[e.jsx("p",{className:"text-xs sm:text-sm font-bold text-slate-300 mb-0.5 sm:mb-1",children:x(t,"d")}),e.jsx("div",{className:"space-y-1 sm:space-y-1.5 max-h-12 sm:max-h-20 overflow-y-auto",children:a.map(n=>{const i=W.get(n.dipId);return e.jsxs(ye.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-rose-600/30 to-purple-600/30 p-1 sm:p-2 rounded-md sm:rounded-lg text-[9px] sm:text-xs flex justify-between items-center",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-rose-300 truncate",children:i==null?void 0:i.nome}),e.jsx("p",{className:"text-cyan-300 hidden sm:block",children:h(n.importo)})]}),e.jsxs("div",{className:"flex gap-0.5 sm:gap-1 flex-shrink-0 ml-1",children:[e.jsxs("button",{onClick:o=>{o.stopPropagation(),re(n)},className:"text-cyan-400 hover:text-cyan-300 p-0.5",children:[e.jsx(R,{size:10,className:"sm:hidden"}),e.jsx(R,{size:14,className:"hidden sm:block"})]}),e.jsxs("button",{onClick:o=>{o.stopPropagation(),oe(n.id)},className:"text-red-400 hover:text-red-300 p-0.5",children:[e.jsx(U,{size:10,className:"sm:hidden"}),e.jsx(U,{size:14,className:"hidden sm:block"})]})]})]},n.id)})}),a.length===0&&e.jsx("p",{className:"hidden sm:block text-xs text-slate-500 italic mt-2",children:"Nessun pagamento"})]},t.toISOString())})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:de.map(t=>{const a=w.filter(r=>r.dipId===t.id&&x(r.data,"yyyy-MM")===f).reduce((r,m)=>r+m.importo,0),n=t.tipo==="percentuale"?j*t.percentuale/100:0,i=t.tipo==="fisso"?t.fissi.filter(r=>x(new Date(r.data),"yyyy-MM")===f).reduce((r,m)=>r+m.importo,0):0,o=(t.tipo==="percentuale"?n:i)-a;return e.jsxs("div",{className:`bg-slate-800/60 backdrop-blur-sm rounded-xl p-5 border ${t.archived?"border-slate-600 opacity-60":"border-slate-700 hover:border-slate-600"} transition-all`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-100",children:t.nome}),t.nominativo&&e.jsx("p",{className:"text-xs text-rose-400",children:t.nominativo}),e.jsx("p",{className:"text-xs text-slate-500",children:t.ruolo})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{var r;F(t),c({nome:t.nome,nominativo:t.nominativo||"",iban:t.iban||"",tipo:t.tipo,percentuale:((r=t.percentuale)==null?void 0:r.toString())||"",fissi:t.fissi||[],ruolo:t.ruolo})},className:"text-xs text-amber-400 hover:text-amber-300",children:"Modifica"}),!t.archived&&e.jsx("button",{onClick:()=>ae(t),className:"text-xs text-red-400 hover:text-red-300",children:"Archivia"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("p",{className:"text-slate-400",children:t.tipo==="percentuale"?`${t.percentuale}% su incasso`:"Fisso mensile"}),t.iban&&e.jsxs("p",{className:"text-xs text-slate-500",children:["IBAN: ",t.iban]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t border-slate-700",children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-400",children:"Provvigione"}),e.jsx("span",{className:"font-medium text-emerald-400",children:h(t.tipo==="percentuale"?n:i)})]}),e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-slate-400",children:"Pagato"}),e.jsx("span",{className:"font-medium text-amber-400",children:h(a)})]}),e.jsxs("div",{className:"flex justify-between text-sm font-bold",children:[e.jsx("span",{className:"text-slate-300",children:"Da pagare"}),e.jsx("span",{className:o>0?"text-rose-400":"text-green-400",children:h(o)})]})]}),!t.archived&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs text-slate-400",children:["Paga il ",l.percentualeDaPagare||100,"%"]}),e.jsx("input",{type:"range",min:"0",max:"100",step:"25",value:l.percentualeDaPagare||100,onChange:r=>{const m=parseInt(r.target.value);b({...l,dipId:t.id,importoBase:(t.tipo==="percentuale"?n:i)*m/100,percentualeDaPagare:m})},className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer slider"}),e.jsxs("div",{className:"flex justify-between text-xs text-slate-500 mt-1",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"75%"}),e.jsx("span",{children:"100%"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"Importo",value:l.importoBase||"",readOnly:!0,className:"flex-1 px-3 py-1.5 text-xs bg-slate-700 text-slate-100 rounded border border-slate-600"}),e.jsx("input",{type:"number",placeholder:"Bonus",className:"w-20 px-2 py-1.5 text-xs bg-slate-700 text-slate-100 rounded border border-slate-600 focus:outline-none focus:border-rose-500",onChange:r=>b({...l,bonus:r.target.value})})]}),e.jsx("input",{type:"text",placeholder:"Note",value:l.note,onChange:r=>b({...l,note:r.target.value}),className:"w-full px-3 py-1.5 text-xs bg-slate-700 text-slate-100 rounded border border-slate-600 focus:outline-none focus:border-rose-500"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",value:l.data,onChange:r=>b({...l,data:r.target.value}),className:"flex-1 px-3 py-1.5 text-xs bg-slate-700 text-slate-100 rounded border border-slate-600 focus:outline-none focus:border-rose-500"}),e.jsx("button",{onClick:ne,className:"px-3 py-1.5 text-xs bg-rose-600 text-white rounded hover:bg-rose-700 transition font-medium",children:"Paga"})]})]})]},t.id)})}),(s.nome||y)&&e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 max-w-md w-full max-h-screen overflow-y-auto",children:[e.jsxs("h2",{className:"text-xl font-bold text-slate-100 mb-4",children:[y?"Modifica":"Nuovo"," Dipendente"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Nome",value:s.nome,onChange:t=>c({...s,nome:t.target.value}),className:"w-full px-4 py-2 bg-slate-700 text-slate-100 rounded-lg border border-slate-600 focus:outline-none focus:border-rose-500"}),e.jsx("input",{type:"text",placeholder:"Nominativo",value:s.nominativo,onChange:t=>c({...s,nominativo:t.target.value}),className:"w-full px-4 py-2 bg-slate-700 text-slate-100 rounded-lg border border-slate-600 focus:outline-none focus:border-rose-500"}),e.jsx("input",{type:"text",placeholder:"IBAN",value:s.iban,onChange:t=>c({...s,iban:t.target.value}),className:"w-full px-4 py-2 bg-slate-700 text-slate-100 rounded-lg border border-slate-600 focus:outline-none focus:border-rose-500"}),e.jsx("select",{value:s.ruolo,onChange:t=>c({...s,ruolo:t.target.value}),className:"w-full px-4 py-2 bg-slate-700 text-slate-100 rounded-lg border border-slate-600 focus:outline-none focus:border-rose-500",children:Ne.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"tipo",value:"percentuale",checked:s.tipo==="percentuale",onChange:t=>c({...s,tipo:t.target.value})}),e.jsx("span",{className:"text-slate-300",children:"Percentuale"}),s.tipo==="percentuale"&&e.jsx("input",{type:"number",placeholder:"%",value:s.percentuale,onChange:t=>c({...s,percentuale:t.target.value}),className:"w-20 px-2 py-1 bg-slate-700 text-slate-100 rounded border border-slate-600 focus:outline-none"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"tipo",value:"fisso",checked:s.tipo==="fisso",onChange:t=>c({...s,tipo:t.target.value})}),e.jsx("span",{className:"text-slate-300",children:"Fisso"})]})]}),s.tipo==="fisso"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"Fissi mensili"}),e.jsx("button",{onClick:ie,className:"text-xs text-rose-400 hover:text-rose-300",children:"+ Aggiungi"})]}),s.fissi.map((t,a)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",placeholder:"Importo",value:t.importo,onChange:n=>{const i=[...s.fissi];i[a].importo=n.target.value,c({...s,fissi:i})},className:"flex-1 px-3 py-1 text-sm bg-slate-700 rounded border border-slate-600 focus:outline-none"}),e.jsx("input",{type:"date",value:t.data,onChange:n=>{const i=[...s.fissi];i[a].data=n.target.value,c({...s,fissi:i})},className:"px-3 py-1 text-sm bg-slate-700 rounded border border-slate-600 focus:outline-none"}),e.jsx("button",{onClick:()=>le(a),className:"px-2 text-rose-400 hover:text-rose-300",children:"×"})]},a))]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:se,className:"flex-1 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700 transition",children:"Salva"}),e.jsx("button",{onClick:T,className:"flex-1 py-2 bg-slate-700 text-slate-300 rounded-lg hover:bg-slate-600 transition",children:"Annulla"})]})]})}),e.jsx("button",{onClick:()=>c({...s,nome:" "}),className:"fixed bottom-6 right-6 w-14 h-14 bg-rose-600 text-white rounded-full shadow-lg hover:bg-rose-700 transition flex items-center justify-center text-3xl font-bold",children:"+"}),e.jsx("style",{jsx:!0,children:`
        input[type="range"].slider::-webkit-slider-thumb {
          appearance: none;
          width: 16px;
          height: 16px;
          background: #f43f5e;
          border-radius: 50%;
          cursor: pointer;
        }
        input[type="range"].slider::-moz-range-thumb {
          width: 16px;
          height: 16px;
          background: #f43f5e;
          border-radius: 50%;
          cursor: pointer;
          border: none;
        }
      `})]})};export{Je as default};
