import{r as x,j as e}from"./react-FJB7Hj_2.js";import{u as K}from"./react-hook-form-CR94GzZN.js";import{g as X}from"./firebase-CiybzbB3.js";import{x as _,y as F,z as H,U as Q,V as Y,W as Z,K as ee,J as se}from"./@firebase-D5dUFubL.js";import{d as I}from"./index-C1w-7Ivh.js";import{a as ae}from"./react-router-DF4cN2Hx.js";import{A as ie,m as p,N as h,r as le,X as te,O as re}from"./lucide-react-BYK_Rxhn.js";import{m as D,A as ne}from"./framer-motion-Bo7GrDk8.js";import{v as oe}from"./uuid-CtRu48qb.js";import"./papaparse-BHXrM2Hc.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./react-dom-BrtcLnxQ.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-udQfSOCw.js";import"./@remix-run-CjG9tKj3.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const O=()=>e.jsx("div",{className:"absolute inset-0 -z-10 overflow-hidden bg-zinc-950",children:e.jsx("div",{className:"aurora-background"})}),ce=()=>e.jsxs("div",{className:"min-h-screen flex justify-center items-center relative",children:[e.jsx(O,{}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})]}),de=({message:s,type:b,onDismiss:N})=>e.jsx(ne,{children:s&&e.jsxs(D.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${b==="success"?"bg-emerald-900/80 text-emerald-300 border-emerald-500/30":"bg-red-900/80 text-red-300 border-red-500/30"} backdrop-blur-md shadow-lg`,children:[e.jsx("p",{children:s}),e.jsx("button",{onClick:N,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(te,{size:16})})]})}),qe=()=>{const[s,b]=x.useState(null),[N,y]=x.useState(!0),[R,g]=x.useState(!1),[P,T]=x.useState({front:null,right:null,left:null,back:null}),[k,q]=x.useState({front:null,right:null,left:null,back:null}),[E,w]=x.useState({message:"",type:""}),z=ae(),u=X().currentUser,$=_(),{register:l,handleSubmit:V,setValue:L,formState:{isSubmitting:C}}=K();x.useEffect(()=>{if(!u){z("/client-login");return}(async()=>{const a=F(I,`clients/${u.uid}/anamnesi`,"initial"),c=await H(a);if(c.exists()){const o=c.data();b(o),o.photoURLs&&q(o.photoURLs),Object.keys(o).forEach(j=>L(j,o[j])),g(!1)}else g(!0);y(!1)})()},[u,z,L]);const A=(n,a="error")=>{w({message:n,type:a}),setTimeout(()=>w({message:"",type:""}),5e3)},B=(n,a)=>{const c=n.target.files[0];c&&(T(o=>({...o,[a]:c})),q(o=>({...o,[a]:URL.createObjectURL(c)})))},M=async n=>{if(u){if(!s&&Object.values(P).some(a=>a===null)){A("Per favore, carica tutte e 4 le foto iniziali.");return}y(!0);try{let a=(s==null?void 0:s.photoURLs)||{};const c=Object.entries(P).filter(([,j])=>j!==null);c.length>0&&(await Promise.all(c.map(async([f,S])=>{const G=`clients/${u.uid}/anamnesi_photos/${f}-${oe()}`,U=Q($,G);await Y(U,S);const J=await Z(U);return{type:f,url:J}}))).forEach(({type:f,url:S})=>{a[f]=S});const o={...n,photoURLs:a,submittedAt:ee()};await se(F(I,`clients/${u.uid}/anamnesi`,"initial"),o,{merge:!0}),b(o),g(!1),A("Anamnesi salvata con successo!","success")}catch(a){console.error("Errore nel salvataggio:",a),A("Si è verificato un errore durante il salvataggio.")}finally{y(!1)}}};if(N)return e.jsx(ce,{});const t="w-full p-2.5 mt-1 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200 placeholder:text-slate-500",i="block text-sm font-medium text-slate-300",d="bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6 shadow-lg",m="font-bold mb-4 text-lg text-cyan-300 border-b border-cyan-400/20 pb-2 flex items-center gap-2",v=({type:n,label:a})=>e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:i,children:a}),e.jsxs("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-zinc-900/50 rounded-lg border-2 border-dashed border-zinc-700 hover:border-cyan-500 transition-colors relative group",children:[k[n]?e.jsx("img",{src:k[n],alt:"preview",className:"h-full w-full object-contain rounded-lg p-1"}):e.jsxs("div",{className:"flex flex-col items-center text-slate-400 transition-colors group-hover:text-cyan-400",children:[e.jsx(re,{size:32}),e.jsx("p",{className:"mt-2 text-sm",children:"Carica foto"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:c=>B(c,n),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})]}),r=({label:n,value:a})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400",children:n}),e.jsx("p",{className:"mt-1 p-3 bg-zinc-900 rounded-lg min-h-[44px] text-slate-200 break-words whitespace-pre-wrap shadow-inner",children:a||"Non specificato"})]}),W=({urls:n})=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:["front","right","left","back"].map(a=>e.jsxs("div",{className:"text-center",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 capitalize",children:a==="front"?"Frontale":a==="back"?"Posteriore":`Laterale ${a==="left"?"Sinistro":"Destro"}`}),n!=null&&n[a]?e.jsx(D.img,{src:n[a],alt:a,className:"mt-2 rounded-lg w-full h-48 object-cover hover:scale-105 transition-transform",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3}}):e.jsx("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-zinc-900 rounded-lg text-slate-500",children:e.jsx("span",{children:"Non caricata"})})]},a))});return e.jsxs("div",{className:"min-h-screen text-slate-200 p-4 sm:p-6 lg:p-8 relative",children:[e.jsx(O,{}),e.jsx(de,{message:E.message,type:E.type,onDismiss:()=>w({message:"",type:""})}),e.jsxs("header",{className:"flex justify-between items-center mb-8 flex-col sm:flex-row gap-4",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-50",children:"Anamnesi Cliente"}),e.jsxs("button",{onClick:()=>z("/client/dashboard"),className:"flex items-center gap-2 px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm font-semibold rounded-lg transition-colors",children:[e.jsx(ie,{size:16}),e.jsx("span",{children:"Torna alla mia dashboard"})]})]}),e.jsx(D.div,{initial:{opacity:0},animate:{opacity:1},children:R?e.jsxs("form",{onSubmit:V(M),className:"space-y-8",children:[e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(p,{size:16})," Dati Anagrafici e Misure"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Nome*"}),e.jsx("input",{...l("firstName",{required:!0}),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Cognome*"}),e.jsx("input",{...l("lastName",{required:!0}),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Data di Nascita*"}),e.jsx("input",{type:"date",...l("birthDate",{required:!0}),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Che lavoro fai?*"}),e.jsx("input",{...l("job",{required:!0}),className:t,placeholder:"Es. Impiegato, studente..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Peso (kg)*"}),e.jsx("input",{type:"number",step:"0.1",...l("weight",{required:!0}),className:t,placeholder:"Es. 75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Altezza (cm)*"}),e.jsx("input",{type:"number",...l("height",{required:!0}),className:t,placeholder:"Es. 180"})]})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(h,{size:16})," Abitudini Alimentari"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Pasti al giorno*"}),e.jsxs("select",{...l("mealsPerDay",{required:!0}),className:t,children:[e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Colazione: Dolce o Salata?*"}),e.jsxs("select",{...l("breakfastType",{required:!0}),className:t,children:[e.jsx("option",{value:"dolce",children:"Dolce"}),e.jsx("option",{value:"salato",children:"Salato"}),e.jsx("option",{value:"entrambi",children:"Entrambi/Indifferente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Alimenti che ti piacciono*"}),e.jsx("textarea",{...l("desiredFoods",{required:!0}),rows:"3",className:t,placeholder:"Elenca qui gli alimenti che vorresti nel piano..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Cosa non mangi?*"}),e.jsx("textarea",{...l("dislikedFoods",{required:!0}),rows:"2",className:t,placeholder:"Elenca qui gli alimenti da evitare..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Allergie o Intolleranze?*"}),e.jsx("input",{...l("intolerances",{required:!0}),className:t,placeholder:"Es. Lattosio, nessuna..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Problemi di digestione o gonfiore?*"}),e.jsx("input",{...l("digestionIssues",{required:!0}),className:t,placeholder:"Sì/No, e se sì quali..."})]})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(p,{size:16})," Allenamento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Allenamenti a settimana*"}),e.jsx("input",{type:"number",...l("workoutsPerWeek",{required:!0}),className:t,placeholder:"Es. 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Dettagli Allenamento*"}),e.jsx("textarea",{...l("trainingDetails",{required:!0}),rows:"3",className:t,placeholder:"Es. Bodybuilding in palestra con macchinari e pesi liberi..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Orario e Durata*"}),e.jsx("input",{...l("trainingTime",{required:!0}),className:t,placeholder:"Es. La sera dalle 18 alle 19:30"})]})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(h,{size:16})," Salute e Obiettivi"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Infortuni o problematiche*"}),e.jsx("textarea",{...l("injuries",{required:!0}),rows:"3",className:t,placeholder:"Es. Mal di schiena, ernie, dolori articolari..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Prendi farmaci?*"}),e.jsx("input",{...l("medications",{required:!0}),className:t,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Usi integratori?*"}),e.jsx("input",{...l("supplements",{required:!0}),className:t,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Obiettivo Principale*"}),e.jsx("textarea",{...l("mainGoal",{required:!0}),rows:"3",className:t,placeholder:"Descrivi in dettaglio cosa vuoi raggiungere..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Durata Percorso*"}),e.jsx("input",{...l("programDuration",{required:!0}),className:t,placeholder:"Es. 3 mesi, 6 mesi..."})]})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(h,{size:16})," Foto Iniziali"]}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Carica 4 foto per il check iniziale: frontale, laterale destro, laterale sinistro e posteriore. Visibili solo a te e al coach."}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(v,{type:"front",label:"Frontale"}),e.jsx(v,{type:"right",label:"Laterale Destro"}),e.jsx(v,{type:"left",label:"Laterale Sinistro"}),e.jsx(v,{type:"back",label:"Posteriore"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:C,className:"flex items-center gap-2 px-5 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(le,{size:16})," ",C?"Salvataggio in corso...":"Salva Anamnesi"]})})]}):s&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(p,{size:16})," Dati Anagrafici"]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Nome",value:s.firstName}),e.jsx(r,{label:"Cognome",value:s.lastName}),e.jsx(r,{label:"Data di Nascita",value:s.birthDate}),e.jsx(r,{label:"Lavoro",value:s.job}),e.jsx(r,{label:"Peso (kg)",value:s.weight}),e.jsx(r,{label:"Altezza (cm)",value:s.height})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(h,{size:16})," Abitudini Alimentari"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Pasti al giorno",value:s.mealsPerDay}),e.jsx(r,{label:"Tipo Colazione",value:s.breakfastType}),e.jsx(r,{label:"Alimenti preferiti",value:s.desiredFoods}),e.jsx(r,{label:"Alimenti da evitare",value:s.dislikedFoods}),e.jsx(r,{label:"Allergie/Intolleranze",value:s.intolerances}),e.jsx(r,{label:"Problemi di digestione",value:s.digestionIssues})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(p,{size:16})," Allenamento"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Allenamenti a settimana",value:s.workoutsPerWeek}),e.jsx(r,{label:"Dettagli Allenamento",value:s.trainingDetails}),e.jsx(r,{label:"Orario e Durata",value:s.trainingTime})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(h,{size:16})," Salute e Obiettivi"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Infortuni o problematiche",value:s.injuries}),e.jsx(r,{label:"Farmaci",value:s.medications}),e.jsx(r,{label:"Integratori",value:s.supplements}),e.jsx(r,{label:"Obiettivo Principale",value:s.mainGoal}),e.jsx(r,{label:"Durata Percorso",value:s.programDuration})]})]}),e.jsxs("div",{className:d,children:[e.jsxs("h4",{className:m,children:[e.jsx(h,{size:16})," Foto Iniziali"]}),e.jsx(W,{urls:s.photoURLs})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-zinc-800 hover:bg-zinc-700 text-slate-300 rounded-lg transition font-semibold",children:[e.jsx(p,{size:16})," Modifica Dati"]})})]})})]})};export{qe as default};
