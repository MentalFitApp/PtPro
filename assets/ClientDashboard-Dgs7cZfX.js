import{r as n,h as J,g as K,j as e,aq as Q,q as g,$ as Y,b1 as E,an as P,v as Z,b2 as ee,aM as M,aF as se,b3 as te,M as ae,e as ie,f as oe,V as ne,W as re,X as le,T as ce,G as de,b4 as me,C as xe}from"./.pnpm-C04Ba0Xq.js";import{d as $}from"./index-DdCoIfwr.js";import{N as he}from"./NotificationPanel-KnSMaSIz.js";const ue=()=>e.jsx("div",{className:"min-h-screen bg-slate-900 flex justify-center items-center",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})}),D=({title:a,value:p,subtext:x,icon:f,variants:b})=>e.jsxs(g.div,{variants:b,className:"bg-slate-800 rounded-xl sm:rounded-2xl border border-slate-700 p-4 sm:p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm sm:text-lg font-semibold text-slate-300",children:a}),e.jsx("div",{className:"text-cyan-300",children:f})]}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-slate-50 mt-2",children:p}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-400 mt-1",children:x})]}),C=({to:a,title:p,description:x,icon:f,variants:b})=>e.jsx(g.div,{variants:b,children:e.jsxs(me,{to:a,className:"group bg-slate-700 hover:bg-slate-600 border border-slate-600 rounded-lg p-3 sm:p-4 flex items-center gap-3 sm:gap-4 transition-all duration-200",children:[e.jsx("div",{className:"bg-slate-700 group-hover:bg-cyan-500 text-cyan-400 group-hover:text-white p-2 sm:p-3 rounded-lg transition-colors duration-300 flex-shrink-0",children:f}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-bold text-slate-200 text-sm sm:text-base",children:p}),e.jsx("p",{className:"text-xs sm:text-sm text-slate-400 truncate",children:x})]}),e.jsx(xe,{className:"text-slate-500 group-hover:text-white transition-colors duration-300 flex-shrink-0",size:18})]})}),je=()=>{const[a,p]=n.useState(null),[x,f]=n.useState(null),[b,v]=n.useState(!0),[q,r]=n.useState(""),[H,R]=n.useState(!1),[U,B]=n.useState(!1),[O,V]=n.useState(!1),h=J(),w=K(),s=w.currentUser;n.useEffect(()=>{if(!s){console.log("ClientDashboard: Nessun utente autenticato, reindirizzamento a /login"),h("/login");return}console.log("ClientDashboard: Caricamento dati per UID:",s.uid,s.email);const t=navigator.userAgent,o=/iPad|iPhone|iPod/.test(t)&&!window.MSStream,l=/Android/.test(t);B(o),V(l),(o||l)&&!window.matchMedia("(display-mode: standalone)").matches&&R(!0);const j=setTimeout(()=>{console.warn("ClientDashboard: Timeout caricamento, forzo setLoading(false)"),v(!1),r("Il caricamento sta impiegando troppo tempo. Riprova o contatta il supporto.")},8e3),G=async()=>{try{const c=ie($,"clients",s.uid),N=await oe(c);if(N.exists()){const u=N.data();if(u.firstLogin===!0){console.log("ClientDashboard: firstLogin ancora true, redirect a /first-access"),clearTimeout(j),h("/first-access");return}p(u),console.log("ClientDashboard: Dati cliente caricati:",u),clearTimeout(j),v(!1)}else clearTimeout(j),v(!1),r("Documento cliente non trovato."),console.log("ClientDashboard: Documento cliente non trovato per UID:",s.uid),setTimeout(()=>h("/login"),2e3)}catch(c){clearTimeout(j),v(!1),console.error("ClientDashboard: Errore nel recupero del documento cliente:",c.code,c.message,{uid:s.uid,email:s.email}),r("Errore nel caricamento dei dati cliente: "+c.message),setTimeout(()=>h("/login"),2e3)}},X=()=>{const c=ne($,`clients/${s.uid}/checks`),N=re(c,le("createdAt","desc"));let u=0;return ce(N,d=>{var A,I;u++,console.log(`ClientDashboard: Snapshot #${u}, documenti:`,d.docs.length);try{const m=d.docs.map(L=>({id:L.id,...L.data()})),_=(I=(A=m[0])==null?void 0:A.createdAt)==null?void 0:I.toDate();f(_||null),m.length===0&&r("Nessun check-in disponibile. Carica il tuo primo check.")}catch(m){console.error("ClientDashboard: Errore nel caricamento dei check-in:",m.code,m.message,{uid:s.uid,email:s.email}),r("Errore nel caricamento dei check-in: "+(m.code==="permission-denied"?"Permessi insufficienti.":m.message))}},d=>{console.error("ClientDashboard: Errore snapshot check-in:",d.code,d.message,{uid:s.uid,email:s.email}),r("Errore nel caricamento dei check-in: "+(d.code==="permission-denied"?"Permessi insufficienti.":d.message))})};G();const T=X();return()=>{clearTimeout(j),T&&T()}},[s,h]);const W=()=>{de(w).then(()=>{sessionStorage.removeItem("app_role"),console.log("ClientDashboard: Logout eseguito per UID:",s.uid),h("/login")}).catch(t=>{console.error("ClientDashboard: Errore durante il logout:",t.code,t.message),r("Errore durante il logout: "+t.message)})};if(b)return e.jsx(ue,{});if(!a)return e.jsx("div",{className:"min-h-screen bg-slate-900 flex justify-center items-center p-8",children:e.jsxs("p",{className:"text-center text-red-400 flex items-center gap-2",children:[e.jsx(Q,{size:18}),q||"Errore nel caricamento dei dati."]})});let y="N/D",k="Non impostata";if(a.scadenza&&a.scadenza.toDate){const t=a.scadenza.toDate(),o=new Date;t.setHours(23,59,59,999),o.setHours(0,0,0,0);const l=t-o;y=Math.max(0,Math.ceil(l/(1e3*60*60*24))),k=t.toLocaleDateString("it-IT")}let S="Nessun check registrato",z="Carica il tuo primo check!";if(x){const t=new Date;t.setHours(0,0,0,0);const o=new Date(x);o.setDate(o.getDate()+7);const l=Math.max(0,Math.ceil((o-t)/(1e3*60*60*24)));S=l===0?"Oggi":`${l} giorni`,z=`Prossimo check suggerito: ${o.toLocaleDateString("it-IT")}`}const F={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.3,staggerChildren:.05}}},i={hidden:{opacity:0},visible:{opacity:1,transition:{duration:.2}}};return e.jsx("div",{className:"min-h-screen overflow-x-hidden w-full",children:e.jsxs(g.div,{initial:"hidden",animate:"visible",variants:F,className:"w-full max-w-6xl mx-auto px-3 sm:px-6 pb-20 sm:pb-6 mobile-safe-bottom",style:{paddingTop:"max(3rem, env(safe-area-inset-top) + 3rem)"},children:[e.jsxs(g.header,{variants:i,className:"flex flex-col gap-4 mb-6 sm:mb-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 w-full",children:[e.jsx(he,{userType:"client"}),e.jsxs("button",{onClick:W,className:"flex items-center justify-center gap-2 px-3 py-2 bg-red-600/80 hover:bg-red-600 text-white text-sm font-semibold rounded-lg transition-colors whitespace-nowrap self-end sm:self-auto",children:[e.jsx(Y,{size:16}),e.jsx("span",{className:"hidden sm:inline",children:"Logout"})]})]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-slate-50",children:["Ciao, ",a.name,"!"]}),e.jsx("p",{className:"text-sm sm:text-base text-slate-300",children:"Benvenuto nella tua area personale."})]})]}),H&&e.jsxs(g.div,{variants:i,className:"mb-4 sm:mb-6 space-y-3",children:[O&&e.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 text-white p-4 rounded-xl flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Aggiungi alla Schermata Home"}),e.jsxs("p",{className:"text-xs opacity-90",children:["Tocca ",e.jsx("strong",{children:"⋮ Menu → Aggiungi alla schermata home"})]})]})]}),e.jsx(P,{size:18})]}),U&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4 rounded-xl flex items-center justify-between shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{size:20}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Aggiungi alla Schermata Home"}),e.jsxs("p",{className:"text-xs opacity-90",children:["Tocca ",e.jsx("strong",{children:"Condividi → Aggiungi alla schermata Home"})]})]})]}),e.jsx(P,{size:18})]})]}),e.jsxs("main",{className:"w-full",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8",children:[e.jsx(D,{title:"Scadenza Percorso",value:`${y} giorni`,subtext:`Scade il: ${k}`,icon:e.jsx(Z,{size:24}),variants:i}),e.jsx(D,{title:"Tipo Percorso",value:a.planType?a.planType.charAt(0).toUpperCase()+a.planType.slice(1):"Non specificato",subtext:"Il tuo piano attuale",icon:e.jsx(ee,{size:24}),variants:i}),e.jsx(D,{title:"Prossimo Check",value:S,subtext:z,icon:e.jsx(M,{size:24}),variants:i})]}),e.jsxs(g.div,{variants:i,className:"bg-slate-800 rounded-xl sm:rounded-2xl border border-slate-700 p-4 sm:p-6 shadow-lg",children:[e.jsx("h3",{className:"text-xl sm:text-2xl font-bold mb-4 text-white",children:"Cosa vuoi fare?"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[e.jsx(C,{to:"/client/anamnesi",title:"La mia Anamnesi",description:"Visualizza o aggiorna i tuoi dati",icon:e.jsx(se,{size:22}),variants:i}),e.jsx(C,{to:"/client/checks",title:"I miei Check",description:"Carica i tuoi progressi periodici",icon:e.jsx(M,{size:22}),variants:i}),e.jsx(C,{to:"/client/payments",title:"I miei Pagamenti",description:"Visualizza lo storico dei pagamenti",icon:e.jsx(te,{size:22}),variants:i}),e.jsx(C,{to:"/client/chat",title:"Chat con il Coach",description:"Invia un messaggio diretto",icon:e.jsx(ae,{size:22}),variants:i})]})]})]})]})})};export{je as default};
