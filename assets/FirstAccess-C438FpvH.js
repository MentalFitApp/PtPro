var b=Object.defineProperty;var y=(t,s,a)=>s in t?b(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a;var v=(t,s,a)=>y(t,typeof s!="symbol"?s+"":s,a);import{r as n,j as e,R as N}from"./react-FJB7Hj_2.js";import{g as S,u as P}from"./firebase-CiybzbB3.js";import{y as z,A as E}from"./@firebase-D5dUFubL.js";import{d as R}from"./index-C1w-7Ivh.js";import{a as C}from"./react-router-DF4cN2Hx.js";import{m,A as k}from"./framer-motion-Bo7GrDk8.js";import{K as A,c as D,G as F}from"./lucide-react-BYK_Rxhn.js";import"./papaparse-BHXrM2Hc.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./react-dom-BrtcLnxQ.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-udQfSOCw.js";import"./@remix-run-CjG9tKj3.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";class L extends N.Component{constructor(){super(...arguments);v(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(a){return{hasError:!0,error:a}}render(){return this.state.hasError?e.jsxs("div",{className:"text-center text-red-400 p-8",children:["Si è verificato un errore: ",this.state.error.message,". Riprova o contatta il supporto."]}):this.props.children}}const I=()=>e.jsx("div",{className:"absolute inset-0 -z-10 overflow-hidden bg-zinc-950",children:e.jsx("div",{className:"aurora-background"})}),ee=()=>{const[t,s]=n.useState(""),[a,w]=n.useState(""),[u,r]=n.useState(""),[l,p]=n.useState(""),[x,o]=n.useState(!1),f=C(),c=S().currentUser,j=async i=>{if(i.preventDefault(),r(""),p(""),o(!0),!c){r("Utente non autenticato. Effettua nuovamente il login."),setTimeout(()=>f("/client-login"),3e3),o(!1);return}if(t.length<6){r("La nuova password deve contenere almeno 6 caratteri."),o(!1);return}if(t!==a){r("Le password non coincidono. Riprova."),o(!1);return}try{await P(c,t);const d=z(R,"clients",c.uid);await E(d,{firstLogin:!1}),p("Password aggiornata! Sarai reindirizzato alla dashboard."),setTimeout(()=>f("/client/dashboard"),3e3)}catch(d){r("Si è verificato un errore. Riprova."),console.error("Errore aggiornamento password:",d),o(!1)}},h="w-full pl-10 pr-3 py-2.5 mt-1 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200 placeholder:text-slate-500",g="block text-sm font-medium text-slate-300";return e.jsx(L,{children:e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4 relative",children:[e.jsx(I,{}),e.jsxs(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"w-full max-w-md bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-8 space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-slate-50",children:"Imposta la tua Password"}),e.jsx("p",{className:"mt-2 text-slate-400",children:"Scegli una password personale per i futuri accessi."})]}),e.jsxs("form",{onSubmit:j,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"new-password",className:g,children:"Nuova Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{id:"new-password",type:"password",required:!0,value:t,onChange:i=>s(i.target.value),className:h})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirm-password",className:g,children:"Conferma Nuova Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{id:"confirm-password",type:"password",required:!0,value:a,onChange:i=>w(i.target.value),className:h})]})]}),e.jsxs(k,{children:[u&&e.jsx(m.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-red-400 text-sm text-center",children:u}),l&&e.jsxs(m.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-emerald-400 text-sm text-center flex items-center justify-center gap-2",children:[e.jsx(F,{size:16}),l]})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",className:"w-full px-4 py-2.5 font-bold text-white bg-cyan-600 rounded-lg hover:bg-cyan-700 disabled:opacity-50 transition-colors",disabled:x||!!l,children:l?"Reindirizzamento...":x?"Salvataggio...":"Imposta Nuova Password"})})]})]})]})})};export{ee as default};
