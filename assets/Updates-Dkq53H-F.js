import{h as M,r as n,T as j,V as F,j as t,q as m,am as O,aM as T,F as $,W as B,aN as G,X as J,Y as L,A as P,av as V}from"./.pnpm-C04Ba0Xq.js";import{d as w}from"./index-DdCoIfwr.js";function g(s){if(!s)return null;if(typeof(s==null?void 0:s.toDate)=="function")return s.toDate();const a=new Date(s);return isNaN(a)?null:a}const b=({title:s,icon:a,items:l,navigate:u,tab:x,onDismiss:p})=>t.jsxs(m.div,{variants:{hidden:{y:20,opacity:0},visible:{y:0,opacity:1}},className:"bg-slate-800/60 backdrop-blur-sm rounded-2xl border border-slate-700 p-4 flex-1 min-w-[280px]",children:[t.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2 text-slate-200",children:[a," ",s]}),t.jsx("div",{className:"space-y-2",children:t.jsx(P,{children:l.length>0?l.map(r=>{var o;return t.jsxs(m.div,{layout:!0,initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.9,transition:{duration:.2}},className:"group flex items-center justify-between p-2 rounded-md hover:bg-white/5",children:[t.jsxs("button",{className:"flex-1 text-left",onClick:()=>u(`/client/${r.clientId}?tab=${x}`),children:[t.jsx("p",{className:"font-medium text-sm text-slate-200 group-hover:text-rose-400 transition-colors",children:r.clientName}),t.jsx("p",{className:"text-xs text-slate-400",children:(o=g(r.date))==null?void 0:o.toLocaleDateString("it-IT",{day:"numeric",month:"long"})})]}),t.jsx("button",{onClick:()=>p(r.id),className:"p-1.5 rounded-full text-slate-500 opacity-0 group-hover:opacity-70 hover:!opacity-100 hover:bg-white/10 hover:text-slate-200 transition-all",title:"Archivia notifica",children:t.jsx(V,{size:14})})]},r.id)}):t.jsx("p",{className:"text-sm text-slate-500 px-2 py-4 text-center",children:"Nessun aggiornamento."})})})]});function R(){const s=M(),[a,l]=n.useState([]),[u,x]=n.useState([]),[p,r]=n.useState([]),[o,C]=n.useState(()=>{const e=sessionStorage.getItem("dismissedUpdates");return e?JSON.parse(e):[]});n.useEffect(()=>{sessionStorage.setItem("dismissedUpdates",JSON.stringify(o))},[o]),n.useEffect(()=>{const e=j(F(w,"clients"),i=>{l(i.docs.map(d=>({id:d.id,...d.data()})))});return()=>e()},[]);const h=n.useMemo(()=>a.reduce((e,i)=>({...e,[i.id]:i.name}),{}),[a]);n.useEffect(()=>{if(Object.keys(h).length===0)return;const e=(v,E)=>{const U=B(L(w,v),J("createdAt","desc"),G(30));return j(U,N=>{const q=N.docs.map(c=>{const y=c.ref.path.split("/")[1];return{id:c.id,clientId:y,clientName:h[y],date:c.data().createdAt}}).filter(c=>c.clientName);E(q.slice(0,10))},N=>{console.error(`Errore collectionGroup ${v}:`,N),console.error(`Se vedi "index", crea l'indice composito su Firebase Console`)})},i=e("checks",x),d=e("anamnesi",r);return()=>{i(),d()}},[h]);const A=n.useMemo(()=>[...a].sort((e,i)=>(g(i.createdAt)||0)-(g(e.createdAt)||0)).slice(0,10).map(e=>({id:e.id,clientId:e.id,clientName:e.name,date:e.createdAt})),[a]),f=e=>{C(i=>[...i,e])},k=A.filter(e=>!o.includes(e.id)),S=u.filter(e=>!o.includes(e.id)),D=p.filter(e=>!o.includes(e.id)),I={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.15}}};return t.jsxs("div",{className:"w-full overflow-x-hidden",children:[t.jsx(m.h1,{initial:{y:-20,opacity:0},animate:{y:0,opacity:1},className:"text-2xl sm:text-3xl font-bold mb-6 text-slate-50 mx-3 sm:mx-6",children:"Ultimi Aggiornamenti"}),t.jsxs(m.div,{className:"flex flex-col md:flex-row gap-4 sm:gap-6 mx-3 sm:mx-6",variants:I,initial:"hidden",animate:"visible",children:[t.jsx(b,{title:"Nuovi Clienti",icon:t.jsx(O,{className:"text-rose-400"}),items:k,navigate:s,tab:"anamnesi",onDismiss:f}),t.jsx(b,{title:"Nuovi Check",icon:t.jsx(T,{className:"text-emerald-400"}),items:S,navigate:s,tab:"checks",onDismiss:f}),t.jsx(b,{title:"Nuove Anamnesi",icon:t.jsx($,{className:"text-amber-400"}),items:D,navigate:s,tab:"anamnesi",onDismiss:f})]})]})}export{R as default};
