import{r as s,j as e}from"./react-FJB7Hj_2.js";import{B as Q,D as S,y as R,z as U,G as _,H as B,P as V,R as q}from"./@firebase-D5dUFubL.js";import{c as C,d as g,t as z}from"./index-C1w-7Ivh.js";import{a as G}from"./react-router-DF4cN2Hx.js";import{m as f,A as H}from"./framer-motion-Bo7GrDk8.js";import{U as J,A as K,S as M,F as O,v as W,i as X}from"./lucide-react-BYK_Rxhn.js";import"./papaparse-BHXrM2Hc.js";import"./idb-BXWtuYvb.js";import"./react-dom-BrtcLnxQ.js";import"./scheduler-DYLXRpC5.js";import"./react-router-dom-udQfSOCw.js";import"./@remix-run-CjG9tKj3.js";import"./firebase-CiybzbB3.js";import"./tslib-BGVaTf34.js";import"./motion-dom-C8PdgYBP.js";import"./motion-utils-DBsP9okC.js";const Y=()=>e.jsx("div",{className:"min-h-screen flex justify-center items-center relative",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})}),Z=({client:a,navigate:m,hasAnamnesi:b,lastCheck:l,variants:x})=>{const u=C(a.scadenza)||"na",o={attivo:"bg-emerald-900/80 text-emerald-300 border border-emerald-500/30",rinnovato:"bg-amber-900/80 text-amber-300 border border-amber-500/30",non_rinnovato:"bg-red-900/80 text-red-400 border border-red-500/30",na:"bg-zinc-700/80 text-zinc-300 border border-zinc-500/30"},p={attivo:"Attivo",rinnovato:"In Scadenza",non_rinnovato:"Scaduto",na:"N/D"};return e.jsxs(f.div,{variants:x,className:"p-3 rounded-lg bg-slate-500/5 hover:bg-slate-500/10 transition-colors",onClick:()=>m(`/coach/client/${a.id}`),children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-200",children:a.name}),e.jsx(O,{size:16,className:b?"text-green-500":"text-gray-500"})]}),e.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${o[u]||o.na}`,children:p[u]||"N/D"})]}),e.jsxs("div",{className:"text-xs text-slate-400 mt-1 flex items-center gap-4",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(W,{size:14})," Scadenza: ",a.scadenza?z(a.scadenza).toLocaleDateString("it-IT"):"N/D"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(X,{size:14})," Ultimo Check: ",l?z(l).toLocaleDateString("it-IT"):"Nessuno"]})]})]})};function fe(){const a=G(),[m,b]=s.useState([]),[l,x]=s.useState([]),[u,o]=s.useState(!0),[p,j]=s.useState(null),[w,k]=s.useState({}),[D,L]=s.useState({}),[c,A]=s.useState(""),[h,E]=s.useState("all");s.useEffect(()=>{const t=Q(S(g,"clients"),async n=>{var d;try{const r=n.docs.map(i=>({id:i.id,...i.data()})),N={},y={};for(const i of r){const F=R(g,`clients/${i.id}/anamnesi`,"initial"),I=await U(F);N[i.id]=I.exists();const $=_(S(g,`clients/${i.id}/checks`),B("createdAt","desc"),V(1)),P=await q($);y[i.id]=((d=P.docs[0])==null?void 0:d.data().createdAt)||null}k(N),L(y),b(r),x(r),o(!1)}catch(r){console.error("Errore nel fetch clients:",r),j("Errore nel caricamento dei clienti."),o(!1)}},n=>{console.error("Errore snapshot clients:",n),j("Errore nel caricamento dei clienti."),o(!1)});return()=>t()},[]),s.useEffect(()=>{let t=[...m];c&&(t=t.filter(n=>{var d,r;return((d=n.name)==null?void 0:d.toLowerCase().includes(c.toLowerCase()))||((r=n.email)==null?void 0:r.toLowerCase().includes(c.toLowerCase()))})),h!=="all"&&(t=t.filter(n=>C(n.scadenza)===h)),x(t)},[c,h,m]);const T={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},v={hidden:{y:20,opacity:0},visible:{y:0,opacity:1}};return p?e.jsx("div",{className:"min-h-screen bg-zinc-950 text-red-400 flex justify-center items-center",children:p}):u?e.jsx(Y,{}):e.jsx("div",{className:"min-h-screen text-slate-200 p-4 sm:p-8 relative",children:e.jsxs(f.div,{initial:"hidden",animate:"visible",variants:T,children:[e.jsxs(f.header,{variants:v,className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8",children:[e.jsxs("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-50 flex items-center gap-2",children:[e.jsx(J,{size:28})," Elenco Clienti"]}),e.jsxs("button",{onClick:()=>a("/coach-dashboard"),className:"flex items-center gap-2 px-3 py-2 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm font-semibold rounded-lg transition-colors",children:[e.jsx(K,{size:16}),e.jsx("span",{children:"Torna alla Dashboard"})]})]}),e.jsxs(f.div,{variants:v,className:"bg-zinc-950/60 backdrop-blur-xl p-4 sm:p-6 rounded-xl gradient-border",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(M,{className:"absolute top-1/2 left-3 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{type:"text",value:c,onChange:t=>A(t.target.value),placeholder:"Cerca per nome o email...",className:"w-full bg-zinc-900/70 p-2 pl-10 rounded-lg border border-white/10 outline-none focus:ring-2 focus:ring-rose-500 text-slate-200 text-sm sm:text-base"})]}),e.jsxs("select",{value:h,onChange:t=>E(t.target.value),className:"bg-zinc-900/70 border border-white/10 rounded-lg px-3 py-2 outline-none focus:ring-2 focus:ring-rose-500 text-slate-200",children:[e.jsx("option",{value:"all",children:"Tutti"}),e.jsx("option",{value:"attivo",children:"Attivo"}),e.jsx("option",{value:"rinnovato",children:"In Scadenza"}),e.jsx("option",{value:"non_rinnovato",children:"Scaduto"})]})]}),e.jsx("div",{className:"space-y-3 max-h-[90vh] overflow-y-auto pr-2",children:e.jsx(H,{children:l.length>0?l.map(t=>e.jsx(Z,{client:t,navigate:a,hasAnamnesi:w[t.id],lastCheck:D[t.id],variants:v},t.id)):e.jsx("p",{className:"text-slate-400 text-center p-4",children:"Nessun cliente trovato."})})})]})]})})}export{fe as default};
