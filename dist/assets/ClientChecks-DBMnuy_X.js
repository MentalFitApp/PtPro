import{r as m,a as Y,q as G,K as H,j as e,h as L,f as v,l as K,d as R,x as J,y as Q,o as V,B as W,M as Z,N as ee,D as te,k as U,H as se}from"./index-anlJ2MEK.js";import{C as ae}from"./Calendar-DGlkWnod.js";import{A as oe}from"./arrow-left-BEeMmgf1.js";import{m as F}from"./proxy-QSBDSPTy.js";import{A as ie}from"./index-BgdaTjSp.js";import{C as re}from"./circle-check-FTy3amIH.js";import{T as ne}from"./triangle-alert-CUFlDxnD.js";import{X as T}from"./x-BK_EVT3h.js";import{S as le}from"./send-C48asdir.js";import{v as ce,C as de}from"./v4-CzaitwUU.js";import{F as he}from"./file-pen-line-QGFduYMl.js";import"./clsx-B-dksMZM.js";const ue=`
.react-calendar { width: 100%; background: transparent; border: none; font-family: inherit; }
.react-calendar__navigation button { color: #67e8f9; font-weight: bold; font-size: 1.1em; }
.react-calendar__navigation button:hover, .react-calendar__navigation button:focus { background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; }
.react-calendar__month-view__weekdays__weekday { color: #9ca3af; text-transform: uppercase; font-size: 0.75rem; font-weight: 600; }
.react-calendar__tile { color: #d1d5db; border-radius: 0.5rem; height: 50px; }
.react-calendar__tile:disabled { color: #6b7280; }
.react-calendar__tile:enabled:hover, .react-calendar__tile:enabled:focus { background: rgba(255, 255, 255, 0.1); }
.react-calendar__tile--now { background: rgba(63, 63, 70, 0.7); font-weight: bold; }
.react-calendar__tile--active { background: #0891b2; color: white; }
.check-day { position: relative; }
.check-day::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; border-radius: 50%; background-color: #f43f5e; }
.check-submitted { position: relative; background-color: rgba(16, 185, 129, 0.2); }
.check-submitted::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; border-radius: 50%; background-color: #10b981; }
`,M=()=>e.jsx("div",{className:"absolute inset-0 -z-10 overflow-hidden bg-zinc-950",children:e.jsx("div",{className:"aurora-background"})}),me=()=>e.jsxs("div",{className:"min-h-screen flex justify-center items-center relative",children:[e.jsx(M,{}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})]}),ge=({message:a,type:i,onDismiss:n})=>e.jsx(ie,{children:a&&e.jsxs(F.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${i==="success"?"bg-emerald-900/80 text-emerald-300 border-emerald-500/30":"bg-red-900/80 text-red-300 border-red-500/30"} backdrop-blur-md shadow-lg`,children:[i==="success"?e.jsx(re,{}):e.jsx(ne,{}),e.jsx("p",{children:a}),e.jsx("button",{onClick:n,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(T,{size:16})})]})}),xe=({formState:a,setFormState:i,handleSubmit:n,isUploading:r,handleFileChange:w})=>{const y=()=>i({id:null,notes:"",weight:"",photos:{},photoPreviews:{}}),l=({type:d,label:c,preview:g})=>e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:c}),e.jsxs("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-zinc-900/50 rounded-lg border-2 border-dashed border-zinc-700 hover:border-cyan-500 transition-colors relative group",children:[g?e.jsx("img",{src:g,alt:"preview",className:"h-full w-full object-contain rounded-lg p-1"}):e.jsxs("div",{className:"flex flex-col items-center text-slate-400 transition-colors group-hover:text-cyan-400",children:[e.jsx(de,{size:32}),e.jsx("p",{className:"mt-2 text-sm",children:"Carica foto"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:N=>w(N,d),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})]});return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-cyan-300",children:a.id?"Modifica Check":"Carica Check del Giorno"}),e.jsx("button",{onClick:y,className:"text-slate-400 hover:text-white p-1 rounded-full",children:e.jsx(T,{size:20})})]}),e.jsxs("form",{onSubmit:n,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Peso Attuale (kg)*"}),e.jsx("input",{type:"number",step:"0.1",value:a.weight,onChange:d=>i(c=>({...c,weight:d.target.value})),required:!0,className:"w-full p-2.5 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200",placeholder:"Es. 75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Note sul check"}),e.jsx("textarea",{value:a.notes,onChange:d=>i(c=>({...c,notes:d.target.value})),rows:"4",className:"w-full p-2.5 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(l,{type:"front",label:"Frontale",preview:a.photoPreviews.front}),e.jsx(l,{type:"right",label:"Laterale Destro",preview:a.photoPreviews.right}),e.jsx(l,{type:"left",label:"Laterale Sinistro",preview:a.photoPreviews.left}),e.jsx(l,{type:"back",label:"Posteriore",preview:a.photoPreviews.back})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:r,className:"flex items-center gap-2 px-5 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition font-semibold disabled:opacity-50",children:[e.jsx(le,{size:16})," ",r?"Salvataggio...":a.id?"Salva Modifiche":"Invia Check"]})})]})]})},pe=({check:a,handleEditClick:i})=>{const n=(new Date-a.createdAt.toDate())/36e5<2;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"font-bold text-lg text-cyan-300",children:["Riepilogo del ",a.createdAt.toDate().toLocaleDateString("it-IT")]}),n&&e.jsxs("button",{onClick:()=>i(a),className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm font-semibold rounded-lg",children:[e.jsx(he,{size:14})," Modifica"]})]}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"Peso Registrato:"}),e.jsxs("p",{className:"text-white text-xl font-bold",children:[a.weight," kg"]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"Note:"}),e.jsx("p",{className:"text-slate-400 p-3 bg-zinc-900/50 rounded-lg whitespace-pre-wrap",children:a.notes||"Nessuna nota."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-slate-300",children:"Foto:"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:a.photoURLs&&["front","right","left","back"].map(r=>a.photoURLs[r]?e.jsx("a",{href:a.photoURLs[r],target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:a.photoURLs[r],alt:r,className:"rounded-lg w-full h-auto"},r)}):null)})]})]})]})};function Ae(){const[a,i]=m.useState(null),[n,r]=m.useState([]),[w,y]=m.useState(!0),[l,d]=m.useState(new Date),[c,g]=m.useState({id:null,notes:"",weight:"",photos:{},photoPreviews:{}}),[N,S]=m.useState(!1),[z,k]=m.useState({message:"",type:""}),D=Y(),h=G().currentUser,E=H();m.useEffect(()=>{if(!h){D("/client-login");return}(async()=>{const o=L(v,"clients",h.uid),t=await K(o);t.exists()&&t.data().createdAt?i(t.data().createdAt.toDate()):i(new Date);const u=R(v,`clients/${h.uid}/checks`),f=J(u,Q("createdAt","desc"));return V(f,j=>{r(j.docs.map(p=>({id:p.id,...p.data()}))),y(!1)})})()},[h,D]);const b=(s,o="error")=>{k({message:s,type:o}),setTimeout(()=>k({message:"",type:""}),5e3)},A=s=>{if(!a)return[];let o=[],t=new Date(a.getTime());for(;t.getTime()<new Date(s.getFullYear(),s.getMonth()+2,1).getTime();)t.getMonth()===s.getMonth()&&t.getFullYear()===s.getFullYear()&&o.push(new Date(t.getTime())),t.setDate(t.getDate()+14);return o},$=({date:s,view:o})=>{if(o==="month"){if(n.some(t=>t.createdAt&&t.createdAt.toDate().toDateString()===s.toDateString()))return"check-submitted";if(A(s).some(t=>t.toDateString()===s.toDateString()))return"check-day"}},I=(s,o)=>{const t=s.target.files[0];t&&g(u=>({...u,photos:{...u.photos,[o]:t},photoPreviews:{...u.photoPreviews,[o]:URL.createObjectURL(t)}}))},q=s=>{d(s.createdAt.toDate()),g({id:s.id,notes:s.notes,weight:s.weight,photos:{},photoPreviews:s.photoURLs})},B=async s=>{s.preventDefault();const{id:o,notes:t,weight:u,photos:f}=c;if(!h||!o&&Object.values(f).length<4||!u){b("Compila il peso e carica tutte e 4 le foto.");return}S(!0);try{const x=o?n.find(C=>C.id===o):null;let j=x?{...x.photoURLs}:{};await Promise.all(Object.entries(f).map(async([C,_])=>{if(_){const X=`clients/${h.uid}/checks/${ce()}-${_.name}`,P=W(E,X);await Z(P,_),j[C]=await ee(P)}}));const p={notes:t,weight:parseFloat(u),photoURLs:j};o?(await te(L(v,`clients/${h.uid}/checks`,o),{...p,lastUpdatedAt:U()}),b("Check modificato con successo!","success")):(await se(R(v,`clients/${h.uid}/checks`),{...p,createdAt:U()}),b("Check caricato con successo!","success")),g({id:null,notes:"",weight:"",photos:{},photoPreviews:{}})}catch(x){console.error("Errore:",x),b("Si Ã¨ verificato un errore.")}finally{S(!1)}},O=()=>{const s=n.find(t=>t.createdAt&&t.createdAt.toDate().toDateString()===l.toDateString()),o=A(l).some(t=>t.toDateString()===l.toDateString());return c.id||o&&!s?e.jsx(xe,{formState:c,setFormState:g,handleSubmit:B,isUploading:N,handleFileChange:I}):s?e.jsx(pe,{check:s,handleEditClick:q}):e.jsx("p",{className:"text-center text-slate-400 p-8",children:"Nessun check previsto o registrato per questa data."})};return w?e.jsx(me,{}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:ue}),e.jsxs("div",{className:"min-h-screen text-slate-200 p-4 sm:p-8 relative",children:[e.jsx(M,{}),e.jsx(ge,{message:z.message,type:z.type,onDismiss:()=>k({message:"",type:""})}),e.jsxs("header",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-50",children:"I miei Check"}),e.jsxs("button",{onClick:()=>D("/client/dashboard"),className:"flex items-center gap-2 px-3 py-2 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm font-semibold rounded-lg transition-colors",children:[e.jsx(oe,{size:16}),e.jsx("span",{children:"Dashboard"})]})]}),e.jsxs(F.div,{initial:{opacity:0},animate:{opacity:1},className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1 bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-4",children:e.jsx(ae,{onChange:d,value:l,tileClassName:$})}),e.jsx("div",{className:"lg:col-span-2 bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6 min-h-[400px]",children:O()})]})]})]})}export{Ae as default};
