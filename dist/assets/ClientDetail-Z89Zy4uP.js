import{r as o,x as T,y as E,d as D,o as k,j as e,f as p,w as q,h as y,k as U,l as B,m as L,z as O,a as I,u as X,A as G,B as Z,C as H,D as J}from"./index-anlJ2MEK.js";import{C as K}from"./Calendar-DGlkWnod.js";import{u as Q}from"./index.esm-C6pMzoLS.js";import{D as F}from"./dollar-sign-t49DdLVO.js";import{X as V}from"./x-BK_EVT3h.js";import{P as W}from"./plus-oXdcBX4E.js";import{A as z}from"./index-BgdaTjSp.js";import{m as u}from"./proxy-QSBDSPTy.js";import{C as Y}from"./calendar-Bva6_DFN.js";import{T as M,C as ee}from"./trash-2-Cm64YcfQ.js";import{T as R}from"./triangle-alert-CUFlDxnD.js";import{A as te}from"./arrow-left-BEeMmgf1.js";import{U as se}from"./user-CwCetbIm.js";import{C as ae,a as ne}from"./copy-Ctl6JDZo.js";import{F as ie}from"./file-text-DgksSl2a.js";import{S as re}from"./square-check-big-CekbCxe2.js";import{F as oe}from"./file-pen-line-QGFduYMl.js";import"./clsx-B-dksMZM.js";const le=({isOpen:t,onClose:a,onConfirm:l})=>e.jsx(z,{children:t&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:e.jsxs(u.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:s=>s.stopPropagation(),className:"w-full max-w-md bg-zinc-950/80 rounded-2xl gradient-border p-6 text-center shadow-2xl shadow-black/40",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-900/50 mb-4",children:e.jsx(R,{className:"h-6 w-6 text-red-400"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-50",children:"Conferma Eliminazione"}),e.jsx("p",{className:"text-sm text-slate-400 mt-2",children:"Sei sicuro di voler eliminare questo pagamento? L'operazione non è reversibile."}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx("button",{onClick:a,className:"px-6 py-2 text-sm font-semibold text-slate-300 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors",children:"Annulla"}),e.jsx("button",{onClick:l,className:"px-6 py-2 text-sm font-semibold text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Elimina"})]})]})})}),_=t=>{if(!t)return null;if(typeof(t==null?void 0:t.toDate)=="function")return t.toDate();const a=new Date(t);return isNaN(a)?null:a};function ce({clientId:t}){const{register:a,handleSubmit:l,reset:s,formState:{isSubmitting:i}}=Q(),[d,x]=o.useState([]),[m,g]=o.useState(!1),[b,f]=o.useState(null);o.useEffect(()=>{const n=T(D(p,"clients",t,"payments"),E("paymentDate","desc")),h=k(n,v=>{x(v.docs.map(w=>({id:w.id,...w.data()})))});return()=>h()},[t]);const j=async n=>{try{const h=parseInt(n.duration,10),v=q(p),w=y(D(p,"clients",t,"payments"));v.set(w,{amount:parseFloat(n.amount),duration:`${h} mes${h>1?"i":"e"}`,paymentMethod:n.paymentMethod,paymentDate:U()});const A=y(p,"clients",t),$=(await B(A)).data();let C=_($.scadenza);(!C||C<new Date)&&(C=new Date);const S=new Date(C);S.setMonth(S.getMonth()+h),v.update(A,{scadenza:S}),await v.commit(),s(),g(!1)}catch(h){console.error("Errore nell'aggiungere il pagamento:",h)}},N=async()=>{if(b)try{const n=y(p,"clients",t,"payments",b.id);await L(n)}catch(n){console.error("Errore nell'eliminazione del pagamento:",n)}finally{f(null)}},r="w-full p-2.5 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-rose-500 text-slate-200 placeholder:text-slate-500",c="block mb-1 text-sm font-medium text-slate-300";return e.jsxs(e.Fragment,{children:[e.jsx(le,{isOpen:!!b,onClose:()=>f(null),onConfirm:N}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-rose-300 flex items-center gap-2",children:[e.jsx(F,{size:20})," Gestione Pagamenti"]}),e.jsxs("button",{onClick:()=>g(!m),className:"flex items-center gap-2 px-3 py-1.5 bg-rose-600/20 hover:bg-rose-600/30 text-rose-300 rounded-lg text-sm transition-colors",children:[m?e.jsx(V,{size:16}):e.jsx(W,{size:16})," ",m?"Annulla":"Aggiungi Rinnovo"]})]}),e.jsx(z,{children:m&&e.jsxs(u.form,{onSubmit:l(j),className:"space-y-4 mb-6 pt-4 border-t border-white/10",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:c,children:"Importo Pagato (€)*"}),e.jsx("input",{type:"number",step:"0.01",...a("amount",{required:!0}),className:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:c,children:"Durata Rinnovo (mesi)*"}),e.jsx("select",{...a("duration",{required:!0}),className:r,children:[...Array(24).keys()].map(n=>e.jsxs("option",{value:n+1,children:[n+1," mes",n>0?"i":"e"]},n+1))})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:c,children:"Metodo di Pagamento"}),e.jsx("input",{...a("paymentMethod"),className:r,placeholder:"Es. Bonifico"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:i,className:"px-4 py-2 bg-rose-600 text-white rounded-lg font-semibold transition disabled:opacity-50",children:i?"Salvataggio...":"Salva Pagamento"})})]})}),e.jsx("h4",{className:"font-semibold text-slate-200 mb-3 mt-4",children:"Cronologia Rinnovi"}),e.jsx("div",{className:"space-y-2",children:d.length>0?d.map(n=>{var h;return e.jsxs("div",{className:"flex justify-between items-center p-3 bg-zinc-900/70 rounded-md border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"text-slate-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-slate-100",children:[n.duration," - €",n.amount.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-slate-400",children:["Pagato il ",(h=_(n.paymentDate))==null?void 0:h.toLocaleDateString("it-IT"),n.paymentMethod&&` via ${n.paymentMethod}`]})]})]}),e.jsx("button",{onClick:()=>f(n),className:"p-1.5 text-slate-500 hover:text-red-400 rounded-md transition-colors",children:e.jsx(M,{size:16})})]},n.id)}):e.jsx("p",{className:"text-sm text-slate-500",children:"Nessun pagamento registrato."})})]})]})}const de=`
.react-calendar { width: 100%; background: transparent; border: none; font-family: inherit; }
.react-calendar__navigation button { color: #f472b6; font-weight: bold; font-size: 1.1em; }
.react-calendar__navigation button:hover, .react-calendar__navigation button:focus { background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; }
.react-calendar__month-view__weekdays__weekday { color: #9ca3af; text-transform: uppercase; font-size: 0.75rem; font-weight: 600; }
.react-calendar__tile { color: #d1d5db; border-radius: 0.5rem; height: 50px; }
.react-calendar__tile:disabled { color: #6b7280; }
.react-calendar__tile:enabled:hover, .react-calendar__tile:enabled:focus { background: rgba(255, 255, 255, 0.1); }
.react-calendar__tile--now { background: rgba(63, 63, 70, 0.7); font-weight: bold; }
.react-calendar__tile--active { background: #db2777; color: white; }
.check-day-highlight { position: relative; background-color: rgba(16, 185, 129, 0.2); }
.check-day-highlight::after { content: ''; position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; border-radius: 50%; background-color: #10b981; }
`;function P(t){if(!t)return null;if(typeof(t==null?void 0:t.toDate)=="function")return t.toDate();const a=new Date(t);return isNaN(a)?null:a}const me=({isOpen:t,onClose:a,onConfirm:l,title:s,children:i})=>e.jsx(z,{children:t&&e.jsx(u.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:e.jsxs(u.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:d=>d.stopPropagation(),className:"w-full max-w-md bg-zinc-950/80 rounded-2xl gradient-border p-6 text-center shadow-2xl shadow-black/40",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-900/50 mb-4",children:e.jsx(R,{className:"h-6 w-6 text-red-400"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-50",children:s}),e.jsx("div",{className:"text-sm text-slate-400 mt-2",children:i}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx("button",{onClick:a,className:"px-6 py-2 text-sm font-semibold text-slate-300 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors",children:"Annulla"}),e.jsx("button",{onClick:l,className:"px-6 py-2 text-sm font-semibold text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Elimina"})]})]})})}),xe=({clientId:t})=>{const[a,l]=o.useState(null);return o.useEffect(()=>{const s=k(y(p,"clients",t,"anamnesi","initial"),i=>l(i.exists()?i.data():null));return()=>s()},[t]),a===null?e.jsx("p",{className:"text-slate-400 text-center p-4",children:"Caricamento..."}):a?e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},className:"space-y-4 bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-rose-300 mb-4",children:"Anamnesi Compilata"}),Object.entries(a).map(([s,i])=>["createdAt","submittedAt","tempPassword"].includes(s)?null:e.jsxs("div",{className:"pb-2 border-b border-white/10 last:border-b-0",children:[e.jsx("h4",{className:"font-semibold text-slate-400 capitalize text-sm",children:s.replace(/([A-Z])/g," $1")}),e.jsx("p",{className:"text-slate-200 whitespace-pre-wrap",children:String(i)||"N/D"})]},s))]}):e.jsx("div",{className:"bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6",children:e.jsx("p",{className:"text-center text-slate-400",children:"Il cliente non ha ancora compilato l'anamnesi."})})},he=({check:t,clientId:a})=>{var N;const[l,s]=o.useState(!1),[i,d]=o.useState(t.coachNotes||""),[x,m]=o.useState(!1),[g,b]=o.useState(!1),f=async()=>{m(!0);try{await J(y(p,"clients",a,"checks",t.id),{coachNotes:i})}finally{m(!1)}},j=async()=>{b(!1);try{if(t.photoURLs){const r=Object.values(t.photoURLs);await Promise.all(r.map(c=>{try{const n=decodeURIComponent(c.split("/o/")[1].split("?")[0]);return G(Z(H,n))}catch(n){return console.warn("Could not delete photo from storage:",n),Promise.resolve()}}))}await L(y(p,"clients",a,"checks",t.id))}catch(r){console.error("Errore eliminazione:",r)}};return e.jsxs(e.Fragment,{children:[e.jsx(me,{isOpen:g,onClose:()=>b(!1),onConfirm:j,title:"Elimina Check",children:e.jsx("p",{children:"Sei sicuro di voler eliminare questo check? Le foto associate verranno rimosse permanentemente."})}),e.jsxs("div",{className:"bg-zinc-900/70 rounded-lg border border-white/10 overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4",children:[e.jsxs("button",{onClick:()=>s(!l),className:"flex-1 flex justify-between items-center text-left",children:[e.jsxs("span",{className:"font-semibold text-slate-200",children:["Check del ",(N=P(t.createdAt))==null?void 0:N.toLocaleDateString("it-IT")]}),e.jsx(u.div,{animate:{rotate:l?180:0},children:e.jsx(ee,{className:"text-slate-400"})})]}),e.jsx("button",{onClick:()=>b(!0),className:"ml-4 p-1.5 text-slate-500 hover:text-red-400 rounded-md",title:"Elimina Check",children:e.jsx(M,{size:14})})]}),e.jsx(z,{children:l&&e.jsx(u.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 pb-4",children:e.jsxs("div",{className:"pt-4 border-t border-white/20 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 mb-2",children:"Note del cliente:"}),e.jsx("p",{className:"text-slate-300 whitespace-pre-wrap",children:t.notes||"-"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:t.photoURLs&&Object.values(t.photoURLs).map((r,c)=>e.jsx("a",{href:r,target:"_blank",rel:"noopener noreferrer",children:e.jsx("img",{src:r,alt:`Foto ${c+1}`,className:"rounded-md aspect-square object-cover"})},c))}),e.jsxs("div",{className:"pt-4 border-t border-white/20",children:[e.jsxs("h4",{className:"text-sm font-semibold text-slate-400 mb-2 flex items-center gap-2",children:[e.jsx(oe,{size:14})," Feedback:"]}),e.jsx("textarea",{value:i,onChange:r=>d(r.target.value),rows:"3",className:"w-full p-2 bg-zinc-950 rounded-lg border border-white/10",placeholder:"Scrivi qui il tuo feedback..."}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx("button",{onClick:f,disabled:x,className:"px-3 py-1.5 bg-rose-600 text-white text-xs font-semibold rounded-lg",children:x?"Salvo...":"Salva"})})]})]})})})]})]})},pe=({clientId:t})=>{const[a,l]=o.useState([]);o.useEffect(()=>{const i=T(D(p,"clients",t,"checks"),E("createdAt","desc")),d=k(i,x=>l(x.docs.map(m=>({id:m.id,...m.data()}))));return()=>d()},[t]);const s=({date:i,view:d})=>{if(d==="month"&&a.some(x=>{var m;return((m=P(x.createdAt))==null?void 0:m.toDateString())===i.toDateString()}))return"check-day-highlight"};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1 bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-4",children:e.jsx(K,{tileClassName:s})}),e.jsx("div",{className:"lg:col-span-2 space-y-2 max-h-[600px] overflow-y-auto pr-2",children:a.length>0?a.map(i=>e.jsx(he,{check:i,clientId:t},i.id)):e.jsx("p",{className:"text-center text-slate-500 p-8",children:"Nessun check ancora registrato."})})]})};function Le(){var N;const{clientId:t}=O(),a=I(),l=X(),[s,i]=o.useState(null),[d,x]=o.useState("anamnesi"),[m,g]=o.useState(!1);o.useEffect(()=>{const r=new URLSearchParams(l.search).get("tab");r&&x(r)},[l.search]),o.useEffect(()=>{const r=k(y(p,"clients",t),c=>{c.exists()?i({id:c.id,...c.data()}):a("/clients")});return()=>r()},[t,a]);const b=()=>{if(!s||!s.tempPassword)return;const c=`Ciao ${s.name},

Benvenuto in PT Manager, la tua area personale per monitorare i progressi e comunicare con il tuo coach!

Ecco le credenziali per il tuo primo accesso:

Link: https://mentalfitmanager.github.io/#/client-login
Email: ${s.email}
Password Temporanea: ${s.tempPassword}

Al primo accesso ti verrà chiesto di impostare una password personale.
A presto!`;navigator.clipboard.writeText(c),g(!0),setTimeout(()=>g(!1),2500)};if(!s)return e.jsx("div",{className:"text-center text-slate-400 p-8",children:"Caricamento..."});const f=((N=P(s.createdAt))==null?void 0:N.toLocaleDateString("it-IT"))||"N/A",j=({tabName:r,label:c,icon:n})=>e.jsxs("button",{onClick:()=>x(r),className:`px-4 py-2 text-sm flex items-center gap-2 transition-colors ${d===r?"border-b-2 border-rose-500 text-slate-50":"text-slate-400 hover:text-slate-200"}`,children:[n," ",c]});return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:de}),e.jsxs("div",{className:"w-full",children:[e.jsxs(u.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[e.jsxs("header",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-50",children:s.name}),e.jsxs("p",{className:"text-slate-400",children:["Cliente dal: ",f]})]}),e.jsxs("button",{onClick:()=>a("/clients"),className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm rounded-lg transition-colors",children:[e.jsx(te,{size:16})," Torna"]})]}),e.jsxs("div",{className:"bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"bg-rose-500/20 text-rose-300 p-3 rounded-full",children:e.jsx(se,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-100",children:"Profilo"}),e.jsx("p",{className:"text-slate-400",children:s.email}),s.phone&&e.jsx("p",{className:"text-slate-400",children:s.phone})]})]}),s.firstLogin&&s.tempPassword&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-white/10",children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 mb-3",children:"Credenziali di Accesso Temporanee"}),e.jsxs("div",{className:"space-y-3 mb-4",children:[e.jsxs("div",{className:"bg-zinc-900 p-3 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Email (Username)"}),e.jsx("p",{className:"font-mono text-slate-200",children:s.email})]}),e.jsxs("div",{className:"bg-zinc-900 p-3 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Password Temporanea"}),e.jsx("p",{className:"font-mono text-slate-200",children:s.tempPassword})]})]}),e.jsx("button",{onClick:b,className:"w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg transition-colors",children:m?e.jsxs(e.Fragment,{children:[e.jsx(ae,{size:18})," Copiato!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:16})," Copia Messaggio di Benvenuto"]})}),e.jsx("p",{className:"text-xs text-slate-500 mt-2 text-center",children:"Copia il messaggio completo con link, email e password da inviare al cliente."})]})]})]}),e.jsxs(u.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},children:[e.jsxs("div",{className:"flex border-b border-white/10 mb-6",children:[e.jsx(j,{tabName:"anamnesi",label:"Anamnesi",icon:e.jsx(ie,{size:16})}),e.jsx(j,{tabName:"checks",label:"Checks",icon:e.jsx(re,{size:16})}),e.jsx(j,{tabName:"payments",label:"Pagamenti",icon:e.jsx(F,{size:16})})]}),e.jsxs("div",{children:[d==="anamnesi"&&e.jsx(xe,{clientId:t}),d==="checks"&&e.jsx(pe,{clientId:t}),d==="payments"&&e.jsx("div",{className:"bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6",children:e.jsx(ce,{clientId:t})})]})]})]})]})}export{Le as default};
