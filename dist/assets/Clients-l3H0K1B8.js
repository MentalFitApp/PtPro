import{a as U,u as $,r as l,o as B,d as q,j as e,f as A,m as K,h as R}from"./index-anlJ2MEK.js";import{c as E,m}from"./proxy-QSBDSPTy.js";import{S as G}from"./search-Bdosj-RF.js";import{U as O}from"./user-plus-E_3j6mvp.js";import{F as Q}from"./file-pen-line-QGFduYMl.js";import{T as H,C as J}from"./trash-2-Cm64YcfQ.js";import{A as V}from"./index-BgdaTjSp.js";import{T as W}from"./triangle-alert-CUFlDxnD.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=E("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=E("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);function u(s){if(!s)return null;if(typeof(s==null?void 0:s.toDate)=="function")return s.toDate();const a=new Date(s);return isNaN(a)?null:a}const x=s=>{const a=u(s);if(!a)return"na";const c=Math.ceil((a-new Date)/(1e3*60*60*24));return c<0?"expired":c<=15?"expiring":"paid"},Z=({status:s})=>{const a={paid:"bg-emerald-900/80 text-emerald-300 border border-emerald-500/30",expiring:"bg-amber-900/80 text-amber-300 border border-amber-500/30",expired:"bg-red-900/80 text-red-400 border border-red-500/30",na:"bg-zinc-700/80 text-zinc-300 border border-zinc-500/30"},i={paid:"Pagato",expiring:"In Scadenza",expired:"Scaduto",na:"N/D"};return e.jsx("span",{className:`px-2.5 py-1 text-xs font-medium rounded-full ${a[s]}`,children:i[s]})},_=({isOpen:s,onClose:a,onConfirm:i,clientName:c})=>e.jsx(V,{children:s&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:e.jsxs(m.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:p=>p.stopPropagation(),className:"w-full max-w-md bg-zinc-950/80 rounded-2xl gradient-border p-6 text-center shadow-2xl shadow-black/40",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-900/50 mb-4",children:e.jsx(W,{className:"h-6 w-6 text-red-400"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-50",children:"Conferma Eliminazione"}),e.jsxs("p",{className:"text-sm text-slate-400 mt-2",children:["Sei sicuro di voler eliminare il cliente ",e.jsx("strong",{className:"text-red-400",children:c}),"? L'operazione Ã¨ irreversibile."]}),e.jsxs("div",{className:"mt-6 flex justify-center gap-4",children:[e.jsx("button",{onClick:a,className:"px-6 py-2 text-sm font-semibold text-slate-300 bg-zinc-800 hover:bg-zinc-700 rounded-lg transition-colors",children:"Annulla"}),e.jsx("button",{onClick:i,className:"px-6 py-2 text-sm font-semibold text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors",children:"Elimina"})]})]})})});function oe(){const s=U(),a=$(),[i,c]=l.useState([]),[p,F]=l.useState(!0),[d,g]=l.useState(null),[j,T]=l.useState(""),[h,w]=l.useState("all"),[o,I]=l.useState("createdAt"),[N,z]=l.useState("desc");l.useEffect(()=>{const n=new URLSearchParams(a.search).get("filter");n&&["paid","expiring","expired"].includes(n)&&w(n)},[a.search]),l.useEffect(()=>{const t=B(q(A,"clients"),n=>{c(n.docs.map(r=>({id:r.id,...r.data()}))),F(!1)});return()=>t()},[]);const M=async()=>{if(d)try{await K(R(A,"clients",d.id)),g(null)}catch(t){console.error("Errore delete:",t)}},C=l.useMemo(()=>{let t=i.filter(r=>h==="all"||x(r.scadenza)===h);const n=j.trim().toLowerCase();return n&&(t=t.filter(r=>(r.name||"").toLowerCase().includes(n)||(r.email||"").toLowerCase().includes(n))),t.sort((r,D)=>{var L,P;const v=o==="name"?(r.name||"").toLowerCase():((L=u(r[o]))==null?void 0:L.getTime())||0,y=o==="name"?(D.name||"").toLowerCase():((P=u(D[o]))==null?void 0:P.getTime())||0;return v===y?0:N==="asc"?v>y?1:-1:v<y?1:-1}),t},[i,j,h,o,N]),f=l.useMemo(()=>({all:i.length,paid:i.filter(t=>x(t.scadenza)==="paid").length,expiring:i.filter(t=>x(t.scadenza)==="expiring").length,expired:i.filter(t=>x(t.scadenza)==="expired").length}),[i]),S=t=>{o===t?z(n=>n==="asc"?"desc":"asc"):(I(t),z(t==="scadenza"||t==="createdAt"?"desc":"asc"))},k=({col:t})=>o===t?N==="asc"?e.jsx(X,{className:"inline ml-1 h-4 w-4"}):e.jsx(J,{className:"inline ml-1 h-4 w-4"}):null,b=({status:t,label:n,count:r})=>e.jsxs("button",{onClick:()=>w(t),className:`px-3 py-1.5 text-sm rounded-md transition ${h===t?"bg-rose-600 text-white font-semibold":"bg-zinc-800 hover:bg-zinc-700 text-slate-300"}`,children:[n," ",e.jsx("span",{className:"text-xs opacity-60",children:r})]});return e.jsxs(e.Fragment,{children:[e.jsx(_,{isOpen:!!d,onClose:()=>g(null),onConfirm:M,clientName:d==null?void 0:d.name}),e.jsxs(m.div,{className:"w-full",initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.1}}},children:[e.jsxs(m.div,{variants:{hidden:{y:-20,opacity:0},visible:{y:0,opacity:1}},className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-50",children:"Gestione Clienti"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-full md:w-auto",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",size:18}),e.jsx("input",{value:j,onChange:t=>T(t.target.value),className:"bg-zinc-900/70 border border-white/10 rounded-lg px-3 py-2 pl-10 w-full md:w-64 outline-none focus:ring-2 focus:ring-rose-500",placeholder:"Cerca per nome o email..."})]}),e.jsxs("button",{onClick:()=>s("/new"),className:"flex items-center justify-center gap-2 px-4 py-2 bg-rose-600 hover:bg-rose-700 text-white font-semibold rounded-lg transition-colors",children:[e.jsx(O,{size:16})," Nuovo"]})]})]}),e.jsxs(m.div,{variants:{hidden:{y:-20,opacity:0},visible:{y:0,opacity:1}},className:"flex items-center gap-2 mb-4 p-2 bg-zinc-900/70 border border-white/10 rounded-lg",children:[e.jsx(Y,{className:"text-slate-400 ml-1",size:16}),e.jsx(b,{status:"all",label:"Tutti",count:f.all}),e.jsx(b,{status:"paid",label:"Pagato",count:f.paid}),e.jsx(b,{status:"expiring",label:"In Scadenza",count:f.expiring}),e.jsx(b,{status:"expired",label:"Scaduto",count:f.expired})]}),e.jsx(m.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},className:"bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm text-left text-slate-300",children:[e.jsx("thead",{className:"bg-white/5 text-slate-400 uppercase text-xs",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"p-4 cursor-pointer select-none",onClick:()=>S("name"),children:["Nome ",e.jsx(k,{col:"name"})]}),e.jsx("th",{className:"p-4",children:"Stato Pagamento"}),e.jsxs("th",{className:"p-4 cursor-pointer select-none",onClick:()=>S("scadenza"),children:["Scadenza ",e.jsx(k,{col:"scadenza"})]}),e.jsx("th",{className:"p-4 text-right",children:"Azioni"})]})}),e.jsxs("tbody",{children:[C.map(t=>e.jsxs("tr",{className:"border-t border-white/10 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"p-4 font-medium",children:e.jsx("button",{className:"hover:underline hover:text-rose-400",onClick:()=>s(`/client/${t.id}`),children:t.name||"-"})}),e.jsx("td",{className:"p-4",children:e.jsx(Z,{status:x(t.scadenza)})}),e.jsx("td",{className:"p-4",children:u(t.scadenza)?u(t.scadenza).toLocaleDateString("it-IT"):"-"}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("button",{onClick:()=>s(`/edit/${t.id}`),className:"p-2 text-slate-400 hover:text-amber-400 hover:bg-white/10 rounded-md transition-colors",title:"Modifica",children:e.jsx(Q,{size:16})}),e.jsx("button",{onClick:()=>g(t),className:"p-2 text-slate-400 hover:text-red-400 hover:bg-white/10 rounded-md transition-colors",title:"Elimina",children:e.jsx(H,{size:16})})]})})]},t.id)),p&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center p-8 text-slate-400",children:"Caricamento clienti..."})}),!p&&C.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center p-8 text-slate-400",children:"Nessun cliente trovato."})})]})]})})})]})]})}export{oe as default};
