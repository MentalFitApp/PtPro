import{a as U,r as x,j as e,n as B,p as O,q as R,t as G,w as H,f as N,h as S,k as T,d as Q,v as V}from"./index-anlJ2MEK.js";import{u as W}from"./index.esm-C6pMzoLS.js";import{m as d}from"./proxy-QSBDSPTy.js";import{A as X}from"./arrow-left-BEeMmgf1.js";import{D as J}from"./dollar-sign-t49DdLVO.js";import{S as K}from"./save-D4sO7FbU.js";import{A as k}from"./index-BgdaTjSp.js";import{C as Y,a as Z}from"./copy-Ctl6JDZo.js";import{T as _}from"./triangle-alert-CUFlDxnD.js";import{X as ee}from"./x-BK_EVT3h.js";const se=({message:n,type:t,onDismiss:o})=>e.jsx(k,{children:n&&e.jsxs(d.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${t==="error"?"bg-red-900/80 text-red-300 border-red-500/30":""} backdrop-blur-md shadow-lg`,children:[e.jsx(_,{className:"text-red-400"}),e.jsx("p",{children:n}),e.jsx("button",{onClick:o,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(ee,{size:16})})]})}),te=()=>{const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let o="";for(let m=0,p=t.length;m<8;++m)o+=t.charAt(Math.floor(Math.random()*p));return o};function xe(){const n=U(),{register:t,handleSubmit:o,reset:m,formState:{isSubmitting:p}}=W(),[P,w]=x.useState(!1),[c,M]=x.useState(null),[D,v]=x.useState(!1),[C,u]=x.useState({message:"",type:""}),h=(s,l="error")=>{u({message:s,type:l}),setTimeout(()=>u({message:"",type:""}),6e3)},E=async s=>{const l=te(),z=B(O,`user-creation-${Date.now()}`),L=R(z);try{const A=(await G(L,s.email,l)).user.uid,b=H(N),q=S(N,"clients",A),f=parseInt(s.duration,10),y=new Date;if(y.setMonth(y.getMonth()+f),b.set(q,{name:s.name,name_lowercase:s.name.toLowerCase(),email:s.email,phone:s.phone||null,status:"attivo",planType:s.planType,createdAt:T(),scadenza:y,isClient:!0,firstLogin:!0,tempPassword:l}),s.paymentAmount){const I=S(Q(N,"clients",A,"payments"));b.set(I,{amount:parseFloat(s.paymentAmount),duration:`${f} mes${f>1?"i":"e"}`,paymentMethod:s.paymentMethod||null,paymentDate:T()})}await b.commit(),M({name:s.name,email:s.email,password:l}),w(!0)}catch(r){console.error("Errore nella creazione del cliente:",r.code,r.message),r.code==="permission-denied"||r.message.includes("permission-denied")?h("Permessi insufficienti. Assicurati che il tuo UID admin sia nelle regole di sicurezza di Firestore."):r.code==="auth/email-already-in-use"?h("Questa email è già in uso da un altro utente."):h("Si è verificato un errore imprevisto.")}finally{await V(z)}},$=()=>{const l=`Ciao ${c.name},

Benvenuto in PT Manager, la tua area personale per monitorare i progressi e comunicare con il tuo coach!

Ecco le credenziali per il tuo primo accesso:

Link: https://mentalfitmanager.github.io/#/client-login
Email: ${c.email}
Password Temporanea: ${c.password}

Al primo accesso ti verrà chiesto di impostare una password personale.
A presto!`;navigator.clipboard.writeText(l),v(!0),setTimeout(()=>v(!1),2500)},F=()=>{w(!1),m(),n("/clients")},a="w-full p-2.5 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-rose-500 text-slate-200 placeholder:text-slate-500",i="block mb-1 text-sm font-medium text-slate-300",g="bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6",j="font-bold mb-4 text-lg text-rose-300 border-b border-rose-400/20 pb-2 flex items-center gap-2";return e.jsxs(e.Fragment,{children:[e.jsx(se,{message:C.message,type:C.type,onDismiss:()=>u({message:"",type:""})}),e.jsxs(d.div,{className:"w-full max-w-2xl mx-auto",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-50",children:"Onboarding Nuovo Cliente"}),e.jsxs("button",{onClick:()=>n("/clients"),className:"flex items-center gap-2 px-3 py-1.5 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm rounded-lg transition-colors",children:[e.jsx(X,{size:16})," Torna Indietro"]})]}),e.jsxs("form",{onSubmit:o(E),className:"space-y-6",children:[e.jsxs("div",{className:g,children:[e.jsx("h4",{className:j,children:"1. Anagrafica"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Nome e Cognome*"}),e.jsx("input",{...t("name",{required:!0}),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Email (sarà il suo username)*"}),e.jsx("input",{type:"email",...t("email",{required:!0}),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Telefono (Opzionale)"}),e.jsx("input",{...t("phone"),className:a})]})]})]}),e.jsxs("div",{className:g,children:[e.jsx("h4",{className:j,children:"2. Dettagli Percorso"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Tipo di Percorso*"}),e.jsxs("select",{...t("planType",{required:!0}),className:a,children:[e.jsx("option",{value:"allenamento",children:"Solo Allenamento"}),e.jsx("option",{value:"alimentazione",children:"Solo Alimentazione"}),e.jsx("option",{value:"completo",children:"Completo"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Durata del Percorso*"}),e.jsxs("select",{...t("duration",{required:!0}),className:a,children:[e.jsx("option",{value:"",children:"Seleziona durata"}),[...Array(24).keys()].map(s=>e.jsxs("option",{value:s+1,children:[s+1," mes",s>0?"i":"e"]},s+1))]})]})]})]}),e.jsxs("div",{className:g,children:[e.jsxs("h4",{className:j,children:[e.jsx(J,{size:20})," 3. Primo Pagamento (Opzionale)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Importo Pagato (€)"}),e.jsx("input",{type:"number",step:"0.01",...t("paymentAmount"),className:a})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Metodo di Pagamento"}),e.jsx("input",{...t("paymentMethod"),className:a,placeholder:"Es. Bonifico"})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:p,className:"flex items-center gap-2 px-5 py-2.5 bg-rose-600 hover:bg-rose-700 text-white rounded-lg transition disabled:opacity-50 font-semibold disabled:cursor-not-allowed",children:[e.jsx(K,{size:16})," ",p?"Creazione in corso...":"Crea Cliente e Genera Password"]})})]})]}),e.jsx(k,{children:P&&e.jsx(d.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm flex justify-center items-center z-50 p-4",children:e.jsxs(d.div,{className:"bg-zinc-950/80 rounded-2xl gradient-border p-6 text-center w-full max-w-md shadow-2xl shadow-black/40",initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},children:[e.jsx("h2",{className:"text-xl font-bold text-slate-50",children:"Cliente Creato!"}),e.jsx("p",{className:"text-slate-400 text-sm mt-2",children:"Copia e invia le credenziali al cliente."}),e.jsxs("div",{className:"my-6 space-y-3 text-left",children:[e.jsxs("div",{className:"bg-zinc-900 p-3 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Email (Username)"}),e.jsx("p",{className:"font-mono text-slate-200",children:c.email})]}),e.jsxs("div",{className:"bg-zinc-900 p-3 rounded-lg border border-white/10",children:[e.jsx("p",{className:"text-xs text-slate-400",children:"Password Temporanea"}),e.jsx("p",{className:"font-mono text-slate-200",children:c.password})]})]}),e.jsx(d.button,{onClick:$,className:"w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-lg flex items-center justify-center gap-2 transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:D?e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:18})," Copiato!"]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:16})," Copia Credenziali"]})}),e.jsx("button",{onClick:F,className:"w-full mt-3 py-2 text-slate-400 hover:text-white text-sm text-center transition-colors",children:"Chiudi"})]})})})]})}export{xe as default};
