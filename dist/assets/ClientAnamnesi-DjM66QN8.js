import{r as u,a as Q,q as W,K,j as e,h as L,f as C,l as X,B as _,M as H,N as J,k as Y,i as Z}from"./index-anlJ2MEK.js";import{u as ee}from"./index.esm-C6pMzoLS.js";import{A as se}from"./arrow-left-BEeMmgf1.js";import{m as U}from"./proxy-QSBDSPTy.js";import{S as ae}from"./save-D4sO7FbU.js";import{F as ie}from"./file-pen-line-QGFduYMl.js";import{A as le}from"./index-BgdaTjSp.js";import{X as te}from"./x-BK_EVT3h.js";import{C as re,v as ne}from"./v4-CzaitwUU.js";const F=()=>e.jsx("div",{className:"absolute inset-0 -z-10 overflow-hidden bg-zinc-950",children:e.jsx("div",{className:"aurora-background"})}),ce=()=>e.jsxs("div",{className:"min-h-screen flex justify-center items-center relative",children:[e.jsx(F,{}),e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-cyan-400"})]}),oe=({message:s,type:j,onDismiss:v})=>e.jsx(le,{children:s&&e.jsxs(U.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:`fixed top-5 right-5 z-50 flex items-center gap-4 p-4 rounded-lg border ${j==="success"?"bg-emerald-900/80 text-emerald-300 border-emerald-500/30":"bg-red-900/80 text-red-300 border-red-500/30"} backdrop-blur-md shadow-lg`,children:[e.jsx("p",{children:s}),e.jsx("button",{onClick:v,className:"p-1 rounded-full hover:bg-white/10",children:e.jsx(te,{size:16})})]})}),fe=()=>{const[s,j]=u.useState(null),[v,f]=u.useState(!0),[I,p]=u.useState(!1),[z,R]=u.useState({front:null,right:null,left:null,back:null}),[A,q]=u.useState({front:null,right:null,left:null,back:null}),[D,N]=u.useState({message:"",type:""}),y=Q(),x=W().currentUser,T=K(),{register:l,handleSubmit:O,setValue:k,formState:{isSubmitting:P}}=ee();u.useEffect(()=>{if(!x){y("/client-login");return}(async()=>{const a=L(C,`clients/${x.uid}/anamnesi`,"initial"),o=await X(a);if(o.exists()){const c=o.data();j(c),c.photoURLs&&q(c.photoURLs),Object.keys(c).forEach(h=>k(h,c[h])),p(!1)}else p(!0);f(!1)})()},[x,y,k]);const w=(n,a="error")=>{N({message:n,type:a}),setTimeout(()=>N({message:"",type:""}),5e3)},$=(n,a)=>{const o=n.target.files[0];o&&(R(c=>({...c,[a]:o})),q(c=>({...c,[a]:URL.createObjectURL(o)})))},B=async n=>{if(x){if(!s&&Object.values(z).some(a=>a===null)){w("Per favore, carica tutte e 4 le foto iniziali.");return}f(!0);try{let a=(s==null?void 0:s.photoURLs)||{};const o=Object.entries(z).filter(([,h])=>h!==null);o.length>0&&(await Promise.all(o.map(async([g,S])=>{const V=`clients/${x.uid}/anamnesi_photos/${g}-${ne()}`,E=_(T,V);await H(E,S);const G=await J(E);return{type:g,url:G}}))).forEach(({type:g,url:S})=>{a[g]=S});const c={...n,photoURLs:a,submittedAt:Y()};await Z(L(C,`clients/${x.uid}/anamnesi`,"initial"),c,{merge:!0}),j(c),p(!1),w("Anamnesi salvata con successo!","success")}catch(a){console.error("Errore nel salvataggio:",a),w("Si è verificato un errore durante il salvataggio.")}finally{f(!1)}}};if(v)return e.jsx(ce,{});const t="w-full p-2.5 mt-1 bg-zinc-900/70 border border-white/10 rounded-lg outline-none focus:ring-2 focus:ring-cyan-500 text-slate-200 placeholder:text-slate-500",i="block text-sm font-medium text-slate-300",d="bg-zinc-950/60 backdrop-blur-xl rounded-2xl gradient-border p-6",m="font-bold mb-4 text-lg text-cyan-300 border-b border-cyan-400/20 pb-2",b=({type:n,label:a})=>e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:i,children:a}),e.jsxs("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-zinc-900/50 rounded-lg border-2 border-dashed border-zinc-700 hover:border-cyan-500 transition-colors relative group",children:[A[n]?e.jsx("img",{src:A[n],alt:"preview",className:"h-full w-full object-contain rounded-lg p-1"}):e.jsxs("div",{className:"flex flex-col items-center text-slate-400 transition-colors group-hover:text-cyan-400",children:[e.jsx(re,{size:32}),e.jsx("p",{className:"mt-2 text-sm",children:"Carica foto"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:o=>$(o,n),className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"})]})]}),r=({label:n,value:a})=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400",children:n}),e.jsx("p",{className:"mt-1 p-3 bg-zinc-900 rounded-lg min-h-[44px] text-slate-200 break-words whitespace-pre-wrap",children:a||"Non specificato"})]}),M=({urls:n})=>e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:["front","right","left","back"].map(a=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-slate-400 capitalize",children:a==="front"?"Frontale":a==="back"?"Posteriore":`Laterale ${a==="left"?"Sinistro":"Destro"}`}),n!=null&&n[a]?e.jsx("img",{src:n[a],alt:a,className:"mt-2 rounded-lg w-full h-auto object-cover"}):e.jsx("div",{className:"mt-2 flex justify-center items-center w-full h-48 bg-zinc-900 rounded-lg text-slate-500",children:e.jsx("span",{children:"Non caricata"})})]},a))});return e.jsxs("div",{className:"min-h-screen text-slate-200 p-4 sm:p-8 relative",children:[e.jsx(F,{}),e.jsx(oe,{message:D.message,type:D.type,onDismiss:()=>N({message:"",type:""})}),e.jsxs("header",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-50",children:"La mia Anamnesi"}),e.jsxs("button",{onClick:()=>y("/client/dashboard"),className:"flex items-center gap-2 px-3 py-2 bg-zinc-800 hover:bg-zinc-700 text-slate-300 text-sm font-semibold rounded-lg transition-colors",children:[e.jsx(se,{size:16}),e.jsx("span",{children:"Dashboard"})]})]}),e.jsx(U.div,{initial:{opacity:0},animate:{opacity:1},children:I?e.jsxs("form",{onSubmit:O(B),className:"space-y-8",children:[e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Dati Anagrafici e Misure"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Nome*"}),e.jsx("input",{...l("firstName",{required:!0}),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Cognome*"}),e.jsx("input",{...l("lastName",{required:!0}),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Data di Nascita*"}),e.jsx("input",{type:"date",...l("birthDate",{required:!0}),className:t})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Che lavoro fai?*"}),e.jsx("input",{...l("job",{required:!0}),className:t,placeholder:"Es. Impiegato, studente..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Peso (kg)*"}),e.jsx("input",{type:"number",step:"0.1",...l("weight",{required:!0}),className:t,placeholder:"Es. 75.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Altezza (cm)*"}),e.jsx("input",{type:"number",...l("height",{required:!0}),className:t,placeholder:"Es. 180"})]})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Abitudini Alimentari"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Quanti pasti riesci a fare al giorno?*"}),e.jsxs("select",{...l("mealsPerDay",{required:!0}),className:t,children:[e.jsx("option",{value:"3",children:"3"}),e.jsx("option",{value:"4",children:"4"}),e.jsx("option",{value:"5",children:"5+"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Colazione: Dolce o Salata?*"}),e.jsxs("select",{...l("breakfastType",{required:!0}),className:t,children:[e.jsx("option",{value:"dolce",children:"Dolce"}),e.jsx("option",{value:"salato",children:"Salato"}),e.jsx("option",{value:"entrambi",children:"Entrambi/Indifferente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Alimenti che ti piacciono*"}),e.jsx("textarea",{...l("desiredFoods",{required:!0}),rows:"3",className:t,placeholder:"Elenca qui gli alimenti che vorresti nel piano..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Cosa non mangi?*"}),e.jsx("textarea",{...l("dislikedFoods",{required:!0}),rows:"2",className:t,placeholder:"Elenca qui gli alimenti da evitare..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Allergie o Intolleranze?*"}),e.jsx("input",{...l("intolerances",{required:!0}),className:t,placeholder:"Es. Lattosio, nessuna..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Problemi di digestione o gonfiore?*"}),e.jsx("input",{...l("digestionIssues",{required:!0}),className:t,placeholder:"Sì/No, e se sì quali..."})]})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Allenamento"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Quanti allenamenti a settimana?*"}),e.jsx("input",{type:"number",...l("workoutsPerWeek",{required:!0}),className:t,placeholder:"Es. 3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Dove ti alleni e con quali attrezzi?*"}),e.jsx("textarea",{...l("trainingDetails",{required:!0}),rows:"3",className:t,placeholder:"Es. Bodybuilding in palestra con macchinari e pesi liberi..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"A che ora e per quanto tempo ti alleni?*"}),e.jsx("input",{...l("trainingTime",{required:!0}),className:t,placeholder:"Es. La sera dalle 18 alle 19:30"})]})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Salute e Obiettivi"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Infortuni o problematiche fisiche?*"}),e.jsx("textarea",{...l("injuries",{required:!0}),rows:"3",className:t,placeholder:"Es. Mal di schiena, ernie, dolori articolari..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Prendi farmaci?*"}),e.jsx("input",{...l("medications",{required:!0}),className:t,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Usi integratori?*"}),e.jsx("input",{...l("supplements",{required:!0}),className:t,placeholder:"Sì/No, e se sì quali..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Scrivimi il tuo obiettivo principale*"}),e.jsx("textarea",{...l("mainGoal",{required:!0}),rows:"3",className:t,placeholder:"Descrivi in dettaglio cosa vuoi raggiungere..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:i,children:"Durata percorso scelto?*"}),e.jsx("input",{...l("programDuration",{required:!0}),className:t,placeholder:"Es. 3 mesi, 6 mesi..."})]})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Foto Iniziali"}),e.jsx("p",{className:"text-sm text-slate-400 mb-6",children:"Carica 4 foto per il check iniziale: frontale, laterale destro, laterale sinistro e posteriore. Saranno visibili solo a te e al coach."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(b,{type:"front",label:"Frontale"}),e.jsx(b,{type:"right",label:"Laterale Destro"}),e.jsx(b,{type:"left",label:"Laterale Sinistro"}),e.jsx(b,{type:"back",label:"Posteriore"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{type:"submit",disabled:P,className:"flex items-center gap-2 px-5 py-2.5 bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ae,{size:16})," ",P?"Salvataggio in corso...":"Salva Anamnesi"]})})]}):s&&e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Dati Anagrafici"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{label:"Nome",value:s.firstName}),e.jsx(r,{label:"Cognome",value:s.lastName}),e.jsx(r,{label:"Data di Nascita",value:s.birthDate}),e.jsx(r,{label:"Lavoro",value:s.job}),e.jsx(r,{label:"Peso (kg)",value:s.weight}),e.jsx(r,{label:"Altezza (cm)",value:s.height})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Abitudini Alimentari"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Pasti al giorno",value:s.mealsPerDay}),e.jsx(r,{label:"Tipo Colazione",value:s.breakfastType}),e.jsx(r,{label:"Alimenti preferiti",value:s.desiredFoods}),e.jsx(r,{label:"Alimenti da evitare",value:s.dislikedFoods}),e.jsx(r,{label:"Allergie/Intolleranze",value:s.intolerances}),e.jsx(r,{label:"Problemi di digestione",value:s.digestionIssues})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Allenamento"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Allenamenti a settimana",value:s.workoutsPerWeek}),e.jsx(r,{label:"Dettagli Allenamento",value:s.trainingDetails}),e.jsx(r,{label:"Orario e Durata",value:s.trainingTime})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Salute e Obiettivi"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(r,{label:"Infortuni o problematiche",value:s.injuries}),e.jsx(r,{label:"Farmaci",value:s.medications}),e.jsx(r,{label:"Integratori",value:s.supplements}),e.jsx(r,{label:"Obiettivo Principale",value:s.mainGoal}),e.jsx(r,{label:"Durata Percorso",value:s.programDuration})]})]}),e.jsxs("div",{className:d,children:[e.jsx("h4",{className:m,children:"Foto Iniziali"}),e.jsx(M,{urls:s.photoURLs})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs("button",{onClick:()=>p(!0),className:"flex items-center gap-2 px-5 py-2.5 bg-zinc-800 hover:bg-zinc-700 text-slate-300 rounded-lg transition font-semibold",children:[e.jsx(ie,{size:16})," Modifica Dati"]})})]})})]})};export{fe as default};
